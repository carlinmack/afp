<div id="ListSlice">
<div class="head">
<h1>Theory ListSlice</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      ListSlice.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Additional definitions and results for lists›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ListSlice
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../List-Infinite/ListInf.html">List-Infinite.ListInf</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Slicing lists into lists of lists›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ilist_slice</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ilist <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list ilist"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ilist_slice</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> map <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[</span><span class="bound">x</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">..&lt;</span>Suc <span class="bound">x</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">list_slice_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_slice_aux</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">list_slice_aux</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> take <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">#</span> <span class="free">list_slice_aux</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">↑</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_slice</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">list_slice</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> list_slice_aux <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_slice2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">list_slice2</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span>
    list_slice <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">@</span> <span class="main">(</span><span class="keyword1">if</span> length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">↑</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  No function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>list_unslice›</span></span></span></span> for finite lists is needed 
  because the corresponding functionality is already provided by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>concat›</span></span></span></span>. 
  Therefore, only a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ilist_unslice›</span></span></span></span> function for infinite lists is defined.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ilist_unslice</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list ilist <span class="main">⇒</span> <span class="tfree">'a</span> ilist"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ilist_unslice</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">mod</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> list_slice_aux_length<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> length <span class="main">(</span>list_slice_aux <span class="bound">xs</span> <span class="free">k</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_aux_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
 <span class="main">⋀</span><span class="bound">m</span> <span class="bound">xs</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span>list_slice_aux <span class="bound">xs</span> <span class="free">k</span> <span class="free">n</span><span class="main">)</span> <span class="main">!</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">(</span><span class="bound">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons' diff_mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>list_slice <span class="free">xs</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_def list_slice_aux_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_0<span class="main">:</span> <span class="quoted"><span class="quoted">"list_slice <span class="free">xs</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_1<span class="main">:</span> <span class="quoted"><span class="quoted">"list_slice <span class="free">xs</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff list_slice_def list_slice_aux_nth list_slice_aux_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_less<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> list_slice <span class="free">xs</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"list_slice <span class="main">[]</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">m</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span> list_slice <span class="free">xs</span> <span class="free">k</span> <span class="main">!</span> <span class="free">m</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_def list_slice_aux_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_nth_length<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">m</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span> length <span class="main">(</span><span class="main">(</span>list_slice <span class="free">xs</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_nth<span class="main">)</span>
<span class="keyword1"><span class="command">thm</span></span> less_div_imp_mult_add_divisor_le
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> less_div_imp_mult_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_nth_eq_sublist_list<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">m</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span> list_slice <span class="free">xs</span> <span class="free">k</span> <span class="main">!</span> <span class="free">m</span> <span class="main">=</span> sublist_list <span class="free">xs</span> <span class="main">[</span><span class="free">m</span> <span class="main">*</span> <span class="free">k</span><span class="main">..&lt;</span><span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> take_drop_eq_sublist_list<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_div_imp_mult_add_divisor_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_nth_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">m</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span>list_slice <span class="free">xs</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">m</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> list_slice_nth_length<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_nth_nth_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">(</span>list_slice <span class="free">xs</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_nth_nth div_less_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_eq_list_slice_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  list_slice <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span>length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> list_slice <span class="free">xs</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff list_slice_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_le min_eqR list_slice_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">-</span> <span class="improper">i</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Suc_leI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">-</span> <span class="improper">i</span> <span class="main">*</span> <span class="free">k</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">-</span> <span class="improper">i</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_diff_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_append_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span>
  list_slice <span class="main">(</span><span class="bound">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> list_slice <span class="bound">xs</span> <span class="free">k</span> <span class="main">@</span> list_slice <span class="free">ys</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_Nil<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_def add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span>"</span></span><span class="main"><span class="main">]</span></span> add.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_append_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
  list_slice <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> list_slice <span class="free">xs</span> <span class="free">k</span> <span class="main">@</span> list_slice <span class="free">ys</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> list_slice_append_mult <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_div_eq_1<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">⟹</span> list_slice <span class="free">xs</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span>take <span class="free">k</span> <span class="free">xs</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_div_eq_Suc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">⟹</span>
  list_slice <span class="free">xs</span> <span class="free">k</span> <span class="main">=</span> list_slice <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="main">@</span> <span class="main">[</span><span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓</span> <span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> sym<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> list_slice_append_mult<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"take <span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">xs</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"drop <span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">xs</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list_slice_div_eq_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_diff_mult_self1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_mod_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> list_slice2 <span class="free">xs</span> <span class="free">k</span> <span class="main">=</span> list_slice <span class="free">xs</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_mod_gr0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">⟹</span> list_slice2 <span class="free">xs</span> <span class="free">k</span> <span class="main">=</span> list_slice <span class="free">xs</span> <span class="free">k</span> <span class="main">@</span> <span class="main">[</span><span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span>length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_length<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="main">(</span>list_slice2 <span class="free">xs</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">if</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="keyword1">else</span> Suc <span class="main">(</span>length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def list_slice_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  list_slice2 <span class="free">xs</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="free">xs</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="main">[</span><span class="free">xs</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def list_slice_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_1<span class="main">:</span> <span class="quoted"><span class="quoted">"list_slice2 <span class="free">xs</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def list_slice_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_le<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> list_slice2 <span class="free">xs</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> length <span class="free">xs</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="main">[</span><span class="free">xs</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_le_less<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def list_slice_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def list_slice_div_eq_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"list_slice2 <span class="main">[]</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def list_slice_Nil<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_list_slice_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">m</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span> list_slice2 <span class="free">xs</span> <span class="free">k</span> <span class="main">!</span> <span class="free">m</span> <span class="main">=</span> list_slice <span class="free">xs</span> <span class="free">k</span> <span class="main">!</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def list_slice_length nth_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">;</span> <span class="free">m</span> <span class="main">=</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  list_slice2 <span class="free">xs</span> <span class="free">k</span> <span class="main">!</span> <span class="free">m</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span>length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def nth_append list_slice_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">m</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  list_slice2 <span class="free">xs</span> <span class="free">k</span> <span class="main">!</span> <span class="free">m</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def list_slice_length nth_append list_slice_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_nth_length_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">m</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span> length <span class="main">(</span>list_slice2 <span class="free">xs</span> <span class="free">k</span> <span class="main">!</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def nth_append list_slice_length list_slice_nth_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_nth_length_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">;</span> <span class="free">m</span> <span class="main">=</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  length <span class="main">(</span>list_slice2 <span class="free">xs</span> <span class="free">k</span> <span class="main">!</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_def list_slice_length nth_append minus_div_mult_eq_mod <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_nth_nth_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">m</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span>list_slice2 <span class="free">xs</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">m</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_list_slice_nth list_slice_nth_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_nth_nth_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">m</span> <span class="main">=</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span>list_slice2 <span class="free">xs</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">m</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> list_slice2_last<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_nth_nth_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="main">(</span>list_slice2 <span class="free">xs</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_slice2_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_nth_nth_eq1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_imp_le<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> less_mod_ge_imp_div_less<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"length <span class="free"><span class="free">xs</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_nth_nth_eq2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_append_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span>
  list_slice2 <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> list_slice2 <span class="free">xs</span> <span class="free">k</span> <span class="main">@</span> list_slice2 <span class="free">ys</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_slice2_def list_slice_append_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main"><span class="main">]</span></span> add_mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice2_append_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
  list_slice2 <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> list_slice2 <span class="free">xs</span> <span class="free">k</span> <span class="main">@</span> list_slice2 <span class="free">ys</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> list_slice2_append_mult <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ilist_slice_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span>ilist_slice <span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> map <span class="free">f</span> <span class="main">[</span><span class="free">m</span> <span class="main">*</span> <span class="free">k</span><span class="main">..&lt;</span>Suc <span class="free">m</span> <span class="main">*</span> <span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_slice_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ilist_slice_nth_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span>ilist_slice <span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_slice_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ilist_slice_nth_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span>ilist_slice <span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="free">m</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_slice_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ilist_slice_nth_nth_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span>ilist_slice <span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_slice_nth_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_concat<span class="main">:</span> <span class="quoted"><span class="quoted">"
  concat <span class="main">(</span>list_slice <span class="free">xs</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span>length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">xs</span> <span class="free">k</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="main">∀</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">=</span> <span class="bound">m</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="bound">xs</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">m</span></span></span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_set_conv_nth div_eq_0_conv' list_slice_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">≤</span> length <span class="improper">xs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_less_div_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_div_eq_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">xs</span> <span class="main">↓</span> <span class="main">(</span><span class="improper">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_unslice_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span> concat <span class="main">(</span>list_slice <span class="free">xs</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_Nil<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_concat<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ilist_slice_unslice<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> ilist_unslice <span class="main">(</span>ilist_slice <span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_unslice_def ilist_slice_nth_length ilist_slice_nth_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_take_ilist_slice_eq_list_slice<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> ilist_slice <span class="free">f</span> <span class="free">k</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> list_slice <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff list_slice_length ilist_slice_nth list_slice_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">-</span> <span class="improper">i</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Suc_leI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_slice_i_take_eq_i_take_ilist_slice<span class="main">:</span> <span class="quoted"><span class="quoted">"
  list_slice <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> ilist_slice <span class="free">f</span> <span class="free">k</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_take_ilist_slice_eq_list_slice<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list_slice_eq_list_slice_take<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">⇓</span></span> <span class="free"><span class="free">n</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_le min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> ilist_slice_i_append_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> 
  ilist_slice <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> list_slice <span class="free">xs</span> <span class="free">k</span> <span class="main">⌢</span> ilist_slice <span class="free">f</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff ilist_slice_nth i_append_nth list_slice_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> n i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="improper">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">-</span> <span class="improper">i</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Suc_leI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff i_append_nth min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff list_eq_iff i_append_nth linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> j<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">≤</span> <span class="improper">i</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="improper">j</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_le_add1<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> ilist_slice_append_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span> 
  ilist_slice <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> list_slice <span class="free">xs</span> <span class="free">k</span> <span class="main">⌢</span> ilist_slice <span class="free">f</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_slice_i_append_mod<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="AF_Stream">
<div class="head">
<h1>Theory AF_Stream</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      AF_Stream.thy
    Date:       Jan 2007
    Author:     David Trachtenherz
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹\textsc{AutoFocus} message streams›</span></span>

<span class="keyword1"><span class="command">theory</span></span> AF_Stream
<span class="keyword2"><span class="keyword">imports</span></span> <a href="ListSlice.html">ListSlice</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic definitions›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Time-synchronous streams›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> message_af <span class="main">=</span> NoMsg <span class="main">|</span> Msg <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>latex<span class="main">)</span>
  NoMsg  <span class="main">(</span><span class="quoted">"<span class="keyword1">\&lt;NoMsg&gt;</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Msg  <span class="main">(</span><span class="quoted">"<span class="keyword1">\&lt;Msg&gt;</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Abbreviation for finite streams›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> fstream_af <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> message_af list"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Abbreviation for infinite streams›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> istream_af <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> message_af ilist"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_NoMsg_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;Msg&gt;</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_Msg_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;Msg&gt;</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">the_af</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> message_af <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">the_af</span> <span class="main">(</span><span class="main">\&lt;Msg&gt;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  By this definition one can determine,
  whether data elements of different data structures with messages,
  especially product types of arbitrary sizes and records,
  are pointwise equal to NoMsg, i.e., contain only NoMsg entries.›</span></span>

<span class="keyword1"><span class="command">consts</span></span> is_NoMsg <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">overloading</span></span> is_NoMsg <span class="main">≡</span> <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">::</span> <span class="tfree">'a</span> message_af <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">is_NoMsg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> message_af <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_NoMsg</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_NoMsg</span> <span class="main">(</span><span class="main">\&lt;Msg&gt;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">overloading</span></span> is_NoMsg <span class="main">≡</span> <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> is_NoMsg_tuple_def  <span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">::</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>is_NoMsg <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∧</span> is_NoMsg <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">overloading</span></span> is_NoMsg <span class="main">≡</span> <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">::</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> is_NoMsg_set_def <span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> is_NoMsg <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">record</span></span> SomeRecordExample <span class="main">=</span>
  Field1 <span class="main">::</span> <span class="quoted"><span class="quoted">"nat message_af"</span></span>
  Field2 <span class="main">::</span> <span class="quoted"><span class="quoted">"int message_af"</span></span>
  Field3 <span class="main">::</span> <span class="quoted"><span class="quoted">"int message_af"</span></span>
<span class="keyword1"><span class="command">overloading</span></span> is_NoMsg <span class="main">≡</span> <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">::</span> <span class="tfree">'a</span> SomeRecordExample_scheme <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> is_NoMsg_SomeRecordExample_def <span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">::</span> <span class="tfree">'a</span> SomeRecordExample_scheme<span class="main">)</span> <span class="main">≡</span>
    Field1 <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> Field2 <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> Field3 <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_Msg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_Msg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">¬</span> is_NoMsg <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_NoMsg_message_af_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"is_NoMsg <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">m</span> <span class="keyword1">of</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⇒</span> True <span class="main">|</span> <span class="main">\&lt;Msg&gt;</span> <span class="bound">x</span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_NoMsg_message_af_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_NoMsg <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_Msg_message_af_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"is_Msg <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">m</span> <span class="keyword1">of</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⇒</span> False <span class="main">|</span> <span class="main">\&lt;Msg&gt;</span> <span class="bound">x</span> <span class="main">⇒</span> True<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_Msg_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_Msg_message_af_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_Msg <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_Msg_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Collection for definitions for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_NoMsg›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> is_NoMsg_defs

<span class="keyword1"><span class="command">declare</span></span>
  is_NoMsg_tuple_def<span class="main">[</span><span class="operator">is_NoMsg_defs</span><span class="main">]</span>
  is_NoMsg_set_def <span class="main">[</span><span class="operator">is_NoMsg_defs</span><span class="main">]</span>
  is_NoMsg_SomeRecordExample_def<span class="main">[</span><span class="operator">is_NoMsg_defs</span><span class="main">]</span>
  is_Msg_def<span class="main">[</span><span class="operator">is_NoMsg_defs</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> not_is_NoMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> is_NoMsg <span class="free">m</span><span class="main">)</span> <span class="main">=</span> is_Msg <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">is_NoMsg_defs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_is_Msg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> is_Msg <span class="free">m</span><span class="main">)</span> <span class="main">=</span> is_NoMsg <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">is_NoMsg_defs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">(</span><span class="main">\&lt;NoMsg&gt;</span><span class="main">::</span><span class="main">(</span>nat message_af<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">(</span><span class="main">\&lt;NoMsg&gt;</span><span class="main">::</span><span class="main">(</span>nat message_af<span class="main">)</span><span class="main">,</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">::</span><span class="main">(</span>nat message_af<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">is_NoMsg_defs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">(</span><span class="main">\&lt;NoMsg&gt;</span><span class="main">::</span><span class="main">(</span>nat message_af<span class="main">)</span><span class="main">,</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">::</span><span class="main">(</span>nat message_af<span class="main">)</span><span class="main">,</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">::</span><span class="main">(</span>nat message_af<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">is_NoMsg_defs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_Msg <span class="main">(</span><span class="main">\&lt;NoMsg&gt;</span><span class="main">::</span><span class="main">(</span>nat message_af<span class="main">)</span><span class="main">,</span> <span class="main">\&lt;Msg&gt;</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">,</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">::</span><span class="main">(</span>nat message_af<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">is_NoMsg_defs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">{</span><span class="main">\&lt;NoMsg&gt;</span><span class="main">::</span><span class="main">(</span>nat message_af<span class="main">)</span><span class="main">,</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">is_NoMsg_defs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_Msg <span class="main">{</span><span class="main">\&lt;NoMsg&gt;</span><span class="main">::</span><span class="main">(</span>nat message_af<span class="main">)</span><span class="main">,</span> <span class="main">\&lt;Msg&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">is_NoMsg_defs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_NoMsg <span class="main">⦇</span> Field1 <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">,</span> Field2 <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">,</span> Field3 <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">is_NoMsg_defs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_Msg  <span class="main">⦇</span> Field1 <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">,</span> Field2 <span class="main">=</span> Msg <span class="main">1</span><span class="main">,</span> Field3 <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">is_NoMsg_defs</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Time abstraction›</span></span>

<span class="comment1">(* Time abstraction:
   Extracts non-empty messages from a stream =
   time abstraction for time-synchronous streams*)</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">untime</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="comment1">(*("®_" 100)*)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">untime</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">untime</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>
     <span class="keyword1">then</span> <span class="main">(</span><span class="free">untime</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="main">(</span>the_af <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">untime</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> untime_eq_filter<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">\&lt;Msg&gt;</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>untime <span class="free">s</span><span class="main">)</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemma involves <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">the_af</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> function
  and thus is some more limited than the previous lemma›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> untime_eq_filter2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  untime <span class="free">s</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> the_af <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">untime_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">untime_length</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> length <span class="main">(</span>untime <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">untime_length_cnt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">untime_length_cnt</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">untime_length_cnt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="free">untime_length_cnt</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> untime_length_eq_untime_length_cnt<span class="main">:</span> <span class="quoted"><span class="quoted">"
  untime_length <span class="free">s</span> <span class="main">=</span> untime_length_cnt <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> untime_length_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">untime_length_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">untime_length_filter</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> untime_length_filter_eq_untime_length<span class="main">:</span> <span class="quoted"><span class="quoted">"
  untime_length_filter <span class="free">s</span> <span class="main">=</span> untime_length <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> untime_length_def untime_length_filter_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> untime_eq_filter2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> untime_empty_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>untime <span class="free">s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>length <span class="free">s</span><span class="main">.</span> <span class="free">s</span> <span class="main">!</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth.simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> untime_not_empty_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>untime <span class="free">s</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>length <span class="free">s</span><span class="main">.</span> <span class="free">s</span> <span class="main">!</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> untime_empty_conv<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> untime_empty_imp_NoMsg<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> untime <span class="free">s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">s</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> untime_empty_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> untime_nth_eq_filter<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> untime_length <span class="free">s</span> <span class="main">⟹</span>
  <span class="main">\&lt;Msg&gt;</span> <span class="main">(</span>untime <span class="free">s</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> untime_eq_filter<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> untime_length_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> untime_nth_eq_filter2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> untime_length <span class="free">s</span> <span class="main">⟹</span>
  untime <span class="free">s</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> the_af <span class="main">(</span><span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> untime_length_def untime_nth_eq_filter<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> untime_hd_eq_filter_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"
  untime <span class="free">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>
  <span class="main">\&lt;Msg&gt;</span> <span class="main">(</span>hd <span class="main">(</span>untime <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> untime_eq_filter<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> hd_eq_first<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> untime_hd_eq_filter_hd2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  untime <span class="free">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>
  hd <span class="main">(</span>untime <span class="free">s</span><span class="main">)</span> <span class="main">=</span> the_af <span class="main">(</span>hd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> untime_hd_eq_filter_hd<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> untime_last_eq_filter_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  untime <span class="free">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>
  <span class="main">\&lt;Msg&gt;</span> <span class="main">(</span>last <span class="main">(</span>untime <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> last <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> untime_eq_filter<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> last_nth<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> untime_last_eq_filter_last2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  untime <span class="free">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>
  last <span class="main">(</span>untime <span class="free">s</span><span class="main">)</span> <span class="main">=</span> the_af <span class="main">(</span>last <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> untime_last_eq_filter_last<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Expanding and compressing lists and streams›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Expanding message streams›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">f_expand</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> fstream_af"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span>"</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  f_expand_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="keyword1"><span class="free">⊙<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> f_expand_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊙<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">@</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1"><span class="free">⊙<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_expand</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream_af <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> istream_af"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span>"</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">i_expand</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">f</span> <span class="bound">k</span> <span class="bound">n</span><span class="main">.</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="bound">n</span> <span class="keyword1">mod</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">f_expand_Suc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> fstream_af"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊙<span class="hidden">⇘</span><sub>fSuc</sub><span class="hidden">⇙</span></span>"</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">f_expand_Suc</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f_expand_Suc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">k</span></span></span></sup><span class="hidden">⇖</span> <span class="main">@</span> <span class="main">(</span><span class="free">f_expand_Suc</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_expand_Suc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream_af <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> istream_af"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊙<span class="hidden">⇘</span><sub>iSuc</sub><span class="hidden">⇙</span></span>"</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_expand_Suc</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">f</span> <span class="bound">k</span> <span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="keyword1">mod</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  f_expand  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊙</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  i_expand  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊙</span>"</span> 100<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> length_f_expand_Suc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>f_expand_Suc <span class="free">xs</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">*</span> Suc <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="keyword1">else</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_def ilist_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">a</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> f_expand_0_is_zero_element<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="free">ys</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> i_expand_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_def<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> i_expand_0_is_zero_element<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_gr0_f_expand_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> f_expand_Suc <span class="free">xs</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_expand_gr0_i_expand_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> i_expand_Suc <span class="free">f</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_def i_expand_Suc_def ilist_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_expand_gr0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_if<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> f_expand_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_expand_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_gr0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_length<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">*</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_expand_gr0_f_expand_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_empty_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> f_expand_not_empty_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_expand_empty_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">@</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> f_expand_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ys</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="bound">ys</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="bound">ys</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="free">x</span> <span class="main">#</span> replicate <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_nth_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span>
  <span class="main">⟦</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="bound">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append append_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_nth_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_gr0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_nth_if<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span>
  <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_expand_nth_mult mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append append_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="improper">xs</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> diff_less_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mod_diff_self2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_expand_nth_mod_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_expand_nth_if<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_expand_nth_mod_neq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_expand_nth_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_nth_0_upto_k_minus_1_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span> <span class="free">n</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">i</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_expand_nth_if<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Suc_leI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> f_expand_take_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff min_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="improper">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_less_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_expand_nth_if <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_take_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> f_expand_take_mult <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_drop_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> append_take_drop_id<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="keyword1"><span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> append_take_drop_id<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="keyword1"><span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_expand_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_expand_take_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_drop_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> f_expand_drop_mult <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_take_mult_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">i</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="free">i</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Suc_leI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free">n</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff min_eqR nth_append f_expand_nth_if min_def nth_Cons' <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ka</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_neq_implies_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ka</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Suc_leI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ka</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_take_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> f_expand_take_mult_Suc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_less_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_nth_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_gr0<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> i_expand_nth_mod_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_gr0<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> i_expand_nth_mod_neq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_gr0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_nth_0_upto_k_minus_1_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">i</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_nth_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_i_take_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff i_expand_nth_if f_expand_nth_if <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_i_take_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> i_expand_i_take_mult <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_i_drop_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_expand_nth_if<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_i_drop_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇑</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> i_expand_i_drop_mult <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_i_take_mult_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">i</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_expand_nth_if f_expand_nth_if nth_append nth_Cons' <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ka</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_neq_implies_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ka</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Suc_leI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ka</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_i_take_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> i_expand_i_take_mult_Suc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_nth_interval_eq_nth_append_replicate_NoMsg<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">t1</span><span class="main">;</span> <span class="free">t1</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↓</span> Suc <span class="free">t1</span> <span class="main">↑</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">t</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="free">t1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="main">(</span><span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_expand_take_mult_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_nth_interval_eq_replicate_NoMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">t1</span><span class="main">;</span> <span class="free">t1</span> <span class="main">≤</span> <span class="free">t2</span><span class="main">;</span> <span class="free">t2</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span><span class="main">;</span> <span class="free">t2</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">*</span> <span class="free">k</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↓</span> <span class="free">t2</span> <span class="main">↑</span> <span class="free">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">t2</span> <span class="main">-</span> <span class="free">t1</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff min_eqR f_expand_nth_if <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i q<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> add_less_mono2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trans_less_add1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">+</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_mod_eq_imp_add_divisor_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> i_expand_nth_interval_eq_nth_append_replicate_NoMsg<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">t1</span><span class="main">;</span> <span class="free">t1</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="free">t1</span> <span class="main">↑</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">t</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff Suc_diff_le i_expand_nth_if nth_Cons'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_nth_interval_eq_replicate_NoMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">t1</span><span class="main">;</span> <span class="free">t1</span> <span class="main">≤</span> <span class="free">t2</span><span class="main">;</span> <span class="free">t2</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> <span class="free">t2</span> <span class="main">↑</span> <span class="free">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">t2</span> <span class="main">-</span> <span class="free">t1</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff i_expand_nth_if add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> add_less_mono2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trans_less_add1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">+</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_mod_eq_imp_add_divisor_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> f_expand_replicate_NoMsg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span>  <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span> <span class="main">*</span> <span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_expand_nth_if <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_const_NoMsg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_def ilist_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">a</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">b</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> replicate_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> diff_mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">a</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_expand_def ilist_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">a</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">b</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">b</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_expand_assoc mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">a</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">b</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_assoc mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> i_expand_i_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_expand_gr0 i_append_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> div_less_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_expand_nth_if<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_diff_mult_self1 div_diff_mult_self1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">ys</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_expand_nth_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">g</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">=</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_nth_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_eq_conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">xs'</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span>length <span class="free">xs'</span> <span class="main">*</span> <span class="free">k</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">xs'</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_expand_nth_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_expand_eq_conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f'</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">f'</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_expand_nth_if<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Aggregating lists›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_aggregate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_aggregate</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">ag</span></span></span> <span class="main">≡</span> map <span class="free"><span class="bound"><span class="entity">ag</span></span></span> <span class="main">(</span>list_slice <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_aggregate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ilist <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> ilist"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_aggregate</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">ag</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ag</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⇑</span> <span class="main">(</span><span class="bound">n</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">⇓</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"f_aggregate <span class="free">xs</span> <span class="main">0</span> <span class="free">ag</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_def list_slice_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">ag</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
  f_aggregate <span class="free">xs</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">ag</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_aggregate_def list_slice_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"f_aggregate <span class="main">[]</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_def list_slice_Nil<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_length<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_def list_slice_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_empty_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span>f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> div_eq_0_conv' <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_0_conv <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_one<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> <span class="main">[</span><span class="free">ag</span> <span class="free">xs</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_def list_slice_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> <span class="free">ag</span> <span class="free">xs</span> <span class="main">#</span> <span class="main">(</span>f_aggregate <span class="free">ys</span> <span class="free">k</span> <span class="free">ag</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_def list_slice_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_eq_f_aggregate_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span>length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_def list_slice_eq_list_slice_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">(</span>f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ag</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_def list_slice_length list_slice_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_nth_eq_sublist_list<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">(</span>f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ag</span> <span class="main">(</span>sublist_list <span class="free">xs</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">..&lt;</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> less_div_imp_mult_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_nth take_drop_eq_sublist_list<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_take_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">xs</span> <span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="bound">xs</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">m</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span><span class="bound">xs</span> <span class="main">↓</span> <span class="bound">m</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> f_aggregate <span class="bound">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_nth drop_take<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_div_imp_mult_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  hd <span class="main">(</span>f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span><span class="main">)</span> <span class="main">=</span> <span class="free">ag</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_le_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hd_eq_first<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_append_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span>
  f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">@</span> f_aggregate <span class="free">ys</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_def list_slice_append_mod<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_append_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span>
  f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">@</span> f_aggregate <span class="free">ys</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> length <span class="free">ys</span> <span class="main">=</span> <span class="free">k</span><span class="main">;</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">@</span> <span class="main">[</span><span class="free">ag</span> <span class="free">ys</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_append_mod f_aggregate_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqL div_le_mono f_aggregate_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> linorder_not_le min_eqR div_le_mono f_aggregate_nth drop_take<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> less_div_imp_mult_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_less_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_imp_le<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_take_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_drop_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">↑</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff div_diff_mult_self1 f_aggregate_nth add_mult_distrib add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_drop_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> f_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> f_aggregate_drop_mult <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">ag</span> <span class="main">(</span>f_aggregate <span class="bound">xs</span> <span class="free">a</span> <span class="free">ag</span><span class="main">)</span> <span class="main">=</span> <span class="free">ag</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span>f_aggregate <span class="free">xs</span> <span class="free">a</span> <span class="free">ag</span><span class="main">)</span> <span class="free">b</span> <span class="free">ag</span> <span class="main">=</span> f_aggregate <span class="free">xs</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff div_mult2_eq f_aggregate_nth<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_drop f_aggregate_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib2 mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span> f_aggregate_drop_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="improper">i</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">↑</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="improper">i</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="improper">i</span> <span class="main">*</span> <span class="free">b</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult2_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_div_imp_mult_add_divisor_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_aggregate_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">ag</span> <span class="main">(</span>f_aggregate <span class="bound">xs</span> <span class="free">a</span> <span class="free">ag</span><span class="main">)</span> <span class="main">=</span> <span class="free">ag</span> <span class="bound">xs</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="keyword1">mod</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">ag</span> <span class="main">(</span>f_aggregate <span class="bound">xs</span> <span class="free">b</span> <span class="free">ag</span><span class="main">)</span> <span class="main">=</span> <span class="free">ag</span> <span class="bound">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span>f_aggregate <span class="free">xs</span> <span class="free">a</span> <span class="free">ag</span><span class="main">)</span> <span class="free">b</span> <span class="free">ag</span> <span class="main">=</span> f_aggregate <span class="main">(</span>f_aggregate <span class="free">xs</span> <span class="free">b</span> <span class="free">ag</span><span class="main">)</span> <span class="free">a</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_assoc mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"i_aggregate <span class="free">f</span> <span class="main">0</span> <span class="free">ag</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">ag</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">ag</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> i_aggregate <span class="free">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">ag</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_def i_take_first<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"i_aggregate <span class="free">f</span> <span class="free">k</span> <span class="free">ag</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ag</span> <span class="main">(</span><span class="free">f</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">⇓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"i_aggregate <span class="free">f</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">0</span> <span class="main">=</span> <span class="free">ag</span> <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_nth_eq_map<span class="main">:</span> <span class="quoted"><span class="quoted">"i_aggregate <span class="free">f</span> <span class="free">k</span> <span class="free">ag</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ag</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">..&lt;</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_nth i_take_drop_eq_map<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_i_append_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">⌢</span> i_aggregate <span class="free">f</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_aggregate_nth i_append_nth f_aggregate_nth mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> diff_mult_distrib <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i n<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Suc_leI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_i_append_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> f_aggregate <span class="free">xs</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">⌢</span> i_aggregate <span class="free">f</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i_aggregate_i_append_mod<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> <span class="main">[</span><span class="free">ag</span> <span class="free">xs</span><span class="main">]</span> <span class="main">⌢</span> <span class="main">(</span>i_aggregate <span class="free">f</span> <span class="free">k</span> <span class="free">ag</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> i_aggregate_i_append_mod<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ag</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_def list_slice_div_eq_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_take_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span> f_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="free">m</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> i_aggregate <span class="free">f</span> <span class="free">k</span> <span class="free">ag</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_nth i_aggregate_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> less_div_imp_mult_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_take_drop_map i_take_drop_eq_map take_map<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_i_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> i_aggregate <span class="free">f</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff i_aggregate_take_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_i_take_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> f_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> i_aggregate <span class="free">f</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">⇓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_i_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_i_drop_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> i_aggregate <span class="free">f</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">⇑</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_aggregate_nth add_mult_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_i_drop_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span> i_aggregate <span class="free">f</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> i_aggregate_i_drop_mult ilist_eq_iff <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">a</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">ag</span> <span class="main">(</span>f_aggregate <span class="bound">xs</span> <span class="free">a</span> <span class="free">ag</span><span class="main">)</span> <span class="main">=</span> <span class="free">ag</span> <span class="bound">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span>i_aggregate <span class="free">f</span> <span class="free">a</span> <span class="free">ag</span><span class="main">)</span> <span class="free">b</span> <span class="free">ag</span> <span class="main">=</span> i_aggregate <span class="free">f</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_aggregate_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_i_drop_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_aggregate_i_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span> mult.assoc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_aggregate_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">a</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">ag</span> <span class="main">(</span>f_aggregate <span class="bound">xs</span> <span class="free">a</span> <span class="free">ag</span><span class="main">)</span> <span class="main">=</span> <span class="free">ag</span> <span class="bound">xs</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="keyword1">mod</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">ag</span> <span class="main">(</span>f_aggregate <span class="bound">xs</span> <span class="free">b</span> <span class="free">ag</span><span class="main">)</span> <span class="main">=</span> <span class="free">ag</span> <span class="bound">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span>i_aggregate <span class="free">xs</span> <span class="free">a</span> <span class="free">ag</span><span class="main">)</span> <span class="free">b</span> <span class="free">ag</span> <span class="main">=</span> i_aggregate <span class="main">(</span>i_aggregate <span class="free">xs</span> <span class="free">b</span> <span class="free">ag</span><span class="main">)</span> <span class="free">a</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_assoc mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Compressing message streams›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Determines the last non-empty message.›</span></span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">last_message</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> <span class="tfree">'a</span> message_af"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">last_message</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">last_message</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">last_message</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="free">last_message</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_shrink</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> fstream_af"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span>"</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_shrink</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> f_aggregate <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> last_message"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_shrink</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream_af <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> istream_af"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span>"</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_shrink</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> i_aggregate <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> last_message"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  f_shrink  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">÷</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  i_shrink  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">÷</span>"</span> 100<span class="main">)</span>


<span class="keyword1"><span class="command">lemmas</span></span> f_shrink_defs <span class="main">=</span> f_shrink_def f_aggregate_def
<span class="keyword1"><span class="command">lemmas</span></span> i_shrink_defs <span class="main">=</span> i_shrink_def i_aggregate_def

<span class="keyword1"><span class="command">lemma</span></span> last_message_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"last_message <span class="main">[]</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_one<span class="main">:</span> <span class="quoted"><span class="quoted">"last_message <span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> last_message_replicate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> last_message <span class="main">(</span><span class="free">m</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_replicate_NoMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"last_message <span class="main">(</span><span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_replicate<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_Cons_NoMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"last_message <span class="main">(</span><span class="main">\&lt;NoMsg&gt;</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> last_message <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_append_one<span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">then</span> last_message <span class="free">xs</span> <span class="keyword1">else</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span>
  last_message <span class="main">(</span><span class="bound">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">if</span> last_message <span class="free">ys</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">then</span> last_message <span class="bound">xs</span> <span class="keyword1">else</span> last_message <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">xs</span> <span class="main">@</span> <span class="main">[</span><span class="improper">a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_append_one<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> last_message_append_replicate_NoMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> last_message <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_append last_message_replicate_NoMsg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_replicate_NoMsg_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message <span class="main">(</span><span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> last_message <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_append last_message_replicate_NoMsg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_NoMsg_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span>last_message <span class="free">xs</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_not_NoMsg_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span>last_message <span class="free">xs</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_NoMsg_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_NoMsg_imp_last_message<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span> last_message <span class="free">xs</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> last_message_not_NoMsg_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> exI<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> conjI<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_exists_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message <span class="free">xs</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> last_message <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a xs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"last_message <span class="improper">xs</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> j<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_NoMsg_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_exists_nth'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message <span class="free">xs</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> last_message <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> last_message_exists_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_messageI2_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span>
  <span class="main">⟦</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  last_message <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="improper">xs</span> <span class="main">⟶</span> <span class="improper">xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_NoMsg_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_NoMsg_imp_last_message<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="improper">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="improper">xs</span> <span class="main">⟶</span> <span class="improper">xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_messageI2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="bound">j</span><span class="main">;</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  last_message <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> last_messageI2_aux<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_messageI<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">m</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="bound">j</span><span class="main">;</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  last_message <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> last_messageI2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_Msg_eq_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> last <span class="free">xs</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span> last_message <span class="free">xs</span> <span class="main">=</span> last <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_nth last_messageI2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟹</span>
  <span class="main">(</span>last_message <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">xs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> last_message_exists_nth<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> last_messageI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_conv_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span>last_message <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">then</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>
   <span class="keyword1">else</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_NoMsg_conv last_message_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_not_NoMsg_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> last_message <span class="free">xs</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> last_message <span class="free">ys</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>last_message <span class="free">xs</span> <span class="main">=</span> last_message <span class="free">ys</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">ys</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span>
         <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>length <span class="free">ys</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_conv<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"last_message <span class="free">ys</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> last_message_exists_nth<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> last_message_exists_nth<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ys</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i j<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">j</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i1 j1 i j<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"last_message <span class="free">ys</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="improper">j</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> last_messageI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_defs list_slice_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def list_slice_Nil<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_empty_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_empty_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> last_message <span class="free">xs</span> <span class="main">#</span> <span class="main">(</span><span class="free">ys</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_one<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span>last_message <span class="free">xs</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_one<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_shrink_eq_f_shrink_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span>length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_defs list_slice_eq_list_slice_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> last_message <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_nth_eq_sublist_list<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> last_message <span class="main">(</span>sublist_list <span class="free">xs</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">..&lt;</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_nth_eq_sublist_list<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_take_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_take_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span> hd <span class="main">(</span><span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> last_message <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_hd<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_append_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="main">(</span><span class="free">ys</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_defs list_slice_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_append_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="main">(</span><span class="free">ys</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> length <span class="free">ys</span> <span class="main">=</span> <span class="free">k</span><span class="main">;</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="main">[</span>last_message <span class="free">ys</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_append_mod f_shrink_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_message<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> last_message <span class="main">(</span><span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> last_message <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> append_constant_length_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_Cons last_message_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_replicate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">m</span><span class="hidden">⇗</span><sup><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_empty_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_shrink_length f_shrink_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> last_message_replicate<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_less_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_f_expand_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_length f_shrink_nth f_expand_drop_mult f_expand_take_mod drop_take_1 last_message_replicate_NoMsg<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_expand_f_shrink_id_take<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span>length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> append_constant_length_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_empty_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_mp<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"length <span class="improper">xs</span> <span class="main">+</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_append_mod<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> replicate <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff nth_Cons'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_shrink_length f_expand_nth_if f_shrink_nth last_message_replicate_NoMsg nth_Cons'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_expand_f_shrink_id_mod_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_expand_f_shrink_id_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_take_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_take_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_drop_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↑</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_drop_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_drop_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_aggregate_drop_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span> <span class="main">=</span> <span class="free">ys</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span>length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k1</span> <span class="main">=</span> length <span class="free">ys</span> <span class="keyword1">div</span> <span class="free">k2</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k1</span><span class="main">.</span>
      last_message <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="free">k1</span><span class="main">)</span> <span class="main">↓</span> <span class="free">k1</span><span class="main">)</span> <span class="main">=</span> last_message <span class="main">(</span><span class="free">ys</span> <span class="main">↑</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="free">k2</span><span class="main">)</span> <span class="main">↓</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span> length_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_shrink_length <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_shrink_empty_conv div_eq_0_conv'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_shrink_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> all_imp_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_eq_conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">xs'</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span>length <span class="free">xs'</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span>
      <span class="keyword1">if</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">xs'</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">xs'</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">xs'</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_shrink_length <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> all_imp_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_div_imp_mult_add_divisor_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"length <span class="free"><span class="free">xs'</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_shrink_nth last_message_conv_if min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ex_imp_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">a</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">b</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> f_shrink_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_aggregate_assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> f_shrink_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_shrink_last_message<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">a</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">b</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">b</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_assoc mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_defs<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_shrink_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_def i_aggregate_1<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_shrink_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> last_message <span class="main">(</span><span class="free">f</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">⇓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_defs<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_shrink_nth_eq_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> last_message <span class="main">(</span>map <span class="free">f</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">..&lt;</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_def i_aggregate_nth_eq_map<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_shrink_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> last_message <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_i_append_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def i_shrink_def i_aggregate_i_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_i_append_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_i_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span>last_message <span class="free">xs</span><span class="main">]</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def i_shrink_def i_aggregate_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_take_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def i_shrink_def i_aggregate_take_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_shrink_nth last_message_replicate<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_const_NoMsg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_i_expand_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_shrink_nth i_expand_i_drop_mult i_expand_i_take_mod i_drop_i_take_1 last_message_replicate_NoMsg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_i_take_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def i_shrink_def i_aggregate_i_take_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_i_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">f</span> <span class="main">⇓</span> <span class="free">n</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def i_shrink_def i_aggregate_i_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_i_drop_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇑</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def i_shrink_def i_aggregate_i_drop_mult<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_shrink_i_drop_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def i_shrink_def i_aggregate_i_drop_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k1</span> <span class="main">=</span> <span class="free">g</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> last_message <span class="main">(</span><span class="free">f</span> <span class="main">⇑</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="free">k1</span><span class="main">)</span> <span class="main">⇓</span> <span class="free">k1</span><span class="main">)</span> <span class="main">=</span>
       last_message <span class="main">(</span><span class="free">g</span> <span class="main">⇑</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="free">k2</span><span class="main">)</span> <span class="main">⇓</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_shrink_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">f'</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">then</span> <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>
       <span class="keyword1">else</span> <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">f'</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> all_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="improper">i</span> <span class="main">=</span> NoMsg"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_NoMsg_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">a</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> i_shrink_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_aggregate_assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> f_shrink_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_message<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">a</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">b</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_assoc mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Holding last messages in everly cycle of a stream›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">last_message_hold_init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> <span class="tfree">'a</span> message_af <span class="main">⇒</span> <span class="tfree">'a</span> fstream_af"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">last_message_hold_init</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">last_message_hold_init</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">#</span>
    <span class="main">(</span><span class="free">last_message_hold_init</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">last_message_hold</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> <span class="tfree">'a</span> fstream_af"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">last_message_hold</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> last_message_hold_init <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_init_length<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> length <span class="main">(</span>last_message_hold_init <span class="free">xs</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_init_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">i</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span>
  <span class="main">(</span>last_message_hold_init <span class="free">xs</span> <span class="bound">m</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> last_message <span class="main">(</span><span class="bound">m</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">↓</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_init_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message_hold_init <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span>
  last_message_hold_init <span class="free">xs</span> <span class="free">m</span> <span class="main">@</span>
    <span class="main">[</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">then</span> last_message <span class="main">(</span><span class="free">m</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">x</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff nth_append last_message_hold_init_nth last_message_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_init_append<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">xs</span> <span class="bound">m</span><span class="main">.</span> last_message_hold_init <span class="main">(</span><span class="bound">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="bound">m</span> <span class="main">=</span>
  last_message_hold_init <span class="bound">xs</span> <span class="bound">m</span> <span class="main">@</span> last_message_hold_init <span class="free">ys</span> <span class="main">(</span>last_message <span class="main">(</span><span class="bound">m</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> append_eq_Cons<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> append_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_hold_init_snoc last_message_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_length<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>last_message_hold <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_hold_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"last_message_hold <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_hold_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_one<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"last_message_hold <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_hold_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> last_message_hold <span class="free">xs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> last_message <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> Suc <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_hold_def last_message_hold_init_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> last <span class="main">(</span>last_message_hold <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> last_message <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"last_message_hold <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_nth last_message_hold_nth length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message_hold <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> last_message_hold <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff last_message_hold_nth min_eqL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message_hold <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
  last_message_hold <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">then</span> last_message <span class="free">xs</span> <span class="keyword1">else</span> <span class="free">x</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_hold_def last_message_hold_init_snoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message_hold <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span>
  last_message_hold <span class="free">xs</span> <span class="main">@</span> last_message_hold_init <span class="free">ys</span> <span class="main">(</span>last_message <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_hold_def last_message_hold_init_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_append'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message_hold <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span>
  last_message_hold <span class="free">xs</span> <span class="main">@</span> tl <span class="main">(</span>last_message_hold <span class="main">(</span>last_message <span class="free">xs</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_hold_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_hold_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_last_message_hold<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message <span class="main">(</span>last_message_hold <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> last_message <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_hold_snoc last_message_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_hold_idem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message_hold <span class="main">(</span>last_message_hold <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> last_message_hold <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff last_message_hold_nth last_message_hold_take<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Returns for each point in time the currently last non-empty message
  of the current stream cycle of length <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>k›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_last_message_hold</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> fstream_af"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span>"</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_last_message_hold</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> concat <span class="main">(</span>map last_message_hold <span class="main">(</span>list_slice2 <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_last_message_hold</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream_af <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> istream_af"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span>"</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_last_message_hold</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> last_message <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⇑</span> <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="bound">n</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">⇓</span> Suc <span class="main">(</span><span class="bound">n</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  f_last_message_hold  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⟼</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  i_last_message_hold  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⟼</span>"</span> 100<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">0</span> <span class="main">=</span> last_message_hold <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_def list_slice2_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_def list_slice2_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_def list_slice2_Nil<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_length<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> append_constant_length_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_slice2_append_mod list_slice2_mod_0 list_slice_div_eq_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_le<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> last_message_hold <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_def list_slice2_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_append_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="main">(</span><span class="free">ys</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_def list_slice2_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_append_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="main">(</span><span class="free">ys</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_def list_slice2_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_nth<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">!</span> <span class="bound">n</span> <span class="main">=</span> last_message <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓</span> Suc <span class="main">(</span><span class="bound">n</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_hold_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> append_constant_length_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_def list_slice2_le last_message_hold_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_append_mod nth_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_def list_slice2_mod_0 list_slice_div_eq_1 last_message_hold_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">n</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less last_message_append div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> <span class="improper">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">≤</span> <span class="improper">n</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_diff_self2 add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_take<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_last_message_hold_nth drop_take div_mult_cancel min_eqL<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_drop_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> append_take_drop_id<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_append_mod min_eqR <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_take_drop_id<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_drop_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↑</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> f_last_message_hold_drop_mult <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_last_message_hold_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_last_message_hold_nth f_last_message_hold_drop_mod<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_last_message_hold_take<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_le min.coboundedI2 Suc_mod_le_divisor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_nth_eq_f_last_message_hold_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> last <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_nth f_last_message_hold_drop_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_last_message_hold_take<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> less_div_imp_mult_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_le last_message_hold_last<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_nth_eq_f_last_message_hold_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_nth_eq_f_last_message_hold_last<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> less_div_imp_mult_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_nth min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_message_f_last_message_hold<span class="main">:</span> <span class="quoted"><span class="quoted">"
  last_message <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> last_message <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> append_constant_length_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_last_message_hold_append_mult last_message_append f_last_message_hold_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_last_message_hold_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> last_message <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_last_message_hold_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_last_message_hold_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_last_message_hold_def i_drop_i_take_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_last_message_hold_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> last_message <span class="main">(</span><span class="free">f</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span> <span class="main">⇓</span> Suc <span class="main">(</span><span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_last_message_hold_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_last_message_hold_i_append_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_last_message_hold_nth i_append_nth f_last_message_hold_nth div_mult_cancel linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="improper">x</span> <span class="main">-</span> <span class="improper">x</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_diff_mult_self1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">-</span> <span class="improper">x</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> add_le_mono1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_last_message_hold_i_append_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_last_message_hold_i_append_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_last_message_hold_i_take<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⇓</span> <span class="free">n</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">⇓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_last_message_hold_nth i_last_message_hold_nth div_mult_cancel i_take_drop min_eqR<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_last_message_hold_i_drop_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">f</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_last_message_hold_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_last_message_hold_i_drop_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇑</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_last_message_hold_i_drop_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_last_message_hold_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_last_message_hold_nth minus_mod_eq_mult_div i_last_message_hold_i_drop_mod<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_last_message_hold_i_take<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> last_message_f_last_message_hold<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_nth_eq_i_last_message_hold_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_nth i_last_message_hold_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_add_assoc <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_diff_assoc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_nth_eq_i_last_message_hold_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> last <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">⇓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_nth i_shrink_nth_eq_i_last_message_hold_nth<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Compressing lists›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lists/Non-message streams
  do not have to permit the empty message <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>\&lt;NoMsg&gt;›</span></span></span></span>
  to be element.
  Thus, they are compressed by factor <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  by just aggregating every sequence of length k
  to its last element.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_shrink_last</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span></span>"</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_shrink_last</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> f_aggregate <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> last"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_shrink_last</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ilist <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> ilist"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span></span>"</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_shrink_last</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> i_aggregate <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> last"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  f_shrink_last  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">÷<span class="hidden">⇩</span><sub>l</sub></span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  i_shrink_last  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">÷<span class="hidden">⇩</span><sub>l</sub></span>"</span> 100<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def f_aggregate_def list_slice_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def f_aggregate_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def f_aggregate_def list_slice_Nil<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_empty_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def f_aggregate_empty_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
 length <span class="free">xs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> last <span class="free">xs</span> <span class="main">#</span> <span class="main">(</span><span class="free">ys</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def f_aggregate_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_one<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span>last <span class="free">xs</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def f_aggregate_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_eq_f_shrink_last_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span>length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def f_aggregate_eq_f_aggregate_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> less_div_imp_mult_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def f_aggregate_nth last_take2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_shrink_last_nth'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_nth add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span> hd <span class="main">(</span><span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def f_aggregate_hd last_take2<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> map <span class="free">f</span> <span class="main">(</span><span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_shrink_last_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> less_div_imp_mult_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_append_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">@</span> <span class="main">(</span><span class="free">ys</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def f_aggregate_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_append_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">@</span> <span class="main">(</span><span class="free">ys</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> f_shrink_last_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_aggregate_append_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> length <span class="free">ys</span> <span class="main">=</span> <span class="free">k</span><span class="main">;</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">@</span> <span class="main">[</span>last <span class="free">ys</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_append_mod f_shrink_last_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> last <span class="main">(</span><span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> last <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> append_take_drop_id<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"length <span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_shrink_last_snoc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqR mod_diff_self2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_replicate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">m</span><span class="hidden">⇗</span><sup><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_shrink_last_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> less_div_imp_mult_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> f_shrink_last_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_aggregate_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_take_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> f_shrink_last_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_aggregate_take_mult<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_drop_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">↑</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> f_shrink_last_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_aggregate_drop_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_drop_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> f_shrink_last_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_aggregate_drop_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">a</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">b</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> f_shrink_last_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_aggregate_assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> f_shrink_last_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_shrink_last_last<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_last_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">a</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">b</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">b</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_assoc mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_last_def i_aggregate_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span>  <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_last_def i_aggregate_nth last_i_take2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_nth'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span>  <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_last_nth add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> last <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_last_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_last_nth last_i_take2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> <span class="main">∘</span> <span class="main">(</span><span class="free">g</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_shrink_last_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_i_append_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def i_shrink_last_def i_aggregate_i_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_i_append_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_last_i_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span>last <span class="free">xs</span><span class="main">]</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def i_shrink_last_def i_aggregate_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_shrink_last_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_i_take_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">⇓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def i_shrink_last_def i_aggregate_i_take_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_i_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">f</span> <span class="main">⇓</span> <span class="free">n</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def i_shrink_last_def i_aggregate_i_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_i_drop_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">⇑</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def i_shrink_last_def i_aggregate_i_drop_mult<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_i_drop_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⇑</span> <span class="free">n</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_def i_shrink_last_def i_aggregate_i_drop_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">a</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">b</span> <span class="main">=</span> <span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> i_shrink_last_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_assoc f_shrink_last_last<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> f_shrink_last_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_last_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">a</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">b</span> <span class="main">=</span> <span class="free">f</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">b</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_last_assoc mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Shrinking a message stream with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>last_message›</span></span></span></span> as aggregation function
  corresponds to shrinking the stream holding last message in each cycle
  with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>last›</span></span></span></span> as aggregation function.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_shrink_eq_f_last_message_hold_shrink_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_shrink_length f_shrink_last_length f_shrink_nth_eq_f_last_message_hold_nth f_shrink_last_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_i_last_message_hold_shrink_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_shrink_last_nth i_shrink_nth_eq_i_last_message_hold_nth<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="AF_Stream_Exec">
<div class="head">
<h1>Theory AF_Stream_Exec</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      AF_Stream_Exec.thy
    Date:       Dec 2006
    Author:     David Trachtenherz
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Processing of message streams›</span></span>

<span class="keyword1"><span class="command">theory</span></span> AF_Stream_Exec
<span class="keyword2"><span class="keyword">imports</span></span> <a href="AF_Stream.html">AF_Stream</a> <span class="quoted">"<a href="../List-Infinite/ListInf_Prefix.html">List-Infinite.ListInf_Prefix</a>"</span> <span class="quoted">"<a href="../List-Infinite/SetIntervalStep.html">List-Infinite.SetIntervalStep</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Executing components with state transition functions›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Function type for functions converting
  an input value to an input port message for a component›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'in</span><span class="main">)</span> Port_Input_Value <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'in</span> message_af"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Function type for functions extracting
  the output value of a single output port from
  a component value›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> Port_Output_Value <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'out</span> message_af"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Function type for functions extracting
  the local state of a component from
  a component value›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> Comp_Local_State <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'state</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Function type for transition functions
  computing the component's value after processing
  an input for a single time unit›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span><span class="main">)</span> Comp_Trans_Fun <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'input</span> <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'comp</span>"</span></span>


<span class="comment1">― ‹Execute a component for all inputs in the input stream <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"<span class="tfree">'input</span> list"</span><span class="antiquote">}</span></span>›</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">f_Exec_Comp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span><span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span> <span class="tfree">'input</span> list <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'comp</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  f_Exec_Nil<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">f_Exec_Comp</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> f_Exec_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f_Exec_Comp</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="free">f_Exec_Comp</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹Execute the component for at most n steps›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_Exec_Comp_N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span><span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'input</span> list <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'comp</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_Exec_Comp_N</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> f_Exec_Comp <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="comment1">― ‹Produce the component stream for all inputs in the input stream›</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">f_Exec_Comp_Stream</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span><span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span> <span class="tfree">'input</span> list <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'comp</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  f_Exec_Stream_Nil<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">f_Exec_Comp_Stream</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> f_Exec_Stream_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f_Exec_Comp_Stream</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span> <span class="free">f_Exec_Comp_Stream</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">f_Exec_Comp_Stream_Init</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span><span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span> <span class="tfree">'input</span> list <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'comp</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  f_Exec_Stream_Init_Nil<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">f_Exec_Comp_Stream_Init</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span>"</span></span>
<span class="main">|</span> f_Exec_Stream_Init_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f_Exec_Comp_Stream_Init</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
    <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">#</span> <span class="main">(</span> <span class="free">f_Exec_Comp_Stream_Init</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_Exec_Comp_Stream</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span><span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span> <span class="tfree">'input</span> ilist <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'comp</span> ilist"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_Exec_Comp_Stream</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">trans_fun</span> <span class="bound">input</span> <span class="bound">c</span> <span class="bound">n</span><span class="main">.</span> f_Exec_Comp <span class="bound">trans_fun</span> <span class="main">(</span><span class="bound">input</span> <span class="main">⇓</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_Exec_Comp_Stream_Init</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span><span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span> <span class="tfree">'input</span> ilist <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'comp</span> ilist"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_Exec_Comp_Stream_Init</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">trans_fun</span> <span class="bound">input</span> <span class="bound">c</span> <span class="bound">n</span><span class="main">.</span> f_Exec_Comp <span class="bound">trans_fun</span> <span class="main">(</span><span class="bound">input</span> <span class="main">⇓</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic results›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_one<span class="main">:</span> <span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="free">c</span> <span class="main">=</span> <span class="free">trans_fun</span> <span class="free">m</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_length<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> length <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_empty_conv<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_not_empty_conv<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_empty_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_eq_f_Exec_Stream_last<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span> <span class="main">=</span> last <span class="main">(</span><span class="bound">c</span> <span class="main">#</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_eq_f_Exec_Stream_last2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>
  f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span> last <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_eq_f_Exec_Stream_last f_Exec_Stream_empty_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">trans_fun</span></span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_eq_f_Exec_Stream_last_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> last <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_eq_f_Exec_Stream_last2<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_take_eq_last_f_Exec_Stream_take<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  last <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_eq_f_Exec_Stream_last2 take_not_empty_conv<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_N_eq_last_f_Exec_Stream_take<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
    f_Exec_Comp_N <span class="free">trans_fun</span> <span class="free">n</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
    last <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_N_def f_Exec_take_eq_last_f_Exec_Stream_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">n</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span> <span class="main">!</span> <span class="bound">n</span> <span class="main">=</span> f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_nth2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">c</span> <span class="main">#</span> f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons' f_Exec_Stream_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_N_all<span class="main">:</span><span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span>
    f_Exec_Comp_N <span class="free">trans_fun</span> <span class="free">n</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span> f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_N_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_append<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span>
    <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span><span class="main">)</span> <span class="main">@</span>
    <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">ys</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_append_last_Cons<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
    <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">@</span>
    <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">ys</span> <span class="main">(</span>last <span class="main">(</span><span class="free">c</span> <span class="main">#</span> <span class="main">(</span>f_Exec_Comp_Stream  <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_append f_Exec_eq_f_Exec_Stream_last<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_append_last<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
    <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">@</span>
    <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">ys</span> <span class="main">(</span>last <span class="main">(</span>f_Exec_Comp_Stream  <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_append_last_Cons f_Exec_Stream_empty_conv<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_append_if<span class="main">:</span><span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
    <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">@</span>
    <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">ys</span> <span class="main">(</span>
      <span class="keyword1">if</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> last <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_append f_Exec_eq_f_Exec_Stream_last_if<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> f_Exec_append<span class="main">:</span><span class="quoted"><span class="quoted">"
  f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp <span class="free">trans_fun</span> <span class="free">ys</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_eq_f_Exec_Stream_last f_Exec_Stream_append_if f_Exec_Stream_empty_conv<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_Cons_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">trans_fun</span> <span class="main">(</span>hd <span class="free">xs</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">#</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="main">(</span>hd <span class="free">xs</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> f_Exec_Stream_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
    f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">@</span>
    <span class="main">[</span><span class="free">trans_fun</span> <span class="free">x</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="free">x</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_append<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_Exec_N_append<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
  f_Exec_Comp_N <span class="free">trans_fun</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_N <span class="free">trans_fun</span> <span class="free">b</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp_N <span class="free">trans_fun</span> <span class="free">a</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_N_def f_Exec_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_drop add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">↓</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">a</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">↓</span></span> <span class="free"><span class="free">a</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">↓</span></span> <span class="free"><span class="free">a</span></span>"</span></span></span> <span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> append_take_drop_id<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_N_Suc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
  f_Exec_Comp_N <span class="free">trans_fun</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_N <span class="free">trans_fun</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp_N <span class="free">trans_fun</span> <span class="free">n</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_N_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_N_Suc2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span>
  f_Exec_Comp_N <span class="free">trans_fun</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp_N <span class="free">trans_fun</span> <span class="free">n</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_N_def take_Suc_conv_app_nth f_Exec_append<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> f_Exec_Stream_take<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> append_take_drop_id<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_append <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_take_drop_id<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> f_Exec_Stream_drop<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> append_take_drop_id<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_append <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_take_drop_id<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> Suc <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_nth_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth i_take_Suc_conv_app_nth f_Exec_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_nth_Suc_first<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇑</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">0</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth i_take_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_nth_eq_i_Exec_Stream_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n'</span><span class="main">)</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_nth i_Exec_Stream_nth min_eqR<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">input</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">⌢</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_Exec_Stream_nth f_Exec_Stream_nth f_Exec_append i_append_nth Suc_diff_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_append_last_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">input</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">⌢</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="main">(</span>
    last <span class="main">(</span><span class="free">c</span> <span class="main">#</span> f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_eq_f_Exec_Stream_last i_Exec_Stream_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_append_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">input</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">⌢</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="main">(</span>
    last <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_empty_conv i_Exec_Stream_append_last_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_append_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">input</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">⌢</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="free">c</span>
    <span class="keyword1">else</span> last <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_append_last<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⌢</span> <span class="free">input</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  <span class="main">[</span><span class="free">trans_fun</span> <span class="free">x</span> <span class="free">c</span><span class="main">]</span> <span class="main">⌢</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="free">x</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_append<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_Cons_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">0</span><span class="main">)</span> <span class="free">c</span><span class="main">]</span> <span class="main">⌢</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇑</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">0</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> i_Exec_Stream_append<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">input</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">input</span></span> <span class="main"><span class="main">⇑</span></span> Suc <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_drop_Suc_conv_tl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> i_Exec_Stream_take<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_Exec_Stream_nth i_Exec_Stream_nth min_eqR<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> i_Exec_Stream_drop<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="main">⇑</span> <span class="free">n</span> <span class="main">=</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_append_i_take_i_drop_id<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_append  i_drop_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> i_append_i_take_i_drop_id<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_expand_aggregate_map_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> take_map f_Exec_Stream_take f_expand_take_mult<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_expand_aggregate_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_aggregate <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span>
  f_aggregate <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> f_Exec_Stream_expand_aggregate_map_take<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">ag</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_expand_aggregate_map_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_i_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_Exec_Stream_take i_expand_i_take_mult<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_expand_aggregate_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span>
  f_aggregate <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> i_Exec_Stream_expand_aggregate_map_take<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">input</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">ag</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_expand_aggregate_map_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_drop_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> drop_map f_Exec_Stream_drop f_expand_take_mult f_expand_drop_mult<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_expand_aggregate_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_aggregate <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span>
  f_aggregate <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> f_Exec_Stream_expand_aggregate_map_drop<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">ag</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_expand_aggregate_map_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">⇑</span> <span class="free">n</span> <span class="main">=</span>
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">input</span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_i_drop_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_Exec_Stream_drop i_expand_i_take_mult i_expand_i_drop_mult<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_expand_aggregate_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">⇑</span> <span class="free">n</span> <span class="main">=</span>
  i_aggregate <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">input</span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> i_Exec_Stream_expand_aggregate_map_drop<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">input</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">ag</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_expand_aggregate_map_nth_eq_i_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n'</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_nth i_aggregate_nth f_Exec_Stream_take f_Exec_Stream_drop i_Exec_Stream_take i_Exec_Stream_drop drop_map take_map<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_expand_take_mod i_expand_i_take_mod f_expand_drop_mod i_expand_i_drop_mod i_drop_i_take_1 drop_take_1 min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_expand_aggregate_map_nth_eq_i_nth'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> Suc <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_expand_aggregate_map_nth_eq_i_nth<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_expand_aggregate_nth_eq_i_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n'</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  i_aggregate <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> f_Exec_Stream_expand_aggregate_map_nth_eq_i_nth<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_id<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_expand_aggregate_nth_eq_i_nth'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> Suc <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  i_aggregate <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_expand_aggregate_nth_eq_i_nth<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_expand_shrink_last_map_nth_eq_f_Exec_Comp<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">f</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> Suc <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_map f_shrink_last_length f_shrink_last_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Suc_leI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_nth add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> f_expand_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_expand_shrink_last_nth_eq_f_Exec_Comp<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> Suc <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> f_Exec_Stream_expand_shrink_last_map_nth_eq_f_Exec_Comp<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_expand_aggregate_map_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">ag</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_nth take_map drop_map<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_map drop_map f_Exec_Stream_drop f_Exec_Stream_take f_expand_take_mod f_expand_drop_mod drop_take_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_expand_aggregate_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">ag</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> f_Exec_Stream_expand_aggregate_map_nth<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_id<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_expand_shrink_map_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  last_message <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_def f_Exec_Stream_expand_aggregate_map_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_expand_aggregate_map_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">ag</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="free">n</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_aggregate_nth i_Exec_Stream_drop i_Exec_Stream_take i_expand_i_take_mod i_expand_i_drop_mod i_drop_i_take_1<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_expand_aggregate_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">ag</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="free">n</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> i_Exec_Stream_expand_aggregate_map_nth<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_id<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_expand_shrink_map_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span>
  last_message <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="free">n</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_def i_Exec_Stream_expand_aggregate_map_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_expand_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span> <span class="main">↑</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓</span> <span class="free">k</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_drop f_Exec_Stream_take f_expand_take_mod f_expand_drop_mod drop_take_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_expand_map_aggregate_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">@</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">ys</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_append f_aggregate_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_expand_map_aggregate_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">input</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">⌢</span>
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_i_append i_Exec_Stream_append i_aggregate_i_append_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_expand_map_aggregate_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span>
  <span class="free">ag</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> append_eq_Cons<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_Exec_Stream_expand_map_aggregate_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_one<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_expand_map_aggregate_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span>
  f_aggregate <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">@</span>
  <span class="main">[</span><span class="free">ag</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_Exec_Stream_expand_map_aggregate_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_one<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_expand_map_aggregate_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⌢</span> <span class="free">input</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span> <span class="main">=</span>
  <span class="main">[</span><span class="free">ag</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">⌢</span>
  i_aggregate <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">ag</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_Exec_Stream_expand_map_aggregate_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_aggregate_one<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_N_eq_f_Exec_Stream_nth<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">⟹</span>
  f_Exec_Comp_N <span class="free">trans_fun</span> <span class="free">n</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">#</span> f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_N_def f_Exec_Stream_nth2<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> f_Exec_Stream_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span>
  <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span><span class="main">)</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_take<span class="main">)</span>
<span class="keyword1"><span class="command">theorem</span></span> i_Exec_Stream_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">input1</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">input2</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">)</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input2</span> <span class="free">c</span><span class="main">)</span> <span class="main">⇓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_take<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Results for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f_Exec_Comp_Stream_Init›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f_Exec_Comp_Stream_Init›</span></span></span></span> computes the execution stream of a component
  with the initial value of the component
  at the beginning of the result stream.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_length<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> length <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_not_empty<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_eq_f_Exec_Stream_Init_last<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span> <span class="main">=</span> last <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_not_empty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span> <span class="main">=</span> <span class="bound">c</span> <span class="main">#</span> f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons_output<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">output_fun</span> <span class="free">c</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟹</span>
  map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">\&lt;NoMsg&gt;</span> <span class="main">#</span> map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_Init_tl_eq_f_Exec_Stream<span class="main">:</span> <span class="quoted"><span class="quoted">"
  tl <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_N_eq_last_f_Exec_Stream_Init_take<span class="main">:</span><span class="quoted"><span class="quoted">"
  f_Exec_Comp_N <span class="free">trans_fun</span> <span class="free">n</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  last <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_N_def f_Exec_eq_f_Exec_Stream_Init_last<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_nth_0<span class="main">:</span> <span class="quoted"><span class="quoted">"f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_conv_nth f_Exec_Stream_Init_not_empty f_Exec_Stream_Init_nth_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_nth_Suc_eq_f_Exec_Stream_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_append<span class="main">:</span><span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
    <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">@</span>
    tl <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">ys</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons f_Exec_Stream_append<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_Init_append_last<span class="main">:</span><span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
    <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">@</span>
    tl <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">ys</span> <span class="main">(</span>last <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_append f_Exec_eq_f_Exec_Stream_Init_last<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_f_Exec_Stream_append<span class="main">:</span><span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
    <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">@</span>
    <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">ys</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons f_Exec_Stream_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_take<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">↓</span> Suc <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons f_Exec_Stream_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_drop<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">⟹</span>
  <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons f_Exec_Stream_drop<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_Suc_conv_app_nth f_Exec_append Cons_nth_drop_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_drop_geq_not_valid<span class="main">:</span><span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span>
  <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">↑</span> Suc <span class="free">n</span> <span class="main">≠</span>
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">arbitrary_input</span> <span class="free">arbitrary_comp</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_not_empty<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Init_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_nth_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">0</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_nth_Suc_eq_i_Exec_Stream_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_nth i_Exec_Stream_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span> <span class="main">⌢</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_Exec_Stream_Init_nth i_append_nth i_Exec_Stream_nth<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_Init_eq_i_Exec_Stream_Cons_output<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">output_fun</span> <span class="free">c</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟹</span>
  <span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span>
  <span class="main">[</span><span class="main">\&lt;NoMsg&gt;</span><span class="main">]</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_append<span class="main">:</span><span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input1</span> <span class="main">⌢</span> <span class="free">input2</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
    <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">)</span> <span class="main">⌢</span>
    <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input2</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⇑</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons i_Exec_Stream_Init_eq_i_Exec_Stream_Cons i_Exec_Stream_append<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_Init_append_last<span class="main">:</span><span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input1</span> <span class="main">⌢</span> <span class="free">input2</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
    <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">)</span> <span class="main">⌢</span>
    <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input2</span> <span class="main">(</span>last <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇑</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_append f_Exec_eq_f_Exec_Stream_Init_last<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_i_Exec_Stream_append<span class="main">:</span><span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input1</span> <span class="main">⌢</span> <span class="free">input2</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
    <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">)</span> <span class="main">⌢</span>
    <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input2</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons i_Exec_Stream_Init_eq_i_Exec_Stream_Cons i_Exec_Stream_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_take<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="main">⇓</span> Suc <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons i_Exec_Stream_Init_eq_i_Exec_Stream_Cons i_Exec_Stream_take<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_drop<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="main">⇑</span> <span class="free">n</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_eq_i_Exec_Stream_Cons i_Exec_Stream_drop<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_take_Suc_conv_app_nth f_Exec_append i_Exec_Stream_nth i_append_nth i_take_first i_take_drop_eq_map<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upt_conv_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> f_Exec_Stream_Init_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span>
  <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">↓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span><span class="main">)</span> <span class="main">↓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_take<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> i_Exec_Stream_Init_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">input1</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">input2</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">)</span> <span class="main">⇓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input2</span> <span class="free">c</span><span class="main">)</span> <span class="main">⇓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_take<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> f_Exec_N_eq_f_Exec_Stream_Init_nth<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">⟹</span>
  f_Exec_Comp_N <span class="free">trans_fun</span> <span class="free">n</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span> f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons f_Exec_N_eq_f_Exec_Stream_nth<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Basic results for previous element functions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The functions <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>list_Previous›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ilist_Previous›</span></span></span></span>
  return the previous element of the list relatively to the specified position <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  or the initial element if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is 0,›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_Previous</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'value</span> list <span class="main">⇒</span> <span class="tfree">'value</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'value</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">list_Previous</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span>
    <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span>
      <span class="main">0</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span>
    <span class="main">|</span> Suc <span class="bound">n'</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">!</span> <span class="bound">n'</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ilist_Previous</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'value</span> ilist <span class="main">⇒</span> <span class="tfree">'value</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'value</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ilist_Previous</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span>
    <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span>
      <span class="main">0</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span>
    <span class="main">|</span> Suc <span class="bound">n'</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n'</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted">"<span class="entity">list_Previous'</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'value</span> list <span class="main">⇒</span> <span class="tfree">'value</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'value</span>"</span></span>
    <span class="main">(</span> <span class="quoted">"_<span class="keyword1">⇗←''</span> _<span class="keyword1">⇖</span> _"</span> <span class="main">[</span>1000<span class="main">,</span> 10<span class="main">,</span> 100<span class="main">]</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="hidden">⇗</span><sup>←' <span class="free"><span class="bound"><span class="entity">init</span></span></span></sup><span class="hidden">⇖</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> list_Previous <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted">"<span class="entity">ilist_Previous'</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'value</span> ilist <span class="main">⇒</span> <span class="tfree">'value</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'value</span>"</span></span>
    <span class="main">(</span> <span class="quoted">"_<span class="keyword1">⇗←</span> _<span class="keyword1">⇖</span> _"</span> <span class="main">[</span>1000<span class="main">,</span> 10<span class="main">,</span> 100<span class="main">]</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="hidden">⇗</span><sup>← <span class="free"><span class="bound"><span class="entity">init</span></span></span></sup><span class="hidden">⇖</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> ilist_Previous <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_Previous_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="hidden">⇗</span><sup>←' <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">n</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="free">init</span> <span class="main">|</span> Suc <span class="bound">n'</span> <span class="main">⇒</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">n'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_Previous_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ilist_Previous_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="hidden">⇗</span><sup>← <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">n</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="free">init</span> <span class="main">|</span> Suc <span class="bound">n'</span> <span class="main">⇒</span> <span class="free">f</span> <span class="bound">n'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_Previous_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_Previous_nth_if<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="hidden">⇗</span><sup>←' <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">init</span> <span class="keyword1">else</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_Previous_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ilist_Previous_nth_if<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="hidden">⇗</span><sup>← <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">init</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_Previous_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_Previous_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="hidden">⇗</span><sup>←' <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">init</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_Previous_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ilist_Previous_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="hidden">⇗</span><sup>← <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">init</span><span class="main">]</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_Previous_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_Previous_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="hidden">⇗</span><sup>←' <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="main">0</span> <span class="main">=</span> <span class="free">init</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_Previous_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ilist_Previous_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="hidden">⇗</span><sup>← <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="main">0</span> <span class="main">=</span> <span class="free">init</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_Previous_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_Previous_gr0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">xs</span><span class="hidden">⇗</span><sup>←' <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_Previous_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ilist_Previous_gr0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">f</span><span class="hidden">⇗</span><sup>← <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_Previous_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_Previous_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="hidden">⇗</span><sup>←' <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_Previous_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ilist_Previous_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="hidden">⇗</span><sup>← <span class="free">init</span></sup><span class="hidden">⇖</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_Previous_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Previous_f_Exec_Stream_Init<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="hidden">⇗</span><sup>←' <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons list_Previous_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Previous_i_Exec_Stream_Init<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span>
  <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span><span class="hidden">⇗</span><sup>← <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_eq_i_Exec_Stream_Cons ilist_Previous_Cons<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> hd <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">trans_fun</span> <span class="main">(</span>hd <span class="free">xs</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_nth_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span><span class="main">=</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The calculation of the n-th result stream element
  from the previous result stream element and the current input stream element.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_nth_gr0_calc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_nth take_Suc_conv_app_nth f_Exec_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_nth_calc_Previous<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="hidden">⇗</span><sup>←' <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_Previous_0 f_Exec_Stream_nth_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_Previous_def f_Exec_Stream_nth_gr0_calc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_nth_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">0</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth i_take_first<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_nth_gr0_calc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth i_take_Suc_conv_app_nth f_Exec_append<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The component state (and thus its output) at time point <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  is computed from the previous state
  (the state at time <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">&gt;</span></span> <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  or the initial state for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>)
  and the input at time <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_nth_calc_Previous<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span><span class="hidden">⇗</span><sup>← <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth ilist_Previous_nth_if i_take_first i_take_Suc_conv_app_nth f_Exec_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_nth_Suc_calc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> Suc <span class="free">n</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_eq_f_Exec_Stream_Cons f_Exec_Stream_nth nth_Cons' length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> gr_implies_gr0<span class="main"><span class="main">]</span></span> take_Suc_conv_app_nth f_Exec_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_nth_Plus1_calc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_nth_Suc_calc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_nth_gr0_calc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> length <span class="free">xs</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gr0_conv_Suc f_Exec_Stream_Init_nth_Suc_calc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  At the beginning,
  the component state (and thus its output)
  for the execution stream with initial state
  is represented by the initial state,
  contrary to the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"i_Exec_Comp_Stream"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  that does not contain the initial state.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The component state (and thus its output) at time point <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  for the execution stream with initial state
  is computed from the previous state
  (the state at time <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>)
  and the previous input
  (input at time <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>),
  contrary to the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"i_Exec_Comp_Stream"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  where each state at time <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  represents the resulting state after processing the input at time <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_nth_Suc_calc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_nth i_take_Suc_conv_app_nth f_Exec_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_nth_Plus1_calc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_nth_Suc_calc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_nth_gr0_calc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gr0_conv_Suc i_Exec_Stream_Init_nth_Suc_calc<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Correlation between Pre/Post-Conditions for
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f_Exec_Comp_Stream›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f_Exec_Comp_Stream_Init›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Pre_Post1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span>
    <span class="free">c_n</span> <span class="main">=</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="hidden">⇗</span><sup>←' <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="free">n</span><span class="main">;</span> <span class="free">x_n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P1</span> <span class="free">x_n</span> <span class="main">∧</span> <span class="free">P2</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">P1</span> <span class="free">x_n</span> <span class="main">∧</span> <span class="free">P2</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="free">x_n</span> <span class="free">c_n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_nth_calc_Previous<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Direct relation between input and result after transition›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Pre_Post2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span>
    <span class="free">c_n</span> <span class="main">=</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="hidden">⇗</span><sup>←' <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="free">n</span><span class="main">;</span> <span class="free">x_n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">P</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="free">x_n</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="free">x_n</span> <span class="free">c_n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_nth_calc_Previous<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Pre_Post2_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span>
    <span class="free">c_n</span> <span class="main">=</span> f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span><span class="main">;</span> <span class="free">x_n1</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> Suc <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">P</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="free">x_n1</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="free">x_n1</span> <span class="free">c_n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_nth_gr0_calc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_Pre_Post1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span>
    <span class="free">c_n</span> <span class="main">=</span> f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span><span class="main">;</span> <span class="free">x_n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P1</span> <span class="free">x_n</span> <span class="main">∧</span> <span class="free">P2</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">P1</span> <span class="free">x_n</span> <span class="main">∧</span> <span class="free">P2</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="free">x_n</span> <span class="free">c_n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_nth_Suc_calc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Direct relation between input and state before transition›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_Pre_Post2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span>
    <span class="free">c_n</span> <span class="main">=</span> f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span><span class="main">;</span> <span class="free">x_n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟶</span>
     <span class="free">Q</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">P</span> <span class="free">x_n</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="free">x_n</span> <span class="free">c_n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Init_nth_Suc_calc<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Pre_Post1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">c_n</span> <span class="main">=</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span><span class="hidden">⇗</span><sup>← <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="free">n</span><span class="main">;</span> <span class="free">x_n</span> <span class="main">=</span> <span class="free">input</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P1</span> <span class="free">x_n</span> <span class="main">∧</span> <span class="free">P2</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">P1</span> <span class="free">x_n</span> <span class="main">∧</span> <span class="free">P2</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="free">x_n</span> <span class="free">c_n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth_calc_Previous<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Direct relation between input and result after transition›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Pre_Post2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">c_n</span> <span class="main">=</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span><span class="hidden">⇗</span><sup>← <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="free">n</span><span class="main">;</span> <span class="free">x_n</span> <span class="main">=</span> <span class="free">input</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">input</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">P</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="free">x_n</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="free">x_n</span> <span class="free">c_n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth_calc_Previous<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Pre_Post2_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">c_n</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span><span class="main">;</span> <span class="free">x_n1</span> <span class="main">=</span> <span class="free">input</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">input</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">P</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="free">x_n1</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="free">x_n1</span> <span class="free">c_n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth_gr0_calc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_Pre_Post1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">c_n</span> <span class="main">=</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span><span class="main">;</span> <span class="free">x_n</span> <span class="main">=</span> <span class="free">input</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P1</span> <span class="free">x_n</span> <span class="main">∧</span> <span class="free">P2</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">P1</span> <span class="free">x_n</span> <span class="main">∧</span> <span class="free">P2</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="free">x_n</span> <span class="free">c_n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_nth_Suc_calc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Direct relation between input and state before transition›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_Pre_Post2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">c_n</span> <span class="main">=</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span><span class="main">;</span> <span class="free">x_n</span> <span class="main">=</span> <span class="free">input</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">input</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟶</span>
     <span class="free">Q</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">P</span> <span class="free">x_n</span> <span class="free">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="free">x_n</span> <span class="free">c_n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_nth_Suc_calc<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Basic results for stream prefices›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"
  prefix <span class="free">xs</span> <span class="free">ys</span> <span class="main">⟹</span>
  prefix <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>
         <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_def f_Exec_Stream_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"
 <span class="free">xs</span> <span class="main">⊑</span> <span class="free">input</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">⊑</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprefix_eq_iprefix_take i_Exec_Stream_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_N_prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> length <span class="free">xs</span><span class="main">;</span> prefix <span class="free">xs</span> <span class="free">ys</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_N <span class="free">trans_fun</span> <span class="free">n</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_N <span class="free">trans_fun</span> <span class="free">n</span> <span class="free">ys</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_N_def prefix_imp_take_eq<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> f_Exec_Stream_prefix_causal<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">⊓</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_causal<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inf_prefix_take_correct<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_prefix<span class="main">:</span><span class="quoted"><span class="quoted">"
  prefix <span class="free">xs</span> <span class="free">ys</span> <span class="main">⟹</span>
  prefix <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>
         <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_def f_Exec_Stream_Init_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"
 <span class="free">xs</span> <span class="main">⊑</span> <span class="free">input</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">⊑</span>
  i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprefix_eq_iprefix_take i_Exec_Stream_Init_take<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> f_Exec_Stream_Init_prefix_strictly_causal<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">⊓</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">↓</span> Suc <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span> <span class="main">↓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_Init_strictly_causal<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inf_prefix_take_correct<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A predicate indicating
  whether a component is deterministically dependent
  on the local state extracted by the the given local state function.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Deterministic_Trans_Fun</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span><span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> Comp_Local_State <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Deterministic_Trans_Fun</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="main">≡</span>
    <span class="main">∀</span><span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="bound">c1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="bound">c2</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="bound">x</span> <span class="bound">c1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="bound">x</span> <span class="bound">c2</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Deterministic_f_Exec<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Deterministic_Trans_Fun <span class="free">trans_fun</span> <span class="free">localState</span><span class="main">;</span> <span class="free">localState</span> <span class="free">c1</span> <span class="main">=</span> <span class="free">localState</span> <span class="free">c2</span><span class="main">;</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c1</span> <span class="main">=</span> f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Deterministic_Trans_Fun_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> y ys<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Deterministic_f_Exec_Stream<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Deterministic_Trans_Fun <span class="free">trans_fun</span> <span class="free">localState</span><span class="main">;</span> <span class="free">localState</span> <span class="free">c1</span> <span class="main">=</span> <span class="free">localState</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c1</span> <span class="main">=</span> f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_Exec_Stream_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Deterministic_f_Exec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> gr_implies_gr0<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Deterministic_i_Exec_Stream<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Deterministic_Trans_Fun <span class="free">trans_fun</span> <span class="free">localState</span><span class="main">;</span> <span class="free">localState</span> <span class="free">c1</span> <span class="main">=</span> <span class="free">localState</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c1</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_Exec_Stream_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Deterministic_f_Exec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Connected streams›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A predicate indicating for two message streams,
  that the ports, they correspond to, are connected.
  The predicate implies strict causality.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_Streams_Connected</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> <span class="tfree">'a</span> fstream_af <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_Streams_Connected</span> <span class="free"><span class="bound"><span class="entity">outS</span></span></span> <span class="free"><span class="bound"><span class="entity">inS</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">inS</span></span></span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">outS</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_Streams_Connected</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream_af <span class="main">⇒</span> <span class="tfree">'a</span> istream_af <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_Streams_Connected</span> <span class="free"><span class="bound"><span class="entity">outS</span></span></span> <span class="free"><span class="bound"><span class="entity">inS</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">inS</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">\&lt;NoMsg&gt;</span><span class="main">]</span> <span class="main">⌢</span> <span class="free"><span class="bound"><span class="entity">outS</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Streams_Connected_defs <span class="main">=</span>
  f_Streams_Connected_def
  i_Streams_Connected_def

<span class="keyword1"><span class="command">lemma</span></span> f_Streams_Connected_imp_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"f_Streams_Connected <span class="free">outS</span> <span class="free">inS</span> <span class="main">⟹</span> <span class="free">inS</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Streams_Connected_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Streams_Connected_nth_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Streams_Connected <span class="free">outS</span> <span class="free">inS</span> <span class="main">=</span>
  <span class="main">(</span>length <span class="free">inS</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="free">outS</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">inS</span><span class="main">.</span> <span class="free">inS</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">|</span> Suc <span class="bound">k</span> <span class="main">⇒</span> <span class="free">outS</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Streams_Connected_def list_eq_iff nth_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Streams_Connected_nth_conv_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Streams_Connected <span class="free">outS</span> <span class="free">inS</span> <span class="main">=</span>
  <span class="main">(</span>length <span class="free">inS</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="free">outS</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">inS</span><span class="main">.</span> <span class="free">inS</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">else</span> <span class="free">outS</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_Streams_Connected_nth_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> all_imp_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> i<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Streams_Connected_nth_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Streams_Connected <span class="free">outS</span> <span class="free">inS</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">inS</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">|</span> Suc <span class="bound">k</span> <span class="main">⇒</span> <span class="free">outS</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Streams_Connected_def ilist_eq_iff i_append_nth_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Streams_Connected_nth_conv_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Streams_Connected <span class="free">outS</span> <span class="free">inS</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">inS</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="keyword1">else</span> <span class="free">outS</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_Streams_Connected_nth_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> all_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> i<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_eq_output_channel<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">output_fun</span> <span class="free">c</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    f_Streams_Connected
      <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel</span> <span class="main">⟧</span> <span class="main">⟹</span>
  map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">channel</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Streams_Connected_def f_Exec_Stream_Init_eq_f_Exec_Stream_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_eq_output_channel<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">output_fun</span> <span class="free">c</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    i_Streams_Connected
      <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output_fun</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">channel</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Streams_Connected_def i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_output_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">↓</span> <span class="free">n</span><span class="main">;</span>
    <span class="free">output1</span> <span class="main">=</span> map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    <span class="free">output2</span> <span class="main">=</span> map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output1</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">output2</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_map f_Exec_Stream_causal<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_output_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">↓</span> <span class="free">n</span><span class="main">;</span>
    <span class="free">output1</span> <span class="main">=</span> map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    <span class="free">output2</span> <span class="main">=</span> map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output1</span> <span class="main">↓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="free">output2</span> <span class="main">↓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_map f_Exec_Stream_Init_strictly_causal<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_output_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">input1</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">input2</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">;</span>
    <span class="free">output1</span> <span class="main">=</span> <span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">;</span>
    <span class="free">output2</span> <span class="main">=</span> <span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input2</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output1</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">output2</span> <span class="main">⇓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_causal<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">input1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_output_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">input1</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">input2</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">;</span>
    <span class="free">output1</span> <span class="main">=</span> <span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">;</span>
    <span class="free">output2</span> <span class="main">=</span> <span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input2</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output1</span> <span class="main">⇓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="free">output2</span> <span class="main">⇓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_strictly_causal<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">input1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Connected_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">↓</span> <span class="free">n</span><span class="main">;</span>
    f_Streams_Connected
      <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel1</span><span class="main">;</span>
    f_Streams_Connected
      <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">channel1</span> <span class="main">↓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="free">channel2</span> <span class="main">↓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Streams_Connected_def take_map f_Exec_Stream_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Connected_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">input1</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">input2</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">;</span>
    i_Streams_Connected
      <span class="main">(</span><span class="free">portOutput</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel1</span><span class="main">;</span>
    i_Streams_Connected
      <span class="main">(</span><span class="free">portOutput</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input2</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">channel1</span> <span class="main">⇓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="free">channel2</span> <span class="main">⇓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Streams_Connected_def i_take_Suc_Cons i_Exec_Stream_take<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A predicate for the semantics with initial state in result stream
  indicating for two message streams that the ports, they correspond to, are connected.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_Streams_Connected_Init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream_af <span class="main">⇒</span> <span class="tfree">'a</span> fstream_af <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_Streams_Connected_Init</span> <span class="free"><span class="bound"><span class="entity">outS</span></span></span> <span class="free"><span class="bound"><span class="entity">inS</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">inS</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">outS</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_Streams_Connected_Init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream_af <span class="main">⇒</span> <span class="tfree">'a</span> istream_af <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_Streams_Connected_Init</span> <span class="free"><span class="bound"><span class="entity">outS</span></span></span> <span class="free"><span class="bound"><span class="entity">inS</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">inS</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">outS</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Streams_Connected_Init_defs <span class="main">=</span>
  f_Streams_Connected_Init_def
  i_Streams_Connected_Init_def

<span class="keyword1"><span class="command">lemma</span></span> f_Streams_Connected_Init_nth_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Streams_Connected_Init <span class="free">outS</span> <span class="free">inS</span> <span class="main">=</span>
  <span class="main">(</span>length <span class="free">inS</span> <span class="main">=</span> length <span class="free">outS</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">inS</span><span class="main">.</span> <span class="free">inS</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">outS</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Streams_Connected_Init_def list_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Streams_Connected_Init_nth_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Streams_Connected_Init <span class="free">outS</span> <span class="free">inS</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">inS</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">outS</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Streams_Connected_Init_def ilist_eq_iff<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Init_eq_output_channel2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">output_fun</span> <span class="free">c</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    f_Streams_Connected_Init
      <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel</span> <span class="main">⟧</span> <span class="main">⟹</span>
  map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">channel</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Streams_Connected_Init_def f_Exec_Stream_Init_eq_f_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_eq_output_channel2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">output_fun</span> <span class="free">c</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    i_Streams_Connected_Init
      <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output_fun</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">channel</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Streams_Connected_Init_def i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Connected_Init_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">↓</span> <span class="free">n</span><span class="main">;</span>
    f_Streams_Connected_Init
      <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel1</span><span class="main">;</span>
    f_Streams_Connected_Init
      <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">channel1</span> <span class="main">↓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="free">channel2</span> <span class="main">↓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Streams_Connected_Init_def f_Exec_Stream_Init_eq_f_Exec_Stream_Cons take_map f_Exec_Stream_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Connected_Init_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">input1</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">input2</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">;</span>
    i_Streams_Connected_Init
      <span class="main">(</span><span class="free">portOutput</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel1</span><span class="main">;</span>
    i_Streams_Connected_Init
      <span class="main">(</span><span class="free">portOutput</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input2</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
      <span class="free">channel2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">channel1</span> <span class="main">⇓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="free">channel2</span> <span class="main">⇓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Streams_Connected_Init_def i_Exec_Stream_Init_eq_i_Exec_Stream_Cons i_Exec_Stream_take<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Additional auxiliary results›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemma shows that,
  if the system state is different at some time points
  with respect to a certain predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  then there exists a defined time point between these two,
  where the state change has taken place›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_State_Change_exists_set<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n1</span> <span class="main">≤</span> <span class="free">n2</span><span class="main">;</span> <span class="free">n1</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">n2</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">↓</span> <span class="free">n1</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    <span class="free">P</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">↓</span> <span class="free">n2</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound">n</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">n1</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">n2</span> <span class="main">∧</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">↓</span> <span class="bound">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">∧</span>
    <span class="free">P</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">↓</span> <span class="main">(</span>inext <span class="bound">n</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inext_predicate_change_exists<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_State_Change_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n1</span> <span class="main">≤</span> <span class="free">n2</span><span class="main">;</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">↓</span> <span class="free">n1</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    <span class="free">P</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">↓</span> <span class="free">n2</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free">n1</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">n2</span> <span class="main">∧</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">↓</span> <span class="bound">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">∧</span>
    <span class="free">P</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">↓</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_Suc_predicate_change_exists<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_State_Change_exists_set<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n1</span> <span class="main">≤</span> <span class="free">n2</span><span class="main">;</span> <span class="free">n1</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">n2</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n1</span><span class="main">)</span><span class="main">;</span>
    <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n2</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound">n</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">n1</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">n2</span> <span class="main">∧</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
    <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span>inext <span class="bound">n</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inext_predicate_change_exists<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_State_Change_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n1</span> <span class="main">≤</span> <span class="free">n2</span><span class="main">;</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n1</span><span class="main">)</span><span class="main">;</span>
    <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n2</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free">n1</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">n2</span> <span class="main">∧</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
    <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_Suc_predicate_change_exists<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_State_Change_Init_exists_set<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n1</span> <span class="main">≤</span> <span class="free">n2</span><span class="main">;</span> <span class="free">n1</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">n2</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n1</span><span class="main">)</span><span class="main">;</span>
    <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n2</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound">n</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">n1</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">n2</span> <span class="main">∧</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
    <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span>inext <span class="bound">n</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inext_predicate_change_exists<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_State_Change_Init_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n1</span> <span class="main">≤</span> <span class="free">n2</span><span class="main">;</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n1</span><span class="main">)</span><span class="main">;</span>
    <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n2</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free">n1</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">n2</span> <span class="main">∧</span>
    <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
    <span class="free">P</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_Suc_predicate_change_exists<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Components with accelerated execution›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This section deals with variable execution speed components.
  A component accelerated by a (clocking) factor <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  processes streams expanded by factor <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and its output streams are compressed by factor <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Equivalence relation for executions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A predicate indicating for
  two components together with transition functions
  and a given equivalence predicate for their local states,
  that the components exhibit equivalent observable behaviour
  after expanding input streams and shrinking output streams
  by a constant factor,
  given that their local states are equivalent
  with respect to the specified equivalence relations.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Equiv_Exec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"
    <span class="tfree">'input</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'state1</span> <span class="main">⇒</span> <span class="tfree">'state2</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Equivalence predicate for local states›</span>
    <span class="main">(</span><span class="tfree">'comp1</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> Comp_Local_State <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp2</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> Comp_Local_State <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'input</span><span class="main">,</span> <span class="tfree">'input1</span><span class="main">)</span> Port_Input_Value <span class="main">⇒</span> <span class="comment1">― ‹Input adaptor for first component›</span>
    <span class="main">(</span><span class="tfree">'input</span><span class="main">,</span> <span class="tfree">'input2</span><span class="main">)</span> Port_Input_Value <span class="main">⇒</span> <span class="comment1">― ‹Input adaptor for second component›</span>
    <span class="main">(</span><span class="tfree">'comp1</span><span class="main">,</span> <span class="tfree">'output</span><span class="main">)</span> Port_Output_Value <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp2</span><span class="main">,</span> <span class="tfree">'output</span><span class="main">)</span> Port_Output_Value <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp1</span><span class="main">,</span> <span class="tfree">'input1</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp2</span><span class="main">,</span> <span class="tfree">'input2</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'comp1</span> <span class="main">⇒</span> <span class="tfree">'comp2</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Equiv_Exec</span>
    <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">equiv_states</span></span></span>
      <span class="free"><span class="bound"><span class="entity">localState1</span></span></span> <span class="free"><span class="bound"><span class="entity">localState2</span></span></span> <span class="free"><span class="bound"><span class="entity">input_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">input_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun2</span></span></span>
      <span class="free"><span class="bound"><span class="entity">trans_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">k1</span></span></span> <span class="free"><span class="bound"><span class="entity">k2</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span>
    <span class="free"><span class="bound"><span class="entity">equiv_states</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">localState1</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">localState2</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>
      last_message <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">output_fun1</span></span></span> <span class="main">(</span>
        f_Exec_Comp_Stream <span class="free"><span class="bound"><span class="entity">trans_fun1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">input_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">k1</span></span></span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      last_message <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">output_fun2</span></span></span> <span class="main">(</span>
        f_Exec_Comp_Stream <span class="free"><span class="bound"><span class="entity">trans_fun2</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">input_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">k2</span></span></span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="free"><span class="bound"><span class="entity">equiv_states</span></span></span>
        <span class="main">(</span><span class="free"><span class="bound"><span class="entity">localState1</span></span></span> <span class="main">(</span>f_Exec_Comp <span class="free"><span class="bound"><span class="entity">trans_fun1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">input_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">k1</span></span></span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="free"><span class="bound"><span class="entity">localState2</span></span></span> <span class="main">(</span>f_Exec_Comp <span class="free"><span class="bound"><span class="entity">trans_fun2</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">input_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">k2</span></span></span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Predicate indicating for
  two components together with transition functions
  and a given equivalence predicate for their local states,
  that the equivalence predicate is stable
  with respect to component execution,
  i.e., it determines the equivalence
  of components' local states
  both for the initial states and after the components
  have processed an arbitrary input.
  The restricting version <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Equiv_Exec_stable_set</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  guarantees stability only for inputs from a given restriction set,
  the not-restricting version guarantees stability for all inputs.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Equiv_Exec_stable_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"
    <span class="tfree">'input</span> set <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'state1</span> <span class="main">⇒</span> <span class="tfree">'state2</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Equivalence predicate for local states›</span>
    <span class="main">(</span><span class="tfree">'comp1</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> Comp_Local_State <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp2</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> Comp_Local_State <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'input</span><span class="main">,</span> <span class="tfree">'input1</span><span class="main">)</span> Port_Input_Value <span class="main">⇒</span> <span class="comment1">― ‹Input adaptor for first component›</span>
    <span class="main">(</span><span class="tfree">'input</span><span class="main">,</span> <span class="tfree">'input2</span><span class="main">)</span> Port_Input_Value <span class="main">⇒</span> <span class="comment1">― ‹Input adaptor for second component›</span>
    <span class="main">(</span><span class="tfree">'comp1</span><span class="main">,</span> <span class="tfree">'output</span><span class="main">)</span> Port_Output_Value <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp2</span><span class="main">,</span> <span class="tfree">'output</span><span class="main">)</span> Port_Output_Value <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp1</span><span class="main">,</span> <span class="tfree">'input1</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp2</span><span class="main">,</span> <span class="tfree">'input2</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'comp1</span> <span class="main">⇒</span> <span class="tfree">'comp2</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Equiv_Exec_stable_set</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>
    <span class="free"><span class="bound"><span class="entity">equiv_states</span></span></span> <span class="free"><span class="bound"><span class="entity">localState1</span></span></span> <span class="free"><span class="bound"><span class="entity">localState2</span></span></span> <span class="free"><span class="bound"><span class="entity">input_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">input_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun2</span></span></span>
    <span class="free"><span class="bound"><span class="entity">trans_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">k1</span></span></span> <span class="free"><span class="bound"><span class="entity">k2</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span>
   <span class="main">∀</span><span class="bound">input</span> <span class="bound">m</span><span class="main">.</span> set <span class="bound">input</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span>
     Equiv_Exec <span class="bound">m</span>
       <span class="free"><span class="bound"><span class="entity">equiv_states</span></span></span> <span class="free"><span class="bound"><span class="entity">localState1</span></span></span> <span class="free"><span class="bound"><span class="entity">localState2</span></span></span> <span class="free"><span class="bound"><span class="entity">input_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">input_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun2</span></span></span>
       <span class="free"><span class="bound"><span class="entity">trans_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">k1</span></span></span> <span class="free"><span class="bound"><span class="entity">k2</span></span></span>
       <span class="main">(</span>f_Exec_Comp <span class="free"><span class="bound"><span class="entity">trans_fun1</span></span></span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">input_fun1</span></span></span> <span class="bound">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">k1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span>
       <span class="main">(</span>f_Exec_Comp <span class="free"><span class="bound"><span class="entity">trans_fun2</span></span></span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">input_fun2</span></span></span> <span class="bound">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">k2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Equiv_Exec_stable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"
    <span class="main">(</span><span class="tfree">'state1</span> <span class="main">⇒</span> <span class="tfree">'state2</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Equivalence predicate for local states›</span>
    <span class="main">(</span><span class="tfree">'comp1</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> Comp_Local_State <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp2</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> Comp_Local_State <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'input</span><span class="main">,</span> <span class="tfree">'input1</span><span class="main">)</span> Port_Input_Value <span class="main">⇒</span> <span class="comment1">― ‹Input adaptor for first component›</span>
    <span class="main">(</span><span class="tfree">'input</span><span class="main">,</span> <span class="tfree">'input2</span><span class="main">)</span> Port_Input_Value <span class="main">⇒</span> <span class="comment1">― ‹Input adaptor for second component›</span>
    <span class="main">(</span><span class="tfree">'comp1</span><span class="main">,</span> <span class="tfree">'output</span><span class="main">)</span> Port_Output_Value <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp2</span><span class="main">,</span> <span class="tfree">'output</span><span class="main">)</span> Port_Output_Value <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp1</span><span class="main">,</span> <span class="tfree">'input1</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp2</span><span class="main">,</span> <span class="tfree">'input2</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'comp1</span> <span class="main">⇒</span> <span class="tfree">'comp2</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Equiv_Exec_stable</span>
    <span class="free"><span class="bound"><span class="entity">equiv_states</span></span></span> <span class="free"><span class="bound"><span class="entity">localState1</span></span></span> <span class="free"><span class="bound"><span class="entity">localState2</span></span></span> <span class="free"><span class="bound"><span class="entity">input_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">input_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun2</span></span></span>
    <span class="free"><span class="bound"><span class="entity">trans_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">k1</span></span></span> <span class="free"><span class="bound"><span class="entity">k2</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span>
   <span class="main">∀</span><span class="bound">input</span> <span class="bound">m</span><span class="main">.</span>
     Equiv_Exec <span class="bound">m</span>
       <span class="free"><span class="bound"><span class="entity">equiv_states</span></span></span> <span class="free"><span class="bound"><span class="entity">localState1</span></span></span> <span class="free"><span class="bound"><span class="entity">localState2</span></span></span> <span class="free"><span class="bound"><span class="entity">input_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">input_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun2</span></span></span>
       <span class="free"><span class="bound"><span class="entity">trans_fun1</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun2</span></span></span> <span class="free"><span class="bound"><span class="entity">k1</span></span></span> <span class="free"><span class="bound"><span class="entity">k2</span></span></span>
       <span class="main">(</span>f_Exec_Comp <span class="free"><span class="bound"><span class="entity">trans_fun1</span></span></span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">input_fun1</span></span></span> <span class="bound">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">k1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span>
       <span class="main">(</span>f_Exec_Comp <span class="free"><span class="bound"><span class="entity">trans_fun2</span></span></span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">input_fun2</span></span></span> <span class="bound">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">k2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_equiv_statesI<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec
      <span class="free">m</span> <span class="free">equiv_states</span>
        <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
        <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">equiv_states</span>
    <span class="main">(</span><span class="free">localState1</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span><span class="free">input_fun1</span> <span class="free">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k1</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="free">localState2</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="free">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k2</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_output_eqI<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec
      <span class="free">m</span> <span class="free">equiv_states</span>
      <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
        <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  last_message <span class="main">(</span>map <span class="free">output_fun1</span> <span class="main">(</span>
    f_Exec_Comp_Stream <span class="free">trans_fun1</span> <span class="main">(</span><span class="free">input_fun1</span> <span class="free">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k1</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  last_message <span class="main">(</span>map <span class="free">output_fun2</span> <span class="main">(</span>
    f_Exec_Comp_Stream <span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="free">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k2</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_equiv_statesI'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec
      <span class="free">m</span> <span class="free">equiv_states</span>
        <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
        <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">equiv_states</span>
   <span class="main">(</span><span class="free">localState1</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">k1</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="free">trans_fun1</span> <span class="main">(</span><span class="free">input_fun1</span> <span class="free">m</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
   <span class="main">(</span><span class="free">localState2</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">k2</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="free">m</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_le1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">k1</span> <span class="main">≤</span> Suc <span class="main">0</span><span class="main">;</span> <span class="free">k2</span> <span class="main">≤</span> Suc <span class="main">0</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec <span class="free">m</span>
      <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
      <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output_fun1</span> <span class="main">(</span><span class="free">trans_fun1</span> <span class="main">(</span><span class="free">input_fun1</span> <span class="free">m</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span> <span class="main">=</span>
  <span class="free">output_fun2</span> <span class="main">(</span><span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="free">m</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span> <span class="main">∧</span>
  <span class="free">equiv_states</span>
    <span class="main">(</span><span class="free">localState1</span> <span class="main">(</span><span class="free">trans_fun1</span> <span class="main">(</span><span class="free">input_fun1</span> <span class="free">m</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="free">localState2</span> <span class="main">(</span><span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="free">m</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_stable_set_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"
  Equiv_Exec_stable_set
    UNIV <span class="free">equiv_states</span>
    <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
    <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">=</span>
  Equiv_Exec_stable
    <span class="free">equiv_states</span>
    <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
    <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_stable_set_def Equiv_Exec_stable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_stable_setI<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Equiv_Exec_stable_set <span class="free">A</span>
    <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
    <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">;</span>
    set <span class="free">input</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  Equiv_Exec
        <span class="free">m</span> <span class="free">equiv_states</span>
        <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
        <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
        <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span>
        <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_stable_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_stableI<span class="main">:</span> <span class="quoted"><span class="quoted">"
  Equiv_Exec_stable
    <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
    <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">⟹</span>
  Equiv_Exec <span class="free">m</span>
    <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
    <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_stable_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Reflexitity, symmetry and transitivity results for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Equiv_Exec"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState</span> <span class="bound">c</span><span class="main">)</span> <span class="main">(</span><span class="free">localState</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  Equiv_Exec
    <span class="free">m</span> <span class="free">equiv_states</span>
    <span class="free">localState</span> <span class="free">localState</span> <span class="free">input_fun</span> <span class="free">input_fun</span> <span class="free">output_fun</span> <span class="free">output_fun</span>
    <span class="free">trans_fun</span> <span class="free">trans_fun</span> <span class="free">k</span> <span class="free">k</span> <span class="free">c</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_sym<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">∀</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span>
      <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="bound">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="bound">c2</span><span class="main">)</span> <span class="main">=</span>
      <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState2</span> <span class="bound">c2</span><span class="main">)</span> <span class="main">(</span><span class="free">localState1</span> <span class="bound">c1</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  Equiv_Exec
    <span class="free">m</span> <span class="free">equiv_states</span>
    <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
    <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">=</span>
  Equiv_Exec
    <span class="free">m</span> <span class="free">equiv_states</span>
    <span class="free">localState2</span> <span class="free">localState1</span> <span class="free">input_fun2</span> <span class="free">input_fun1</span> <span class="free">output_fun2</span> <span class="free">output_fun1</span>
    <span class="free">trans_fun2</span> <span class="free">trans_fun1</span> <span class="free">k2</span> <span class="free">k1</span> <span class="free">c2</span> <span class="free">c1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Equiv_Exec_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_sym2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">equiv_states_sym</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="free">equiv_states</span> <span class="bound">s2</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  Equiv_Exec
    <span class="free">m</span> <span class="free">equiv_states</span>
    <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
    <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">=</span>
  Equiv_Exec
    <span class="free">m</span> <span class="free">equiv_states_sym</span>
    <span class="free">localState2</span> <span class="free">localState1</span> <span class="free">input_fun2</span> <span class="free">input_fun1</span> <span class="free">output_fun2</span> <span class="free">output_fun1</span>
    <span class="free">trans_fun2</span> <span class="free">trans_fun1</span> <span class="free">k2</span> <span class="free">k1</span> <span class="free">c2</span> <span class="free">c1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Equiv_Exec_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_sym2_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">∃</span><span class="bound">equiv_states_sym</span><span class="main">.</span>
    Equiv_Exec
      <span class="free">m</span> <span class="free">equiv_states</span>
      <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
      <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">=</span>
    Equiv_Exec
      <span class="free">m</span> <span class="bound">equiv_states_sym</span>
      <span class="free">localState2</span> <span class="free">localState1</span> <span class="free">input_fun2</span> <span class="free">input_fun1</span> <span class="free">output_fun2</span> <span class="free">output_fun1</span>
      <span class="free">trans_fun2</span> <span class="free">trans_fun1</span> <span class="free">k2</span> <span class="free">k1</span> <span class="free">c2</span> <span class="free">c1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Equiv_Exec_sym2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Equiv_Exec
      <span class="free">m</span> <span class="free">equiv_states12</span>
      <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
      <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">;</span>
    Equiv_Exec
      <span class="free">m</span> <span class="free">equiv_states23</span>
      <span class="free">localState2</span> <span class="free">localState3</span> <span class="free">input_fun2</span> <span class="free">input_fun3</span> <span class="free">output_fun2</span> <span class="free">output_fun3</span>
      <span class="free">trans_fun2</span> <span class="free">trans_fun3</span> <span class="free">k2</span> <span class="free">k3</span> <span class="free">c2</span> <span class="free">c3</span><span class="main">;</span>
    <span class="free">equiv_states13</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s1</span> <span class="bound">s3</span><span class="main">.</span> <span class="main">(</span>
      <span class="keyword1">if</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">localState1</span> <span class="free">c1</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">localState3</span> <span class="free">c3</span> <span class="keyword1">then</span>
        <span class="free">equiv_states12</span> <span class="bound">s1</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span> <span class="main">∧</span>
        <span class="free">equiv_states23</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span> <span class="bound">s3</span>
      <span class="keyword1">else</span>
        <span class="free">equiv_states12</span> <span class="bound">s1</span> <span class="main">(</span>
          <span class="free">localState2</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="free">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k2</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="free">equiv_states23</span> <span class="main">(</span>
          <span class="free">localState2</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="free">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k2</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span> <span class="bound">s3</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
    Equiv_Exec
      <span class="free">m</span> <span class="free">equiv_states13</span>
      <span class="free">localState1</span> <span class="free">localState3</span> <span class="free">input_fun1</span> <span class="free">input_fun3</span> <span class="free">output_fun1</span> <span class="free">output_fun3</span>
      <span class="free">trans_fun1</span> <span class="free">trans_fun3</span> <span class="free">k1</span> <span class="free">k3</span> <span class="free">c1</span> <span class="free">c3</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Equiv_Exec_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Equiv_Exec_trans_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Equiv_Exec
      <span class="free">m</span> <span class="free">equiv_states12</span>
      <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
      <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">;</span>
    Equiv_Exec
      <span class="free">m</span> <span class="free">equiv_states23</span>
      <span class="free">localState2</span> <span class="free">localState3</span> <span class="free">input_fun2</span> <span class="free">input_fun3</span> <span class="free">output_fun2</span> <span class="free">output_fun3</span>
      <span class="free">trans_fun2</span> <span class="free">trans_fun3</span> <span class="free">k2</span> <span class="free">k3</span> <span class="free">c2</span> <span class="free">c3</span> <span class="main">⟧</span> <span class="main">⟹</span>
    <span class="main">∃</span><span class="bound">equiv_states13</span><span class="main">.</span> Equiv_Exec
      <span class="free">m</span> <span class="bound">equiv_states13</span>
      <span class="free">localState1</span> <span class="free">localState3</span> <span class="free">input_fun1</span> <span class="free">input_fun3</span> <span class="free">output_fun1</span> <span class="free">output_fun3</span>
      <span class="free">trans_fun1</span> <span class="free">trans_fun3</span> <span class="free">k1</span> <span class="free">k3</span> <span class="free">c1</span> <span class="free">c3</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Equiv_Exec_trans<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A predicate indicating for
  a given local state extraction function and
  a given transition function,
  that components, whose states are equal with regard to the
  local state extraction function,
  are transformed into equal componenents,
  when the transition function is applied with the same input.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Exec_Equal_State</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> Comp_Local_State <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Exec_Equal_State</span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">≡</span>
    <span class="main">∀</span><span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">m</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="bound">c1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="bound">c2</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="bound">m</span> <span class="bound">c1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="bound">m</span> <span class="bound">c2</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Exec_Equal_StateD<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="free">localState</span> <span class="free">c1</span> <span class="main">=</span> <span class="free">localState</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">trans_fun</span> <span class="free">m</span> <span class="free">c1</span> <span class="main">=</span> <span class="free">trans_fun</span> <span class="free">m</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Exec_Equal_State_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Exec_Equal_StateD'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">⟹</span>
  <span class="main">∀</span><span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">m</span><span class="main">.</span> <span class="free">localState</span> <span class="bound">c1</span> <span class="main">=</span> <span class="free">localState</span> <span class="bound">c2</span> <span class="main">⟶</span> <span class="free">trans_fun</span> <span class="bound">m</span> <span class="bound">c1</span> <span class="main">=</span> <span class="free">trans_fun</span> <span class="bound">m</span> <span class="bound">c2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Exec_Equal_State_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Exec_Equal_StateI<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">⋀</span><span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">m</span><span class="main">.</span> <span class="free">localState</span> <span class="bound">c1</span> <span class="main">=</span> <span class="free">localState</span> <span class="bound">c2</span> <span class="main">⟹</span> <span class="free">trans_fun</span> <span class="bound">m</span> <span class="bound">c1</span> <span class="main">=</span> <span class="free">trans_fun</span> <span class="bound">m</span> <span class="bound">c2</span><span class="main">)</span>
  <span class="main">⟹</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Exec_Equal_State_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Equal_State<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span>
  <span class="main">⟦</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="free">localState</span> <span class="bound">c1</span> <span class="main">=</span> <span class="free">localState</span> <span class="bound">c2</span><span class="main">;</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c1</span> <span class="main">=</span> f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Exec_Equal_StateD<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">trans_fun</span> <span class="improper">a</span> <span class="improper">c1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">trans_fun</span> <span class="improper">a</span> <span class="improper">c2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> <span class="var">?c1.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?c2.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Exec_Equal_StateD<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Equal_State<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="free">localState</span> <span class="free">c1</span> <span class="main">=</span> <span class="free">localState</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c1</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_Exec_Stream_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> gr_implies_gr0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Equal_State<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Equal_State<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="free">localState</span> <span class="free">c1</span> <span class="main">=</span> <span class="free">localState</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c1</span> <span class="main">=</span>
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_Exec_Stream_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Equal_State<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Idle states›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">State_Idle</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> Comp_Local_State <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'output</span> message_af<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">State_Idle</span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">state</span></span></span> <span class="main">≡</span>
    <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="bound">c</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">state</span></span></span> <span class="main">⟶</span>
      <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">\&lt;NoMsg&gt;</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">state</span></span></span> <span class="main">∧</span>
      <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">\&lt;NoMsg&gt;</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> State_IdleD<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">state</span><span class="main">;</span>
    <span class="free">localState</span> <span class="free">c</span> <span class="main">=</span> <span class="free">state</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">localState</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">state</span> <span class="main">∧</span>
  <span class="free">output_fun</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> State_Idle_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> State_IdleD'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">state</span> <span class="main">⟹</span>
  <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="free">localState</span> <span class="bound">c</span> <span class="main">=</span> <span class="free">state</span> <span class="main">⟶</span>
  <span class="free">localState</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">state</span> <span class="main">∧</span>
  <span class="free">output_fun</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> State_Idle_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> State_IdleI<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="free">localState</span> <span class="bound">c</span> <span class="main">=</span> <span class="free">state</span> <span class="main">⟹</span>
    <span class="free">localState</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">state</span> <span class="main">∧</span>
    <span class="free">output_fun</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">state</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> State_Idle_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> State_Idle_step<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> State_IdleD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> State_IdleI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> c0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> State_IdleD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_State_Idle_replicate_NoMsg_state<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">localState</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> State_Idle_step<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> State_IdleD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> f_Exec_State_Idle_replicate_NoMsg_gr0_output<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span>
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="bound">c</span><span class="main">)</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> State_IdleD<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> State_Idle_step<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_State_Idle_replicate_NoMsg_output<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    <span class="free">output_fun</span> <span class="free">c</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_State_Idle_replicate_NoMsg_gr0_output<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_State_Idle_replicate_NoMsg_output<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_Exec_Stream_nth min_eqL f_Exec_State_Idle_replicate_NoMsg_gr0_output <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> replicate.simps<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_State_Idle_append_replicate_NoMsg_state<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_append f_Exec_State_Idle_replicate_NoMsg_state<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_State_Idle_append_replicate_NoMsg_ge_state<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> replicate_add append_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_State_Idle_append_replicate_NoMsg_state<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_State_Idle_replicate_NoMsg_ge_state<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cut_tac</span> f_Exec_State_Idle_append_replicate_NoMsg_ge_state<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_State_Idle_append_replicate_NoMsg_gr0_output<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_append f_Exec_State_Idle_replicate_NoMsg_gr0_output<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_State_Idle_append_replicate_NoMsg_gr0_output<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
  map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_append f_Exec_Stream_State_Idle_replicate_NoMsg_output<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_State_Idle_append_replicate_NoMsg_gr_output<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> replicate_add append_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_State_Idle_append_replicate_NoMsg_gr0_output<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_State_Idle_append_replicate_NoMsg_ge_output<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_le_less f_Exec_State_Idle_append_replicate_NoMsg_gr_output<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_State_Idle_replicate_NoMsg_gr_output<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cut_tac</span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> f_Exec_State_Idle_append_replicate_NoMsg_gr_output<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_State_Idle_replicate_NoMsg_ge_output<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_le_less f_Exec_State_Idle_replicate_NoMsg_gr_output<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> State_Idle_append_replicate_NoMsg_output_last_message<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  last_message <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  last_message <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_State_Idle_append_replicate_NoMsg_gr0_output last_message_append_replicate_NoMsg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> State_Idle_append_replicate_NoMsg_output_Msg_eq_last_message<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟧</span> <span class="main">⟹</span>
  last_message <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> State_Idle_append_replicate_NoMsg_output_last_message f_Exec_eq_f_Exec_Stream_last2 <span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> last_message_Msg_eq_last<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_last f_Exec_Stream_not_empty_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> State_Idle_output_Msg_eq_last_message<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟧</span> <span class="main">⟹</span>
  last_message <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> State_Idle_append_replicate_NoMsg_output_Msg_eq_last_message<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> State_Idle_imp_exists_state_change<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>
    <span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="bound">i</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>
    <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟶</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="bound">j</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span>
  a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
  P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> NoMsg<span class="hidden">⇗</span><sup><span class="bound">x</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nat_Suc_predicate_change_exists<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> n1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n1</span> <span class="main">+</span> <span class="main">(</span><span class="improper">j</span> <span class="main">-</span> Suc <span class="improper">n1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> replicate_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> replicate_add f_Exec_State_Idle_append_replicate_NoMsg_state<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> State_Idle_imp_exists_state_change2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="bound">i</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟶</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="bound">j</span></sup><span class="hidden">⇖</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> State_Idle_imp_exists_state_change<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic definitions for accelerated execution›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Stream processing with accelerated components›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_Exec_Comp_Stream_Acc_Output</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="comment1">― ‹Acceleration factor›</span>
    <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'output</span> message_af<span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Output extraction function›</span>
    <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    <span class="tfree">'input</span> fstream_af <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span>
    <span class="tfree">'output</span> fstream_af"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_Exec_Comp_Stream_Acc_Output</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
    <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_Exec_Comp_Stream_Acc_LocalState</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="comment1">― ‹Acceleration factor›</span>
    <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'state</span><span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Local state extraction function›</span>
    <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    <span class="tfree">'input</span> fstream_af <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span>
    <span class="tfree">'state</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_Exec_Comp_Stream_Acc_LocalState</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
    <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_Exec_Comp_Stream_Acc_Output</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="comment1">― ‹Acceleration factor›</span>
    <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'output</span> message_af<span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Output extraction function›</span>
    <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    <span class="tfree">'input</span> istream_af <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span>
    <span class="tfree">'output</span> istream_af"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_Exec_Comp_Stream_Acc_Output</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">input</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">input</span></span></span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_Exec_Comp_Stream_Acc_LocalState</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="comment1">― ‹Acceleration factor›</span>
    <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'state</span><span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Local state extraction function›</span>
    <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    <span class="tfree">'input</span> istream_af <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span>
    <span class="tfree">'state</span> ilist"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_Exec_Comp_Stream_Acc_LocalState</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">input</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">input</span></span></span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_Exec_Comp_Stream_Acc_Output_Init</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="comment1">― ‹Acceleration factor›</span>
    <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'output</span> message_af<span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Output extraction function›</span>
    <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    <span class="tfree">'input</span> fstream_af <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span>
    <span class="tfree">'output</span> fstream_af"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_Exec_Comp_Stream_Acc_Output_Init</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">#</span> f_Exec_Comp_Stream_Acc_Output <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_Exec_Comp_Stream_Acc_LocalState_Init</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="comment1">― ‹Acceleration factor›</span>
    <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'state</span><span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Local state extraction function›</span>
    <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span> <span class="tfree">'input</span> fstream_af <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span>
    <span class="tfree">'state</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_Exec_Comp_Stream_Acc_LocalState_Init</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">#</span> f_Exec_Comp_Stream_Acc_LocalState <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_Exec_Comp_Stream_Acc_Output_Init</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="comment1">― ‹Acceleration factor›</span>
    <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'output</span> message_af<span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Output extraction function›</span>
    <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    <span class="tfree">'input</span> istream_af <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span>
    <span class="tfree">'output</span> istream_af"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_Exec_Comp_Stream_Acc_Output_Init</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">input</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
    <span class="main">[</span><span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span> <span class="main">⌢</span> <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">input</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_Exec_Comp_Stream_Acc_LocalState_Init</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="comment1">― ‹Acceleration factor›</span>
    <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'state</span><span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Local state extraction function›</span>
    <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    <span class="tfree">'input</span> istream_af <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span>
    <span class="tfree">'state</span> ilist"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_Exec_Comp_Stream_Acc_LocalState_Init</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">input</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
    <span class="main">[</span><span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span> <span class="main">⌢</span> <span class="main">(</span>i_Exec_Comp_Stream_Acc_LocalState <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">input</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_length<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  length <span class="main">(</span>f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def f_shrink_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_length<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  length <span class="main">(</span>f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_LocalState_def f_shrink_last_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> f_Exec_Stream_Acc_length <span class="main">=</span>
  f_Exec_Stream_Acc_LocalState_length
  f_Exec_Stream_Acc_Output_length


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic results for accelerated execution›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">[]</span> <span class="free">c</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">[]</span> <span class="free">c</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_LocalState_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> f_Exec_Stream_Acc_Nil <span class="main">=</span>
  f_Exec_Stream_Acc_LocalState_Nil
  f_Exec_Stream_Acc_Output_Nil

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output <span class="main">0</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_LocalState <span class="main">0</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_LocalState_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> f_Exec_Stream_Acc_0 <span class="main">=</span>
  f_Exec_Stream_Acc_LocalState_0
  f_Exec_Stream_Acc_Output_0

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_LocalState <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  map <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_LocalState_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Acc_Output <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span>
  <span class="free">output_fun</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_LocalState_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Acc_LocalState <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span>
  <span class="free">localState</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_LocalState_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_eq_last_message_hold<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def f_shrink_eq_f_last_message_hold_shrink_last<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_eq_last_message_hold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_eq_i_last_message_hold_shrink_last<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def f_shrink_def f_Exec_Stream_expand_aggregate_map_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def f_shrink_def f_Exec_Stream_expand_aggregate_map_drop<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def i_Exec_Comp_Stream_Acc_Output_def
  f_shrink_def i_shrink_def i_Exec_Stream_expand_aggregate_map_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">⇑</span> <span class="free">n</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_def i_Exec_Stream_expand_aggregate_map_drop<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_LocalState_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_LocalState_def i_Exec_Comp_Stream_Acc_LocalState_def
  f_shrink_last_def i_shrink_last_def i_Exec_Stream_expand_aggregate_map_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_LocalState_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">⇑</span> <span class="free">n</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_LocalState_def i_shrink_last_def i_Exec_Stream_expand_aggregate_map_drop<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">@</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">ys</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def f_shrink_def f_Exec_Stream_expand_map_aggregate_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  last_message <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def f_shrink_def f_Exec_Stream_expand_map_aggregate_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_one<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="free">c</span> <span class="main">=</span>
  <span class="main">[</span>last_message <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_Output_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">@</span>
  <span class="main">[</span>last_message <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_Output_append f_Exec_Stream_Acc_Output_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">input</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">⌢</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def i_Exec_Comp_Stream_Acc_Output_def f_shrink_def i_shrink_def i_Exec_Stream_expand_map_aggregate_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⌢</span> <span class="free">input</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  <span class="main">[</span>last_message <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">⌢</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_Output_append f_Exec_Stream_Acc_Output_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">@</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">ys</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_LocalState_def f_shrink_last_def f_Exec_Stream_expand_map_aggregate_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span>  <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">#</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> f_Exec_Comp_Stream_Acc_LocalState_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_shrink_last_map f_expand_Cons append_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_append replicate_pred_Cons_length f_shrink_last_Cons <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Cons append_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_eq_f_Exec_Stream_last2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_Exec_Stream_empty_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_one<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="free">c</span> <span class="main">=</span>
  <span class="main">[</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">@</span>
  <span class="main">[</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_append f_Exec_Stream_Acc_LocalState_Cons f_Exec_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_LocalState_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">input</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">⌢</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_LocalState_def i_Exec_Comp_Stream_Acc_LocalState_def f_shrink_last_def i_shrink_last_def i_Exec_Stream_expand_map_aggregate_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_LocalState_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⌢</span> <span class="free">input</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  <span class="main">[</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span>  <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">]</span> <span class="main">⌢</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="main">(</span>
    f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_LocalState_append f_Exec_Stream_Acc_LocalState_one f_expand_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  last_message <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>
    f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">(</span>
      f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> f_Exec_Comp_Stream_Acc_Output_def f_shrink_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_Exec_Stream_expand_aggregate_map_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_nth_eq_i_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n'</span><span class="main">)</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> f_Exec_Comp_Stream_Acc_Output_def i_Exec_Comp_Stream_Acc_Output_def f_shrink_def i_shrink_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_Exec_Stream_expand_aggregate_map_nth_eq_i_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span>
  last_message <span class="main">(</span>map <span class="free">output_fun</span> <span class="main">(</span>
    f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="free">n</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">(</span>
      f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_Exec_Stream_expand_aggregate_map_nth<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_Acc_Output_nth_f_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> Suc <span class="free">n</span><span class="main">)</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_Output_nth_eq_i_nth<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_Acc_Output_nth_f_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span>
  last <span class="main">(</span>f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> Suc <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_Output_nth_f_nth last_nth length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> Suc <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_LocalState_def f_shrink_last_map<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_nth' f_shrink_last_length <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mult_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_nth less_imp_Suc_mult_pred_less f_expand_take_mod <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mult_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_nth_eq_i_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n'</span><span class="main">)</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> f_Exec_Comp_Stream_Acc_LocalState_def i_Exec_Comp_Stream_Acc_LocalState_def f_shrink_last_def i_shrink_last_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_Exec_Stream_expand_aggregate_map_nth_eq_i_nth<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_Acc_LocalState_nth_f_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> Suc <span class="free">n</span><span class="main">)</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth_eq_i_nth<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_Acc_LocalState_nth_f_last<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span>
  last <span class="main">(</span>f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> Suc <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_LocalState_nth_f_nth last_nth length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_LocalState_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> Suc <span class="free">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_LocalState_nth_f_nth f_Exec_Stream_Acc_LocalState_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_Output_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">input1</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">input2</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input2</span> <span class="free">c</span> <span class="main">⇓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_Output_take<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Connected_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">↓</span> <span class="free">n</span><span class="main">;</span>
    f_Streams_Connected
      <span class="main">(</span>f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>
      <span class="free">channel1</span><span class="main">;</span>
    f_Streams_Connected
      <span class="main">(</span>f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span><span class="main">)</span>
      <span class="free">channel2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">channel1</span> <span class="main">↓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="free">channel2</span> <span class="main">↓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Streams_Connected_def f_Exec_Stream_Acc_Output_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_Connected_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">input1</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">input2</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">;</span>
    i_Streams_Connected
      <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span><span class="main">)</span>
      <span class="free">channel1</span><span class="main">;</span>
    i_Streams_Connected
      <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input2</span> <span class="free">c</span><span class="main">)</span>
      <span class="free">channel2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">channel1</span> <span class="main">⇓</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="free">channel2</span> <span class="main">⇓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> i_Streams_Connected_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_Output_take<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Complete execution cycles/steps of accelrated execution›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Acc_Trans_Fun_Step</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="comment1">― ‹Acceleration factor›</span>
    <span class="main">(</span><span class="tfree">'comp</span><span class="main">,</span> <span class="tfree">'input</span> message_af<span class="main">)</span> Comp_Trans_Fun <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'comp</span> list <span class="main">⇒</span> <span class="tfree">'comp</span><span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Pointwise output shrink function›</span>
    <span class="tfree">'input</span> message_af <span class="main">⇒</span> <span class="tfree">'comp</span> <span class="main">⇒</span>
    <span class="tfree">'comp</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Acc_Trans_Fun_Step</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="free"><span class="bound"><span class="entity">pointwise_shrink</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
    <span class="free"><span class="bound"><span class="entity">pointwise_shrink</span></span></span> <span class="main">(</span>f_Exec_Comp_Stream <span class="free"><span class="bound"><span class="entity">trans_fun</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_Pointwise_Output_Shrink</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span> list <span class="main">⇒</span> <span class="tfree">'comp</span><span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Pointwise output shrink function›</span>
    <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'output</span> message_af<span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Output extraction function for consideration›</span>
    bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_Pointwise_Output_Shrink</span> <span class="free"><span class="bound"><span class="entity">pointwise_shrink</span></span></span> <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="main">≡</span>
    <span class="main">∀</span><span class="bound">cs</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pointwise_shrink</span></span></span> <span class="bound">cs</span><span class="main">)</span> <span class="main">=</span> last_message <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">output_fun</span></span></span> <span class="bound">cs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">is_Pointwise_Output_Shrink_list</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span> list <span class="main">⇒</span> <span class="tfree">'comp</span><span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Pointwise output shrink function›</span>
    <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'output</span> message_af<span class="main">)</span> list <span class="main">⇒</span> <span class="comment1">― ‹List of output extraction functions for consideration›</span>
    bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_Pointwise_Output_Shrink_list</span> <span class="free"><span class="bound"><span class="entity">pointwise_shrink</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_Pointwise_Output_Shrink_list</span> <span class="free"><span class="bound"><span class="entity">pointwise_shrink</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span>is_Pointwise_Output_Shrink <span class="free"><span class="bound"><span class="entity">pointwise_shrink</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span>
     <span class="free">is_Pointwise_Output_Shrink_list</span> <span class="free"><span class="bound"><span class="entity">pointwise_shrink</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_correct_localState_Pointwise_Output_Shrink</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'comp</span> list <span class="main">⇒</span> <span class="tfree">'comp</span><span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Pointwise output shrink function›</span>
    <span class="main">(</span><span class="tfree">'comp</span> <span class="main">⇒</span> <span class="tfree">'state</span><span class="main">)</span> <span class="main">⇒</span> <span class="comment1">― ‹Local state extraction function›</span>
    bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_correct_localState_Pointwise_Output_Shrink</span> <span class="free"><span class="bound"><span class="entity">pointwise_shrink</span></span></span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="main">≡</span>
    <span class="main">∀</span><span class="bound">cs</span><span class="main">.</span> <span class="bound">cs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pointwise_shrink</span></span></span> <span class="bound">cs</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">localState</span></span></span> <span class="main">(</span>last <span class="bound">cs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Deterministic_trans_fun_imp_acc_trans_fun<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Deterministic_Trans_Fun <span class="free">trans_fun</span> <span class="free">localState</span> <span class="main">⟹</span>
    Deterministic_Trans_Fun <span class="main">(</span>Acc_Trans_Fun_Step <span class="free">k</span> <span class="free">trans_fun</span> <span class="free">pointwise_shrink</span><span class="main">)</span> <span class="free">localState</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Deterministic_Trans_Fun_def Acc_Trans_Fun_Step_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Deterministic_f_Exec_Stream<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_Pointwise_Output_Shrink_list_imp_is_Pointwise_Output_Shrink<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> is_Pointwise_Output_Shrink_list <span class="free">pointwise_shrink</span> <span class="free">fs</span><span class="main">;</span> <span class="free">output_fun</span> <span class="main">∈</span> set <span class="free">fs</span> <span class="main">⟧</span> <span class="main">⟹</span>
    is_Pointwise_Output_Shrink <span class="free">pointwise_shrink</span> <span class="free">output_fun</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_Pointwise_Output_Shrink_list_eq_is_Pointwise_Output_Shrink_all<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>is_Pointwise_Output_Shrink_list <span class="free">pointwise_shrink</span> <span class="free">fs</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">output_fun</span> <span class="main">∈</span> set <span class="free">fs</span><span class="main">.</span> is_Pointwise_Output_Shrink <span class="free">pointwise_shrink</span> <span class="bound">output_fun</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> is_Pointwise_Output_Shrink_list_imp_is_Pointwise_Output_Shrink<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_Pointwise_Output_Shrink_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> is_Pointwise_Output_Shrink_list <span class="free">pointwise_shrink</span> <span class="free">fs</span><span class="main">;</span> set <span class="free">fs'</span> <span class="main">⊆</span> set <span class="free">fs</span> <span class="main">⟧</span> <span class="main">⟹</span>
    is_Pointwise_Output_Shrink_list <span class="free">pointwise_shrink</span> <span class="free">fs'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_Pointwise_Output_Shrink_list_eq_is_Pointwise_Output_Shrink_all<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_eq_Acc_Trans_Fun_Step_LocalState<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span>
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    Deterministic_Trans_Fun <span class="free">trans_fun</span> <span class="free">localState</span><span class="main">;</span>
    is_correct_localState_Pointwise_Output_Shrink <span class="free">pointwise_shrink</span> <span class="free">localState</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span> <span class="main">=</span>
  map <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="main">(</span>Acc_Trans_Fun_Step <span class="free">k</span> <span class="free">trans_fun</span> <span class="free">pointwise_shrink</span><span class="main">)</span> <span class="free">xs</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Deterministic_trans_fun_imp_acc_trans_fun<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">pointwise_shrink</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth f_Exec_Stream_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x xs c i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Acc_Trans_Fun_Step_def f_expand_Cons f_Exec_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_correct_localState_Pointwise_Output_Shrink_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="improper">x</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_not_empty_conv f_Exec_eq_f_Exec_Stream_last<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> i2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="improper">x</span> <span class="improper">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_correct_localState_Pointwise_Output_Shrink_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="improper">x</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_not_empty_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">localState</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Deterministic_f_Exec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_eq_f_Exec_Stream_last<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_eq_Acc_Trans_Fun_Step_Output<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span>
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    Deterministic_Trans_Fun <span class="free">trans_fun</span> <span class="free">localState</span><span class="main">;</span>
    is_correct_localState_Pointwise_Output_Shrink <span class="free">pointwise_shrink</span> <span class="free">localState</span><span class="main">;</span>
    is_Pointwise_Output_Shrink <span class="free">pointwise_shrink</span> <span class="free">output_fun</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span> <span class="main">=</span>
  map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream <span class="main">(</span>Acc_Trans_Fun_Step <span class="free">k</span> <span class="free">trans_fun</span> <span class="free">pointwise_shrink</span><span class="main">)</span> <span class="free">xs</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Deterministic_trans_fun_imp_acc_trans_fun<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">pointwise_shrink</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_Output_nth f_Exec_Stream_nth <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x xs c i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Acc_Trans_Fun_Step_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_Pointwise_Output_Shrink_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> i2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="improper">x</span> <span class="improper">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_correct_localState_Pointwise_Output_Shrink_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="improper">x</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_not_empty_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Deterministic_f_Exec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_eq_f_Exec_Stream_last<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_LocalState_eq_Acc_Trans_Fun_Step_LocalState<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span>
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    Deterministic_Trans_Fun <span class="free">trans_fun</span> <span class="free">localState</span><span class="main">;</span>
    is_correct_localState_Pointwise_Output_Shrink <span class="free">pointwise_shrink</span> <span class="free">localState</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="bound">c</span> <span class="main">=</span>
  <span class="free">localState</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="main">(</span>Acc_Trans_Fun_Step <span class="free">k</span> <span class="free">trans_fun</span> <span class="free">pointwise_shrink</span><span class="main">)</span> <span class="free">input</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ilist_i_take_eq_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_LocalState_take i_Exec_Stream_take f_Exec_Stream_Acc_LocalState_eq_Acc_Trans_Fun_Step_LocalState<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_eq_Acc_Trans_Fun_Step_Output<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span>
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    Deterministic_Trans_Fun <span class="free">trans_fun</span> <span class="free">localState</span><span class="main">;</span>
    is_correct_localState_Pointwise_Output_Shrink <span class="free">pointwise_shrink</span> <span class="free">localState</span><span class="main">;</span>
    is_Pointwise_Output_Shrink <span class="free">pointwise_shrink</span> <span class="free">output_fun</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="bound">c</span> <span class="main">=</span>
  <span class="free">output_fun</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="main">(</span>Acc_Trans_Fun_Step <span class="free">k</span> <span class="free">trans_fun</span> <span class="free">pointwise_shrink</span><span class="main">)</span> <span class="free">input</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ilist_i_take_eq_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_Output_take i_Exec_Stream_take f_Exec_Stream_Acc_Output_eq_Acc_Trans_Fun_Step_Output<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic results for accelerated execution with initial state in the resulting stream›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Init_length<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  length <span class="main">(</span>f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_Init_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_Init_length<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  length <span class="main">(</span>f_Exec_Comp_Stream_Acc_LocalState_Init <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_LocalState_Init_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Init_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">[]</span> <span class="free">c</span> <span class="main">=</span> <span class="main">[</span><span class="free">output_fun</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_Init_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_Init_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_LocalState_Init <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="main">[]</span> <span class="free">c</span> <span class="main">=</span> <span class="main">[</span><span class="free">localState</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_LocalState_Init_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Init_1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output_Init <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  map <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_Init_def f_Exec_Stream_Init_eq_f_Exec_Stream_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState_Init_1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_LocalState_Init <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  map <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_LocalState_Init_def f_Exec_Stream_Init_eq_f_Exec_Stream_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_Init_1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Acc_Output_Init <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span>
  <span class="free">output_fun</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_Init_def i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_LocalState_Init_1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Acc_LocalState_Init <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span>
  <span class="free">localState</span> <span class="main">∘</span> <span class="main">(</span>i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_LocalState_Init_def i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Init_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">↓</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_Init_def f_Exec_Stream_Acc_Output_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Init_drop'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">↑</span> Suc <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">↑</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_Init_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_Init_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">⇓</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_Init_def i_Exec_Comp_Stream_Acc_Output_Init_def i_Exec_Stream_Acc_Output_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_Init_drop'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">⇑</span> Suc <span class="free">n</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">⇑</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_Init_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Init_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">↓</span> Suc <span class="free">n</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">ys</span> <span class="free">c</span> <span class="main">↓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_Init_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_Exec_Stream_Acc_Output_causal<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_Init_strictly_causal<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">input1</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">input2</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input1</span> <span class="free">c</span> <span class="main">⇓</span> Suc <span class="free">n</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input2</span> <span class="free">c</span> <span class="main">⇓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_Init_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_Exec_Stream_Acc_Output_causal<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Init_eq_f_Exec_Stream_Acc_Output_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  <span class="free">output_fun</span> <span class="free">c</span> <span class="main">#</span> f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream_Acc_Output_def f_Exec_Comp_Stream_Acc_Output_Init_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Init_eq_f_Exec_Stream_Acc_Output_Cons_output<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">output_fun</span> <span class="free">c</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  <span class="main">\&lt;NoMsg&gt;</span> <span class="main">#</span> f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_Output_Init_eq_f_Exec_Stream_Acc_Output_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream__Acc_OutputInit_tl_eq_f_Exec_Stream_Acc_Output<span class="main">:</span> <span class="quoted"><span class="quoted">"
  tl <span class="main">(</span>f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_Output_Init_eq_f_Exec_Stream_Acc_Output_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Previous_f_Exec_Stream_Acc_Output_Init<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span>
  <span class="main">(</span>f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span><span class="hidden">⇗</span><sup>←' <span class="free">output_fun</span> <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_Output_Init_eq_f_Exec_Stream_Acc_Output_Cons list_Previous_nth_if nth_Cons'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output_Init_eq_output_channel<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">output_fun</span> <span class="free">c</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    f_Streams_Connected
      <span class="main">(</span>f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span><span class="main">)</span>
      <span class="free">channel</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span> <span class="free">channel</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Streams_Connected_def f_Exec_Stream_Acc_Output_Init_eq_f_Exec_Stream_Acc_Output_Cons_output<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_Init_eq_i_Exec_Stream_Acc_Output_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span>
  <span class="main">[</span><span class="free">output_fun</span> <span class="free">c</span><span class="main">]</span> <span class="main">⌢</span> i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_Exec_Comp_Stream_Acc_Output_Init_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_Init_eq_i_Exec_Stream_Acc_Output_Cons_output<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">output_fun</span> <span class="free">c</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span>
  <span class="main">[</span><span class="main">\&lt;NoMsg&gt;</span> <span class="main">]</span> <span class="main">⌢</span> i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_Output_Init_eq_i_Exec_Stream_Acc_Output_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Previous_i_Exec_Stream_Acc_Output_Init<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span><span class="hidden">⇗</span><sup>← <span class="free">output_fun</span> <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_Output_Init_eq_i_Exec_Stream_Acc_Output_Cons ilist_Previous_nth_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output_Init_eq_output_channel<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">output_fun</span> <span class="free">c</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    i_Streams_Connected
      <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span>
      <span class="free">channel</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output_Init <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span> <span class="free">channel</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Streams_Connected_def i_Exec_Stream_Acc_Output_Init_eq_i_Exec_Stream_Acc_Output_Cons_output<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Rules for proving execution equivalence›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A required precondition is that the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> relation,
  which indicates whether the local states of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c2</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  are equivalent with respect to observable behaviour,
  is preserved also after executing an input stream,
  because the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> relation
  should deliver valid results not only at the time point <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  but at every time point.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Equiv_Exec_Stream_expand_shrink_equiv_state_set<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span>
   <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
   <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="bound">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="bound">c2</span><span class="main">)</span><span class="main">;</span>
   <span class="main">∀</span><span class="bound">input0</span><span class="main">.</span> set <span class="bound">input0</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span>
      Equiv_Exec <span class="bound">m</span> <span class="free">equiv_states</span>
      <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
      <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
      <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="bound">c1</span><span class="main">)</span>
      <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="bound">c2</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>equiv_states›</span></span> relation implies equivalent executions›</span>
      <span class="comment1">― ‹not only at the beginning but also after processing an input›</span>
   set <span class="free">input</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">input</span> <span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">equiv_states</span>
     <span class="main">(</span><span class="free">localState1</span> <span class="main">(</span><span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="bound">c1</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k1</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span><span class="free">localState2</span> <span class="main">(</span><span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="bound">c2</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k2</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">input</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_Exec_Stream_append_if f_shrink_last_Cons nth_Cons <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> last.simps f_Exec_Stream_Cons append_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> last.simps f_Exec_Stream_Cons<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_Exec_eq_f_Exec_Stream_last2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Equiv_Exec_equiv_statesI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> i'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_Exec_eq_f_Exec_Stream_last2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span><span class="free">input_fun1</span> <span class="improper">a</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k1</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="improper">a</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k2</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Equiv_Exec_equiv_statesI'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_mp<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">#</span> <span class="improper">input0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_Equiv_Exec_Stream_expand_shrink_equiv_state<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">input0</span> <span class="bound">m</span><span class="main">.</span> Equiv_Exec <span class="bound">m</span>
       <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
       <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
       <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span>
       <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    <span class="free">i</span><span class="main">&lt;</span>length <span class="free">input</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">equiv_states</span>
    <span class="main">(</span><span class="free">localState1</span> <span class="main">(</span><span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k1</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="free">localState2</span> <span class="main">(</span><span class="main">(</span>f_Exec_Comp_Stream <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span> ÷<span class="hidden">⇘</span><sub>fl</sub><span class="hidden">⇙</span> <span class="free">k2</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_Equiv_Exec_Stream_expand_shrink_equiv_state_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c2</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">UNIV</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun2</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Equiv_Exec_expand_shrink_equiv_state_set<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span> <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">input0</span> <span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span>set <span class="bound">input0</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span>
       Equiv_Exec
         <span class="bound">m</span> <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
         <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span> <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    set <span class="free">input</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">equiv_states</span>
    <span class="main">(</span><span class="free">localState1</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="free">localState2</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">input</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"map <span class="free">input_fun1</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> map <span class="free">input_fun2</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_eq_f_Exec_Stream_last2 last_nth f_Exec_Stream_not_empty_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> f_shrink_last_nth<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"length <span class="free"><span class="free">input</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"f_Exec_Comp_Stream <span class="free"><span class="free">trans_fun1</span></span> <span class="main"><span class="main">(</span></span>map <span class="free"><span class="free">input_fun1</span></span> <span class="free"><span class="free">input</span></span> <span class="keyword1"><span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="free"><span class="free">k1</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">c1</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> f_shrink_last_nth<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"length <span class="free"><span class="free">input</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"f_Exec_Comp_Stream <span class="free"><span class="free">trans_fun2</span></span> <span class="main"><span class="main">(</span></span>map <span class="free"><span class="free">input_fun2</span></span> <span class="free"><span class="free">input</span></span> <span class="keyword1"><span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="free"><span class="free">k2</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">c2</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib gr0_imp_self_le_mult2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Equiv_Exec_Stream_expand_shrink_equiv_state_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Equiv_Exec_expand_shrink_equiv_state<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span> <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">input0</span> <span class="bound">m</span><span class="main">.</span>
       Equiv_Exec
         <span class="bound">m</span> <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
         <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span> <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">equiv_states</span>
    <span class="main">(</span><span class="free">localState1</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="free">localState2</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_Equiv_Exec_expand_shrink_equiv_state_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">UNIV</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun2</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Equiv_Exec_Stream_expand_shrink_equiv_state_set<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span> <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">input0</span> <span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span>set <span class="bound">input0</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span>
       Equiv_Exec
        <span class="bound">m</span> <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
        <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span> <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
       <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span>
       <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    range <span class="free">input</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">equiv_states</span>
    <span class="main">(</span><span class="free">localState1</span> <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun1</span> <span class="main">(</span><span class="main">(</span><span class="free">input_fun1</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k1</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="free">localState2</span> <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun2</span> <span class="main">(</span><span class="main">(</span><span class="free">input_fun2</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k2</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_last_nth i_Exec_Stream_nth i_expand_i_take_mod<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Equiv_Exec_expand_shrink_equiv_state_set<span class="main"><span class="main">[</span></span><span class="operator">of</span>
  <span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set_i_take_subset<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Equiv_Exec_Stream_expand_shrink_equiv_state<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span> <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">input0</span> <span class="bound">m</span><span class="main">.</span>
       Equiv_Exec
        <span class="bound">m</span> <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
        <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span> <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
       <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span>
       <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">equiv_states</span>
    <span class="main">(</span><span class="free">localState1</span> <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun1</span> <span class="main">(</span><span class="main">(</span><span class="free">input_fun1</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k1</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="free">localState2</span> <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun2</span> <span class="main">(</span><span class="main">(</span><span class="free">input_fun2</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span> ÷<span class="hidden">⇘</span><sub>il</sub><span class="hidden">⇙</span> <span class="free">k2</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i_Equiv_Exec_Stream_expand_shrink_equiv_state_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c2</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">UNIV</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun2</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_Equiv_Exec_Stream_expand_shrink_output_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">input0</span> <span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span> set <span class="bound">input0</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
       Equiv_Exec
         <span class="bound">m</span> <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
         <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span> <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    set <span class="free">input</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>map <span class="free">output_fun1</span> <span class="main">(</span>
    f_Exec_Comp_Stream <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span> <span class="main">=</span>
  <span class="main">(</span>map <span class="free">output_fun2</span> <span class="main">(</span>
    f_Exec_Comp_Stream <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_shrink_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> last.simps f_Exec_Stream_Cons <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_nth take_map drop_map f_Exec_Stream_take f_Exec_Stream_drop f_expand_take_mod f_expand_drop_mod take_first<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set_take_subset<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> atomize_all atomize_imp<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"take <span class="improper">i</span> <span class="free">input</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">input</span> <span class="main">!</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> nth_mem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> last.simps f_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Equiv_Exec_output_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_Exec_Stream_expand_shrink_last_nth_eq_f_Exec_Comp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Suc_lessD<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Equiv_Exec_Stream_expand_shrink_equiv_state_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k1</span></span> <span class="quoted"><span class="free">k2</span></span> <span class="quoted"><span class="free">equiv_states</span></span> <span class="quoted"><span class="free">localState1</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">localState2</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">input_fun1</span></span> <span class="quoted"><span class="free">input_fun2</span></span> <span class="quoted"><span class="free">output_fun1</span></span> <span class="quoted"><span class="free">output_fun2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Equiv_Exec_Stream_expand_shrink_output_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">input0</span> <span class="bound">m</span><span class="main">.</span>
       Equiv_Exec
         <span class="bound">m</span> <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
         <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
         <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>map <span class="free">output_fun1</span> <span class="main">(</span>
    f_Exec_Comp_Stream <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span> <span class="main">=</span>
  <span class="main">(</span>map <span class="free">output_fun2</span> <span class="main">(</span>
    f_Exec_Comp_Stream <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_Equiv_Exec_Stream_expand_shrink_output_set_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">UNIV</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Equiv_Exec_Stream_expand_shrink_output_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">input0</span> <span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span> set <span class="bound">input0</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
       Equiv_Exec
         <span class="bound">m</span> <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
         <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
         <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    range <span class="free">input</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">output_fun1</span> <span class="main">∘</span>
    i_Exec_Comp_Stream <span class="free">trans_fun1</span> <span class="main">(</span><span class="main">(</span><span class="free">input_fun1</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k1</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">output_fun2</span> <span class="main">∘</span>
    i_Exec_Comp_Stream <span class="free">trans_fun2</span> <span class="main">(</span><span class="main">(</span><span class="free">input_fun2</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> last.simps f_Exec_Stream_Cons <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_nth i_Exec_Stream_take i_Exec_Stream_drop i_expand_i_take_mod i_expand_i_drop_mod i_take_first map_one f_expand_one<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Equiv_Exec_output_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span>
  <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span>
  <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Equiv_Exec_expand_shrink_equiv_state_set<span class="main"><span class="main">[</span></span><span class="operator">of</span>
  <span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span>
  <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set_i_take_subset<span class="main"><span class="main">]</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ rangeI<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Equiv_Exec_Stream_expand_shrink_output_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">input0</span> <span class="bound">m</span><span class="main">.</span>
       Equiv_Exec
         <span class="bound">m</span> <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
         <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span> <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span>
         <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="bound">input0</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">output_fun1</span> <span class="main">∘</span>
    i_Exec_Comp_Stream <span class="free">trans_fun1</span> <span class="main">(</span><span class="main">(</span><span class="free">input_fun1</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k1</span><span class="main">)</span> <span class="free">c1</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k1</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">output_fun2</span> <span class="main">∘</span>
    i_Exec_Comp_Stream <span class="free">trans_fun2</span> <span class="main">(</span><span class="main">(</span><span class="free">input_fun2</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k2</span><span class="main">)</span> <span class="free">c2</span><span class="main">)</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Equiv_Exec_Stream_expand_shrink_output_set_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span>
  <span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c2</span></span></span></span> <span class="quoted"><span class="quoted">UNIV</span></span>
  <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> f_Equiv_Exec_Stream_Acc_LocalState_set<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec_stable_set <span class="free">A</span>
      <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
      <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
      <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">;</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>equiv_states›</span></span> relation implies equivalent executions›</span>
      <span class="comment1">― ‹not only at the beginning but also after processing an input›</span>
    set <span class="free">input</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span>
    <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">input</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">equiv_states</span>
    <span class="main">(</span>f_Exec_Comp_Stream_Acc_LocalState <span class="free">k1</span> <span class="free">localState1</span> <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span><span class="main">)</span> <span class="free">c1</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp_Stream_Acc_LocalState <span class="free">k2</span> <span class="free">localState2</span> <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span><span class="main">)</span> <span class="free">c2</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> f_Exec_Comp_Stream_Acc_LocalState_def Equiv_Exec_stable_set_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_shrink_last_map f_shrink_last_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Equiv_Exec_Stream_expand_shrink_equiv_state_set<span class="main"><span class="main">[</span></span><span class="operator">of</span>
  <span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span>
  <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Equiv_Exec_Stream_Acc_LocalState<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec_stable
      <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
      <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
      <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">;</span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>equiv_states›</span></span> relation implies equivalent executions›</span>
      <span class="comment1">― ‹not only at the beginning but also after processing an input›</span>
    <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">input</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">equiv_states</span>
    <span class="main">(</span>f_Exec_Comp_Stream_Acc_LocalState <span class="free">k1</span> <span class="free">localState1</span> <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span><span class="main">)</span> <span class="free">c1</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>
    <span class="main">(</span>f_Exec_Comp_Stream_Acc_LocalState <span class="free">k2</span> <span class="free">localState2</span> <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span><span class="main">)</span> <span class="free">c2</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Equiv_Exec_Stream_Acc_LocalState_set<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_stable_set_UNIV<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Equiv_Exec_Stream_Acc_Output_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec_stable_set <span class="free">A</span>
      <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
      <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span> <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">;</span>
    set <span class="free">input</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k1</span> <span class="free">output_fun1</span> <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span><span class="main">)</span> <span class="free">c1</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k2</span> <span class="free">output_fun2</span> <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span><span class="main">)</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> f_Exec_Comp_Stream_Acc_Output_def Equiv_Exec_stable_set_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Equiv_Exec_Stream_expand_shrink_output_set_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span>
  <span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c2</span></span></span></span>
  <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">input</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Equiv_Exec_Stream_Acc_Output_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec_stable
      <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
      <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span> <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k1</span> <span class="free">output_fun1</span> <span class="free">trans_fun1</span> <span class="main">(</span>map <span class="free">input_fun1</span> <span class="free">input</span><span class="main">)</span> <span class="free">c1</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k2</span> <span class="free">output_fun2</span> <span class="free">trans_fun2</span> <span class="main">(</span>map <span class="free">input_fun2</span> <span class="free">input</span><span class="main">)</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Equiv_Exec_Stream_Acc_Output_set_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c2</span></span></span></span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_stable_set_UNIV<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> i_Equiv_Exec_Stream_Acc_LocalState_set<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec_stable_set <span class="free">A</span>
      <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span> <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
      <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">;</span>
    range <span class="free">input</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">equiv_states</span>
    <span class="main">(</span>i_Exec_Comp_Stream_Acc_LocalState <span class="free">k1</span> <span class="free">localState1</span> <span class="free">trans_fun1</span> <span class="main">(</span><span class="free">input_fun1</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="free">c1</span> <span class="free">i</span><span class="main">)</span>
    <span class="main">(</span>i_Exec_Comp_Stream_Acc_LocalState <span class="free">k2</span> <span class="free">localState2</span> <span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="free">c2</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_LocalState_nth_f_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Equiv_Exec_Stream_Acc_LocalState_set<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set_i_take_subset<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Equiv_Exec_Stream_Acc_LocalState<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec_stable
      <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
      <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span>
      <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">equiv_states</span>
    <span class="main">(</span>i_Exec_Comp_Stream_Acc_LocalState <span class="free">k1</span> <span class="free">localState1</span> <span class="free">trans_fun1</span> <span class="main">(</span><span class="free">input_fun1</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="free">c1</span> <span class="free">i</span><span class="main">)</span>
    <span class="main">(</span>i_Exec_Comp_Stream_Acc_LocalState <span class="free">k2</span> <span class="free">localState2</span> <span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="free">c2</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Equiv_Exec_Stream_Acc_LocalState_set<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_stable_set_UNIV<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Equiv_Exec_Stream_Acc_Output_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec_stable_set <span class="free">A</span>
      <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
      <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span> <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">;</span>
    range <span class="free">input</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k1</span> <span class="free">output_fun1</span> <span class="free">trans_fun1</span> <span class="main">(</span><span class="free">input_fun1</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="free">c1</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k2</span> <span class="free">output_fun2</span> <span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_Exec_Stream_Acc_Output_nth_f_nth<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set_i_take_subset<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Equiv_Exec_Stream_Acc_Output_set_eq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> equiv_states<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">equiv_states</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Equiv_Exec_Stream_Acc_Output_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k1</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k2</span><span class="main">;</span>
    <span class="free">equiv_states</span> <span class="main">(</span><span class="free">localState1</span> <span class="free">c1</span><span class="main">)</span> <span class="main">(</span><span class="free">localState2</span> <span class="free">c2</span><span class="main">)</span><span class="main">;</span>
    Equiv_Exec_stable
      <span class="free">equiv_states</span> <span class="free">localState1</span> <span class="free">localState2</span>
      <span class="free">input_fun1</span> <span class="free">input_fun2</span> <span class="free">output_fun1</span> <span class="free">output_fun2</span> <span class="free">trans_fun1</span> <span class="free">trans_fun2</span> <span class="free">k1</span> <span class="free">k2</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k1</span> <span class="free">output_fun1</span> <span class="free">trans_fun1</span> <span class="main">(</span><span class="free">input_fun1</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="free">c1</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k2</span> <span class="free">output_fun2</span> <span class="free">trans_fun2</span> <span class="main">(</span><span class="free">input_fun2</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Equiv_Exec_Stream_Acc_Output_set_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">equiv_states</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c2</span></span></span></span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Equiv_Exec_stable_set_UNIV<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Idle states and accelerated execution›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState__State_Idle_nth<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">c</span> <span class="bound">i</span><span class="main">.</span>
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≤</span><span class="bound">i</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      f_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span>
    <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="bound">c</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> gr_implies_gr0<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth take_Suc_conv_app_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_expand_snoc f_Exec_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">l</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">@</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span><span class="main">-</span><span class="free">l</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> replicate_le_diff2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> append_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_Cons f_Exec_State_Idle_append_replicate_NoMsg_state<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="improper">a</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">l</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> length_greater_imp_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_mp<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth f_Exec_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_expand_Cons f_Exec_append <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="improper">a</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c</span><span class="main">)</span> <span class="main">=</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="improper">a</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">l</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_Cons<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> replicate_le_diff2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc_leI<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_Exec_append <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_State_Idle_replicate_NoMsg_state<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span>
   <span class="var">?c1.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="improper">a</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
   xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">xs</span> <span class="main">!</span> <span class="main">0</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">l</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> f_Exec_Equal_State<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span>
  <span class="var">?c1.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="improper">a</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
  xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">xs</span> <span class="main">↓</span> <span class="improper">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> f_Exec_Equal_State<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_expand_not_empty_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_Exec_Stream_Acc_LocalState__State_Idle_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      f_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_Acc_LocalState__State_Idle_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_LocalState__State_Idle_nth<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≤</span><span class="free">i</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">i</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth_eq_i_nth<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_Acc_LocalState__State_Idle_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth_eq_i_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Stream_Acc_LocalState__State_Idle_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Exec_Stream_Acc_LocalState__State_Idle_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output__State_Idle_nth<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≤</span><span class="free">i</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      f_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span>
    <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">l</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_le_less<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> zero_less_diff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> length_greater_imp_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_Output_nth <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> replicate_le_diff2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc_leI<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Cons<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> append_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth take_first f_expand_one <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> last.simps f_Exec_Cons f_Exec_Stream_Cons append_Cons replicate.simps<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_append map_append last_message_append<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> if_P'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> last_message_NoMsg_conv f_Exec_Stream_nth min_eqL <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> last.simps f_Exec_Comp.simps append_Cons replicate.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_State_Idle_replicate_NoMsg_gr0_output<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> last.simps f_Exec_Comp_Stream.simps append_Cons<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_append map_append last_message_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> Suc <span class="improper">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>
  <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> Suc <span class="improper">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">l</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_Acc_LocalState__State_Idle_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> if_P'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_message_NoMsg_conv f_Exec_Stream_nth min_eqL <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Comp.simps replicate.simps<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> j<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span>
   <span class="var">?c1.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> Suc <span class="improper">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">l</span><span class="main">)</span> <span class="free">c</span>"</span></span>
   <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?c2.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> Suc <span class="improper">n</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span>"</span></span>
   <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f_Exec_Equal_State<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Comp.simps replicate.simps<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> take_Suc_conv_app_nth f_expand_snoc f_Exec_append<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_State_Idle_replicate_NoMsg_gr0_output<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> last_message <span class="main"><span class="main">(</span></span>map <span class="free"><span class="free">output_fun</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_Equal_State<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output__State_Idle_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      f_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">l</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_Acc_Output__State_Idle_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output__State_Idle_nth<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≤</span><span class="free">i</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">i</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">l</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_Output_nth_f_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_Acc_Output__State_Idle_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth_eq_i_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output__State_Idle_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">l</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Exec_Stream_Acc_Output__State_Idle_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  When a certain number <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of steps suffices to reach
  an idle state from any other idle state,
  than for any acceleration factor <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span> <span class="main"><span class="main">≥</span></span> <span class="free"><span class="free">l</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  the accelerated processing of every input message
  will be finished in an idle state.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState__State_Idle_all<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">c</span> <span class="bound">xs</span><span class="main">.</span> <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="bound">c</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">c</span> <span class="bound">m</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟶</span>
      State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
        <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="bound">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">l</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">i</span> <span class="main">&lt;</span> length <span class="bound">xs</span> <span class="main">⟧</span> <span class="main">⟹</span>
  State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
    f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="bound">xs</span> <span class="bound">c</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> length_greater_imp_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
  State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
    <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span>hd <span class="improper">xs</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="improper">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> replicate_le_diff2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc_leI<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_append f_Exec_State_Idle_replicate_NoMsg_state<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth take_first hd_eq_first<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span>hd <span class="improper">xs</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="improper">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">&lt;</span> length <span class="main">(</span>tl <span class="improper">xs</span><span class="main">)</span> <span class="main">∧</span> tl <span class="improper">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> take_Suc<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_Exec_append <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_mp<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span>hd <span class="improper">xs</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="improper">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="main">(</span>tl <span class="improper">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> replicate_le_diff2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc_leI<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_append f_Exec_State_Idle_replicate_NoMsg_state<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_LocalState__State_Idle_all<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">c</span> <span class="bound">m</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟶</span>
      State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
        <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="bound">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">l</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
    i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_LocalState_nth_f_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_Acc_LocalState__State_Idle_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> c' m<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_Output__State_Idle_all_imp_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">c</span> <span class="bound">m</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟶</span>
      State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
        <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="bound">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">l</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_Output <span class="free">l</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_Acc_Output__State_Idle_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_Acc_LocalState__State_Idle_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_Output__State_Idle_all_imp_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">c</span> <span class="bound">m</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟶</span>
      State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
        <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="bound">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">l</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">l</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Exec_Stream_Acc_Output__State_Idle_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_LocalState__State_Idle_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_Acc_LocalState__State_Idle_all_imp_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">c</span> <span class="bound">m</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟶</span>
      State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
        <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="bound">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">l</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_Acc_LocalState__State_Idle_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_Stream_Acc_LocalState__State_Idle_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Acc_LocalState__State_Idle_all_imp_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> Exec_Equal_State <span class="free">localState</span> <span class="free">trans_fun</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">c</span> <span class="bound">m</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟶</span>
      State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
        <span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="bound">m</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">l</span> <span class="main">-</span> Suc <span class="main">0</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span> <span class="main">=</span>
  i_Exec_Comp_Stream_Acc_LocalState <span class="free">l</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Exec_Stream_Acc_LocalState__State_Idle_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Exec_Stream_Acc_LocalState__State_Idle_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Converting inputs›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_Exec_input_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span>
  f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> f_Exec_Comp <span class="main">(</span><span class="free">trans_fun</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> f_Exec_Stream_input_map<span class="main">:</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  f_Exec_Comp_Stream <span class="main">(</span><span class="free">trans_fun</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_Exec_Stream_nth take_map f_Exec_input_map<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_input_map<span class="main">:</span> <span class="quoted"><span class="quoted">"
  i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">input</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>
  i_Exec_Comp_Stream <span class="main">(</span><span class="free">trans_fun</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">input</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_Exec_Stream_nth f_Exec_input_map<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IL_AF_Stream">
<div class="head">
<h1>Theory IL_AF_Stream</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      IL_AF_Stream.thy
    Date:       Jan 2007
    Author:     David Trachtenherz
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹\textsc{AutoFocus} message streams and temporal logic on intervals›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IL_AF_Stream
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../Nat-Interval-Logic/IL_TemporalOperators.html">Nat-Interval-Logic.IL_TemporalOperators</a>"</span> <a href="AF_Stream.html">AF_Stream</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stream views -- joining streams and intervals›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic definitions›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">f_join_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">f_join_aux</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f_join_aux</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1">then</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span> <span class="main">@</span> <span class="free">f_join_aux</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The functions <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f_join›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i_join›</span></span></span></span>
  deliver views of finite and infinite streams through intervals
  (more exactly: arbitrary natural sets).
  A stream view contains only the elements of the original stream
  at positions, which are contained in the interval.
  For instance, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f_join [0,10,20,30,40] {1,4} = [10,40]›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_join</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>      <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span>"</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1"><span class="free">⋈<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">≡</span> f_join_aux <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_join</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ilist <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="tfree">'a</span> ilist"</span></span>    <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span>"</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1"><span class="free">⋈<span class="hidden">⇩</span><sub>i</sub></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">→</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  f_join  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋈⇩</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  i_join  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋈⇩</span>"</span> 100<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i_f_join›</span></span></span></span> can be used for the case,
  when an infinite stream is joined with a finite interval.
  The function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i_join›</span></span></span></span> would then deliver
  an infinite stream, whose elements after position <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>card I›</span></span></span></span>
  are equal to initial stream's element at position <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Max I›</span></span></span></span>.
  The function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i_f_join›</span></span></span></span> in contrast
  cuts the resulting stream at this position
  and returns a finite stream.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_f_join</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ilist <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>    <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span></span>"</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⇓</span> Suc <span class="main">(</span>Max <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>
<span class="keyword1"><span class="command">notation</span></span>
  i_f_join  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋈⇩</span>"</span> 100<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i_f_join›</span></span></span></span> should be used
  only for finite sets in order to deliver well-defined results.
  The function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i_join›</span></span></span></span> should be used for infinite sets,
  because joining an infinite stream <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span> and a finite set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>I›</span></span></span></span>
  using <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i_join›</span></span></span></span> would deliver an infinite stream,
  ending with an infinite sequence of elements equal to
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s (Max I)›</span></span></span></span>.›</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic results›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_aux_length<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> length <span class="main">(</span>f_join_aux <span class="free">xs</span> <span class="bound">n</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">n</span><span class="main">..&lt;</span><span class="bound">n</span> <span class="main">+</span> length <span class="free">xs</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeastLessThan_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="improper">n</span><span class="main">..}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"insert <span class="improper">n</span> <span class="main">{</span>Suc <span class="improper">n</span><span class="main">..}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_aux_nth<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">n</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">n</span><span class="main">..&lt;</span><span class="bound">n</span> <span class="main">+</span> length <span class="free">xs</span><span class="main">}</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="main">(</span>f_join_aux <span class="free">xs</span> <span class="bound">n</span> <span class="free">I</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">n</span><span class="main">..&lt;</span><span class="bound">n</span> <span class="main">+</span> length <span class="free">xs</span><span class="main">}</span><span class="main">)</span> <span class="main">→</span> <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="improper">n</span><span class="main">..&lt;</span>Suc <span class="main">(</span><span class="improper">n</span> <span class="main">+</span> length <span class="improper">xs</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> insert <span class="improper">n</span> <span class="main">{</span>Suc <span class="improper">n</span><span class="main">..&lt;</span>Suc <span class="main">(</span><span class="improper">n</span> <span class="main">+</span> length <span class="improper">xs</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> card_gr0_imp_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gr_implies_gr0<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">n</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="improper">n</span> <span class="main">≤</span> <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="improper">n</span><span class="main">..&lt;</span>Suc <span class="main">(</span><span class="improper">n</span> <span class="main">+</span> length <span class="improper">xs</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">→</span> <span class="improper">i</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMin_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inext_nth_closed<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMin_Int_ge2<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">n</span> <span class="main">&lt;</span> <span class="improper">n</span> <span class="main">+</span> length <span class="improper">xs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_atLeastLessThan<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="improper">n</span><span class="main">..&lt;</span>Suc <span class="main">(</span><span class="improper">n</span> <span class="main">+</span> length <span class="improper">xs</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_insert<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="improper">n</span> <span class="main">≤</span> iMin <span class="main">{</span>Suc <span class="improper">n</span><span class="main">..&lt;</span>Suc <span class="main">(</span><span class="improper">n</span> <span class="main">+</span> length <span class="improper">xs</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">n</span> <span class="main">&lt;</span> <span class="improper">n</span> <span class="main">+</span> length <span class="improper">xs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_atLeastLessThan<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> i1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> inext_nth.simps<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> inext_nth_insert_Suc<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc_le_lessD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMin_Int_ge2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="improper">n</span> <span class="main">≤</span> <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="improper">n</span><span class="main">..&lt;</span>Suc <span class="main">(</span><span class="improper">n</span> <span class="main">+</span> length <span class="improper">xs</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">→</span> <span class="improper">i1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMin_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inext_nth_closed<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMin_Int_ge2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Joining finite streams and intervals›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
lemma "[(0::nat),10,20,30,40] ⋈<span class="hidden">⇩</span><sub>f</sub> {1,4} = [10,40]"
by (simp add: f_join_def)
*)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_def f_join_aux_length atLeast0LessThan cut_less_Int_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> f_join_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> back_subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ cut_less_Int_conv<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_aux_nth atLeast0LessThan cut_less_Int_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> inext_nth_cut_less_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_nth2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth f_join_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">{}</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_join_length cut_less_empty <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_join_length cut_less_0_empty <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_Nil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_join_length card_0_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_0_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_Nil_conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_join_Nil_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_all_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{..&lt;</span>length <span class="free">xs</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_Nil<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="main">]</span></span> f_join_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span> <span class="main">⊂</span> <span class="main">{..&lt;</span>length <span class="free">xs</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> psubset_card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_lessThan<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length cut_less_Int_conv Int_absorb1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="main">]</span></span> f_join_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(!)</span></span> <span class="free"><span class="free">xs</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="main">{..&lt;</span>length <span class="free">xs</span><span class="main">}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> inext_nth_cut_less_eq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"length <span class="free"><span class="free">xs</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_nth_lessThan<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span>length <span class="free">xs</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_join_all_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_join_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> UNIV <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_all<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">A</span><span class="main">;</span> Max <span class="free">A</span> <span class="main">&lt;</span> iMin <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">A</span> <span class="main">@</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Max_less_iMin_imp_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length cut_less_Un <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_less_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">↓&lt;</span> length <span class="free">xs</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">↓&lt;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Int<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cut_less_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> card_Un_disjoint<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite nat_cut_less_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_less_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_join_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length cut_less_Un<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append f_join_length <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_less_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth f_join_length <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_less_iff<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inext_nth_card_append_eq1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ cut_less_card<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_join_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"iMin <span class="free">B</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less cut_less_Min_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> order_less_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">!</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Max_all inext_nth_card_append_eq2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_singleton_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length cut_less_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> f_join_nth<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="free"><span class="free">n</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length cut_less_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> insert <span class="free">n</span> <span class="free">I</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"insert <span class="free">n</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> nat_cut_less_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty f_join_singleton_if<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> iMin <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_union f_join_singleton_if <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">&lt;</span> iMin <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_gr_iff cut_greater_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty f_join_union f_join_singleton_if <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_left<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> iMin <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> iMin <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_gr_iff i_cut_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_union f_join_singleton_if <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span>
  <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">@</span> <span class="main">(</span><span class="keyword1">if</span> length <span class="free">xs</span> <span class="main">∈</span> <span class="free">I</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
  card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> length <span class="free">xs</span> <span class="main">∈</span> <span class="free">I</span> <span class="keyword1">then</span> Suc <span class="main">0</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_le_less_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cut_le_less_conv_if<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_if<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span> cut_less_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_join_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append f_join_length<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_join_nth<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append less_card_cut_less_imp_inext_nth_less<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth f_join_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less less_Suc_eq_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_join_nth<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">→</span> <span class="improper">i</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Max_equality<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ nat_cut_less_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> inext_nth_cut_less_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">(</span></span>length <span class="free"><span class="free">xs</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inext_nth_card_Max<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gr0_imp_not_empty<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append less_card_cut_less_imp_inext_nth_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
lemma "
  let xs = [0::nat,10,20,30]; ys =[100,110,120,130]; I = {0,2,4,6} in
  (xs @ ys) ⋈<span class="hidden">⇩</span><sub>f</sub> I = xs ⋈<span class="hidden">⇩</span><sub>f</sub> I @ (ys ⋈<span class="hidden">⇩</span><sub>f</sub> (I ⊕- (length xs)))"
by (simp add: Let_def f_join_def iT_Plus_neg_def)
*)</span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_join_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">@</span> <span class="free">ys</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_Nil<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_join_snoc <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_assoc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_mem_iff add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_f_join_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> less_card_cut_less_imp_inext_nth_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length cut_cut_less min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> card <span class="free">I</span> <span class="main">∨</span> infinite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ cut_less_card<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqL cut_less_inext_nth_card_eq1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_join_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_join_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length cut_cut_less min_eqL<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_inext_nth_card_eq1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_inext_nth_card_eq1 inext_nth_cut_less_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_f_join_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> take_f_join_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_f_join_eq1 take_f_join_eq2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> drop_f_join_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> same_append_eq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="keyword1"><span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="free"><span class="free">I</span></span> <span class="main"><span class="main">↓</span></span> <span class="free"><span class="free">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹First, a simplification step without <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>take_f_join_eq1›</span></span></span></span> required for correct transformation, in order to eliminate <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(xs ⋈<span class="hidden">⇩</span><sub>f</sub> I) ↓ n›</span></span></span></span> in the equation.›</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Now, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>take_f_join_eq1›</span></span></span></span> can be applied›</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_f_join_eq1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">→</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> neq_le_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"iMin <span class="free"><span class="free">I</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inext_nth_closed<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Min_not_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_Min_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_join_union<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_not_empty_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inext_nth_closed<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_less_finite i_cut_mem_iff iMin_gr_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_cut_ge_ident<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> drop_f_join_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> drop_f_join_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_f_join_eq1 drop_f_join_eq2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_take<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">↓</span> <span class="free">n</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length cut_cut_less min.commute<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth f_join_length cut_cut_less min.commute<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqL inext_nth_cut_less_eq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_card_cut_less_imp_inext_nth_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqR linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> inext_nth_cut_less_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_less_le_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite cut_less_mono<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_Nil<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_Nil_conv' iT_Plus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> append_take_drop_id<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">↑</span></span> <span class="free"><span class="free">n</span></span> <span class="keyword1"><span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="free"><span class="free">I</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="keyword1"><span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">I</span></span> <span class="main"><span class="main">⊕</span></span> <span class="free"><span class="free">n</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_join_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_take min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_Plus_neg_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">n</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_empty_iff iT_Plus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> cut_less_eq_imp_f_join_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">A</span> <span class="main">↓&lt;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="free">B</span> <span class="main">↓&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">A</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length f_join_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inext_nth_cut_less_eq<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"length <span class="free"><span class="free">xs</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inext_nth_cut_less_eq<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"length <span class="free"><span class="free">xs</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_join_cut_less_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  length <span class="free">xs</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cut_less_eq_imp_f_join_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_cut_less min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_Suc_Max_eq_imp_f_join_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">xs</span> <span class="main">↓</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">↓</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="free">ys</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_eqL<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">→</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">→</span> <span class="improper">i</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_card_cut_less_imp_inext_nth_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less min_eqR Suc_le_eq <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_less_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">ys</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_join_nth2 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_less_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">→</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">→</span> <span class="improper">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_Suc_eq_le inext_nth_closed<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_less_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_join_take_Suc_Max_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  finite <span class="free">I</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">↓</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> take_Suc_Max_eq_imp_f_join_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Joining infinite streams and infinite intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> UNIV <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_join_nth inext_nth_UNIV<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">A</span><span class="main">;</span> Max <span class="free">A</span> <span class="main">&lt;</span> iMin <span class="free">B</span><span class="main">;</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> Suc <span class="main">(</span>Max <span class="free">A</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">A</span><span class="main">)</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_nth i_append_nth f_join_length <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_less_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">↓&lt;</span> Suc <span class="main">(</span>Max <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_le_less_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cut_le_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_less_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_nth_card_append_eq1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth f_join_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_card_cut_less_imp_inext_nth_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_nth_card_append_eq2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_join_nth inext_nth_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span>insert <span class="free">n</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">f</span> <span class="main">⇓</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">⌢</span> <span class="main">[</span><span class="free">f</span> <span class="free">n</span><span class="main">]</span> <span class="main">⌢</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert_eq_cut_less_cut_greater<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_singleton ilist_eq_iff i_append_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">&lt;</span> iMin <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_Min_greater<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> insert_is_Un<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_join_union<span class="main"><span class="main">[</span></span><span class="operator">OF</span> singleton_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_singleton_if<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> iMin <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_less_Max_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"insert <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_join_union<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite _ singleton_not_empty<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_singleton<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span> <span class="free">n</span><span class="main">]</span> <span class="main">⌢</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_append_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_append_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span> <span class="free">n</span><span class="main">]</span> <span class="main">⌢</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_append_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_Suc_Max_eq_imp_f_join_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span> min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> iMin <span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">∧</span> Max <span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">&lt;</span> iMin <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_Min_greater nat_cut_less_Max_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"insert <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span> <span class="main">∪</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> Max <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> iMin <span class="main">(</span><span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_insert<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_union nat_cut_less_finite singleton_finite <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_left Un_insert_right Max_less_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_singleton_if<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_Suc_Max_eq_imp_f_join_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span> min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_i_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  infinite <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="main">⌢</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">⌢</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> length <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_nth i_append_nth f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≥</span> length <span class="free">xs</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_ge_not_empty_iff infinite_nat_iff_unbounded_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_nth_less_less_card_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕-</span> length <span class="free">xs</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_empty_iff infinite_imp_nonempty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_inext_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> length <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> cut_less_empty_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> cut_ge_all_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inext_nth_card_append_eq2<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_imp_Max_less_iMin<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span> i_cut_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_cut_ge_ident<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_take_i_join<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length cut_less_inext_nth_card_eq1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> inext_nth_mono2_infin<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_join_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_nth_less_less_card_conv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_ge_infinite_not_empty<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_drop_i_join<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span> <span class="main">⇑</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_nth inext_nth_cut_ge_inext_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_i_take<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⇓</span> <span class="free">n</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span> <span class="main">⇓</span> card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> less_card_cut_less_imp_inext_nth_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_nth f_join_length f_join_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_i_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_nth iT_Plus_inext_nth add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> i_join_finite_nth_ge_card_eq_nth_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> card <span class="free">I</span> <span class="main">≤</span> Suc <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_nth inext_nth_card_Max<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_finite_i_drop_card_eq_const_nth_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">⇑</span> <span class="main">(</span>card <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_join_finite_nth_ge_card_eq_nth_Max<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_finite_i_append_nth_Max_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">⇓</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">⌢</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span>Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_le_less_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cut_le_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_append_nth i_join_nth f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth f_join_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_take_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_card_cut_less_imp_inext_nth_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_nth_card_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Joining infinite streams and finite intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_length<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span> <span class="main">⟹</span> length <span class="main">(</span><span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> card <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_le_less_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cut_le_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> card <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> card_gr0_imp_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gr_implies_gr0<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> card_gr0_imp_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gr_implies_gr0<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_take_nth<span class="main"><span class="main">[</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">I</span></span> <span class="main"><span class="main">→</span></span> <span class="free"><span class="free">n</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">(</span></span>Max <span class="free"><span class="free">I</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_imp_less_Suc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Max_ge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ inext_nth_closed<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth2 nat_cut_le_less_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cut_le_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def f_join_empty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_eq_i_join_i_take<span class="main">:</span> <span class="quoted"><span class="quoted">"
  finite <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span> <span class="main">⇓</span> <span class="main">(</span>card <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_i_take nat_cut_le_less_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cut_le_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">A</span><span class="main">;</span> finite <span class="free">B</span><span class="main">;</span> Max <span class="free">A</span> <span class="main">&lt;</span> iMin <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">A</span> <span class="main">@</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def f_join_union <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_less_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="free">A</span> <span class="main">&lt;</span> Max <span class="free">B</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMin_le_Max<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Max_Un max_eqR<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_imp_le<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> take_Suc_Max_eq_imp_f_join_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqR<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_imp_le<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">[</span><span class="free">f</span> <span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def f_join_singleton_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"
  finite <span class="free">I</span> <span class="main">⟹</span>
  <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> insert <span class="free">n</span> <span class="free">I</span> <span class="main">=</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">@</span> <span class="free">f</span> <span class="free">n</span> <span class="main">#</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_singleton i_cut_empty i_f_join_empty<span class="main">)</span>
<span class="comment1">(*
apply (subgoal_tac "n &lt; Suc (Max (insert n I))")
 prefer 2
 apply simp
apply (frule less_Suc_eq_le[THEN iffD1])*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_insert<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> cut_greater_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> take_Suc_Max_eq_imp_f_join_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="main"><span class="main">⇓</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> min_eqR<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> max.coboundedI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> less_imp_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_less_Max_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_Max_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> Max <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less cut_greater_Max_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_eqR<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_imp_le<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> take_Suc_Max_eq_imp_f_join_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="main"><span class="main">⇓</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Max_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_i_f_join_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> card <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> card_ge_0_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gr_implies_gr0<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_empty i_f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def take_f_join_eq1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> take_Suc_Max_eq_imp_f_join_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="main"><span class="main">⇓</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> min_eqR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cut_less_Max_less<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_less_finite inext_nth_closed<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_i_f_join_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> card <span class="free">I</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_empty i_f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def take_f_join_eq2 cut_less_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_i_f_join_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  finite <span class="free">I</span> <span class="main">⟹</span>
  <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">&lt;</span> card <span class="free">I</span> <span class="keyword1">then</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_i_f_join_eq1 take_i_f_join_eq2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> drop_i_f_join_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> card <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> card_ge_0_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gr_implies_gr0<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_empty i_f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def drop_f_join_eq1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> in_imp_not_empty<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">I</span></span> <span class="main"><span class="main">→</span></span> <span class="free"><span class="free">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_mem_iff inext_nth_closed<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> take_Suc_Max_eq_imp_f_join_eq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cut_ge_finite<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="main"><span class="main">⇓</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqR cut_ge_Max_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> drop_i_f_join_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> card <span class="free">I</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> drop_i_f_join_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  finite <span class="free">I</span> <span class="main">⟹</span>
  <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">&lt;</span> card <span class="free">I</span> <span class="keyword1">then</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_i_f_join_eq1 drop_i_f_join_eq2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_i_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"
  finite <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⇑</span> <span class="free">n</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span> <span class="main">=</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_empty i_f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def iT_Plus_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_take_i_drop f_join_drop<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_take_Suc_Max_eq_imp_i_f_join_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">f</span> <span class="main">⇓</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⇓</span> Suc <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span> <span class="main">=</span> <span class="free">g</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_take_i_join_eq_i_f_join<span class="main">:</span> <span class="quoted"><span class="quoted">"
  infinite <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> infinite_imp_nonempty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Min_empty i_f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> inext_nth_gr_Min_conv_infinite<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_take_i_join i_f_join_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Max <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">I</span> <span class="main">→</span> <span class="free">n</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc_leI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nat_cut_less_Max_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Min_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_cut_less_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_i_take<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="keyword1"><span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span></span> <span class="free"><span class="free">I</span></span> <span class="main"><span class="main">⇓</span></span> card <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gr0_conv_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_less_inext_conv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inext_nth_closed<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_le_less_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">I</span></span> <span class="main"><span class="main">↓≤</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Max_equality<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ nat_cut_le_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_mem_iff inext_nth_closed<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Results for intervals from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IL_Interval›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_iFROM<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length iFROM_cut_less iIN_card Suc_diff_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_join_nth2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_cut_less iIN_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_inext_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_iFROM<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="free">f</span> <span class="main">⇑</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff i_join_nth iFROM_inext_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_iIN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">↑</span> <span class="free">n</span> <span class="main">↓</span> Suc <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length iIN_cut_less iIN_card Suc_diff_Suc min_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth2 iIN_cut_less iIN_card iIN_inext_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_iIN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> <span class="main">⇑</span> <span class="free">n</span> <span class="main">⇓</span> Suc <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def f_join_iIN iIN_Max i_take_drop<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_iTILL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_join_iIN<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_iTILL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> <span class="main">⇓</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_f_join_iIN<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> f_join_f_expand_iT_Mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Mult_cut_less2 iT_Mult_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_nth2 iT_Mult_cut_less2 iT_Mult_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> less_card_cut_less_imp_inext_nth_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_inext_nth f_expand_nth_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_i_expand_iT_Mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_nth iT_Mult_inext_nth i_expand_nth_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_i_expand_iT_Mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> finite <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty i_f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_eq_iff i_f_join_length iT_Mult_finite_iff iT_Mult_not_empty iT_Mult_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_nth iT_Mult_card iT_Mult_inext_nth i_expand_nth_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_f_shrink_iT_Plus_iT_Div_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_empty iT_Div_empty f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff f_join_length f_shrink_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">-</span> <span class="free">k</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">-</span> length <span class="free">xs</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_diff_le linorder_not_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc_leI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> diff_less_mono2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_less_divisor<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> context_conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_cut_less iT_Div_cut_less2 iT_Plus_card<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iT_Div_card_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mod_eq_imp_div_right_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">card</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff cut_less_mem_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_mod_eq_imp_add_divisor_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_diff_right_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_join_nth f_join_length f_shrink_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_inext_nth iT_Plus_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_mod_inext_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_shrink_nth_eq_f_last_message_hold_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"card <span class="skolem">x</span> <span class="main">=</span> card <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_cut_less iT_Plus_card<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_mult_imp_div_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_card_cut_less_imp_inext_nth_less<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel inext_nth_closed<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_i_shrink_iT_Plus_iT_Div_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_nth_eq_i_last_message_hold_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_inext_nth iT_Div_mod_inext_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">→</span> <span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_nth_closed<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_i_shrink_iT_Plus_iT_Div_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> finite <span class="free">I</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_empty iT_Div_empty i_f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def iT_Plus_Max iT_Div_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_last_message_hold_i_take<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_shrink_i_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_div_mult_cancel<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_f_shrink_iT_Plus_iT_Div_mod<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> One_nat_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_join_f_shrink_iT_Plus_iT_Div_mod_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">;</span>
    <span class="free">A</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span> <span class="free">B</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">A</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_f_shrink_iT_Plus_iT_Div_mod<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> One_nat_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> i_join_i_shrink_iT_Plus_iT_Div_mod_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">;</span>
    <span class="free">A</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span> <span class="free">B</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_i_shrink_iT_Plus_iT_Div_mod<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> One_nat_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> i_f_join_i_shrink_iT_Plus_iT_Div_mod_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> finite <span class="free">I</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">;</span>
    <span class="free">A</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span> <span class="free">B</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">A</span><span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_i_shrink_iT_Plus_iT_Div_mod<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> One_nat_def<span class="main"><span class="main">]</span></span><span class="main">)</span>



<span class="keyword1"><span class="command">lemma</span></span> f_join_f_shrink_iT_Div_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">I</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_empty f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Suc_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> order_le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕-</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iT_Plus_neg_Plus_le_inverse<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMinI_ex2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMinI_ex2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mod_add_eq_imp_mod_0<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iT_Plus_Div_distrib_mod_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_join_f_shrink_iT_Plus_iT_Div_mod<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> One_nat_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_i_shrink_iT_Div_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span><span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_join_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_nth_eq_i_last_message_hold_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_mod_inext_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">→</span> <span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inext_nth_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">≤</span> <span class="free">I</span> <span class="main">→</span> <span class="improper">x</span> "</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ mod_le_dividend<span class="main"><span class="main"><span class="main">[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_i_shrink_iT_Div_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> finite <span class="free">I</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="free">I</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_empty iT_Div_empty i_f_join_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_f_join_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_last_message_hold_i_take<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_shrink_i_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">≤</span> Max <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ mod_le_dividend<span class="main"><span class="main"><span class="main">[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_join_f_shrink_iT_Div_mod<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_f_expand_iMOD<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> iFROM_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_join_f_expand_iT_Mult<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> f_join_f_expand_iMOD_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> f_join_f_expand_iMOD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_0 f_join_UNIV<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_f_expand_iMODb<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> iIN_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> f_join_f_expand_iT_Mult<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> f_join_f_expand_iMODb_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> f_join_f_expand_iMODb<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_i_expand_iMOD<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> iFROM_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_join_i_expand_iT_Mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iFROM_not_empty<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_join_i_expand_iMOD_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> i_join_i_expand_iMOD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_0 i_join_UNIV<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_i_expand_iMODb<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> iIN_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_join_i_expand_iT_Mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iIN_not_empty<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_join_i_expand_iMODb_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> i_join_i_expand_iMODb<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> i_f_join_i_expand_iMODb<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> iIN_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_f_join_i_expand_iT_Mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iIN_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> i_f_join_i_expand_iMODb_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> i_f_join_i_expand_iMODb<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> f_join_f_shrink_iMOD<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_join_f_shrink_iT_Plus_iT_Div_mod_subst<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff iMOD_add iMOD_div_ge<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_join_f_shrink_iMOD_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> f_join_f_shrink_iMOD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_0 f_join_UNIV<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_join_f_shrink_iMODb<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_join_f_shrink_iT_Plus_iT_Div_mod_subst<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">d</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff iMODb_add iMODb_div_ge<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> f_join_f_shrink_iMODb_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> f_join_f_shrink_iMODb<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_join_i_shrink_iMOD<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_join_i_shrink_iT_Plus_iT_Div_mod_subst<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_not_empty iMOD_iff iMOD_add iMOD_div_ge<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> i_join_i_shrink_iMOD_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">⋈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">[</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> i_join_i_shrink_iMOD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_0 i_join_UNIV<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_f_join_i_shrink_iMODb<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_f_join_i_shrink_iT_Plus_iT_Div_mod_subst<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">d</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_finite iMODb_iff iMODb_add iMODb_div_ge<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> i_f_join_i_shrink_iMODb_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">⟼<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> ⋈<span class="hidden">⇘</span><sub>i-f</sub><span class="hidden">⇙</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> i_f_join_i_shrink_iMODb<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv i_join_UNIV<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Streams and temporal operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_NoMsg_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_nth last_message_NoMsg_conv iAll_def Ball_def iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_NoMsg_iAll_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add i_shrink_eq_NoMsg_iAll_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_Msg_iEx_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">□</span> <span class="bound">t2</span> <span class="main">[</span>Suc <span class="bound">t1</span><span class="main">…]</span><span class="main">.</span> <span class="bound">t2</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">⟶</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_nth last_message_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iAll_def iEx_def Ball_def Bex_def iIN_iff iFROM_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_add_assoc less_imp_le_pred <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_diff_assoc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> j<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">j</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_Msg_iEx_iAll_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">□</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">1</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t1</span> <span class="main">.</span> <span class="bound">t2</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟶</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add i_shrink_eq_Msg_iEx_iAll_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_Msg_iEx_iAll_cut_greater_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">□</span> <span class="bound">t2</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="bound">t1</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_eq_Msg_iEx_iAll_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_cut_greater iEx_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bex_cong2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subset_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iAll_def Ball_def iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_Msg_iEx_iAll_cut_greater_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[…</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="bound">t1</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add i_shrink_eq_Msg_iEx_iAll_cut_greater_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_Msg_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒮</span> <span class="bound">t1</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iSince_def iIN_cut_greater i_shrink_eq_Msg_iEx_iAll_cut_greater_conv<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_Msg_iSince_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒮</span> <span class="bound">t1</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add i_shrink_eq_Msg_iSince_conv<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_iAll_i_expand_nth_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_mem_iff2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_nth_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Mult_mem_iff mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> i_expand_nth_mod_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Streams and temporal operators cycle start/finish events›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_NoMsg_iAll_start_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_not_empty iNext_True<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> neq_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_eq_NoMsg_iAll_conv iTL_defs Ball_def Bex_def iT_add iT_iff iFROM_cut_less iFROM_inext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x1 x2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x2</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> q<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Suc_le_lessD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">q</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_mod_eq_imp_add_divisor_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_Msg_iUntil_start_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="free">s</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>
    <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t''</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
      <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t''</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_not_empty iNext_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> neq_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_eq_Msg_iSince_conv iTL_defs iT_add iT_cut_greater iT_cut_less Ball_def Bex_def iT_iff iFROM_inext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_2_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> numeral_2_eq_2 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mult_Suc_right<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="improper">i</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> between_imp_mod_gr0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc_le_lessD<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> between_imp_mod_gr0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc_le_lessD<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_imp_mod_pred<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> between_imp_mod_gr0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc_le_lessD<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mult_le_mono1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> j<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">j</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 Suc_diff_Suc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Suc_leI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free">t</span></span>"</span></span></span><span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> q<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> j<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">j</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_3_eq_3 Suc_diff_Suc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">≤</span> <span class="improper">q</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_mod_eq_imp_add_divisor_le<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc_le_lessD<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 Suc_diff_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i1</span> <span class="main">=</span> Suc <span class="improper">i</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="improper">i</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> pred_less_imp_le<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> between_imp_mod_between<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> q<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="free">t</span> <span class="main">≤</span> <span class="improper">q</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc_leI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_less_cancel2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc_le_lessD<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free">t</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">&gt;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_NoMsg_iAll_finish_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_eq_NoMsg_iAll_conv iT_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iTL_defs Ball_def Bex_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff div_mult_cancel iFROM_cut_less iFROM_inext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_pred<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Suc_leI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_le_less<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1 t2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t2</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">Suc</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Suc_leI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff linorder_not_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">≤</span> <span class="improper">t2</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_diff_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_mod_eq_imp_add_divisor_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_shrink_eq_Msg_iUntil_finish_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">÷<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">(</span>
    <span class="main">○</span> <span class="bound">t'</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t4</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t4</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_eq_Msg_iSince_conv <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iTL_defs iT_add iT_cut_greater iT_cut_less Ball_def Bex_def iT_iff iFROM_inext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">≠</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_imp_neq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_pred_imp_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> between_imp_mod_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_pred iIN_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mod_pred iIN_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_pred<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span>
   <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_mod_add_eq_imp_add_mod_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_imp_le<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main"><span class="main">]</span></span> mod_pred<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1 t2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t3<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t2</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">≤</span> <span class="improper">t2</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_imp_le_pred<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> between_imp_mod_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">(</span></span>Suc <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span> <span class="main"><span class="main">_</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> diff_Suc_less<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> gr_implies_gr0<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t3</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t3</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_imp_less_or_eq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_imp_less_or_eq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 Suc_diff_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="improper">t1</span> <span class="main">=</span> <span class="improper">t2</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff numeral_2_eq_2 Suc_diff_Suc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_pred<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="improper">t1</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="improper">t1</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">t1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> between_imp_mod_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_pred<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"All <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="skolem">B</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t3</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t3</span> <span class="main">≤</span> <span class="improper">t2</span> <span class="main">⟹</span> <span class="free">s</span> <span class="improper">t3</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t3</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t3</span> <span class="main">≤</span> <span class="improper">t2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_mp<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="improper">t2</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="improper">t2</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="improper">t2</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_divisor_le_mod_ge_imp_ge<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IL_AF_Stream_Exec">
<div class="head">
<h1>Theory IL_AF_Stream_Exec</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      IL_AF_Exec_Stream.thy
    Date:       Nov 2007
    Author:     David Trachtenherz
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹\textsc{AutoFocus} message stream processing and temporal logic on intervals›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IL_AF_Stream_Exec
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <a href="IL_AF_Stream.html">IL_AF_Stream</a> <a href="AF_Stream_Exec.html">AF_Stream_Exec</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Correlation between Pre/Post-Conditions for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f_Exec_Comp_Stream›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f_Exec_Comp_Stream_Init›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Pre_Post1_iAll<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">result</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">x_n</span> <span class="main">∧</span> <span class="free">P2</span> <span class="bound">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">P1</span> <span class="main">(</span><span class="free">input</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P2</span> <span class="main">(</span><span class="free">result</span><span class="hidden">⇗</span><sup>← <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">result</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Pre_Post1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Direct relation between input and result after transition›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Pre_Post2_iAll<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">result</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">x_n</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">result</span><span class="hidden">⇗</span><sup>← <span class="free">c</span></sup><span class="hidden">⇖</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">input</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="free">result</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Pre_Post2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Pre_Post3_iAll_iNext<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">result</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">x_n</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> inext <span class="bound">t</span> <span class="free">I'</span> <span class="main">=</span> Suc <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">result</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t1</span> <span class="bound">t</span> <span class="free">I'</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">input</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">(</span><span class="free">result</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNext_def i_Exec_Stream_Pre_Post2_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_Pre_Post1_iAll_iNext<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">result</span> <span class="main">=</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">x_n</span> <span class="main">∧</span> <span class="free">P2</span> <span class="bound">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> inext <span class="bound">t</span> <span class="free">I'</span> <span class="main">=</span> Suc <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">P1</span> <span class="main">(</span><span class="free">input</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P2</span> <span class="main">(</span><span class="free">result</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t1</span> <span class="bound">t</span> <span class="free">I'</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">result</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNext_def i_Exec_Stream_Init_Pre_Post1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Direct relation between input and state before transition›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_Pre_Post2_iAll_iNext<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">result</span> <span class="main">=</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x_n</span> <span class="bound">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> inext <span class="bound">t</span> <span class="free">I'</span> <span class="main">=</span> Suc <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">input</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="free">result</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t1</span> <span class="bound">t</span> <span class="free">I'</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">result</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNext_def i_Exec_Stream_Init_Pre_Post2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Relation between input and output›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Stream_Init_Pre_Post3_iAll_iNext<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">result</span> <span class="main">=</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">c_n</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">x_n</span> <span class="main">(</span><span class="free">trans_fun</span> <span class="bound">x_n</span> <span class="bound">c_n</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> inext <span class="bound">t</span> <span class="free">I'</span> <span class="main">=</span> Suc <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">result</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t1</span> <span class="bound">t</span> <span class="free">I'</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">input</span><span class="hidden">⇗</span><sup>← <span class="main">\&lt;NoMsg&gt;</span></sup><span class="hidden">⇖</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">(</span><span class="free">result</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> iNext_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilist_Previous_Suc i_Exec_Stream_Init_nth_Suc_eq_i_Exec_Stream_nth i_Exec_Stream_Previous_i_Exec_Stream_Init<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Pre_Post2_iAll<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i_Exec_Comp_Stream_Acc_Output›</span></span></span></span> and temporal operators with bounded intervals.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Temporal relation between uncompressed and compressed output of accelerated components.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_eq_NoMsg_iAll_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_iAll_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_iAll_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__Init__eq_NoMsg_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="main">[</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> i_Exec_Comp_Stream_Acc_Output_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_eq_NoMsg_iAll_conv i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_iAll_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_iEx_iAll_cut_greater_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">□</span> <span class="bound">t2</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="bound">t1</span> <span class="main">.</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_eq_Msg_iEx_iAll_cut_greater_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_iEx_iAll_cut_greater_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[…</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="bound">t1</span> <span class="main">.</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_eq_Msg_iEx_iAll_cut_greater_conv2<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒮</span> <span class="bound">t1</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_eq_Msg_iSince_conv<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_iSince_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒮</span> <span class="bound">t1</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_iSince_conv iT_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__Init__eq_Msg_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒮</span> <span class="bound">t1</span> <span class="main">[</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> i_Exec_Comp_Stream_Acc_Output_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_shrink_eq_Msg_iSince_conv i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_iSince_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_iAll_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒮</span> <span class="bound">t1</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_iAll_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_iSince_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_iAll_iSince_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒮</span> <span class="bound">t1</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_iAll_iSince_conv iT_add<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i_Exec_Comp_Stream_Acc_Output›</span></span></span></span> and temporal operators with unbounded intervals and start/finish events.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_iAll_start_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span><span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_eq_NoMsg_iAll_start_event_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__Init__eq_NoMsg_iAll_start_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span><span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_eq_NoMsg_iAll_start_event_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iNext_def iFROM_inext iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">…]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>Suc <span class="main">(</span><span class="free">t</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">…]</span> <span class="main">⊕</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_iUntil_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__Init__eq_NoMsg_iAll_start_event2_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span><span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__Init__eq_NoMsg_iAll_start_event_conv mod_eq_Suc_0_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_iUntil_start_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="free">s</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>
    <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t''</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
      <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t''</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_eq_Msg_iUntil_start_event_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__Init__eq_Msg_iUntil_start_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="free">s</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>
    <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t''</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
      <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t''</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_eq_Msg_iUntil_start_event_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNext_def iFROM_inext iFROM_iff iT_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Suc_eq_plus1 iFROM_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_iUntil_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Suc_eq_plus1 iFROM_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_iUntil_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__Init__eq_Msg_iUntil_start_event2_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="free">s</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>
    <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t''</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
      <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t''</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__Init__eq_Msg_iUntil_start_event_conv mod_eq_Suc_0_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_iAll_finish_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span><span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_eq_NoMsg_iAll_finish_event_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__Init__eq_NoMsg_iAll_finish_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span><span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="free">t0</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_iAll_finish_event_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNext_def iFROM_inext iFROM_iff iT_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">…]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">…]</span> <span class="main">⊕</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_iUntil_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_eq_divisor_minus_Suc_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_iUntil_finish_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span><span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">(</span>
    <span class="main">○</span> <span class="bound">t'</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t4</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t4</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_not_empty iFROM_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> neq_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output_def i_shrink_eq_Msg_iUntil_finish_event_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__Init__eq_Msg_iUntil_finish_event_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">t0</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">output_fun</span> <span class="main">∘</span> i_Exec_Comp_Stream_Init <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟧</span><span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="free">event</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">(</span>
    <span class="main">○</span> <span class="bound">t'</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="free">event</span> <span class="bound">t4</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">t4</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_iUntil_finish_event_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNext_def iFROM_inext iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Init_eq_i_Exec_Stream_Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_iUntil_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_eq_divisor_minus_Suc_0_conv add_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i_Exec_Comp_Stream_Acc_Output›</span></span></span></span> and temporal operators with idle states.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_State_Idle_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>
   <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iUntil_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_cut_less<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff iT_cut_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_le_less<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_neq_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_sym Suc_leI<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_iAll_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add i_Exec_Stream_nth i_Exec_Stream_Acc_LocalState_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_take_Suc_conv_app_nth<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_i_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> f_Exec_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="main">∈</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="bound">t1</span> <span class="main">↑</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">input</span> <span class="free">t</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="bound">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_nth_interval_eq_nth_append_replicate_NoMsg iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
   <span class="main">¬</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="bound">t1</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_iUntil <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> not_iAll<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1 t2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_le_neq_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ not_sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_cut_less1 iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"
  State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span>
    <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="main">(</span><span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="free">t</span><span class="main">)</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
   <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="main">[</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">.</span> <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="bound">t1</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> NoMsg<span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">t1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_take_drop_append<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_append <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> i_take_drop_append<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_take_Suc_conv_app_nth f_Exec_append i_expand_nth_mult<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_State_Idle_replicate_NoMsg_output<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iUntil_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_take_Suc_conv_app_nth f_Exec_append i_expand_nth_mult iFROM_cut_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">.</span> <span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇑</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">⇓</span> <span class="bound">i</span> <span class="main">=</span> NoMsg<span class="hidden">⇗</span><sup><span class="bound">i</span></sup><span class="hidden">⇖</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_eq_iff i_expand_nth_if<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> State_Idle_imp_exists_state_change2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Suc_less_pred_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iUntil_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="improper">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> Suc <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_take_add<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="improper"><span class="improper"><span class="improper"><span class="improper">i</span></span></span></span>"</span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_take_Suc_conv_app_nth f_Exec_append i_expand_nth_mult<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_imp_le_pred<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff iFROM_cut_less1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> iexE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">&lt;</span> <span class="improper">t2</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">=</span> <span class="improper">t2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> le_neq_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ not_sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_imp_add_positive<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_Suc <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_take_add f_Exec_append iFROM_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇑</span> Suc <span class="improper">t2</span> <span class="main">⇓</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="improper">i</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list_eq_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_expand_nth_if<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> imp_conv_disj<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> Suc <span class="main">(</span><span class="improper">t2</span> <span class="main">+</span> <span class="improper">i1</span><span class="main">)</span> <span class="main">∧</span> Suc <span class="main">(</span><span class="improper">t2</span> <span class="main">+</span> <span class="improper">i1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> between_imp_mod_gr0<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_Exec_State_Idle_replicate_NoMsg_gr0_output<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_with_State_Idle_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">t1</span> <span class="main">∈</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="free">t1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="free">t1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0 iT_Plus_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_neq_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Suc_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_Output_nth i_Exec_Stream_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="free">t1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_take_add f_Exec_append i_expand_i_take_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇑</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">⇓</span> <span class="main">(</span>Suc <span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">input</span> <span class="free">t</span> <span class="main">#</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_take_i_drop<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_expand_nth_interval_eq_nth_append_replicate_NoMsg<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream.simps<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">i</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_iff_add<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> replicate_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> append_Cons<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> State_Idle_append_replicate_NoMsg_output_last_message<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_Exec_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">input</span> <span class="main">⇓</span> <span class="free">t</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="free">input</span> <span class="free">t</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="free">t1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_expand_i_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">input</span> <span class="free">t</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_take_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
  f_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="free">t</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span></sup><span class="hidden">⇖</span><span class="main">)</span>
   <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="main">⇓</span> <span class="free">t</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_not_empty_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> last_message_Msg_eq_last<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_Exec_eq_f_Exec_Stream_last2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_Exec_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">input</span> <span class="main">⇓</span> <span class="free">t</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">k</span> <span class="main">@</span> <span class="free">input</span> <span class="free">t</span> <span class="main">#</span> NoMsg<span class="hidden">⇗</span><sup><span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="free">t1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_expand_i_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="free">t1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_take_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_Exec_eq_f_Exec_Stream_last2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_with_State_Idle_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">;</span>
    <span class="free">t1</span> <span class="main">∈</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="free">t1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
      <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0 iT_Plus_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_neq_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> not_sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Suc_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_with_State_Idle_imp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1'</span> <span class="main">=</span> <span class="free">t1</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
   <span class="main">⋀</span> <span class="bound">n1</span> <span class="bound">n2</span><span class="main">.</span>
   <span class="main">⟦</span> <span class="bound">n1</span> <span class="main">&lt;</span> <span class="bound">n2</span><span class="main">;</span> <span class="bound">n1</span> <span class="main">∈</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span> <span class="bound">n2</span> <span class="main">∈</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
     State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="bound">n1</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="bound">n2</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> NoMsg <span class="main">⟧</span> <span class="main">⟹</span>
   False"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_imp_add_positive<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> add_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_take_add f_Exec_append<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇑</span> Suc <span class="improper">n1</span> <span class="main">⇓</span> <span class="improper">i</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="improper">i</span></sup><span class="hidden">⇖</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_take_i_drop<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="improper">i</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="improper">i</span> <span class="main">+</span> Suc <span class="improper">n1</span> <span class="main">-</span> Suc <span class="improper">n1</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_expand_nth_interval_eq_replicate_NoMsg<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="improper">n1</span><span class="main">)</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span>
     <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> f_Exec_State_Idle_replicate_NoMsg_gr0_output<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> linorder_neq_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here the property to be checked uses only unbounded intervals suitable for LTL.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_with_State_Idle_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">;</span>
    <span class="free">t1</span> <span class="main">∈</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="free">t1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒰</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
      <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_with_State_Idle_conv2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> iexE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t2'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff iT_iff iT_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_imp_less_Suc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_imp_add_positive<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth add_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_take_add f_Exec_append<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_take_i_drop<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> <span class="main">(</span><span class="improper">i</span> <span class="main">+</span> Suc <span class="improper">t2'</span><span class="main">)</span> <span class="main">↑</span> Suc <span class="improper">t2'</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="improper">i</span></sup><span class="hidden">⇖</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="improper">i</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">\&lt;NoMsg&gt;</span><span class="hidden">⇗</span><sup><span class="improper">i</span> <span class="main">+</span> Suc <span class="improper">t2'</span> <span class="main">-</span> Suc <span class="improper">t2'</span></sup><span class="hidden">⇖</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_expand_nth_interval_eq_replicate_NoMsg<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="improper">t2'</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span>
   <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> f_Exec_State_Idle_replicate_NoMsg_gr0_output<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_add iT_iff i_Exec_Stream_Acc_LocalState_nth i_Exec_Stream_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_imp2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">;</span>
    <span class="free">t1</span> <span class="main">∈</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">;</span>
    <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="free">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span><span class="main">;</span>
    <span class="main">○</span> <span class="bound">t2</span> <span class="free">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
     <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t2</span><span class="main">)</span><span class="main">.</span>
      <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iUntil_def iNext_def iT_inext iT_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_Output_nth i_Exec_Stream_Acc_LocalState_nth i_Exec_Stream_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> last_message_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_add iT_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream.simps<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_nth min_eqL <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Comp.simps f_Exec_Comp_Stream.simps<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_Exec_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_expand_i_take_mult_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_length length_Cons length_replicate Suc_pred
  nth_map f_Exec_Stream_nth take_Suc_Cons take_replicate min_eqL<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_imp_le_pred<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_Exec_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_expand_i_take_mult_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t2</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="improper">j</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_less<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
  State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span>
    <span class="main">(</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="improper">j</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="improper">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">t2</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="improper">j</span> <span class="main">-</span> <span class="improper">t2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_take_add f_Exec_append<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_take_i_drop<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_expand_nth_interval_eq_replicate_NoMsg<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_State_Idle_replicate_NoMsg_state<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∧</span> <span class="improper">t2</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">=</span> <span class="free">t</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_less_imp_div<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_expand_i_take_Suc i_expand_i_take_mult_Suc f_Exec_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t2</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> f_Exec_State_Idle_replicate_NoMsg_gr_output<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_div_mult_eq_mod <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">□</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>
      State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
     <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">○</span> <span class="bound">t2</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
      <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t2</span><span class="main">)</span><span class="main">.</span>
      <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_Output_nth i_Exec_Stream_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iNext_def iFROM_iff iFROM_inext<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> last_message_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_nth min_eqL <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Comp.simps f_Exec_Comp_Stream.simps de_Morgan_conj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
   <span class="main">□</span> <span class="bound">t'</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="improper">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span>
   <span class="free">output_fun</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="bound">t'</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iT_add iT_iff cut_less_mem_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t'</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t'</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_Stream_nth min_eqL <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream.simps de_Morgan_conj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">≤</span> <span class="improper">t'</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">t'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="improper">t'</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_take_add f_Exec_append i_expand_i_take_mult<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_take_i_drop<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_expand_nth_interval_eq_nth_append_replicate_NoMsg<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream.simps de_Morgan_conj<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_Suc_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_expand_i_take_mult_Suc f_Exec_append <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_Suc_right<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_LocalState_nth i_expand_i_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult_Suc add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
   <span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span>
       <span class="main">(</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="improper">i</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_Suc_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_expand_i_take_mult_Suc f_Exec_append i_expand_i_take_mult <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_Suc_right<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"last_message <span class="skolem">x</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">x</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span>
   a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
   P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span>
          <span class="main">(</span><span class="free">localState</span> <span class="main">(</span>f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> <span class="bound">x</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> back_subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_expand_i_take_mult_Suc f_Exec_append<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">-</span> <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> State_Idle_imp_exists_state_change<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_Exec_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> replicate_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_diff_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> add.commute<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Suc_less_pred_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iUntil_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="main">(</span><span class="improper">i</span> <span class="main">+</span> <span class="improper">i1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="main">(</span><span class="improper">i</span> <span class="main">+</span> <span class="improper">i1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff cut_less_mem_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="main">(</span><span class="improper">i</span> <span class="main">+</span> <span class="improper">i1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> Suc <span class="main">(</span>Suc <span class="main">(</span><span class="improper">i</span> <span class="main">+</span> <span class="improper">i1</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_expand_i_take_mult_Suc f_Exec_append<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_Suc_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> replicate_add f_Exec_append <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_Suc_right replicate.simps<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff iT_add iT_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f_Exec_Comp_Stream.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i'</span></span><span class="main">&gt;</span><span class="improper">i</span><span class="main">.</span> <span class="improper">t'</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">i'</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t'</span> <span class="main">-</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"iAll <span class="skolem"><span class="skolem"><span class="skolem">I</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">P</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">I</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">P</span></span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i'</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_Suc_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_expand_i_take_mult_Suc f_Exec_append f_Exec_Stream_nth min_eqL i_expand_i_take_mult <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_Suc_right f_Exec_Comp_Stream.simps<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> iexE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_imp2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here the property to be checked uses only unbounded intervals suitable for LTL.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">(</span><span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
    <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">○</span> <span class="bound">t3</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
      <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t4</span> <span class="keyword1">𝒰</span> <span class="bound">t5</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t3</span><span class="main">)</span><span class="main">.</span>
       <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"
  <span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
      State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_with_State_Idle_imp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc_lessD refl refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iNext_def iT_inext iT_iff iUntil_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> iexE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t2 t3<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t2</span> <span class="main">≤</span> <span class="improper">t1</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff iT_add iT_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"iAll <span class="skolem">I</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">I</span> <span class="skolem">P</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">≤</span> <span class="improper">t2</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t3</span> <span class="main">&lt;</span> <span class="improper">t1</span> <span class="main">⟶</span> <span class="free">output_fun</span> <span class="main">(</span>i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span> <span class="improper">t1</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">≤</span> <span class="improper">t3</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∧</span> <span class="improper">t3</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">=</span> <span class="free">t</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff le_less_imp_div<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth i_expand_i_take_Suc f_Exec_append<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t3</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> f_Exec_State_Idle_replicate_NoMsg_gr_output<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">localState</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">output_fun</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">trans_fun</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth i_expand_i_take_Suc f_Exec_append<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_div_mult_eq_mod <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">&lt;</span> <span class="improper">t3</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff iT_add iT_iff<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_conv2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iNext_def iT_inext iT_iff iUntil_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> iexE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1 t2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_LocalState_nth i_expand_i_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"iAll <span class="skolem">I</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">I</span> <span class="skolem">P</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff iT_add iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">□</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>
      State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
     <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">○</span> <span class="bound">t3</span> <span class="bound">t2</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
       <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t4</span> <span class="keyword1">𝒰</span> <span class="bound">t5</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t3</span><span class="main">)</span><span class="main">.</span>
        <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_conv2<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iNext_def iT_inext iT_iff iUntil_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> iexE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1 t2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_imp_add_positive<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_nth<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> add_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_take_add f_Exec_append<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_take_i_drop<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">+</span> Suc <span class="improper">t'</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i_expand_nth_interval_eq_replicate_NoMsg<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ le_imp_less_Suc le_add2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"f_Exec_Comp <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span> <span class="main">⇓</span> Suc <span class="improper">t'</span><span class="main">)</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> f_Exec_State_Idle_replicate_NoMsg_gr0_output<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_imp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
    <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
    <span class="main">(</span>State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">○</span> <span class="bound">t2</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
      <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t2</span><span class="main">)</span><span class="main">.</span>
       <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> conj_disj_distribL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"
  <span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span>
    <span class="main">(</span>State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> iexE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_with_State_Idle_conv2<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> Suc_lessD<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> iexE conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_with_State_Idle_conv2<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?t1.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_imp2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_conv2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ refl refl<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv2'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
      <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
      <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">○</span> <span class="bound">t2</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
          <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t2</span><span class="main">)</span><span class="main">.</span>
           <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_iAll_iUntil_State_Idle_conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>
     <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
      <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
      <span class="main">(</span>State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">○</span> <span class="bound">t2</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
        <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t2</span><span class="main">)</span><span class="main">.</span>
         <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_State_Idle_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒰</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span>
    <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">(</span><span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒰</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span>
   <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">○</span> <span class="bound">t3</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
     <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t4</span> <span class="keyword1">𝒰</span> <span class="bound">t5</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t3</span><span class="main">)</span><span class="main">.</span>
      <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"
  <span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span>
    <span class="main">(</span>State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> iexE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_with_State_Idle_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> Suc_lessD<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_with_State_Idle_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_imp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_before_State_Idle_conv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ refl refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> iexE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Stream_Acc_LocalState_nth i_Exec_Stream_nth i_expand_i_take_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"iAll <span class="skolem">I</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">I</span> <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff iT_add iT_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_add iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒰</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span>
    <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
      <span class="main">(</span>State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">○</span> <span class="bound">t3</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
          <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t4</span> <span class="keyword1">𝒰</span> <span class="bound">t5</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t3</span><span class="main">)</span><span class="main">.</span>
           <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv'<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iUntil_disj_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iUntil_cong2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_iUntil_State_Idle_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>
     <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒰</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span>
      <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
        <span class="main">(</span>State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">○</span> <span class="bound">t3</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
            <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t4</span> <span class="keyword1">𝒰</span> <span class="bound">t5</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t3</span><span class="main">)</span><span class="main">.</span>
             <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_State_Idle_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sufficient conditions for output messages.›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_iEx_imp1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
       <span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv2'<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_iEx_imp2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">◇</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span> <span class="main">(</span>
          <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">○</span> <span class="bound">t2</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
              <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t3</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t3</span> <span class="keyword1">𝒰</span> <span class="bound">t4</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t2</span><span class="main">)</span><span class="main">.</span>
               <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv2'<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_iUntil_imp1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">(</span><span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒰</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span>
    <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv'<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_iUntil_imp2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span>
    State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span>
      i_Exec_Comp_Stream_Acc_LocalState <span class="free">k</span> <span class="free">localState</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span><span class="main">)</span><span class="main">;</span>
    <span class="free">m</span> <span class="main">≠</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">;</span>
    <span class="free">t0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">;</span>
    <span class="free">s</span> <span class="main">=</span> i_Exec_Comp_Stream <span class="free">trans_fun</span> <span class="main">(</span><span class="free">input</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">k</span><span class="main">)</span> <span class="free">c</span><span class="main">;</span>
    <span class="main">(</span><span class="main">¬</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">t2</span> <span class="keyword1">𝒰</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">t0</span><span class="main">.</span>
    <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">○</span> <span class="bound">t3</span> <span class="bound">t1</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span>
      <span class="main">(</span><span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t4</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span><span class="main">.</span> <span class="bound">t4</span> <span class="keyword1">𝒰</span> <span class="bound">t5</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊕</span> <span class="bound">t3</span><span class="main">)</span><span class="main">.</span>
       <span class="main">(</span><span class="free">output_fun</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span> <span class="main">=</span> <span class="main">\&lt;NoMsg&gt;</span> <span class="main">∧</span> State_Idle <span class="free">localState</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="main">(</span><span class="free">localState</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t5</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  i_Exec_Comp_Stream_Acc_Output <span class="free">k</span> <span class="free">output_fun</span> <span class="free">trans_fun</span> <span class="free">input</span> <span class="free">c</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv'<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹List of selected lemmas about output of accelerated components.›</span></span>

<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_iAll_conv
<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_iEx_iAll_cut_greater_conv
<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_iSince_conv
<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_iAll_iSince_conv

<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_NoMsg_State_Idle_conv
<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv2
<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv
<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv2'
<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_conv'

<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_iAll_iUntil_State_Idle_conv2
<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_iUntil_State_Idle_conv

<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_iEx_imp1
<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_iEx_imp2
<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_iUntil_imp1
<span class="keyword1"><span class="command">thm</span></span> i_Exec_Comp_Stream_Acc_Output__eq_Msg_State_Idle_iUntil_imp2

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>