<div id="Zeta_Library">
<div class="head">
<h1>Theory Zeta_Library</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Various preliminary material›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Zeta_Library
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Complex_Analysis/Complex_Analysis.html">HOL-Complex_Analysis.Complex_Analysis</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Real_Asymp/Real_Asymp.html">HOL-Real_Asymp.Real_Asymp</a>"</span>
  <span class="quoted">"<a href="../Dirichlet_Series/Dirichlet_Series_Analysis.html">Dirichlet_Series.Dirichlet_Series_Analysis</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Facts about limits›</span></span>

<span class="keyword1" id="Zeta_Library-at_within_altdef"><span class="command">lemma</span></span> at_within_altdef<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">S</span><span class="main">∈</span><span class="main">{</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">}</span><span class="main">.</span> principal <span class="main">(</span><span class="bound">S</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> at_within_def nhds_def inf_principal <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> INF_inf_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> INF_constant<span class="main">)</span>

<span class="keyword1" id="Zeta_Library-tendsto_at_left_realI_sequentially"><span class="command">lemma</span></span> tendsto_at_left_realI_sequentially<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>first_countable_topology"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> filterlim <span class="bound">X</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span> sequentially <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"decseq <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="skolem">A</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"nhds <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> principal <span class="main">(</span><span class="skolem">A</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nhds_countable<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&lt;</span><span class="free">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">d</span><span class="main">&lt;..&lt;</span><span class="free">c</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="bound">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&lt;</span><span class="free">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">d</span><span class="main">&lt;..&lt;</span><span class="free">c</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">d</span><span class="main">&lt;..&lt;</span><span class="free">c</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∉</span> <span class="skolem">A</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">X</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="bound">X</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">c</span> <span class="main">-</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="bound">X</span> <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> dependent_nat_choice<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">from</span></span> **<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> **<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> max <span class="main">0</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">X</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">X</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">c</span> <span class="main">-</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> X_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="skolem">X</span> <span class="main">0</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="skolem">X</span> <span class="main">0</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">=</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="skolem">X</span> <span class="main">0</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="skolem">X</span> <span class="main">0</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="skolem">X</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> diff_left_mono divide_right_mono Suc diff_right_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span> <span class="main">-</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="skolem">X</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">X</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⇢</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_sandwich<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">X</span> <span class="bound">n</span> <span class="main">≤</span> <span class="free">c</span><span class="main">)</span> sequentially"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> always_eventually<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">X</span> <span class="bound">n</span> <span class="main">≥</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="skolem">X</span> <span class="main">0</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> sequentially"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X_ge <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> always_eventually<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">X</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_imp_filterlim_at_left<span class="main">)</span>
         <span class="main">(</span><span class="operator">use</span> X <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> always_eventually less_imp_le›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> topological_tendstoD<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">[</span></span><span class="operator">OF</span> this<span class="main"><span class="main">]</span></span> A<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span> 3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> X<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">d</span> <span class="skolem">m</span><span class="main">&lt;..&lt;</span><span class="free">c</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"at_left <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">S</span><span class="main">∈</span><span class="main">{</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">}</span><span class="main">.</span> principal <span class="main">(</span><span class="bound">S</span> <span class="main">∩</span> <span class="main">{..&lt;</span><span class="free">c</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> at_within_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> d <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> *** A <span class="keyword1"><span class="command">using</span></span> A<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_base<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">m</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span> <span class="bound"><span class="bound"><span class="bound">m</span></span></span><span class="main"><span class="main"><span class="main">&lt;..}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> at_right_PInf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"at_right <span class="main">(</span><span class="main">∞</span> <span class="main">::</span> ereal<span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> at_left_MInf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"at_left <span class="main">(</span><span class="main">-</span><span class="main">∞</span> <span class="main">::</span> ereal<span class="main">)</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">∞</span><span class="main">::</span>ereal<span class="main">)</span><span class="main">&lt;..}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="main">-</span><span class="main">(</span><span class="main">∞</span><span class="main">::</span>ereal<span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"at_right <span class="main">(</span><span class="main">∞</span> <span class="main">::</span> ereal<span class="main">)</span> <span class="main">=</span> bot"</span></span> <span class="quoted"><span class="quoted">"at_left <span class="main">(</span><span class="main">-</span><span class="main">∞</span> <span class="main">::</span> ereal<span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> at_within_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-tendsto_at_left_erealI_sequentially"><span class="command">lemma</span></span> tendsto_at_left_erealI_sequentially<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ereal <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>first_countable_topology"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> filterlim <span class="bound">X</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span> sequentially <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> PInf
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>ereal <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">y</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_at_topI_sequentially assms<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ereal_tendsto_simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def filterlim_at<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> at_left_PInf filterlim_filtermap<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> MInf
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>real <span class="skolem">c'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>ereal <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">c'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_at_left_realI_sequentially assms<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">X</span> <span class="main">(</span>at_left <span class="skolem">c'</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequentially_imp_eventually_within tendsto_imp_filterlim_at_left<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> at_left_ereal filterlim_filtermap<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-tendsto_at_right_realI_sequentially"><span class="command">lemma</span></span> tendsto_at_right_realI_sequentially<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>first_countable_topology"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> filterlim <span class="bound">X</span> <span class="main">(</span>at_right <span class="free">c</span><span class="main">)</span> sequentially <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"decseq <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="skolem">A</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"nhds <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">n</span><span class="main">.</span> principal <span class="main">(</span><span class="skolem">A</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nhds_countable<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="free">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">c</span><span class="main">&lt;..&lt;</span><span class="bound">d</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="bound">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="free">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">c</span><span class="main">&lt;..&lt;</span><span class="bound">d</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">c</span><span class="main">&lt;..&lt;</span><span class="bound">d</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∉</span> <span class="skolem">A</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">X</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="bound">X</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">+</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="bound">X</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> dependent_nat_choice<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">from</span></span> **<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> **<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">+</span> max <span class="main">0</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">X</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">X</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">+</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> X_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">0</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">+</span> max <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="skolem">X</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> X<span class="main">)</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">0</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_left_mono divide_right_mono Suc diff_right_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">0</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⇢</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_sandwich<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">X</span> <span class="bound">n</span> <span class="main">≥</span> <span class="free">c</span><span class="main">)</span> sequentially"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> always_eventually<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">X</span> <span class="bound">n</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">0</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> sequentially"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> always_eventually<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">X</span> <span class="main">(</span>at_right <span class="free">c</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_imp_filterlim_at_right<span class="main">)</span>
         <span class="main">(</span><span class="operator">use</span> X <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> always_eventually less_imp_le›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> topological_tendstoD<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">[</span></span><span class="operator">OF</span> this<span class="main"><span class="main">]</span></span> A<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span> 3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> X<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">m</span> <span class="main">&gt;</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c</span><span class="main">&lt;..&lt;</span><span class="skolem">d</span> <span class="skolem">m</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"at_right <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">S</span><span class="main">∈</span><span class="main">{</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">}</span><span class="main">.</span> principal <span class="main">(</span><span class="bound">S</span> <span class="main">∩</span> <span class="main">{</span><span class="free">c</span><span class="main">&lt;..}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> at_within_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> d <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> *** A <span class="keyword1"><span class="command">using</span></span> A<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_base<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">m</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">{..&lt;</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span> <span class="bound"><span class="bound"><span class="bound">m</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-tendsto_at_right_erealI_sequentially"><span class="command">lemma</span></span> tendsto_at_right_erealI_sequentially<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ereal <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>first_countable_topology"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> filterlim <span class="bound">X</span> <span class="main">(</span>at_right <span class="free">c</span><span class="main">)</span> sequentially <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> MInf
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">-</span>ereal <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">y</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_at_topI_sequentially assms<span class="main">)</span>
      <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> uminus_ereal.simps ereal_tendsto_simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def filterlim_at<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> at_right_MInf filterlim_filtermap at_top_mirror<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> PInf
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>real <span class="skolem">c'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>ereal <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">c'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_at_right_realI_sequentially assms<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">X</span> <span class="main">(</span>at_right <span class="skolem">c'</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">c</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequentially_imp_eventually_within tendsto_imp_filterlim_at_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> at_right_ereal filterlim_filtermap<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> analytic_continuation'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">holomorphic_on</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"open <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="keyword1">islimpt</span> <span class="free">U</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> fU0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">w</span> <span class="main">=</span> <span class="free">g</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> analytic_continuation<span class="main">[</span><span class="operator">OF</span> holomorphic_on_diff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hol<span class="main"><span class="main">]</span></span> assms<span class="main"><span class="main">(</span></span>3-7<span class="main"><span class="main">)</span></span> _ assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>8<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Various facts about integrals›</span></span>

<span class="keyword1" id="Zeta_Library-continuous_on_imp_set_integrable_cbox"><span class="command">lemma</span></span> continuous_on_imp_set_integrable_cbox<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> euclidean_space <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="keyword1">absolutely_integrable_on</span> cbox <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_continuous<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable borel"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> borel_measurable_continuous_on_indicator<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> integrable_completion<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-set_nn_integral_cong"><span class="command">lemma</span></span> set_nn_integral_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="free">M'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> space <span class="free">M</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set_nn_integral <span class="free">M</span> <span class="free">A</span> <span class="free">f</span> <span class="main">=</span> set_nn_integral <span class="free">M'</span> <span class="free">B</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>

<span class="keyword1" id="Zeta_Library-set_integrable_bound"><span class="command">lemma</span></span> set_integrable_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">::</span><span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="free">M</span> <span class="free">A</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable <span class="free">M</span> <span class="free">A</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set_integrable <span class="free">M</span> <span class="free">A</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="free">A</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_integrable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="free">A</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> norm <span class="main">(</span>indicat_real <span class="free">A</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span>indicat_real <span class="free">A</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO replace version in library. Better name? *)</span>
<span class="keyword1" id="Zeta_Library-nn_integral_has_integral_lebesgue"><span class="command">lemma</span></span> nn_integral_has_integral_lebesgue<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Ω</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_integral</span> <span class="free">I</span><span class="main">)</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>N</sup></span> lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="free">Ω</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="free">Ω</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> lebesgue <span class="keyword1">→<span class="hidden">⇩</span><sub>M</sub></span> borel"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_implies_lebesgue_measurable<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> borel <span class="keyword1">→<span class="hidden">⇩</span><sub>M</sub></span> borel"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> indicator <span class="free">Ω</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> completion_ex_borel_measurable_real<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> abs <span class="main">(</span>indicator <span class="free">Ω</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="free">I</span><span class="main">)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nonneg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def if_distrib<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">y</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> abs <span class="main">(</span>indicator <span class="free">Ω</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="free">I</span><span class="main">)</span> UNIV <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> abs <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="free">I</span><span class="main">)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_AE<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>N</sup></span> lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> abs <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_has_integral_lborel<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>N</sup></span> lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> abs <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>N</sup></span> lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> abs <span class="main">(</span>indicator <span class="free">Ω</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong_AE<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> abs <span class="main">(</span>indicator <span class="free">Ω</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="free">Ω</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nonneg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Uniform convergence of integrals›</span></span>

<span class="keyword1" id="Zeta_Library-has_absolute_integral_change_of_variables_1'"><span class="command">lemma</span></span> has_absolute_integral_change_of_variables_1'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> der_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_field_derivative</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">g</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g'</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span> <span class="main">∧</span>
           integral <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g'</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>
     <span class="main">⟷</span> <span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> integral <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g'</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vec <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> real <span class="main">^</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span> <span class="main">∧</span>
           integral <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g'</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vec <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec <span class="free">b</span> <span class="main">::</span> real <span class="main">^</span> <span class="main">1</span><span class="main">)</span>
         <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vec <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">::</span> real <span class="main">^</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span>
           integral <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vec <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec <span class="free">b</span> <span class="main">::</span> real <span class="main">^</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> has_field_derivative_iff_has_vector_derivative
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_absolute_integral_change_of_variables_1 assms<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_on_1_iff integral_on_1_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-set_nn_integral_lborel_eq_integral"><span class="command">lemma</span></span> set_nn_integral_lborel_eq_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="free">A</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> integral <span class="free">A</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span>indicator <span class="free">A</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="free">A</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_lborel_eq_integral<span class="main">)</span>
                      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def set_borel_measurable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="free">A</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> integral <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="free">A</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral_spike_set<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> integral <span class="free">A</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-nn_integral_has_integral_lebesgue'"><span class="command">lemma</span></span> nn_integral_has_integral_lebesgue'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Ω</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_integral</span> <span class="free">I</span><span class="main">)</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>N</sup></span> lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> indicator <span class="free">Ω</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>N</sup></span> lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> indicator <span class="free">Ω</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
        <span class="keyword1">integral<span class="hidden">⇧</span><sup>N</sup></span> lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span>indicator <span class="free">Ω</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_has_integral_lebesgue<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-uniform_limit_set_lebesgue_integral"><span class="command">lemma</span></span> uniform_limit_set_lebesgue_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> euclidean_space <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">X'</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X'</span> <span class="main">∈</span> sets borel"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟹</span> set_borel_measurable borel <span class="free">X'</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">AE</span> <span class="bound">t</span><span class="main">∈</span><span class="free">X'</span> <span class="keyword1">in</span> lborel<span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">X</span> <span class="bound">x</span> <span class="main">∈</span> sets borel <span class="main">∧</span> <span class="free">X</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="free">X'</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> set_lebesgue_integral lborel <span class="main">(</span><span class="free">X</span> <span class="bound">x</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>
             <span class="main">(</span>nhds <span class="main">(</span>set_lebesgue_integral lborel <span class="free">X'</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uniform_limit <span class="free">Y</span>
           <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> set_lebesgue_integral lborel <span class="main">(</span><span class="free">X</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> set_lebesgue_integral lborel <span class="free">X'</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> uniform_limitI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ε</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> integrable_g<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="skolem">U</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> sets borel"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> dist <span class="main">(</span>set_lebesgue_integral lborel <span class="main">(</span><span class="free">X</span> <span class="bound">x</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>
                             <span class="main">(</span>set_lebesgue_integral lborel <span class="free">X'</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">ε</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tendsto_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹eventually <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">_</span> <span class="main">∧</span> <span class="main">_</span><span class="main">)</span> <span class="free">F</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="skolem">x</span> <span class="main">∈</span> sets borel"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="free">X'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="skolem">U</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> sets borel"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="skolem">U</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">:</span> set_borel_measurable_def›</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>set_lebesgue_integral lborel <span class="main">(</span><span class="free">X</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span>set_lebesgue_integral lborel <span class="free">X'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            norm <span class="main">(</span>set_lebesgue_integral lborel <span class="free">X'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">-</span>
                  set_lebesgue_integral lborel <span class="main">(</span><span class="free">X</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm norm_minus_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_lebesgue_integral lborel <span class="free">X'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">-</span>
                    set_lebesgue_integral lborel <span class="main">(</span><span class="free">X</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span>
                 set_lebesgue_integral lborel <span class="main">(</span><span class="free">X'</span> <span class="main">-</span> <span class="free">X</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bochner_Integration.integral_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integrable<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">fact</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integrable<span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> Bochner_Integration.integral_cong<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="free">X'</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> indicator_def›</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">t</span><span class="main">∈</span><span class="free">X'</span><span class="main">-</span><span class="free">X</span> <span class="skolem">x</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integral_norm_bound integrable<span class="main">)</span> <span class="main">(</span><span class="operator">fact</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">t</span><span class="main">∈</span><span class="free">X'</span> <span class="main">-</span> <span class="free">X</span> <span class="skolem">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">t</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">t</span><span class="main">∈</span><span class="free">X'</span><span class="main">-</span><span class="free">X</span> <span class="skolem">x</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">t</span><span class="main">∈</span><span class="free">X'</span><span class="main">-</span><span class="free">X</span> <span class="skolem">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integral_mono_AE set_integrable_norm integrable integrable_g<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">t</span><span class="main">∈</span><span class="free">X'</span><span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∫</span><span class="bound">t</span><span class="main">∈</span><span class="free">X</span> <span class="skolem">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bochner_Integration.integral_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integrable_g<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">fact</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integrable_g<span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> Bochner_Integration.integral_cong<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="free">X'</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> indicator_def›</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> dist <span class="main">(</span><span class="main">∫</span><span class="bound">t</span><span class="main">∈</span><span class="free">X</span> <span class="skolem">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">(</span><span class="main">∫</span><span class="bound">t</span><span class="main">∈</span><span class="free">X'</span><span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>set_lebesgue_integral lborel <span class="main">(</span><span class="free">X</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">(</span>set_lebesgue_integral lborel <span class="free">X'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-integral_dominated_convergence_at_right"><span class="command">lemma</span></span> integral_dominated_convergence_at_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">i</span> <span class="keyword1">in</span> at_right <span class="free">c</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> norm <span class="main">(</span><span class="free">s</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">w</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="free">M</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="free">M</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_at_right_realI_sequentially<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">X</span> <span class="main">(</span>at_right <span class="free">c</span><span class="main">)</span> sequentially"</span></span>
  <span class="keyword1"><span class="command">from</span></span> filterlim_iff<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">OF</span> this<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> bound<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">N</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> norm <span class="main">(</span><span class="free">s</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">w</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_sequentially<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="free">M</span> <span class="main">(</span><span class="free">s</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="free">M</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_offset<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> integral_dominated_convergence<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> norm <span class="main">(</span><span class="free">s</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">w</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> w<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lim
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> LIMSEQ_ignore_initial_segment filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ X<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-integral_dominated_convergence_at_left"><span class="command">lemma</span></span> integral_dominated_convergence_at_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="bound">t</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">i</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> norm <span class="main">(</span><span class="free">s</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">w</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="free">M</span> <span class="main">(</span><span class="free">s</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="free">M</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_at_left_realI_sequentially<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">X</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span> sequentially"</span></span>
  <span class="keyword1"><span class="command">from</span></span> filterlim_iff<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">OF</span> this<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> bound<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">N</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> norm <span class="main">(</span><span class="free">s</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">w</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_sequentially<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="free">M</span> <span class="main">(</span><span class="free">s</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="free">M</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_offset<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> integral_dominated_convergence<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> norm <span class="main">(</span><span class="free">s</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">w</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> w<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lim
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> LIMSEQ_ignore_initial_segment filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ X<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-uniform_limit_interval_integral_right"><span class="command">lemma</span></span> uniform_limit_interval_integral_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="free">a</span> <span class="free">b</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟹</span> set_borel_measurable borel <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">AE</span> <span class="bound">t</span><span class="main">∈</span>einterval <span class="free">a</span> <span class="free">b</span> <span class="keyword1">in</span> lborel<span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"uniform_limit <span class="free">Y</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b'</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">t</span><span class="main">=</span><span class="free">a</span><span class="main">..</span><span class="bound">b'</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">t</span><span class="main">=</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> g_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">t</span><span class="main">∈</span>einterval <span class="free">a</span> <span class="free">b</span> <span class="keyword1">in</span> lborel<span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">b'</span><span class="main">.</span> <span class="bound">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_at_leftI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">⟷</span> uniform_limit <span class="free">Y</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b'</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∫</span><span class="bound">t</span><span class="main">∈</span>einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="bound">b'</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span>
                                  <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">∫</span><span class="bound">t</span><span class="main">∈</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">uniformly_on</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integral_def fun_eq_iff min_def
             <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="main">…</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> uniform_limit_set_lebesgue_integral<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">b'</span> <span class="keyword1">in</span> at_left <span class="free">b</span><span class="main">.</span> einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="bound">b'</span><span class="main">)</span> <span class="main">∈</span> sets borel <span class="main">∧</span>
                              einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="bound">b'</span><span class="main">)</span> <span class="main">⊆</span> einterval <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ev <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b'</span><span class="main">.</span> set_lebesgue_integral lborel <span class="main">(</span>einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="bound">b'</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="main">⤏</span>
            set_lebesgue_integral lborel <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_at_left_erealI_sequentially integral_dominated_convergence<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> less_imp_le<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def set_integrable_def set_borel_measurable_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">(</span>einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_borel_measurable_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">X</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>
               <span class="main">⇢</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> AE_I2<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">(</span>einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⇢</span>
                indicator <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> einterval <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span>max <span class="free">a</span> <span class="skolem">x</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_at_leftI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"ereal <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def min_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">X</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span>max <span class="free">a</span> <span class="skolem">x</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> sequentially"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_compose_filterlim<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">(</span>einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span> sequentially"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> True <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> indicator_def einterval_def›</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> tendsto_eventually<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>
                 <span class="main">⇢</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> norm <span class="main">(</span>indicator <span class="main">(</span>einterval <span class="free">a</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span>
              indicator <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def einterval_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> 
         <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> interval_lebesgue_integrable_def set_integrable_def›</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> interval_lebesgue_integrable_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Zeta_Library-uniform_limit_interval_integral_left"><span class="command">lemma</span></span> uniform_limit_interval_integral_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="free">a</span> <span class="free">b</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟹</span> set_borel_measurable borel <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">AE</span> <span class="bound">t</span><span class="main">∈</span>einterval <span class="free">a</span> <span class="free">b</span> <span class="keyword1">in</span> lborel<span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"uniform_limit <span class="free">Y</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a'</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">t</span><span class="main">=</span><span class="bound">a'</span><span class="main">..</span><span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">t</span><span class="main">=</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> g_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">t</span><span class="main">∈</span>einterval <span class="free">a</span> <span class="free">b</span> <span class="keyword1">in</span> lborel<span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">b'</span><span class="main">.</span> <span class="bound">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_at_rightI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">⟷</span> uniform_limit <span class="free">Y</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a'</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∫</span><span class="bound">t</span><span class="main">∈</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="bound">a'</span><span class="main">)</span> <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span>
                                  <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">∫</span><span class="bound">t</span><span class="main">∈</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">uniformly_on</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integral_def fun_eq_iff max_def
             <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="main">…</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> uniform_limit_set_lebesgue_integral<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">a'</span> <span class="keyword1">in</span> at_right <span class="free">a</span><span class="main">.</span> einterval <span class="main">(</span>max <span class="free">a</span> <span class="bound">a'</span><span class="main">)</span> <span class="free">b</span> <span class="main">∈</span> sets borel <span class="main">∧</span>
                              einterval <span class="main">(</span>max <span class="free">a</span> <span class="bound">a'</span><span class="main">)</span> <span class="free">b</span> <span class="main">⊆</span> einterval <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ev <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a'</span><span class="main">.</span> set_lebesgue_integral lborel <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="bound">a'</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="main">⤏</span>
            set_lebesgue_integral lborel <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_at_right_erealI_sequentially integral_dominated_convergence<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> less_imp_le<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def set_integrable_def set_borel_measurable_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_borel_measurable_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">X</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>
               <span class="main">⇢</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> AE_I2<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⇢</span>
                indicator <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> einterval <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span>"</span></span><span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_at_rightI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"ereal <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def min_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">X</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> sequentially"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_compose_filterlim<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span> sequentially"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> True <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> indicator_def einterval_def›</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> tendsto_eventually<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="skolem">X</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>
                 <span class="main">⇢</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> norm <span class="main">(</span>indicator <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="skolem">X</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span>
              indicator <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def einterval_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> 
         <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> interval_lebesgue_integrable_def set_integrable_def›</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> interval_lebesgue_integrable_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Zeta_Library-uniform_limit_interval_integral_sequentially"><span class="command">lemma</span></span> uniform_limit_interval_integral_sequentially<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="free">a</span> <span class="free">b</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟹</span> set_borel_measurable borel <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">AE</span> <span class="bound">t</span><span class="main">∈</span>einterval <span class="free">a</span> <span class="free">b</span> <span class="keyword1">in</span> lborel<span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="free">a'</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> sequentially"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b'<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="free">b'</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> sequentially"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"uniform_limit <span class="free">Y</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">t</span><span class="main">=</span><span class="free">a'</span> <span class="bound">n</span><span class="main">..</span><span class="free">b'</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span><span class="main">)</span>
             <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">t</span><span class="main">=</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span><span class="main">)</span> sequentially"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> g_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">t</span><span class="main">∈</span>einterval <span class="free">a</span> <span class="free">b</span> <span class="keyword1">in</span> lborel<span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">a'</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">a'</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">b'</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">b'</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">)</span> sequentially"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> ereal_dense2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> ereal <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">t</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a'</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_compose_filterlim<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ a'<span class="main"><span class="main">]</span></span> eventually_at_rightI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"ereal <span class="skolem"><span class="skolem"><span class="skolem">t</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">b'</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">t</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_compose_filterlim<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ b'<span class="main"><span class="main">]</span></span> eventually_at_leftI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"ereal <span class="skolem"><span class="skolem"><span class="skolem">t</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">a'</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">a'</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">b'</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">b'</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">⟷</span> uniform_limit <span class="free">Y</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∫</span><span class="bound">t</span><span class="main">∈</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span>
                      <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">∫</span><span class="bound">t</span><span class="main">∈</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span> sequentially"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">uniformly_on</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integral_def fun_eq_iff min_def max_def
             <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="main">…</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> uniform_limit_set_lebesgue_integral<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> sets borel <span class="main">∧</span>
                                einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> einterval <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ev <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> set_lebesgue_integral lborel <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="main">⤏</span>
            set_lebesgue_integral lborel <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> integral_dominated_convergence<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> less_imp_le<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def set_integrable_def set_borel_measurable_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_borel_measurable_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>
               <span class="main">⇢</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> AE_I2<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⇢</span>
                indicator <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> einterval <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_at_rightI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"ereal <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def min_def<span class="main">)</span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a'</span> <span class="bound">n</span><span class="main">&lt;..&lt;</span><span class="free">b'</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> sequentially"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a'</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> sequentially"</span></span> <span class="keyword1"><span class="command">using</span></span> True
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_compose_filterlim<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ a'<span class="main"><span class="main">]</span></span> eventually_at_rightI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"ereal <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                 <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">b'</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> sequentially"</span></span> <span class="keyword1"><span class="command">using</span></span> True
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_compose_filterlim<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ b'<span class="main"><span class="main">]</span></span> eventually_at_leftI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"ereal <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                 <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a'</span> <span class="bound">n</span><span class="main">&lt;..&lt;</span><span class="free">b'</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span> sequentially"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span> sequentially"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> True <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> indicator_def einterval_def›</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> tendsto_eventually<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>
                 <span class="main">⇢</span> indicat_real <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> norm <span class="main">(</span>indicator <span class="main">(</span>einterval <span class="main">(</span>max <span class="free">a</span> <span class="main">(</span><span class="free">a'</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="free">b</span> <span class="main">(</span><span class="free">b'</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span>
              indicator <span class="main">(</span>einterval <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def einterval_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> 
         <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> interval_lebesgue_integrable_def set_integrable_def›</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> interval_lebesgue_integrable_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Zeta_Library-interval_lebesgue_integrable_combine"><span class="command">lemma</span></span> interval_lebesgue_integrable_combine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="free">A</span> <span class="free">B</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="free">B</span> <span class="free">C</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">(</span>einterval <span class="free">A</span> <span class="free">C</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≤</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="free">A</span> <span class="free">C</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> meas<span class="main">:</span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">(</span>einterval <span class="free">A</span> <span class="free">B</span> <span class="main">∪</span> einterval <span class="free">B</span> <span class="free">C</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_borel_measurable_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> einterval_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span>einterval <span class="free">A</span> <span class="free">B</span> <span class="main">∪</span> einterval <span class="free">B</span> <span class="free">C</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integrable_Un<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> set_integrable lborel <span class="main">(</span>einterval <span class="free">A</span> <span class="free">C</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="main">{</span><span class="main">∞</span><span class="main">,</span> <span class="main">-</span><span class="main">∞</span><span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"einterval <span class="free">A</span> <span class="free">B</span> <span class="main">∪</span> einterval <span class="free">B</span> <span class="free">C</span> <span class="main">=</span> einterval <span class="free">A</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> ereal <span class="skolem">B'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">B</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indicator <span class="main">(</span>einterval <span class="free">A</span> <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>indicator <span class="main">(</span>einterval <span class="free">A</span> <span class="free">B</span> <span class="main">∪</span> einterval <span class="free">B</span> <span class="free">C</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">B'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">C</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def indicator_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> space lborel<span class="main">.</span> indicat_real <span class="main">(</span>einterval <span class="free">A</span> <span class="free">B</span> <span class="main">∪</span> einterval <span class="free">B</span> <span class="free">C</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span>
              indicat_real <span class="main">(</span>einterval <span class="free">A</span> <span class="free">C</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">B'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def <span class="keyword1"><span class="command">using</span></span> meas assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_cong_AE AE_I<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">B'</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order.trans<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-interval_lebesgue_integrable_bigo_right"><span class="command">lemma</span></span> interval_lebesgue_integrable_bigo_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span>at_left <span class="free">B</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">A</span><span class="main">..&lt;</span><span class="free">B</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> meas<span class="main">:</span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">{</span><span class="free">A</span><span class="main">&lt;..&lt;</span><span class="free">B</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="free">A</span> <span class="free">B</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&lt;</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="free">A</span> <span class="free">B</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> landau_o.bigE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> B'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">&lt;</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">B'</span><span class="main">&lt;..&lt;</span><span class="free">B</span><span class="main">}</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">&lt;</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Topological_Spaces.eventually_at_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> interval_lebesgue_integrable_combine<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="free">A</span> <span class="main">(</span>max <span class="free">A</span> <span class="skolem">B'</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> B' assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> interval_integrable_continuous_on continuous_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cont<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">(</span>einterval <span class="main">(</span>ereal <span class="free">A</span><span class="main">)</span> <span class="main">(</span>ereal <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> meas'<span class="main">:</span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">{</span>max <span class="free">A</span> <span class="skolem">B'</span><span class="main">&lt;..&lt;</span><span class="free">B</span><span class="main">}</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_borel_measurable_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> meas<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span>max <span class="free">A</span> <span class="skolem">B'</span><span class="main">&lt;..&lt;</span><span class="free">B</span><span class="main">}</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ AE_I2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> impI<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">A</span><span class="main">&lt;..&lt;</span><span class="free">B</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span>max <span class="free">A</span> <span class="skolem">B'</span><span class="main">&lt;..&lt;</span><span class="free">B</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>max <span class="free">A</span> <span class="skolem">B'</span><span class="main">&lt;..&lt;</span><span class="free">B</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> B'<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> norm_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> meas' <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> set_borel_measurable_def›</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">(</span>ereal <span class="main">(</span>max <span class="free">A</span> <span class="skolem">B'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ereal <span class="free">B</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> interval_lebesgue_integrable_def einterval_eq_Icc <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B'</span> <span class="main">&lt;</span> <span class="free">B</span>›</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> B' assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-interval_lebesgue_integrable_bigo_left"><span class="command">lemma</span></span> interval_lebesgue_integrable_bigo_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span>at_right <span class="free">A</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">A</span><span class="main">&lt;..</span><span class="free">B</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> meas<span class="main">:</span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">{</span><span class="free">A</span><span class="main">&lt;..&lt;</span><span class="free">B</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="free">A</span> <span class="free">B</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&lt;</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="free">A</span> <span class="free">B</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> landau_o.bigE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">&gt;</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">A</span><span class="main">&lt;..&lt;</span><span class="skolem">A'</span><span class="main">}</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">&lt;</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Topological_Spaces.eventually_at_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> interval_lebesgue_integrable_combine<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">(</span>min <span class="free">B</span> <span class="skolem">A'</span><span class="main">)</span> <span class="free">B</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A' assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> interval_integrable_continuous_on continuous_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cont<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">(</span>einterval <span class="main">(</span>ereal <span class="free">A</span><span class="main">)</span> <span class="main">(</span>ereal <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> meas'<span class="main">:</span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">{</span><span class="free">A</span><span class="main">&lt;..&lt;</span>min <span class="free">B</span> <span class="skolem">A'</span><span class="main">}</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_borel_measurable_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> meas<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">A</span><span class="main">&lt;..&lt;</span>min <span class="free">B</span> <span class="skolem">A'</span><span class="main">}</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ AE_I2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> impI<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">A</span><span class="main">&lt;..&lt;</span><span class="free">B</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">A</span><span class="main">&lt;..&lt;</span>min <span class="free">B</span> <span class="skolem">A'</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">A</span><span class="main">&lt;..&lt;</span>min <span class="free">B</span> <span class="skolem">A'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> A'<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> norm_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> meas' <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> set_borel_measurable_def›</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">(</span>ereal <span class="free">A</span><span class="main">)</span> <span class="main">(</span>ereal <span class="main">(</span>min <span class="free">B</span> <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> interval_lebesgue_integrable_def einterval_eq_Icc <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A'</span> <span class="main">&gt;</span> <span class="free">A</span>›</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> A' assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Other material›</span></span>

<span class="comment1">(* TODO: Library *)</span>
<span class="keyword1" id="Zeta_Library-summable_comparison_test_bigo"><span class="command">lemma</span></span> summable_comparison_test_bigo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"summable <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">g</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> landau_o.bigE<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_ev<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> summable_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-fps_expansion_cong"><span class="command">lemma</span></span> fps_expansion_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fps_expansion <span class="free">g</span> <span class="free">x</span> <span class="main">=</span> fps_expansion <span class="free">h</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">g</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">h</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> higher_deriv_cong_ev assms refl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_expansion_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-fps_expansion_eq_zero_iff"><span class="command">lemma</span></span> fps_expansion_eq_zero_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">holomorphic_on</span> ball <span class="free">z</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fps_expansion <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>ball <span class="free">z</span> <span class="free">r</span><span class="main">.</span> <span class="free">g</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>ball <span class="free">z</span> <span class="free">r</span><span class="main">.</span> <span class="free">g</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> ball <span class="free">z</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">g</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> * <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fps_expansion <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> fps_expansion <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fps_expansion_cong<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fps_expansion <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_expansion_def fps_zero_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fps_expansion <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> ball <span class="free">z</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">w</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_fun_eq_0_on_ball<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> * <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> fps_expansion_def fps_eq_iff›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>ball <span class="free">z</span> <span class="free">r</span><span class="main">.</span> <span class="free">g</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Library-fds_nth_higher_deriv"><span class="command">lemma</span></span> fds_nth_higher_deriv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fds_nth <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> of_real <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> fds_nth <span class="free">F</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_deriv fun_eq_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real<span class="main">)</span>

<span class="keyword1" id="Zeta_Library-binomial_n_n_minus_one"><span class="command">lemma</span></span> binomial_n_n_minus_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">n</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Zeta_Library-has_field_derivative_complex_powr_right"><span class="command">lemma</span></span> has_field_derivative_complex_powr_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">w</span> <span class="keyword1">powr</span> <span class="bound">z</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> Ln <span class="free">w</span> <span class="main">*</span> <span class="free">w</span> <span class="keyword1">powr</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">z</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> has_field_derivative_powr_right<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> has_field_derivative_complex_powr_right' <span class="main">=</span>
  has_field_derivative_complex_powr_right<span class="main">[</span><span class="operator">THEN</span> DERIV_chain2<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Zeta_Function">
<div class="head">
<h1>Theory Zeta_Function</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Zeta_Function.thy
    Author:    Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Hurwitz and Riemann $\zeta$ functions›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Zeta_Function
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../Euler_MacLaurin/Euler_MacLaurin.html">Euler_MacLaurin.Euler_MacLaurin</a>"</span>
  <span class="quoted">"<a href="../Bernoulli/Bernoulli_Zeta.html">Bernoulli.Bernoulli_Zeta</a>"</span>
  <span class="quoted">"<a href="../Dirichlet_Series/Dirichlet_Series_Analysis.html">Dirichlet_Series.Dirichlet_Series_Analysis</a>"</span>
  <span class="quoted">"<a href="../Winding_Number_Eval/Winding_Number_Eval.html">Winding_Number_Eval.Winding_Number_Eval</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Real_Asymp/Real_Asymp.html">HOL-Real_Asymp.Real_Asymp</a>"</span>
  <a href="Zeta_Library.html">Zeta_Library</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminary facts›</span></span>

<span class="comment1">(* TODO Move once Landau symbols are in the distribution *)</span>
<span class="keyword1" id="Zeta_Function-holomorphic_on_extend"><span class="command">lemma</span></span> holomorphic_on_extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">ξ</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span> <span class="main">∈</span> interior <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="free">ξ</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="keyword1">holomorphic_on</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">ξ</span><span class="main">}</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> holomorphic_on_extend_bounded<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> landau_o.bigE<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-removable_singularities"><span class="command">lemma</span></span> removable_singularities<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> interior <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="bound">z</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="keyword1">holomorphic_on</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="free">S</span><span class="main">-</span><span class="free">X</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">z0</span> <span class="skolem">X</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.prems <span class="keyword2"><span class="keyword">and</span></span> insert.hyps <span class="keyword1"><span class="command">have</span></span> z0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z0</span> <span class="main">∈</span> interior <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interior_diff finite_imp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="keyword1">holomorphic_on</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="free">S</span> <span class="main">-</span> <span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">z0</span><span class="main">}</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert.prems insert.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_extend<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">holomorphic_on</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="free">S</span> <span class="main">-</span> <span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">z0</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="keyword1">holomorphic_on</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="free">S</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> insert.IH<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z0'</span> <span class="keyword3"><span class="command">assume</span></span> z0'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z0'</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> interior <span class="free">S</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">z0'</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">z0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>nhds <span class="skolem">z0'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.prems insert.hyps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open open_Diff finite_imp_closed<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">z0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z0'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_filter 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> z0' insert.hyps interior_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="keyword1">at</span> <span class="skolem">z0'</span><span class="main">](</span><span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> g<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="skolem">z0'</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> z0' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> insert.prems<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> insert.prems g<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">holomorphic_on</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="free">S</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">holomorphic_on</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="free">S</span> <span class="main">-</span> insert <span class="skolem">z0</span> <span class="skolem">X</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-continuous_imp_bigo_1"><span class="command">lemma</span></span> continuous_imp_bigo_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bigoI_tendsto<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">1</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Zeta_Function-taylor_bigo_linear"><span class="command">lemma</span></span> taylor_bigo_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="free">x0</span> <span class="keyword1">within</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x0</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="free">x0</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">x0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_field_derivative</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> field_differentiable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x0</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">x0</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x0</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI_tendsto<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem">f'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_filter<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(* END TODO *)</span>

<span class="comment1">(* TODO Move? *)</span>
<span class="keyword1" id="Zeta_Function-powr_add_minus_powr_asymptotics"><span class="command">lemma</span></span> powr_add_minus_powr_asymptotics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">complex</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">z</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="main">1</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_at_ball'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>complex"</span></span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">z</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> gen_binomial_complex<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sums_Suc_iff<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_mult_D<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> elim <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_radius <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> conv_radius <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">gchoose</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_radius_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">gchoose</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cball <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">z</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_radius_gchoose<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powser_continuous_suminf<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> continuous_on_interior<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">─</span><span class="main">0</span><span class="main">→</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> isCont_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-complex_powr_add_minus_powr_asymptotics"><span class="command">lemma</span></span> complex_powr_add_minus_powr_asymptotics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">-</span> of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> of_real <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> 
                            of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="main">=</span> 
                          of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">-</span> of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> at_top"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">/</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">*</span> <span class="var">?h</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">_</span> <span class="main">=</span> <span class="main">_</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?g</span> <span class="skolem">x</span> <span class="main">*</span> <span class="var">?h</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">a</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="var">?h</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="var">?h</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?g</span> <span class="skolem">x</span> <span class="main">=</span> of_real <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> of_real <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">-</span> of_real <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> powr_times_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">(</span>complex_of_real <span class="main">0</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_of_real real_tendsto_divide_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span> filterlim_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_atI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">/</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">*</span> <span class="var">?h</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">s</span> <span class="main">*</span> <span class="main">0</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> s
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> powr_add_minus_powr_asymptotics<span class="main"><span class="main">]</span></span>
              tendsto_const tendsto_neg_powr_complex_of_real filterlim_ident<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">/</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">*</span> <span class="var">?h</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(* END TODO *)</span>

<span class="keyword1" id="Zeta_Function-summable_zeta"><span class="command">lemma</span></span> summable_zeta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> exp <span class="main">(</span>complex_of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"summable <span class="var">?f</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> summable_Suc_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> summable_complex_powr_iff<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-summable_zeta_real"><span class="command">lemma</span></span> summable_zeta_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span>complex_of_real <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_zeta<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_Reals_eq<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> summable_complex_of_real<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-summable_hurwitz_zeta"><span class="command">lemma</span></span> summable_hurwitz_zeta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> summable_zeta_real <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> Re <span class="free">s</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_powr_real_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span>Re <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mono2'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">≤</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> summable_Suc_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-summable_hurwitz_zeta_real"><span class="command">lemma</span></span> summable_hurwitz_zeta_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span>complex_of_real <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_hurwitz_zeta<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_Reals_eq<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> summable_complex_of_real<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We use the Euler--MacLaurin summation formula to express $\zeta(s,a) - \frac{a^{1-s}}{s-1}$ as
  a polynomial plus some remainder term, which is an integral over a function of 
  order $O(-1-2n-\mathfrak{R}(s))$. It is then clear that this integral converges uniformly
  to an analytic function in $s$ for all $s$ with $\mathfrak{R}(s) &gt; -2n$.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pre_zeta_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pre_zeta_aux</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">.</span> <span class="main">(</span>bernoulli <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>pochhammer <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> 
                 of_real <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span> of_nat <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    EM_remainder <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span> 
      <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span>pochhammer <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  By iterating the above construction long enough, we can extend this to the entire
  complex plane.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pre_zeta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pre_zeta</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> pre_zeta_aux <span class="main">(</span>nat <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">⌈</span>Re <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">⌉</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can then obtain the Hurwitz $\zeta$ function by adding back the pole at 1.
  Note that it is not necessary to trust that this somewhat complicated definition is,
  in fact, the correct one, since we will later show that this Hurwitz zeta function
  fulfils
  \[\zeta(s,a) = \sum_{n=0}^\infty \frac{1}{(n + a)^s}\]
  and is analytic on $\mathbb{C}\setminus \{1\}$, which uniquely defines the function
  due to analytic continuation. It is therefore obvious that any alternative definition
  that is analytic on $\mathbb{C}\setminus \{1\}$ and satisfies the above equation 
  must be equal to our Hurwitz $\zeta$ function.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hurwitz_zeta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hurwitz_zeta</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> pre_zeta <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> of_real <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The Riemann $\zeta$ function is simply the Hurwitz $\zeta$ function with $a = 1$.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zeta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">zeta</span> <span class="main">=</span> hurwitz_zeta <span class="main">1</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define the $\zeta$ functions as 0 at their poles. To avoid confusion, these facts
  are not added as simplification rules by default.
›</span></span>
<span class="keyword1" id="Zeta_Function-hurwitz_zeta_1"><span class="command">lemma</span></span> hurwitz_zeta_1<span class="main">:</span> <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">c</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hurwitz_zeta_def<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-zeta_1"><span class="command">lemma</span></span> zeta_1<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_def hurwitz_zeta_1<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-zeta_minus_pole_eq"><span class="command">lemma</span></span> zeta_minus_pole_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">⟹</span> zeta <span class="free">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> pre_zeta <span class="main">1</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_def hurwitz_zeta_def<span class="main">)</span>


<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Zeta_Function-holomorphic_pre_zeta_aux'"><span class="command">lemma</span></span> holomorphic_pre_zeta_aux'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"bounded <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"open <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="free">σ</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="keyword1">holomorphic_on</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pre_zeta_aux_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> max <span class="main">0</span> <span class="main">(</span>Sup <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> norm <span class="main">(</span>pochhammer <span class="bound">s</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> closure <span class="free">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compact <span class="main">(</span>closure <span class="free">U</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compact_eq_bounded_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"compact <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> norm <span class="main">(</span>pochhammer <span class="bound">s</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> closure <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compact_continuous_image <span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> norm <span class="main">(</span>pochhammer <span class="bound">s</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> closure <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compact_eq_bounded_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span>pochhammer <span class="skolem">s</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">using</span></span> that closure_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> C_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> max.coboundedI2 cSup_upper bounded_imp_bdd_above<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> C' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="main">-</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="main">-</span> <span class="free">σ</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="main">-</span> <span class="free">σ</span><span class="main">)</span>"</span></span>  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">poch'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">poch'</span> <span class="main">=</span> deriv <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>complex<span class="main">.</span> pochhammer <span class="bound">z</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> pochhammer <span class="bound">z</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> <span class="skolem">poch'</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span> <span class="keyword1"><span class="command">unfolding</span></span> poch'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_derivI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holomorphic_pochhammer <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="main"><span class="main"><span class="main">_</span></span></span> <span class="quoted">UNIV</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="skolem">A</span> <span class="skolem">poch'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="keyword1"><span class="command">unfolding</span></span> poch'_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ subset_UNIV<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">intro</span> holomorphic_on_imp_continuous_on holomorphic_deriv<span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> holomorphic_pochhammer<span class="main">)</span> 
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span> <span class="main">=</span> continuous_on_compose2<span class="main">[</span><span class="operator">OF</span> this _ subset_UNIV<span class="main">]</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">t</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">poch'</span> <span class="bound">z</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">-</span>
                          Ln <span class="main">(</span>complex_of_real <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> 
                            <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> pochhammer <span class="bound">z</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> EM_remainder <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span>pochhammer <span class="bound">z</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                  complex_of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span>
    <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pre_zeta_aux_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_EM_remainder<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">f'</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> 1 σ <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_diff powr_add powr_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">z</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> has_field_derivative_powr_right <span class="main">[</span><span class="operator">THEN</span> DERIV_chain2<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> 2 σ <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_eq_0_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">+</span> complex_of_real <span class="free">a</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> nonpos_Reals_of_real_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">+</span><span class="free">a</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> of_real_add<span class="main">]</span> that <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> f'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold add_eq_0_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">z</span> <span class="skolem">e</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span> <span class="main">&lt;</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> σ<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 4 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">&lt;</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms 4
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_continuous_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">t</span> <span class="skolem">x</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_EM_remainder'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 6
    <span class="keyword1"><span class="command">from</span></span> σ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span> <span class="main">-</span> <span class="free">σ</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span> <span class="main">-</span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_right_zero tendsto_neg_powr
            filterlim_real_sequentially filterlim_tendsto_add_at_top <span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> convergent_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 7
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">-</span> <span class="main">(</span>pochhammer <span class="skolem">s</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              norm <span class="main">(</span>pochhammer <span class="skolem">s</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="main">-</span> Re <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 7 <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult norm_powr_real_powr<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?g</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 7 assms x s <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono C powr_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">≤</span> <span class="var">?g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Zeta_Function-analytic_pre_zeta_aux"><span class="command">lemma</span></span> analytic_pre_zeta_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="keyword1">analytic_on</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> analytic_on_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">=</span> <span class="main">(</span>Re <span class="skolem">s</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> s <span class="keyword1"><span class="command">have</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> σ_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="skolem">σ</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> σ_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="skolem">σ</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> open_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> s' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ε</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ball <span class="skolem">s</span> <span class="skolem">ε</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="skolem">σ</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> open_contains_ball <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> σ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="keyword1">holomorphic_on</span> ball <span class="skolem">s</span> <span class="skolem">ε</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_pre_zeta_aux' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="keyword1">holomorphic_on</span> ball <span class="skolem">s</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ζ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">ζ</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ζ<span class="main">:</span> euler_maclaurin_nat'
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> pochhammer <span class="free">s</span> <span class="bound">n</span> <span class="main">*</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
  <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="quoted">"<span class="free">ζ</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">+</span> complex_of_real <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_real_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> of_real_eq_0_iff add_eq_0_iff2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a s <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_nonneg_nonneg<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">k</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">+</span> complex_of_real <span class="free">a</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nonpos_Reals_of_real_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">+</span><span class="free">a</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> of_real_add<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"pochhammer <span class="skolem">z</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> pochhammer <span class="skolem">z</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="skolem">z</span> <span class="main">-</span> of_nat <span class="skolem">n</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pochhammer_rec' <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> pochhammer <span class="free">s</span> <span class="skolem">k</span> <span class="main">*</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
          <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">k</span> <span class="main">*</span> pochhammer <span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span>
            of_real <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> 4 *<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_real_field <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> powr_add powr_diff powr_minus **<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 5
  <span class="keyword1"><span class="command">with</span></span> s a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minus_equation_iff add_eq_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">+</span> complex_of_real <span class="free">a</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nonpos_Reals_of_real_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">+</span><span class="free">a</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> of_real_add<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_real_add
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> 6 s *<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_real_field <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> 
          <span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_equation_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 7
  <span class="keyword1"><span class="command">from</span></span> s a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="free">ζ</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ζ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_sums summable_hurwitz_zeta<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">ζ</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_def'<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> real <span class="bound">b</span><span class="main">)</span> <span class="keyword1">powr</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_neg_powr filterlim_tendsto_add_at_top filterlim_real_sequentially<span class="main">)</span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> real <span class="bound">b</span><span class="main">)</span> <span class="keyword1">powr</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> norm <span class="main">(</span><span class="main">(</span>of_nat <span class="bound">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> norm_powr_real_powr<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> tendsto_norm_zero_iff<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_divide tendsto_const *<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">N</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="main">(</span>bernoulli' <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span>
             <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> pochhammer <span class="free">s</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="bound">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⇢</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">N</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="main">(</span>bernoulli' <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> 
                   <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> pochhammer <span class="free">s</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> *<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">N</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="main">(</span>bernoulli' <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span>
              <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> pochhammer <span class="free">s</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="bound">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> tendsto_diff<span class="main">[</span><span class="operator">OF</span> tendsto_diff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 2<span class="main"><span class="main">]</span></span> 3<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The pre-$\zeta$ functions agree with the infinite sum that is used to define the $\zeta$
  function for $\mathfrak{R}(s)&gt;1$.
›</span></span>
<span class="keyword1" id="Zeta_Function-pre_zeta_aux_conv_zeta"><span class="command">lemma</span></span> pre_zeta_aux_conv_zeta<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="free">N</span> <span class="free">a</span> <span class="free">s</span> <span class="main">=</span> <span class="free">ζ</span> <span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">N</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>bernoulli <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> pochhammer <span class="free">s</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"EM_remainder <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span>pochhammer <span class="free">s</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
              of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">N</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ζ.euler_maclaurin_strong_nat'<span class="main">[</span><span class="operator">OF</span> le_refl<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">ζ</span> <span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="var">?R</span><span class="main">)</span> <span class="main">-</span> <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_negf <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real pre_zeta_aux_def mult_ac<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pre_zeta_aux_def 
    <span class="comment1">(* TODO: Field_as_Ring causes some problems with field_simps vs. div_mult_self *)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self3 div_mult_self4 div_mult_self2 div_mult_self1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since all of the partial pre-$\zeta$ functions are analytic and agree in the halfspace with 
  $\mathfrak R(s)&gt;0$, they must agree in their entire domain.
›</span></span>
<span class="keyword1" id="Zeta_Function-pre_zeta_aux_eq"><span class="command">lemma</span></span> pre_zeta_aux_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="free">m</span> <span class="free">a</span> <span class="free">s</span> <span class="main">=</span> pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="free">s</span> <span class="main">-</span> pre_zeta_aux <span class="free">m</span> <span class="free">a</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="bound">s</span> <span class="main">-</span> pre_zeta_aux <span class="free">m</span> <span class="free">a</span> <span class="bound">s</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="bound">s</span> <span class="main">-</span> pre_zeta_aux <span class="free">m</span> <span class="free">a</span> <span class="bound">s</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">m</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> analytic_imp_holomorphic 
                        analytic_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> analytic_pre_zeta_aux<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="skolem">s</span> <span class="main">-</span> pre_zeta_aux <span class="free">m</span> <span class="free">a</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pre_zeta_aux_conv_zeta<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> interior <span class="main">…</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> interior_open <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> open_halfspace_Re_gt<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">islimpt</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> interior_limit_point<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">m</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> convex_halfspace_gt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>complex"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> convex_connected<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-pre_zeta_aux_eq'"><span class="command">lemma</span></span> pre_zeta_aux_eq'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="free">m</span> <span class="free">a</span> <span class="free">s</span> <span class="main">=</span> pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pre_zeta_aux_eq<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> greater
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eq_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> pre_zeta_aux_eq<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Zeta_Function-pre_zeta_aux_eq_pre_zeta"><span class="command">lemma</span></span> pre_zeta_aux_eq_pre_zeta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> real <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="free">s</span> <span class="main">=</span> pre_zeta <span class="free">a</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pre_zeta_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> pre_zeta_aux_eq'<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">⌈</span>Re <span class="free">s</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">⌉</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Re <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This means that the idea of iterating that construction infinitely does yield
  a well-defined entire function.
›</span></span>
<span class="keyword1" id="Zeta_Function-analytic_pre_zeta"><span class="command">lemma</span></span> analytic_pre_zeta<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"pre_zeta <span class="free">a</span> <span class="keyword1">analytic_on</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> analytic_on_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s'</span><span class="main">.</span> Re <span class="bound">s'</span> <span class="main">&gt;</span> of_int <span class="main">⌊</span>Re <span class="skolem">s</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">linarith</span><span class="main"><span class="keyword3">?</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> open_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ε</span></span> <span class="keyword2"><span class="keyword">where</span></span> ε<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ball <span class="skolem">s</span> <span class="skolem">ε</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> open_contains_ball <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> ball <span class="skolem">s</span> <span class="skolem">ε</span>"</span></span>

  <span class="keyword1"><span class="command">note</span></span> analytic <span class="main">=</span> analytic_on_subset<span class="main">[</span><span class="operator">OF</span> analytic_pre_zeta_aux<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="main">(</span>nat <span class="main">⌈</span><span class="main">-</span> Re <span class="skolem">s</span><span class="main">⌉</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">a</span> <span class="keyword1">holomorphic_on</span> <span class="skolem">C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> analytic_imp_holomorphic analytic subsetI assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">w</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ε <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ceiling_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> pre_zeta <span class="free">a</span> <span class="keyword1">holomorphic_on</span> <span class="skolem">C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_cong refl pre_zeta_aux_eq_pre_zeta assms<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> ε <span class="keyword1"><span class="command">have</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">⌈</span><span class="main">-</span> Re <span class="skolem">s</span><span class="main">⌉</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> Re <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ceiling_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> pre_zeta <span class="free">a</span> <span class="keyword1">holomorphic_on</span> ball <span class="skolem">s</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-holomorphic_pre_zeta"><span class="command">lemma</span></span> holomorphic_pre_zeta <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> pre_zeta <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> holomorphic_on_compose <span class="main">[</span><span class="operator">OF</span> _ analytic_imp_holomorphic <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analytic_pre_zeta<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_on_pre_zeta<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> continuous_on <span class="free">A</span> <span class="main">(</span>pre_zeta <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_imp_continuous_on <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_on_pre_zeta' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> continuous_on <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> pre_zeta <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_on_compose2 <span class="main">[</span><span class="operator">OF</span> continuous_on_pre_zeta<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_pre_zeta <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>pre_zeta <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_within_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">insert</span> continuous_on_pre_zeta<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at open_Compl<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_pre_zeta' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟹</span>
     continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> pre_zeta <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_within_compose3<span class="main">[</span><span class="operator">OF</span> continuous_pre_zeta<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It is now obvious that $\zeta$ is holomorphic everywhere except 1, where it has a 
  simple pole with residue 1, which we can simply read off.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> holomorphic_hurwitz_zeta<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> pre_zeta <span class="free">a</span> <span class="bound">s</span> <span class="main">+</span> complex_of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hurwitz_zeta_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> holomorphic_hurwitz_zeta' <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="main">∘</span> <span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_compose_gen<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main"><span class="main">]</span></span> holomorphic_hurwitz_zeta assms<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> holomorphic_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span> zeta <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zeta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> holomorphic_zeta' <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> zeta <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> zeta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> analytic_hurwitz_zeta<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="keyword1">analytic_on</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_hurwitz_zeta<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> hurwitz_zeta <span class="free">a</span> <span class="keyword1">analytic_on</span> <span class="main">-</span><span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> analytic_on_open <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_on_subset<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> analytic_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> zeta <span class="keyword1">analytic_on</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zeta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_hurwitz_zeta<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_on_hurwitz_zeta<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> continuous_on <span class="free">A</span> <span class="main">(</span>hurwitz_zeta <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_imp_continuous_on <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_on_hurwitz_zeta' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span> 
     continuous_on <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_on_compose2 <span class="main">[</span><span class="operator">OF</span> continuous_on_hurwitz_zeta<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_on_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> continuous_on <span class="free">A</span> zeta"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_imp_continuous_on <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_on_zeta' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="free">f</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span> 
     continuous_on <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> zeta <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_on_compose2 <span class="main">[</span><span class="operator">OF</span> continuous_on_zeta<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_hurwitz_zeta <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">⟹</span> continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>hurwitz_zeta <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_within_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">insert</span> continuous_on_hurwitz_zeta<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at open_Compl<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_hurwitz_zeta' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">⟹</span> continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟹</span>
     continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_within_compose3<span class="main">[</span><span class="operator">OF</span> continuous_hurwitz_zeta<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_zeta <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">⟹</span> continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> zeta"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zeta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> continuous_zeta' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">⟹</span> continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟹</span> continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">s</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="main">(</span><span class="free">f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zeta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> field_differentiable_at_zeta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zeta <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zeta <span class="keyword1">holomorphic_on</span> <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> holomorphic_zeta <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="main">1</span><span class="main">}</span> <span class="main">::</span> complex set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> open_Compl<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holomorphic_on_open open_halfspace_Re_gt open_Diff field_differentiable_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> is_pole_hurwitz_zeta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"is_pole <span class="main">(</span>hurwitz_zeta <span class="free">a</span><span class="main">)</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="main">(</span>pre_zeta <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_imp_continuous_on analytic_imp_holomorphic analytic_pre_zeta<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>pre_zeta <span class="free">a</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_zeta <span class="free">a</span> <span class="main">─</span><span class="main">1</span><span class="main">→</span> pre_zeta <span class="free">a</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isCont_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> complex_of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> isCont_powr_complex<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> complex_of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">─</span><span class="main">1</span><span class="main">→</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isCont_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">─</span><span class="main">1</span><span class="main">→</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at eventually_at_filter<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="main">::</span> complex<span class="main">.</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_infinity <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_divide_at_infinity <span class="main"><span class="main">[</span></span><span class="operator">OF</span> **<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_pole <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> pre_zeta <span class="free">a</span> <span class="bound">s</span> <span class="main">+</span> complex_of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_pole_def hurwitz_zeta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_add_filterlim_at_infinity * ***<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_pole_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_filter hurwitz_zeta_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> is_pole_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pole zeta <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zeta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_pole_hurwitz_zeta<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> zorder_hurwitz_zeta<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"zorder <span class="main">(</span>hurwitz_zeta <span class="free">a</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> zorder_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> UNIV"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span>pre_zeta <span class="free">a</span> <span class="skolem">w</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span>of_int <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> powr_of_int<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hurwitz_zeta_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> zorder_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"zorder zeta <span class="main">1</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zeta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zorder_hurwitz_zeta<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> residue_hurwitz_zeta<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"residue <span class="main">(</span>hurwitz_zeta <span class="free">a</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> holo <span class="main">=</span> analytic_imp_holomorphic<span class="main">[</span><span class="operator">OF</span> analytic_pre_zeta<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"residue <span class="main">(</span>hurwitz_zeta <span class="free">a</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> residue <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> pre_zeta <span class="free">a</span> <span class="bound">z</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> residue_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_filter hurwitz_zeta_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> residue <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> residue_add <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> holo <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> residue_holo<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ _ holo<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> complex_of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> residue_simple <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> residue_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"residue zeta <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zeta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> residue_hurwitz_zeta<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Zeta_Function-zeta_bigo_at_1"><span class="command">lemma</span></span> zeta_bigo_at_1<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zeta <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> pre_zeta <span class="main">1</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_filter zeta_def hurwitz_zeta_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> pre_zeta <span class="main">1</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="main">(</span>pre_zeta <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_imp_continuous_on <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>pre_zeta <span class="main">1</span><span class="main">)</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>pre_zeta <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_within_subset<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pre_zeta <span class="main">1</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_imp_bigo_1<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> ball <span class="main">1</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_at_ball'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.bigI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_filter norm_divide dist_norm norm_minus_commute <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pre_zeta <span class="main">1</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> hurwitz_zeta_conv_suminf<span class="main">:</span> <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   sums_hurwitz_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> hurwitz_zeta <span class="free">a</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="free">s</span> <span class="main">=</span> pre_zeta_aux <span class="main">0</span> <span class="free">a</span> <span class="free">s</span> <span class="main">+</span> of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hurwitz_zeta_def pre_zeta_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="main">0</span> <span class="free">a</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">+</span> 
                          of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pre_zeta_aux_conv_zeta<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_sums summable_hurwitz_zeta assms<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> hurwitz_zeta <span class="free">a</span> <span class="free">s</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> zeta_conv_suminf<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   sums_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> zeta <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hurwitz_zeta_conv_suminf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> sums_hurwitz_zeta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_def add_ac<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> zeta_nat_conv_suminf<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   sums_zeta_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">sums</span> zeta <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="keyword1">sums</span> zeta <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_zeta<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">sums</span> zeta <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-pre_zeta_aux_cnj"><span class="command">lemma</span></span> pre_zeta_aux_cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span>pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> 
          of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">-</span>cnj <span class="free">z</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>bernoulli <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span>
            <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>cnj <span class="free">z</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> pochhammer <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> EM_remainder <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span>pochhammer <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
                  cnj <span class="main">(</span>of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">+</span> <span class="var">?A</span> <span class="main">+</span> <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> pre_zeta_aux_def complex_cnj_add <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> EM_remainder_cnj <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cnj_powr add_eq_0_iff mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> EM_remainder <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span>pochhammer <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">n</span> <span class="main">-</span> cnj <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> EM_remainder_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cnj_powr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">-</span>cnj <span class="free">z</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="var">?A</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> pre_zeta_aux <span class="free">n</span> <span class="free">a</span> <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pre_zeta_aux_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-pre_zeta_cnj"><span class="command">lemma</span></span> pre_zeta_cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> pre_zeta <span class="free">a</span> <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span>pre_zeta <span class="free">a</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pre_zeta_def<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-hurwitz_zeta_cnj"><span class="command">lemma</span></span> hurwitz_zeta_cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span>hurwitz_zeta <span class="free">a</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="free">z</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hurwitz_zeta_def cnj_powr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-zeta_cnj"><span class="command">lemma</span></span> zeta_cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span>zeta <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> hurwitz_zeta_real<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hurwitz_zeta_cnj <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"of_real <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Reals_cnj_iff <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> zeta_cnj<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_real<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zeta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hurwitz_zeta_real<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_real'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="main">ℝ</span> <span class="main">⟹</span> zeta <span class="free">z</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> Reals_cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zeta_real<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Connection to Dirichlet series›</span></span>

<span class="keyword1" id="Zeta_Function-eval_fds_zeta"><span class="command">lemma</span></span> eval_fds_zeta<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> eval_fds fds_zeta <span class="free">s</span> <span class="main">=</span> zeta <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sums_zeta <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eval_fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> euler_product_zeta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="bound">p</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">⇢</span> zeta <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> euler_product_fds_zeta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">unfolding</span></span> nat_power_complex_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_zeta<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> euler_product_zeta'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">.</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="bound">p</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> zeta <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> euler_product_zeta <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="bound">p</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> prime <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">.</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="bound">p</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext prod.mono_neutral_cong_right refl<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> zeta_Re_gt_1_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> zeta <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eval_fds_zeta_nonzero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_zeta<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> tendsto_zeta_Re_going_to_at_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>zeta <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Re <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_gt_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Re <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> eval_fds fds_zeta <span class="bound">z</span> <span class="main">=</span> zeta <span class="bound">z</span><span class="main">)</span> <span class="main">(</span>Re <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fds_zeta<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_zeta <span class="main">::</span> complex fds<span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conv_abscissa_leI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">c'</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c'</span> <span class="main">∧</span> fds_converges fds_zeta <span class="main">(</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">c'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eval_fds fds_zeta <span class="main">⤏</span> fds_nth fds_zeta <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Re <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_eval_fds_Re_going_to_at_top'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eval_fds fds_zeta <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Re <span class="keyword1">going_to</span> at_top<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-conv_abscissa_zeta"><span class="command">lemma</span></span> conv_abscissa_zeta <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_zeta <span class="main">::</span> complex fds<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> abs_conv_abscissa_zeta <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_zeta <span class="main">::</span> complex fds<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fds_zeta <span class="main">::</span> complex fds"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="var">?z</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conv_abscissa_geI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">c'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">c'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> summable_real_powr_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">c'</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> summable_of_real_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">c'</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">⟷</span> 
                 fds_converges fds_zeta <span class="main">(</span>of_real <span class="skolem">c'</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fds_converges_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_zeta powr_Reals_eq powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c'</span> <span class="main">∧</span> <span class="main">¬</span>fds_converges fds_zeta <span class="bound">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">c'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="var">?z</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> abs_conv_abscissa_leI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> ereal <span class="skolem">c'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c'</span> <span class="main">∧</span> fds_abs_converges fds_zeta <span class="bound">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">c'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="var">?z</span> <span class="main">≤</span> abs_conv_abscissa <span class="var">?z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> B
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="var">?z</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> antisym<span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span> A
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="var">?z</span> <span class="main">≤</span> abs_conv_abscissa <span class="var">?z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="var">?z</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> deriv_zeta_sums<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> deriv zeta <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_deriv fds_zeta<span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_converges_deriv<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>of_real <span class="main">(</span>ln <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span>
                  deriv <span class="main">(</span>eval_fds fds_zeta<span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_converges_altdef
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_deriv scaleR_conv_of_real eval_fds_deriv eval_fds_zeta<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds fds_zeta <span class="bound">s</span> <span class="main">=</span> zeta <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_fds_zeta<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span>eval_fds fds_zeta<span class="main">)</span> <span class="free">s</span> <span class="main">=</span> deriv zeta <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> deriv_cong_ev refl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> inverse_zeta_sums<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> inverse <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_abs_converges_moebius_mu<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> moebius_mu <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="main">(</span>fds moebius_mu<span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds moebius_mu <span class="main">=</span> inverse <span class="main">(</span>fds_zeta <span class="main">::</span> complex fds<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_moebius_inverse_zeta<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">…</span> <span class="free">s</span> <span class="main">=</span> inverse <span class="main">(</span>zeta <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eval_fds_inverse<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_moebius_inverse_zeta <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> eval_fds_zeta 
             <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fds_abs_converges_moebius_mu<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following gives an extension of the $\zeta$ functions to the critical strip.
›</span></span>
<span class="keyword1" id="Zeta_Function-hurwitz_zeta_critical_strip"><span class="command">lemma</span></span> hurwitz_zeta_critical_strip<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">i</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">I'</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">S</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">I'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> hurwitz_zeta <span class="free">a</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> pochhammer <span class="free">s</span> <span class="bound">n</span> <span class="main">*</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">-</span> of_nat <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> minus_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> EM_remainder' <span class="main">1</span> <span class="main">(</span><span class="var">?fs</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>real <span class="main">0</span><span class="main">)</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R_lim</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R_lim</span> <span class="main">=</span> EM_remainder <span class="main">1</span> <span class="main">(</span><span class="var">?fs</span> <span class="main">1</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_real <span class="main">(</span><span class="free">a</span> <span class="main">+</span> real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span><span class="free">a</span> <span class="main">+</span> real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C''</span> <span class="main">=</span> of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>of_real <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> 
            of_real <span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> has_vector_derivative_real_field <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span>
               <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">I</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">C'</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> C'_def I_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> integral <span class="main">{</span>real <span class="main">0</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="var">?f</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span>bernoulli' <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?fs</span> <span class="bound">k</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="var">?fs</span> <span class="bound">k</span> <span class="main">(</span>real <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> n assms <span class="keyword1"><span class="command">unfolding</span></span> R_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> euler_maclaurin_strong_raw_nat<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Y <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> has_vector_derivative_real_field
               <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pochhammer_rec' <span class="dynamic"><span class="dynamic">algebra_simps</span></span> complex_nonpos_Reals_iff add_eq_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span>bernoulli' <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="var">?fs</span> <span class="bound">k</span> <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="var">?fs</span> <span class="bound">k</span> <span class="main">(</span>real <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">-</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lessThan_nat_numeral scaleR_conv_of_real numeral_2_eq_2 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">C</span> <span class="main">+</span> <span class="skolem">D</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def D_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span>real <span class="main">0</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">I</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">C'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> of_real <span class="main">(</span>real <span class="bound">i</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> of_real <span class="main">(</span>real <span class="bound">i</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.head<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> of_real <span class="main">(</span>real <span class="bound">i</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span> <span class="skolem">n</span> <span class="main">+</span> of_real <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.last_plus<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atLeast0LessThan<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">-</span> <span class="skolem">C'</span> <span class="main">+</span> <span class="skolem">C''</span> <span class="main">-</span> <span class="skolem">D'</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">D</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">R</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">I</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">I'</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">I'</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> S_def D'_def C''_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">-</span> <span class="skolem">C'</span> <span class="main">+</span> <span class="skolem">C''</span> <span class="main">-</span> <span class="skolem">D'</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">D</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">R</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">I'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">I'</span> <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span> <span class="main">=</span> <span class="main">-</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>pochhammer <span class="free">s</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">⇢</span> <span class="skolem">R_lim</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def R_lim_def of_nat_0
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> of_int_0 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> tendsto_EM_remainder<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="var">?fs</span> <span class="main">1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?C</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult norm_powr_real_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> real_of_int <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>numeral <span class="skolem">n</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">-</span> numeral <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?C</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span>Re <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> 
              <span class="var">?C</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> Re <span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span>real_of_int <span class="main">0</span><span class="main">..}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?C</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span> Re <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> real <span class="bound">y</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> Re <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_right_zero tendsto_neg_powr filterlim_real_sequentially
                  filterlim_tendsto_add_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?C</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span> Re <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">y</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> Re <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac convergent_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_EM_remainder' <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">I'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>complex_of_real <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> 
                 of_real <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3-5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ filterlim_real_sequentially<span class="main"><span class="main">]</span></span>
                             tendsto_divide complex_powr_add_minus_powr_asymptotics<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">I'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_def I'_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">-</span> <span class="skolem">C'</span> <span class="main">+</span> <span class="skolem">C''</span> <span class="main">-</span> <span class="skolem">D'</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">D</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">R</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">I'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">⇢</span> <span class="skolem">C</span> <span class="main">-</span> <span class="skolem">C'</span> <span class="main">+</span> <span class="skolem">C''</span> <span class="main">-</span> <span class="main">0</span> <span class="main">+</span> <span class="main">0</span> <span class="main">+</span> <span class="skolem">R_lim</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> D_def D'_def <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_add tendsto_diff tendsto_const tendsto_mult_right_zero
              tendsto_neg_powr_complex_of_real filterlim_tendsto_add_at_top 
              filterlim_real_sequentially<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">-</span> <span class="skolem">C'</span> <span class="main">+</span> <span class="skolem">C''</span> <span class="main">-</span> <span class="main">0</span> <span class="main">+</span> <span class="main">0</span> <span class="main">+</span> <span class="skolem">R_lim</span> <span class="main">+</span> <span class="main">0</span> <span class="main">=</span> 
               <span class="main">(</span><span class="free">a</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">R_lim</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def C'_def C''_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> hurwitz_zeta <span class="free">a</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hurwitz_zeta_def pre_zeta_def pre_zeta_aux_def
                              R_lim_def scaleR_conv_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">-</span> <span class="skolem">C'</span> <span class="main">+</span> <span class="skolem">C''</span> <span class="main">-</span> <span class="skolem">D'</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">D</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">R</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">I'</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> hurwitz_zeta <span class="free">a</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> ev <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Lim_transform_eventually<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-zeta_critical_strip"><span class="command">lemma</span></span> zeta_critical_strip<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">i</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">S</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">I</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> zeta <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> hurwitz_zeta_critical_strip<span class="main">[</span><span class="operator">OF</span> s zero_less_one<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> complex_of_real <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span>
            of_nat <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> hurwitz_zeta <span class="main">1</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> complex_of_real <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="bound">i</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted">Suc</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_def S_def I_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The non-vanishing of $\zeta$ for $\mathfrak{R}(s) \geq 1$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This proof is based on a sketch by Newman~\cite{newman1998analytic}, which was previously
  formalised in HOL Light by Harrison~\cite{harrison2009pnt}, albeit in a much more concrete
  and low-level style.

  Our aim here is to reproduce Newman's proof idea cleanly and on the same high level of
  abstraction.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> zeta_Re_ge_1_nonzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zeta <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">-</span>Im <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> False assms <span class="keyword1"><span class="command">have</span></span> s <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff a_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"zeta <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> zeta_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> zero'<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">― ‹We define the function $Q(s) = \zeta(s)^2\zeta(s+ia)\zeta(s-ia)$ and its Dirichlet series.
        The objective will be to show that this function is entire and its Dirichlet series
        converges everywhere. Of course, $Q(s)$ has singularities at $1$ and $1\pm ia$, so we 
        need to show they can be removed.›</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="skolem"><span class="skolem">Q_fds</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="bound">s</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q_fds</span> <span class="main">=</span> fds_zeta <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> fds_shift <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> fds_zeta <span class="main">*</span> fds_shift <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> fds_zeta"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sings</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">}</span>"</span></span>
 
    <span class="comment1">― ‹We show that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span> is locally bounded everywhere. This is the case because the
        poles of $\zeta(s)$ cancel with the zeros of $\zeta(s\pm ia)$ and vice versa.
        This boundedness is then enough to show that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span> has only removable singularities.›</span>
    <span class="keyword1"><span class="command">have</span></span> Q_bigo_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> Q_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>zeta <span class="bound">s</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>zeta <span class="bound">s</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def power2_eq_square mult_ac<span class="main">)</span>

      <span class="comment1">― ‹The singularity of $\zeta(s)$ at 1 gets cancelled by the zero of $\zeta(s-ia)$:›</span>
      <span class="keyword1"><span class="command">have</span></span> bigo1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="bound">s</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">real</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">-</span> zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> taylor_bigo_linear holomorphic_on_imp_differentiable_at<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">{</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span>
                    <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="bound">s</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.mult zeta_bigo_at_1<span class="main">)</span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_filter<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="comment1">― ‹The analogous result for $\zeta(s) \zeta(s+ia)$:›</span>
      <span class="keyword1"><span class="command">have</span></span> bigo1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="bound">s</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">real</span>
        <span class="keyword1"><span class="command">using</span></span> bigo1<span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">a</span>"</span></span><span class="main">]</span> that zeta_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="comment1">― ‹The singularity of $\zeta(s-ia)$ gets cancelled by the zero of $\zeta(s)$:›</span>
      <span class="keyword1"><span class="command">have</span></span> bigo2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="bound">s</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">real</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="bound">s</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span>filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">)</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> bigo1'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute landau_o.big.in_filtermap_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> filtermap_at_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="comment1">― ‹Again, the analogous result for $\zeta(s) \zeta(s+ia)$:›</span>
      <span class="keyword1"><span class="command">have</span></span> bigo2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="bound">s</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">real</span>
        <span class="keyword1"><span class="command">using</span></span> bigo2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">a</span>"</span></span><span class="main">]</span> that zeta_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="comment1">― ‹Now the final case distinction to show $Q(s)\in O(1)$ for all $s\in\mathbb{C}$:›</span>
      <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> <span class="var">?sings</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_eq <span class="keyword1"><span class="command">using</span></span> zero zero' a
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bigo1 bigo1' landau_o.big.mult_in_1<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="bound">s</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_eq <span class="keyword1"><span class="command">using</span></span> zero zero' a
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bigo2 landau_o.big.mult_in_1 continuous_imp_bigo_1<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 3
        <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="bound">s</span> <span class="main">*</span> zeta <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_eq <span class="keyword1"><span class="command">using</span></span> zero zero' a
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bigo2' landau_o.big.mult_in_1 continuous_imp_bigo_1<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> continuous_imp_bigo_1 <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def complex_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="comment1">― ‹Thus, we can remove the singularities from <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span> and extend it to an entire function.›</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q'</span><span class="main">.</span> <span class="bound">Q'</span> <span class="keyword1">holomorphic_on</span> UNIV <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>UNIV <span class="main">-</span> <span class="var">?sings</span><span class="main">.</span> <span class="bound">Q'</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> removable_singularities Q_bigo_1<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def complex_eq_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="keyword1">holomorphic_on</span> UNIV"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∉</span> <span class="var">?sings</span> <span class="main">⟹</span> <span class="skolem">Q'</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q'</span></span><span class="antiquote">}</span></span> constitutes an analytic continuation of the Dirichlet series of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span>.›</span>
    <span class="keyword1"><span class="command">have</span></span> eval_Q_fds<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="skolem">Q_fds</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">Q'</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="skolem">Q_fds</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_fds_def Q_def eval_fds_mult eval_fds_power fds_abs_converges_mult 
                      fds_abs_converges_power eval_fds_zeta<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">Q'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Q'<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="comment1">― ‹Since $\zeta(s)$ and $\zeta(s\pm ia)$ are completely multiplicative Dirichlet series,
        the logarithm of their product can be rewritten into the following nice form:›</span>
    <span class="keyword1"><span class="command">have</span></span> ln_Q_fds_eq<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"fds_ln <span class="main">0</span> <span class="skolem">Q_fds</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> ln <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cos <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">note</span></span> simps <span class="main">=</span> fds_ln_mult<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> l'' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> fds_ln_power<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
                   fds_ln_prod<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_ln <span class="main">0</span> <span class="skolem">Q_fds</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> fds_ln <span class="main">0</span> fds_zeta <span class="main">+</span> fds_shift <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>fds_ln <span class="main">0</span> fds_zeta<span class="main">)</span> <span class="main">+</span> 
                               fds_shift <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>fds_ln <span class="main">0</span> fds_zeta<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_fds_def simps<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth <span class="main">(</span>fds_zeta <span class="main">::</span> complex fds<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_ln <span class="main">(</span><span class="main">0</span> <span class="main">::</span> complex<span class="main">)</span> fds_zeta <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> mangoldt <span class="bound">n</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fds_ln_completely_multiplicative<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">…</span> <span class="main">+</span> fds_shift <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">…</span> <span class="main">+</span> fds_shift <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> 
                   fds <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> mangoldt <span class="bound">k</span> <span class="main">/</span> ln <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cos <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">=</span> <span class="var">?b</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fds_nth <span class="var">?a</span> <span class="skolem">n</span> <span class="main">=</span> mangoldt <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> scaleR_conv_of_real numeral_fds<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> cos <span class="main">(</span>of_real <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cos_exp_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mangoldt <span class="skolem">n</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">…</span><span class="main">)</span> <span class="main">=</span> 
                     of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> mangoldt <span class="skolem">n</span> <span class="main">/</span> ln <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cos <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cos_of_real<span class="main">)</span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_nth_fds'<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">― ‹It is then obvious that this logarithm series has non-negative real coefficients.›</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="main">…</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> cos_ge_minus_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> ln <span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> cos <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonneg_Reals_iff fds_nth_fds' mangoldt_nonneg
                 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> divide_nonneg_nonneg mult_nonneg_nonneg<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">― ‹Therefore, the original series also has non-negative real coefficients.›</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"nonneg_dirichlet_series <span class="skolem">Q_fds</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nonneg_dirichlet_series_lnD<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_fds_def<span class="main">)</span>
  
    <span class="comment1">― ‹By the Pringsheim--Landau theorem, a Dirichlet series with non-negative coefficnets that 
        can be analytically continued to the entire complex plane must converge everywhere, i.\,e.\ 
        its abscissa of (absolute) convergence is $-\infty$:›</span>
    <span class="keyword1"><span class="command">have</span></span> abscissa_Q_fds<span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="skolem">Q_fds</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Q_fds_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> abs_conv_abscissa_mult_leI abs_conv_abscissa_power_leI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> nonneg <span class="keyword2"><span class="keyword">and</span></span> eval_Q_fds <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q'</span> <span class="keyword1">holomorphic_on</span> UNIV›</span></span>
      <span class="keyword1"><span class="command">have</span></span> abscissa<span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="skolem">Q_fds</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> entire_continuation_imp_abs_conv_abscissa_MInfty<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem">Q'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_ereal_def<span class="main">)</span>
  
    <span class="comment1">― ‹This now leads to a contradiction in a very obvious way. If <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q_fds</span></span><span class="antiquote">}</span></span> is
        absolutely convergent, then the subseries corresponding to powers of 2 (\i.e.
        we delete all summands $a_n / n ^ s$ where $n$ is not a power of 2 from the sum) is
        also absolutely convergent. We denote this series with $R$.›</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R_fds</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R_fds</span> <span class="main">=</span> fds_primepow_subseries <span class="numeral">2</span> <span class="skolem">Q_fds</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="skolem">R_fds</span> <span class="main">≤</span> abs_conv_abscissa <span class="skolem">R_fds</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_le_abs_conv_abscissa<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="skolem">R_fds</span> <span class="main">≤</span> abs_conv_abscissa <span class="skolem">Q_fds</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> R_fds_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_restrict<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abscissa<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> abscissa'<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="skolem">R_fds</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="comment1">― ‹Since $\zeta(s)$ and $\zeta(s \pm ia)$ have an Euler product expansion for 
        $\mathfrak{R}(s) &gt; 1$, we have
          \[R(s) = (1 - 2^{-s})^-2 (1 - 2^{-s+ia})^{-1} (1 - 2^{-s-ia})^{-1}\]
        there, and since $R$ converges everywhere and the right-hand side is holomorphic for
        $\mathfrak{R}(s) &gt; 0$, the equation is also valid for all $s$ with $\mathfrak{R}(s) &gt; 0$
        by analytic continuation.›</span>
    <span class="keyword1"><span class="command">have</span></span> eval_R<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="skolem">R_fds</span> <span class="skolem">s</span> <span class="main">=</span> 
                   <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">s</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="skolem">R_fds</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_def exp_eq_1 Ln_Reals_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"completely_multiplicative_function <span class="main">(</span>fds_nth fds_zeta<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="skolem">R_fds</span> <span class="skolem">z</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_fds_def Q_fds_def eval_fds_mult eval_fds_power fds_abs_converges_mult 
                fds_abs_converges_power fds_primepow_subseries_euler_product_cm <span class="dynamic"><span class="dynamic">divide_simps</span></span>
                powr_minus powr_diff powr_add fds_abs_summable_zeta<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> that abscissa'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span> convex_connected open_halfspace_Re_gt
                                               convex_halfspace_Re_gt <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="comment1">― ‹We now clearly have a contradiction: $R(s)$, being entire, is continuous everywhere,
        while the function on the right-hand side clearly has a pole at $0$.›</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> not_tendsto_and_filterlim_at_infinity<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="bound">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="bound">b</span><span class="main">+</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="bound">b</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> 
              <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="var">?f'</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_filter<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="var">?f'</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_def exp_eq_1 Ln_Reals_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="var">?f'</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="var">?f</span> at_infinity <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?lim</span></span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_divide_at_infinity<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span>
                     tendsto_mult_filterlim_at_infinity<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lim</span> <span class="main">⟷</span> filterlim <span class="main">(</span>eval_fds <span class="skolem">R_fds</span><span class="main">)</span> at_infinity <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_R<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="main">…</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>eval_fds <span class="skolem">R_fds</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abscissa'<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>eval_fds <span class="skolem">R_fds</span> <span class="main">⤏</span> eval_fds <span class="skolem">R_fds</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> closure <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> closure_halfspace_gt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>complex"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="main">0</span> <span class="keyword1">within</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> bot"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> at_within_eq_bot_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> zeta_Re_gt_1_nonzero<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Special values of the $\zeta$ functions›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hurwitz_zeta_neg_of_nat<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>bernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">a</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>of_nat <span class="free">n</span> <span class="main">≠</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>complex<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> 
           pre_zeta <span class="free">a</span> <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">powr</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> zeta_def hurwitz_zeta_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_of_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">powr</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">powr</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">powr</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">^</span> Suc <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_realpow<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_zeta <span class="free">a</span> <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> pre_zeta_aux <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span><span class="main">-</span> of_nat <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pre_zeta_aux_eq_pre_zeta <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_real <span class="free">a</span> <span class="keyword1">powr</span> of_nat <span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">.</span> <span class="main">(</span>bernoulli <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span>
                       <span class="main">(</span>pochhammer <span class="main">(</span><span class="main">-</span> of_nat <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span>
                       of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">-</span> of_nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    EM_remainder <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span>pochhammer <span class="main">(</span><span class="main">-</span> of_nat <span class="free">n</span><span class="main">)</span>
                      <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> of_nat <span class="free">n</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">+</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">_</span> <span class="main">+</span> <span class="main">_</span>"</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> pre_zeta_aux_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> of_real <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_Reals_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_realpow<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pochhammer <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> pochhammer_eq_0_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> 
                  <span class="main">-</span> <span class="main">(</span><span class="free">a</span> <span class="main">^</span> Suc <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">(*)</span> <span class="numeral">2</span> <span class="main">`</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">i</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="numeral">2</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> evenE<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bernoulli_odd_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="numeral">2</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pochhammer <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> pochhammer_eq_0_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">.</span> <span class="main">-</span>of_real <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> bernoulli <span class="bound">i</span> <span class="main">*</span> 
                     <span class="free">a</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?lhs</span> <span class="main">_</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">n</span> <span class="main">-</span> of_nat <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_nat_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">…</span> <span class="main">=</span> of_real <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_nat<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"of_real <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">-</span> of_nat <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pochhammer <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> complex_of_real <span class="main">(</span>pochhammer <span class="main">(</span><span class="main">-</span>real <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pochhammer_of_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pochhammer <span class="main">(</span><span class="main">-</span>real <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> pochhammer <span class="main">(</span><span class="main">-</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> real <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pochhammer_rec_if<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">-</span> real <span class="free">n</span> <span class="main">=</span> <span class="main">-</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"pochhammer <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> 
                    <span class="main">-</span>complex_of_real <span class="main">(</span>pochhammer <span class="main">(</span><span class="main">-</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">-</span>complex_of_real <span class="main">(</span>bernoulli <span class="skolem">i</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="main">-</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">/</span> fact <span class="skolem">i</span> <span class="main">*</span> 
                      <span class="free">a</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> A B<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bernoulli <span class="skolem">i</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="main">-</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">/</span> fact <span class="skolem">i</span> <span class="main">=</span>
                 <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> bernoulli <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gbinomial_pochhammer<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minus_one_power_iff bernoulli_odd_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="skolem">i</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="keyword1">choose</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> binomial_gbinomial<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span>Suc <span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sum.atLeast_Suc_atMost<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">a</span> <span class="main">^</span> Suc <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>Suc <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sum.atLeast_Suc_atMost<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span> bernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">a</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_negf sum_divide_distrib <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bernpoly_def atLeast0AtMost<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-hurwitz_zeta_0"><span class="command">lemma</span></span> hurwitz_zeta_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> hurwitz_zeta <span class="free">a</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hurwitz_zeta_neg_of_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bernpoly_def<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-zeta_0"><span class="command">lemma</span></span> zeta_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">0</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> zeta_neg_of_nat<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>of_real <span class="main">(</span>bernoulli' <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zeta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hurwitz_zeta_neg_of_nat bernpoly_1'<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_trivial_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"even <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zeta_neg_of_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bernoulli'_odd_eq_0<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> zeta_even_nat<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> 
     of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">n</span> <span class="main">*</span> bernoulli <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> zeta <span class="main">(</span>of_nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_zeta_nat<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sums_unique2 <span class="main">[</span><span class="operator">OF</span> this nat_even_power_sums_complex<span class="main">]</span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> zeta_neg_of_nat<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_even_numeral<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"zeta <span class="main">(</span>numeral <span class="main">(</span>Num.Bit0 <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> of_real
     <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> Suc <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">*</span> bernoulli <span class="main">(</span>numeral <span class="main">(</span>num.Bit0 <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
     <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">^</span> numeral <span class="main">(</span>num.Bit0 <span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> fact <span class="main">(</span>numeral <span class="main">(</span>num.Bit0 <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> numeral <span class="free">n</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">=</span> numeral <span class="main">(</span>Num.Bit0 <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> numeral.numeral_Bit0<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> mult_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"numeral <span class="main">(</span>Num.Bit0 <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> numeral <span class="free">n</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> numeral.numeral_Bit0<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> mult_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> of_nat <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_nat_numeral of_nat_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zeta <span class="main">…</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> zeta_even_nat<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_neg_even_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">-</span>numeral <span class="main">(</span>Num.Bit0 <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>numeral <span class="main">(</span>Num.Bit0 <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span>of_nat <span class="main">(</span>numeral <span class="main">(</span>Num.Bit0 <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zeta <span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> zeta_trivial_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"numeral <span class="main">(</span>Num.Bit0 <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> numeral <span class="free">n</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> numeral.numeral_Bit0<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> mult_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_triv_left<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>numeral <span class="main">(</span>Num.Bit0 <span class="free">n</span><span class="main">)</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_neg_numeral<span class="main">:</span>
  <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">-</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">=</span> 
     <span class="main">-</span>of_real <span class="main">(</span>bernoulli' <span class="main">(</span>numeral <span class="main">(</span>Num.inc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> numeral <span class="main">(</span>Num.inc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>numeral <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> of_nat <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zeta <span class="main">…</span> <span class="main">=</span> <span class="main">-</span>of_real <span class="main">(</span>bernoulli' <span class="main">(</span>numeral <span class="main">(</span>Num.inc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> numeral <span class="main">(</span>Num.inc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> zeta_neg_of_nat<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_inc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">12</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zeta_neg_of_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_bernoulli<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_neg3<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">120</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_neg_numeral<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_neg5<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">-</span><span class="numeral">5</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">252</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_neg_numeral<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_2<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="numeral">2</span> <span class="main">=</span> pi <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">6</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_even_numeral<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_4<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="numeral">4</span> <span class="main">=</span> pi <span class="main">^</span> <span class="numeral">4</span> <span class="main">/</span> <span class="numeral">90</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_even_numeral fact_num_eq_if<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_6<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="numeral">6</span> <span class="main">=</span> pi <span class="main">^</span> <span class="numeral">6</span> <span class="main">/</span> <span class="numeral">945</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_even_numeral fact_num_eq_if<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_8<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="numeral">8</span> <span class="main">=</span> pi <span class="main">^</span> <span class="numeral">8</span> <span class="main">/</span> <span class="numeral">9450</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_even_numeral fact_num_eq_if<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Integral relation between $\Gamma$ and $\zeta$ function›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   Gamma_hurwitz_zeta_aux_integral<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"Gamma <span class="free">z</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∫</span><span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lebesgue<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   Gamma_hurwitz_zeta_aux_integrable<span class="main">:</span>
            <span class="quoted"><span class="quoted">"set_integrable lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> integrable <span class="main">=</span> absolutely_integrable_Gamma_integral' <span class="main">[</span><span class="operator">OF</span> z<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?INT</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set_lebesgue_integral lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">::</span> <span class="main">(</span>real <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?INT'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set_lebesgue_integral lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">::</span> <span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real"</span></span>

  <span class="keyword1"><span class="command">have</span></span> meas1<span class="main">:</span> <span class="quoted"><span class="quoted">"set_borel_measurable lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> 
                 <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_borel_measurable_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> measurable_completion<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> measurable_lborel2<span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">intro</span> borel_measurable_continuous_on_indicator<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> integrable1<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> 
                       <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> absolutely_integrable_Gamma_integral<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_nonneg_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">0</span> <span class="main">≠</span> of_real <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_real_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="main">+</span> of_real <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> complex_of_real <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> Gamma <span class="free">z</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gamma_integral_complex'<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="free">z</span> <span class="main">=</span> <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_lebesgue_integral_eq_integral<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> integrable<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff exp_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lebesgue <span class="main">=</span> density <span class="main">(</span>distr lebesgue lebesgue <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>real <span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span>real <span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lebesgue_real_scale<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span>"</span></span><span class="main">]</span> pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_lebesgue_integral <span class="main">…</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> of_real <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               set_lebesgue_integral <span class="main">(</span>distr lebesgue lebesgue <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>
                 <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> integrable pos
    <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_density<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span> scaleR_conv_of_real set_integrable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_real <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> of_real <span class="bound">s</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> 
                    of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> integral_distr<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> lebesgue <span class="keyword1">→<span class="hidden">⇩</span><sub>M</sub></span> lebesgue"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lebesgue_measurable_scaling<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span>"</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> real_scaleR_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">∈</span> lebesgue <span class="keyword1">→<span class="hidden">⇩</span><sub>M</sub></span> borel"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> integrable <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> borel_measurable_times<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span>
           <span class="main">(</span>complex_of_real <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> complex_of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∈</span> borel_measurable lebesgue"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">intro</span> Bochner_Integration.integral_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pos<span class="main"><span class="keyword3">,</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def zero_less_mult_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_lebesgue_integral_cong refl allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> powr_times_real<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">*</span> <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_mult_right_zero <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="free">z</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">=</span> 
                  <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   Gamma_hurwitz_zeta_aux_integral_real<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"Gamma <span class="free">x</span> <span class="main">/</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">x</span> <span class="main">=</span> 
               set_lebesgue_integral lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> 
               <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   Gamma_hurwitz_zeta_aux_integrable_real<span class="main">:</span>
            <span class="quoted"><span class="quoted">"set_integrable lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_integrable lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> absolutely_integrable_Gamma_integral<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">xa</span><span class="main">.</span> complex_of_real <span class="bound">xa</span> <span class="keyword1">powr</span> <span class="main">(</span>of_real <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> 
              of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Gamma_hurwitz_zeta_aux_integrable<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> integrable lebesgue
                 <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> complex_of_real <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Bochner_Integration.integrable_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_Reals_eq indicator_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def complex_of_real_integrable_eq <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_integrable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AE_I2 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def norm_divide norm_powr_real_powr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Gamma_hurwitz_zeta_aux_integral<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span>Gamma <span class="free">x</span> <span class="main">/</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> set_lebesgue_integral lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> 
            <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> complex_of_real <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span>of_real <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?I</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Gamma_complex_of_real powr_Reals_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">=</span> lebesgue_integral lebesgue
                    <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> of_real <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Bochner_Integration.integral_cong refl<span class="main">)</span> 
                   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def powr_Reals_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_real <span class="main">(</span>set_lebesgue_integral lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> 
                    <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integral_complex_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="free">x</span> <span class="main">/</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">x</span> <span class="main">=</span> set_lebesgue_integral lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> 
                  <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_real_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   Gamma_times_hurwitz_zeta_integral<span class="main">:</span> <span class="quoted"><span class="quoted">"Gamma <span class="free">z</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="free">z</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lebesgue<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   Gamma_times_hurwitz_zeta_integrable<span class="main">:</span>
            <span class="quoted"><span class="quoted">"set_integrable lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> 
               <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?INT</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set_lebesgue_integral lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">::</span> <span class="main">(</span>real <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?INT'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set_lebesgue_integral lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">::</span> <span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"complex_set_integrable lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> 
            <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gamma_hurwitz_zeta_aux_integrable<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>of_real <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> 
             of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>of_real <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_mult summable_geometric<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult norm_divide exp_add exp_diff
                    exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> exp_of_nat_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∫</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>complex_of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span>
                            complex_of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lebesgue<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Gamma <span class="main">(</span>Re <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span>Re <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_mult summable_hurwitz_zeta_real<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?INT'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> norm <span class="main">(</span>of_real <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> 
                                       of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong always_eventually allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="main">(</span>Re <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span>Re <span class="free">z</span> <span class="main">=</span> Gamma <span class="main">(</span>Re <span class="free">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> Re <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>Re <span class="free">z</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lebesgue<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Gamma_hurwitz_zeta_aux_integral_real<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">xa</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> norm <span class="main">(</span>of_real <span class="bound">xa</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">∂</span>lebesgue<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Bochner_Integration.integral_cong refl<span class="main">)</span>
          <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def norm_divide norm_powr_real_powr<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_lebesgue_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> sum_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>of_real <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                   indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>of_real <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> 
                     of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="skolem">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>of_real <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> of_real <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_cong<span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exp_add exp_minus exp_of_nat_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> of_real_exp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> of_real <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span>
                 of_real <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_mult summable_geometric<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> complex_of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_geometric<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> 
                 of_real <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> exp_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_integrable lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> 
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">unfolding</span></span> sum_eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> set_integrable_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_suminf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ AE_I2<span class="main"><span class="main">]</span></span> 2 3<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> lebesgue_integral lebesgue
            <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">s</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="keyword1">sums</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def set_integrable_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_integral<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ AE_I2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">]</span></span> 3<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Gamma <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Gamma_hurwitz_zeta_aux_integral <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
                   <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> of_real <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_eq set_lebesgue_integral_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Gamma <span class="free">z</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="keyword1">sums</span>
                  <span class="var">?INT</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Gamma <span class="free">z</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> of_real <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span>Gamma <span class="free">z</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_mult sums_hurwitz_zeta<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="free">z</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="free">z</span> <span class="main">=</span> 
                     <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> 
                        of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lebesgue<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_unique2 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   Gamma_times_zeta_integral<span class="main">:</span> <span class="quoted"><span class="quoted">"Gamma <span class="free">z</span> <span class="main">*</span> zeta <span class="free">z</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lebesgue<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   Gamma_times_zeta_integrable<span class="main">:</span>
            <span class="quoted"><span class="quoted">"set_integrable lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> 
               <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> 
                of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> exp_minus indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Gamma_times_hurwitz_zeta_integral <span class="main">[</span><span class="operator">OF</span> assms zero_less_one<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> *
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_def set_lebesgue_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Gamma_times_hurwitz_zeta_integrable <span class="main">[</span><span class="operator">OF</span> assms zero_less_one<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> *
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_def set_integrable_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> hurwitz_zeta_integral_Gamma_def<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="free">a</span> <span class="free">z</span> <span class="main">=</span> 
             rGamma <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> 
               of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lebesgue<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Gamma_eq_zero_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Ints_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Gamma_times_hurwitz_zeta_integral <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rGamma_inverse_Gamma <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_integral_Gamma_def<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"zeta <span class="free">z</span> <span class="main">=</span>
             rGamma <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span>exp <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lebesgue<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Gamma_eq_zero_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Ints_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Gamma_times_zeta_integral <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rGamma_inverse_Gamma <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-Gamma_times_zeta_has_integral"><span class="command">lemma</span></span> Gamma_times_zeta_has_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="main">(</span>exp <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>Gamma <span class="free">z</span> <span class="main">*</span> zeta <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f</span> <span class="keyword1">has_integral</span> <span class="main">_</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f</span> <span class="keyword1">has_integral</span> set_lebesgue_integral lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="var">?f</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Gamma_times_zeta_integrable<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_set_lebesgue<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_lebesgue_integral lebesgue <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="var">?f</span> <span class="main">=</span> Gamma <span class="free">z</span> <span class="main">*</span> zeta <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Gamma_times_zeta_integral<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-Gamma_times_zeta_has_integral_real"><span class="command">lemma</span></span> Gamma_times_zeta_has_integral_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>exp <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>Gamma <span class="free">z</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>of_real <span class="free">z</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Re <span class="main">(</span>complex_of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>complex_of_real <span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>exp <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
           Gamma <span class="free">z</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="main">(</span>complex_of_real <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_linear<span class="main">[</span><span class="operator">OF</span> Gamma_times_zeta_has_integral<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span> bounded_linear_Re<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def Gamma_complex_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_Reals_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-Gamma_integral_real'"><span class="command">lemma</span></span> Gamma_integral_real'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_integral</span> Gamma <span class="free">x</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Gamma_integral_real<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> has_integral_closure <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹An analytic proof of the infinitude of primes›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now also do an analytic proof of the infinitude of primes.
›</span></span>
<span class="keyword1" id="Zeta_Function-primes_infinite_analytic"><span class="command">lemma</span></span> primes_infinite_analytic<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">p</span> <span class="main">::</span> nat<span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="comment1">― ‹Suppose the set of primes were finite.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">P</span>"</span></span>

  <span class="comment1">― ‹Then the Euler product form of the $\zeta$ function ranges over a finite set,
      and since each factor is holomorphic in the positive real half-space, 
      the product is, too.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zeta'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex"</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zeta'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="bound">p</span> <span class="keyword1">powr</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> holo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zeta'</span> <span class="keyword1">holomorphic_on</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_1 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> of_nat_less_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_gt_Suc_0_nat P_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>of_nat <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> real <span class="skolem">p</span> <span class="keyword1">powr</span> Re <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_powr_real_powr<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&gt;</span> real <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p p' s that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_less_cancel_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">p</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zeta'_def P_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹Since the Euler product expansion of $\zeta(s)$ is valid for all $s$ with
      real value at least 1, and both $\zeta(s)$ and the Euler product must 
      be equal in the positive real half-space punctured at 1 by analytic
      continuation.›</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">zeta'</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted">zeta</span> <span class="quoted"><span class="skolem">zeta'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">p</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> prime <span class="bound">p</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="bound">p</span> <span class="keyword1">powr</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">zeta'</span> <span class="skolem">s</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Max <span class="skolem">P</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> elim <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> zeta'_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⇢</span> zeta <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> euler_product_zeta<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">zeta'</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇢</span> zeta <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Lim_transform_eventually<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"zeta <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">zeta'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LIMSEQ_const_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span> open_halfspace_Re_gt connected_open_delete convex_halfspace_Re_gt 
         <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> holo that <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> convex_connected<span class="main">)</span>

  <span class="comment1">― ‹However, since the Euler product is holomorphic on the entire positive real
      half-space, it cannot have a pole at 1, while $\zeta(s)$ does have a pole
      at 1. Since they are equal in the punctured neighbourhood of 1, this is
      a contradiction.›</span>
  <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_filter <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt
               eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_nhds_in_open<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_pole <span class="skolem">zeta'</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> not_is_pole_holomorphic <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> holo open_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_pole <span class="skolem">zeta'</span> <span class="main">1</span> <span class="main">⟷</span> is_pole zeta <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_pole_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span> eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> is_pole_zeta <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The periodic zeta function›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The periodic zeta function $F(s, q)$ (as described e.\,g.\ by Apostol~\cite{apostol1976analytic} 
  is related to the Hurwitz zeta function. It is periodic in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q›</span></span></span></span> with period 1 and it can be 
  represented by a Dirichlet series that is absolutely convergent for $\mathfrak{R}(s) &gt; 1$.
   If <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q ∉ ℤ›</span></span></span></span>, it furthermore convergent for $\mathfrak{R}(s) &gt; 0$.

  It is clear that for integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q›</span></span></span></span>, we have $F(s, q) = F(s, 0) = \zeta(s)$. Moreover, for
  non-integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q›</span></span></span></span>, $F(s, q)$ can be analytically continued to an entire function.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fds_perzeta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex fds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fds_perzeta</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="bound">m</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The definition of the periodic zeta function on the full domain is a bit unwieldy.
  The precise reasoning for this definition will be given later, and, in any case, it
  is probably more instructive to look at the derived ``alternative'' definitions later.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">perzeta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">perzeta</span> <span class="free"><span class="bound"><span class="entity">q'</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">q'</span></span></span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> zeta <span class="free"><span class="bound"><span class="entity">s</span></span></span>
      <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">q</span> <span class="main">=</span> frac <span class="free"><span class="bound"><span class="entity">q'</span></span></span> <span class="keyword1">in</span>
        <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="main">(</span>pre_zeta <span class="bound">q</span> <span class="main">1</span> <span class="main">-</span> pre_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">q</span><span class="main">)</span> <span class="main">1</span> <span class="main">+</span> 
                                             ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">q</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">q</span> <span class="main">+</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>
        <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∈</span> <span class="main">ℕ</span> <span class="keyword1">then</span> eval_fds <span class="main">(</span>fds_perzeta <span class="bound">q</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> 
        <span class="keyword1">else</span> complex_of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> Gamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">*</span>
               <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="bound">q</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">-</span>
                <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> fds_perzeta<span class="main">:</span> periodic_fun_simple' <span class="quoted">fds_perzeta</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_perzeta_def exp_add ring_distribs exp_eq_polar
                             cis_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cis_multiple_2pi<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> perzeta<span class="main">:</span> periodic_fun_simple' <span class="quoted">perzeta</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟷</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> frac_eq_0_iff <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frac.plus_1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"periodic_fun_simple' perzeta"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff perzeta_def Let_def frac.plus_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-perzeta_frac"><span class="command">lemma</span></span> perzeta_frac <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"perzeta <span class="main">(</span>frac <span class="free">q</span><span class="main">)</span> <span class="main">=</span> perzeta <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perzeta_def fun_eq_iff Let_def<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-fds_perzeta_frac"><span class="command">lemma</span></span> fds_perzeta_frac <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_perzeta <span class="main">(</span>frac <span class="free">q</span><span class="main">)</span> <span class="main">=</span> fds_perzeta <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fds_perzeta.plus_of_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"frac <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">q</span><span class="main">⌋</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frac_def<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-abs_conv_abscissa_perzeta"><span class="command">lemma</span></span> abs_conv_abscissa_perzeta<span class="main">:</span> <span class="quoted"><span class="quoted">"abs_conv_abscissa <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> abs_conv_abscissa_leI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_real_powr_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> fds_abs_converges <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fds_abs_converges_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> summable_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_divide norm_powr_real_powr fds_perzeta_def powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> fds_abs_converges <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">c</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-conv_abscissa_perzeta"><span class="command">lemma</span></span> conv_abscissa_perzeta<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv_le_abs_conv_abscissa abs_conv_abscissa_perzeta<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Zeta_Function-fds_perzeta__left_0"><span class="command">lemma</span></span> fds_perzeta__left_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_perzeta <span class="main">0</span> <span class="main">=</span> fds_zeta"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_perzeta_def fds_zeta_def<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-perzeta_0_left"><span class="command">lemma</span></span> perzeta_0_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"perzeta <span class="main">0</span> <span class="free">s</span> <span class="main">=</span> zeta <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perzeta_def eval_fds_zeta<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-perzeta_int"><span class="command">lemma</span></span> perzeta_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟹</span> perzeta <span class="free">q</span> <span class="main">=</span> zeta"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perzeta_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-fds_perzeta_int"><span class="command">lemma</span></span> fds_perzeta_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟹</span> fds_perzeta <span class="free">q</span> <span class="main">=</span> fds_zeta"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_perzeta.of_int <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-sums_fds_perzeta"><span class="command">lemma</span></span> sums_fds_perzeta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> Suc <span class="bound">m</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span>
             eval_fds <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conv_abscissa_perzeta<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> ereal <span class="main">(</span>Re <span class="free">s</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_ereal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_converges<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> nat_power <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span>
           eval_fds <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sums_Suc_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_converges_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_perzeta_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-sum_tendsto_fds_perzeta"><span class="command">lemma</span></span> sum_tendsto_fds_perzeta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>
              <span class="main">⇢</span> eval_fds <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> Suc <span class="bound">m</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_fds_perzeta assms<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">⇢</span>
           eval_fds <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="var">?f</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_def powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">q</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext sum.reindex_bij_betw sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted">Suc</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Using the geometric series, it is easy to see that the Dirichlet series for $F(s, q)$
  has bounded partial sums for non-integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q›</span></span></span></span>, so it must converge for any <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span> with
  $\mathfrak{R}(s) &gt; 0$.
›</span></span>
<span class="keyword1" id="Zeta_Function-conv_abscissa_perzeta'"><span class="command">lemma</span></span> conv_abscissa_perzeta'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"conv_abscissa <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conv_abscissa_leI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bounded_partial_sums_imp_fps_converges<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ω</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">=</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="skolem">ω</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_def<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">/</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∉</span> <span class="main">ℤ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ω_def exp_eq_1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
  
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Bseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Bseq_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">M</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> fds_nth <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="bound">k</span> <span class="main">/</span> nat_power <span class="bound">k</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">ω</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_perzeta_def fds_nth_fds exp_of_nat_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult_ac ω_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">ω</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">ω</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">ω</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ω</span> <span class="main">≠</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> False
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_gp_offset<span class="main">)</span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="main">1</span><span class="main">::</span>complex<span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="skolem">ω</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">ω</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> norm_mult norm_divide
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono divide_right_mono norm_triangle_ineq4<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def norm_power<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> c<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> fds_converges <span class="main">(</span>fds_perzeta <span class="free">q</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">c</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-fds_perzeta_one_half"><span class="command">lemma</span></span> fds_perzeta_one_half<span class="main">:</span> <span class="quoted"><span class="quoted">"fds_perzeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> fds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Complex.DeMoivre<span class="main">[</span><span class="operator">of</span> <span class="quoted">pi</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_perzeta_def exp_eq_polar mult_ac<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-perzeta_one_half_1"><span class="command">lemma</span></span> perzeta_one_half_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"perzeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span>ln <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_unique2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fraction_not_in_ints<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span>fds_perzeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fds_converges<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> le_less_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conv_abscissa_perzeta'<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> * <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">n</span> <span class="main">/</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="main">(</span>fds_perzeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fds_converges_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_perzeta_one_half<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_perzeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> perzeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perzeta_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>complex_of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> perzeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>complex_of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">-</span>of_real <span class="main">(</span>ln <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_minus sums_of_real alternating_harmonic_series_sums<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>complex_of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">-</span><span class="main">(</span>ln <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Ln_of_real<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Hurwitz's formula›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now move on to prove Hurwitz's formula relating the Hurwitz zeta function and the
  periodic zeta function. We mostly follow Apostol's proof, although we do make some small
  changes in order to make the proof more amenable to Isabelle's complex analysis library.
 
  The big difference is that Apostol integrates along a circle with a slit, where the two
  sides of the slit lie on different branches of the integrand. This makes sense when looking
  as the integrand as a Riemann surface, but we do not have a notion of Riemann surfaces in
  Isabelle.

  It is therefore much easier to simply cut the circle into an upper and a lower half. In fact,
  the integral on the lower half can be reduced to the one on the upper half easily by
  symmetry, so we really only need to handle the integral on the upper half. The integration
  contour that we will use is therefore a semi-annulus in the upper half of the complex plane,
  centred around the origin.

  Now, first of all, we prove the existence of an important improper integral 
  that we will need later.
›</span></span>
<span class="comment1">(* TODO: Move *)</span>
<span class="keyword1" id="Zeta_Function-set_integrable_bigo"><span class="command">lemma</span></span> set_integrable_bigo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> real_normed_field<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">a</span><span class="main">..}</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">⟹</span> set_integrable lborel <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="bound">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">{</span><span class="free">a</span><span class="main">..}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">a</span><span class="main">..}</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">x0</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">x0</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> landau_o.bigE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x0'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x0'</span> <span class="main">=</span> max <span class="free">a</span> <span class="skolem">x0</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="skolem">x0'</span><span class="main">}</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> assms<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x0'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="skolem">x0'</span><span class="main">..}</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="skolem">x0'</span><span class="main">..}</span> <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x0'_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">C</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>indicator <span class="main">{</span><span class="skolem">x0'</span><span class="main">..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_scaleR_right<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult norm_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable borel <span class="main">{</span><span class="skolem">x0'</span><span class="main">..}</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_borel_measurable_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x0'_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="skolem">x0'</span><span class="main">..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> norm <span class="main">(</span>indicator <span class="main">{</span><span class="skolem">x0'</span><span class="main">..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>
                            <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">C</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>indicator <span class="main">{</span><span class="skolem">x0'</span><span class="main">..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> AE_I2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_mult indicator_def x0'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="skolem">x0'</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x0'</span><span class="main">..}</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_Un<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="skolem">x0'</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x0'</span><span class="main">..}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x0'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-set_integrable_Gamma_hurwitz_aux2_real"><span class="command">lemma</span></span> set_integrable_Gamma_hurwitz_aux2_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">r</span><span class="main">..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="main">_</span> <span class="main">_</span> <span class="var">?g</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_bigo<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">a</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">r</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_on_exp_minus_to_infinity<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set_integrable lebesgue <span class="main">{</span><span class="free">r</span><span class="main">..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">a</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nonnegative_absolutely_integrable<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">r</span><span class="main">..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">a</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_integrable_def integrable_completion<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> borel_integrable_atLeastAtMost'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">r</span><span class="main">..&lt;</span><span class="skolem">y</span><span class="main">}</span> <span class="var">?g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">a</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-set_integrable_Gamma_hurwitz_aux2"><span class="command">lemma</span></span> set_integrable_Gamma_hurwitz_aux2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">r</span><span class="main">..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="main">_</span> <span class="main">_</span> <span class="var">?g</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">r</span><span class="main">..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span>Re <span class="free">s</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="main">_</span> <span class="main">_</span> <span class="var">?g'</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_Gamma_hurwitz_aux2_real<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="free">r</span><span class="main">..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?g'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_integrable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="free">r</span><span class="main">..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?g'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span>indicator <span class="main">{</span><span class="free">r</span><span class="main">..}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def norm_mult norm_divide norm_powr_real_powr fun_eq_iff
                   exp_of_real exp_minus norm_inverse in_Reals_norm power2_eq_square <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> integrable_norm_iff<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-closed_neg_Im_slit"><span class="command">lemma</span></span> closed_neg_Im_slit<span class="main">:</span> <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">(</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Im <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> closed_Int closed_halfspace_Re_eq closed_halfspace_Im_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Im <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define tour semi-annulus path. When this path is mirrored into the lower half of the complex
  plane and subtracted from the original path and the outer radius tends to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∞›</span></span></span></span>, this becomes a
  Hankel contour extending to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>-∞›</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hankel_semiannulus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> nat <span class="main">⇒</span> real <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">hankel_semiannulus</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">R</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi <span class="keyword1">in</span>
    part_circlepath <span class="main">0</span> <span class="bound">R</span> <span class="main">0</span> pi <span class="main">+++</span>                  <span class="comment1">―‹Big half circle›</span>
    linepath <span class="main">(</span>of_real <span class="main">(</span><span class="main">-</span><span class="bound">R</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_real <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">+++</span>    <span class="comment1">―‹Line on the negative real axis›</span>
    part_circlepath <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> pi <span class="main">0</span> <span class="main">+++</span>                  <span class="comment1">―‹Small half circle›</span>
    linepath <span class="main">(</span>of_real <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>of_real <span class="bound">R</span><span class="main">)</span><span class="main">)</span>             <span class="comment1">―‹Line on the positive real axis›</span>"</span></span> 

<span class="keyword1" id="Zeta_Function-path_hankel_semiannulus"><span class="command">lemma</span></span> path_hankel_semiannulus <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="main">(</span>hankel_semiannulus <span class="free">r</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> valid_path_hankel_semiannulus <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>hankel_semiannulus <span class="free">r</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pathfinish_hankel_semiannulus <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
        <span class="quoted"><span class="quoted">"pathfinish <span class="main">(</span>hankel_semiannulus <span class="free">r</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="main">(</span>hankel_semiannulus <span class="free">r</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hankel_semiannulus_def Let_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We set the stage for an application of the Residue Theorem. We define a function
  \[f(s, z) = z^{-s} \frac{\exp(az)}{1-\exp(-z)}\ ,\]
  which will be the integrand. However, the principal branch of $z^{-s}$ has a branch cut
  along the non-positive real axis, which is bad because a part of our integration path also
  lies on the non-positive real axis. We therefore choose a slightly different branch of $z^{-s}$
  by moving the logarithm branch along by $90^{\circ}$ so that the branch cut lies on the
  non-positive imaginary axis instead.
›</span></span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> real <span class="main">⇒</span> complex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex <span class="main">⇒</span> real <span class="main">⇒</span> complex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Res</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> nat <span class="main">⇒</span> complex"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Ln'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span>"</span></span>

  <span class="comment1">―‹Our custom branch of the logarithm›</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ln'</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> ln <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

  <span class="comment1">―‹The integrand›</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="bound">z</span><span class="main">.</span> exp <span class="main">(</span><span class="free">Ln'</span> <span class="bound">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="bound">s</span><span class="main">)</span> <span class="main">+</span> of_real <span class="free">a</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="comment1">―‹The integrand on the negative real axis›</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="bound">x</span><span class="main">.</span> complex_of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="bound">s</span> <span class="main">*</span> of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="comment1">―‹The integrand on the circular arcs›</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">r</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> cis <span class="bound">t</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> cis <span class="bound">t</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">r</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span> <span class="main">/</span>
                        <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> cis <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="comment1">―‹The interesting part of the residues›</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">Res</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="bound">k</span><span class="main">.</span> exp <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span>
                            of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="comment1">―‹The periodic zeta function (at least on $\mathfrak{R}(s) &gt; 1$ half-plane)›</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> eval_fds <span class="main">(</span>fds_perzeta <span class="bound">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  First, some basic properties of our custom branch of the logarithm:
›</span></span>
<span class="keyword1" id="Zeta_Function-Ln'_i"><span class="command">lemma</span></span> Ln'_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Ln'</span> <span class="keyword1">𝗂</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln'_def<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-Ln'_of_real_pos"><span class="command">lemma</span></span> Ln'_of_real_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">Ln'</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>ln <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ln'</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Ln <span class="main">(</span>of_real <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln'_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_real <span class="main">(</span>ln <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Ln_times_of_real<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ln_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-Ln'_of_real_neg"><span class="command">lemma</span></span> Ln'_of_real_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">Ln'</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>ln <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ln'</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Ln <span class="main">(</span>of_real <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln'_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_real <span class="main">(</span>ln <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Ln_times_of_real<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ln_Reals_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-Ln'_times_of_real"><span class="command">lemma</span></span> Ln'_times_of_real<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ln'</span> <span class="main">(</span>of_real <span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>ln <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">Ln'</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">z</span> <span class="free">x</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ln'</span> <span class="main">(</span>of_real <span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> Ln <span class="main">(</span>of_real <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln'_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_real <span class="main">(</span>ln <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">Ln'</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Ln_times_of_real<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ln'_def Ln_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-Ln'_cis"><span class="command">lemma</span></span> Ln'_cis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi <span class="main">/</span> <span class="numeral">2</span><span class="main">&lt;..</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">Ln'</span> <span class="main">(</span>cis <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_eq_polar<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Ln <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> cis <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Ln_unique<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> exp_diff cis_conv_exp<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln'_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we show that the line and circle integrals are holomorphic using Leibniz's rule:
›</span></span>
<span class="keyword1" id="Zeta_Function-contour_integral_part_circlepath_h"><span class="command">lemma</span></span> contour_integral_part_circlepath_h<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="free">r</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="free">h</span> <span class="free">r</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="free">r</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> 
          integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="free">s</span> <span class="main">(</span><span class="free">r</span> <span class="main">*</span> cis <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="free">r</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> cis <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contour_integral_part_circlepath_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="free">s</span> <span class="main">(</span><span class="free">r</span> <span class="main">*</span> cis <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="free">r</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> cis <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="free">h</span> <span class="free">r</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> integral_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span>pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">&lt;..</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span> <span class="main">(</span><span class="free">r</span> <span class="main">*</span> cis <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="free">r</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> cis <span class="skolem">t</span> <span class="main">=</span> <span class="free">h</span> <span class="free">r</span> <span class="free">s</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def Ln'_times_of_real Ln'_cis h_def Ln_Reals_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-integral_g_holomorphic"><span class="command">lemma</span></span> integral_g_holomorphic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> integral <span class="main">{</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span>of_real <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> complex_of_real <span class="main">(</span>ln <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> 
                          of_real <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> leibniz_rule_holomorphic<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> cbox <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">g</span> <span class="bound">s</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> <span class="skolem">g'</span> <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def g'_def powr_def Ln_Reals_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">s</span> <span class="keyword1">integrable_on</span> cbox <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_continuous <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>UNIV <span class="main">×</span> cbox <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="skolem">g'</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g'_def case_prod_unfold <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-integral_h_holomorphic"><span class="command">lemma</span></span> integral_h_holomorphic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> integral <span class="main">{</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">}</span> <span class="main">(</span><span class="free">h</span> <span class="free">r</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> no_sing<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="free">r</span> <span class="main">*</span> cis <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> cis <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"exp <span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">z</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> of_int <span class="main">¦</span><span class="skolem">n</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exp_eq_1 cmod_def abs_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">z</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z_def norm_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> r_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> of_int <span class="main">¦</span><span class="skolem">n</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">using</span></span> pi_gt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">with</span></span> r_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">n</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">r</span> <span class="main">*</span> cis <span class="bound">t</span> <span class="main">-</span> <span class="main">(</span>ln <span class="free">r</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span> <span class="main">*</span>
                           <span class="main">(</span><span class="main">-</span>ln <span class="free">r</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> cis <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="free">r</span> <span class="main">*</span> cis <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span> <span class="free">r</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> leibniz_rule_holomorphic<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> cbox <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">h</span> <span class="free">r</span> <span class="bound">s</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> <span class="skolem">h'</span> <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_sing r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def h'_def mult_ac Ln_Reals_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="free">r</span> <span class="skolem">s</span> <span class="keyword1">integrable_on</span> cbox <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_sing <span class="keyword1"><span class="command">unfolding</span></span> h_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> integrable_continuous_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>UNIV <span class="main">×</span> cbox <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="skolem">h'</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_sing
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h'_def case_prod_unfold <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now move on to the core result, which uses the Residue Theorem to relate a contour integral
  along a semi-annulus to a partial sum of the periodic zeta function.
›</span></span>
<span class="keyword1" id="Zeta_Function-hurwitz_formula_integral_semiannulus"><span class="command">lemma</span></span> hurwitz_formula_integral_semiannulus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">≡</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">N</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> integral <span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="free">R</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
         integral <span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="free">R</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
         contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="free">R</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span>
         contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="free">r</span> pi <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span>
         <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">s</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="free">Res</span> <span class="free">s</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span> <span class="keyword1">contour_integrable_on</span> hankel_semiannulus <span class="free">r</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">using</span></span> pi_gt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> r_R <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">&lt;</span> <span class="numeral">2</span>›</span></span> this

  <span class="comment1">―‹We integrate along the edge of a semi-annulus in the upper half of the complex plane.
     It consists of a big semicircle, a small semicircle, and two lines connecting the two
     circles, one on the positive real axis and one on the negative real axis.

     The integral along the big circle will vanish as the radius of the circle tends to <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>∞›</span></span>,
     whereas the remaining path becomes a Hankel contour, and the integral along that Hankel
     contour is what we are interested in, since it is connected to the Hurwitz zeta function.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">big_circle</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">big_circle</span> <span class="main">=</span> part_circlepath <span class="main">0</span> <span class="free">R</span> <span class="main">0</span> pi"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">small_circle</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">small_circle</span> <span class="main">=</span> part_circlepath <span class="main">0</span> <span class="free">r</span> pi <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">neg_line</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">neg_line</span> <span class="main">=</span> linepath <span class="main">(</span>complex_of_real <span class="main">(</span><span class="main">-</span><span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="main">(</span><span class="main">-</span><span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pos_line</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pos_line</span> <span class="main">=</span> linepath <span class="main">(</span>complex_of_real <span class="free">r</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> hankel_semiannulus <span class="free">r</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> γ_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> <span class="skolem">big_circle</span> <span class="main">+++</span> <span class="skolem">neg_line</span> <span class="main">+++</span> <span class="skolem">small_circle</span> <span class="main">+++</span> <span class="skolem">pos_line</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> γ_def R_def add_ac hankel_semiannulus_def big_circle_def
                  neg_line_def small_circle_def pos_line_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">γ</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">γ</span>"</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">γ</span> <span class="main">=</span> pathstart <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> γ_def<span class="main">)</span>

  <span class="comment1">―‹The integrand has a branch cut along the non-positive imaginary axis and additional 
     simple poles at $2n\pi i$ for any <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>n ∈ ℕ<span class="hidden">⇩</span><sub>&gt;</sub><span class="hidden">⇩</span><sub>0</sub>›</span></span>. The radius of the smaller circle will always
     be less than $2\pi$ and the radius of the bigger circle of the form $(2N+1)\pi$, so we
     always have precisely the first $N$ poles inside our path.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sngs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sngs</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sngs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sngs'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">N</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> sngs_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sngs'</span> <span class="main">⊆</span> <span class="skolem">sngs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sngs_def sngs'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> image_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> closed_sngs <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"closed <span class="main">(</span><span class="skolem">sngs</span> <span class="main">-</span> <span class="skolem">sngs'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sngs_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> discrete_imp_closed<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span>
                norm <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">-</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">-</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">=</span>
                 of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> of_int <span class="main">(</span>int <span class="skolem">m</span> <span class="main">-</span> int <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> of_int <span class="main">¦</span>int <span class="skolem">m</span> <span class="main">-</span> int <span class="skolem">n</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> norm_mult norm_of_int <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>real <span class="skolem">m</span> <span class="main">-</span> real <span class="skolem">n</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">=</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="comment1">―‹We define an area within which the integrand is holomorphic. Choosing this area as big as
     possible makes things easier later on, so we only remove the branch cut and the poles.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">-</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">sngs</span> <span class="main">-</span> <span class="skolem">sngs'</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span> <span class="main">=</span> <span class="main">-</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> sngs<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">sngs</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"exp <span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> of_int <span class="skolem">n</span> <span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> exp_eq_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword2"><span class="keyword">and</span></span> pi_gt_zero <span class="keyword2"><span class="keyword">and</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_less_mult_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> nat <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nat <span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">sngs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sngs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sngs_def exp_eq_polar<span class="main">)</span>

  <span class="comment1">―‹We show that the path stays within the well-behaved area.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">neg_line</span> <span class="main">=</span> of_real <span class="main">`</span> <span class="main">{</span><span class="main">-</span><span class="free">R</span><span class="main">..</span><span class="main">-</span><span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_R
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> neg_line_def closed_segment_Reals closed_segment_eq_real_ivl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">neg_line</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_R sngs_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def sngs_def complex_eq_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">pos_line</span> <span class="main">=</span> of_real <span class="main">`</span> <span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="free">R</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_R
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pos_line_def closed_segment_Reals closed_segment_eq_real_ivl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">pos_line</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_R sngs_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def sngs_def complex_eq_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> part_circlepath_in_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> path_image <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r'</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">∨</span> <span class="skolem">z</span> <span class="main">∈</span> path_image <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r'</span> pi <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> <span class="skolem">r'</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">r'</span> <span class="main">∧</span> Im <span class="skolem">z</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path_image_def part_circlepath_def norm_mult Im_exp linepath_def
               <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_nonneg_nonneg sin_ge_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cmod_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> z <span class="keyword2"><span class="keyword">and</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="skolem">sngs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sngs_def norm_mult image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sngs_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pi_gt3 r_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> part_circlepath_in_S<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main">]</span> r_R <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">small_circle</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> small_circle_def<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">n</span> <span class="main">=</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">N</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">N</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_nat_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> of_nat_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> part_circlepath_in_S<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main">]</span> r_R <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">big_circle</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> big_circle_def<span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span> path_images <span class="main">=</span>
    <span class="quoted"><span class="quoted">‹path_image <span class="skolem">small_circle</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>›</span></span> <span class="quoted"><span class="quoted">‹path_image <span class="skolem">big_circle</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>›</span></span>
    <span class="quoted"><span class="quoted">‹path_image <span class="skolem">neg_line</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>›</span></span> <span class="quoted"><span class="quoted">‹path_image <span class="skolem">pos_line</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">γ</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_images
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> γ_altdef path_image_join big_circle_def neg_line_def 
                   small_circle_def pos_line_def<span class="main">)</span>

  <span class="comment1">―‹We need to show that the complex plane is still connected after we removed the branch cut
     and the poles. We do this by showing that the complex plane with the branch cut removed
     is starlike and therefore connected. Then we remove the (countably many) poles, which does not
     break connectedness either.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closed_neg_Im_slit <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"starlike <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"starlike <span class="var">?S'</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> starlike_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">using</span></span> pi_gt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="free">N</span><span class="main">)</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">∈</span> <span class="var">?S'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="var">?S'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed_segment <span class="keyword1">𝗂</span> <span class="skolem">z</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> closed_segment <span class="keyword1">𝗂</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">s</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> linepath <span class="keyword1">𝗂</span> <span class="skolem">z</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> linepath_image_01 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> z s t <span class="keyword1"><span class="command">have</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Re_linepath' S_def linepath_0'<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">s</span> <span class="main">∈</span> closed_segment <span class="main">1</span> <span class="main">(</span>Im <span class="skolem">z</span><span class="main">)</span> <span class="main">∧</span> Im <span class="skolem">s</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> closed_segment_same_Re<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> z' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_segment_eq_real_ivl <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"closed_segment <span class="keyword1">𝗂</span> <span class="skolem">z</span> <span class="main">⊆</span> <span class="var">?S'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"connected <span class="var">?S'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> starlike_imp_connected<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"connected <span class="skolem">S'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Compl_eq_Diff_UNIV S'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"connected <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> connected_open_diff_countable<span class="main">)</span>
       <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹connected <span class="skolem">S'</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sngs_def closed_neg_Im_slit S'_def<span class="main">)</span>

  <span class="comment1">―‹The integrand is now clearly holomorphic on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>"</span><span class="antiquote">}</span></span> and we can apply the
     Residue Theorem.›</span>
  <span class="keyword1"><span class="command">have</span></span> holo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span> <span class="keyword1">holomorphic_on</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def Ln'_def S_def <span class="keyword1"><span class="command">using</span></span> sngs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"contour_integral <span class="skolem">γ</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
          of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">sngs'</span><span class="main">.</span> winding_number <span class="skolem">γ</span> <span class="bound">z</span> <span class="main">*</span> residue <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Residue_theorem<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∉</span> <span class="skolem">S</span> <span class="main">⟶</span> winding_number <span class="skolem">γ</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> Im <span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">sngs</span> <span class="main">-</span> <span class="skolem">sngs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span>Im <span class="skolem">z</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> Im <span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">-</span>of_real <span class="skolem">x</span> <span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> complex_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_def<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> norm <span class="bound">z</span> <span class="main">≥</span> <span class="skolem">B</span> <span class="main">⟹</span> winding_number <span class="skolem">γ</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> winding_number_zero_at_infinity<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">γ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ</span> <span class="main">(</span><span class="main">-</span>of_real <span class="main">(</span>max <span class="skolem">B</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ</span> <span class="main">(</span><span class="main">-</span>of_real <span class="main">(</span>max <span class="skolem">B</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> winding_number <span class="skolem">γ</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> winding_number_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed_segment <span class="main">(</span><span class="main">-</span>of_real <span class="main">(</span>max <span class="skolem">B</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_segment_same_Re closed_segment_eq_real_ivl<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹path_image <span class="skolem">γ</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"closed_segment <span class="main">(</span><span class="main">-</span>of_real <span class="main">(</span>max <span class="skolem">B</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">∩</span> path_image <span class="skolem">γ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">sngs</span> <span class="main">-</span> <span class="skolem">sngs'</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> winding_number_zero_outside<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">γ</span> <span class="main">=</span> path_image <span class="skolem">big_circle</span> <span class="main">∪</span> path_image <span class="skolem">neg_line</span> <span class="main">∪</span>
                                 path_image <span class="skolem">small_circle</span> <span class="main">∪</span> path_image <span class="skolem">pos_line</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> γ_altdef small_circle_def big_circle_def pos_line_def neg_line_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_image_join Un_assoc<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> cball <span class="main">0</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">N</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_R
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> small_circle_def big_circle_def pos_line_def neg_line_def
                           path_image_join norm_mult R_def path_image_part_circlepath'
                           in_Reals_norm closed_segment_Reals closed_segment_eq_real_ivl<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">γ</span> <span class="main">⊆</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> z<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sngs_def sngs'_def norm_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹path_image <span class="skolem">γ</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>›</span></span> <span class="quoted"><span class="quoted">‹connected <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹open <span class="skolem">S</span>›</span></span> holo<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sngs'_def<span class="main">)</span>

  <span class="comment1">―‹We can use Wenda Li's framework to compute the winding numbers at the poles and show that
     they are all 1.›</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">sngs'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pi_gt3 r_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> norm_z<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="skolem">z</span> <span class="main">&gt;</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">z</span> <span class="main">&lt;</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that r_R
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sngs'_def norm_mult R_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">big_circle</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_R that <span class="keyword1"><span class="command">unfolding</span></span> big_circle_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_circlepath_upper<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sngs'_def norm_mult R_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">small_circle</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_R that norm_z <span class="keyword1"><span class="command">unfolding</span></span> small_circle_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_reversepath'<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> reversepath_part_circlepath<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">subst</span> cindex_pathE_circlepath_upper<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sngs'_def norm_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">neg_line</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">pos_line</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> neg_line_def pos_line_def <span class="keyword1"><span class="command">using</span></span> r_R that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_linepath<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> neg_line_def cindex_pathE_linepath
            closed_segment_Reals closed_segment_eq_real_ivl sngs'_def complex_eq_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">note</span></span> indices <span class="main">=</span> <span class="quoted"><span class="quoted">‹cindex_pathE <span class="skolem">big_circle</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹cindex_pathE <span class="skolem">small_circle</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>›</span></span>
                   <span class="quoted"><span class="quoted">‹cindex_pathE <span class="skolem">neg_line</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹cindex_pathE <span class="skolem">pos_line</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> γ_altdef big_circle_def small_circle_def pos_line_def neg_line_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval_winding</span> <span class="main">(</span><span class="operator">insert</span> indices path_images that<span class="main"><span class="keyword3">,</span></span>
                       <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> big_circle_def small_circle_def pos_line_def neg_line_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">sngs'</span><span class="main">.</span> winding_number <span class="skolem">γ</span> <span class="bound">z</span> <span class="main">*</span> residue <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">sngs'</span><span class="main">.</span> residue <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> residue <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sngs'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_onI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>

  <span class="comment1">―‹Next, we compute the residues at each pole.›</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"residue <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> of_nat <span class="skolem">k</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>exp <span class="main">(</span><span class="main">-</span> <span class="free">s</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">Res</span> <span class="free">s</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">N</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> residue_simple_pole_deriv<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">S'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closed_neg_Im_slit <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S'_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="skolem">S'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> exp <span class="main">(</span><span class="free">Ln'</span> <span class="bound">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">+</span> of_real <span class="free">a</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="skolem">S'</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> exp <span class="bound">z</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="skolem">S'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S'_def Ln'_def complex_nonpos_Reals_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> exp <span class="bound">z</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> <span class="main">-</span>exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">k</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">k</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_eq_polar<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> exp <span class="bound">z</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>
                    <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pi_gt_zero that
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">∈</span> <span class="skolem">S'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S'_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_eq_polar<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="free">Ln'</span> <span class="main">(</span>complex_of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span><span class="free">s</span> <span class="main">+</span>
              of_real <span class="free">a</span> <span class="main">*</span> <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">-</span><span class="main">1</span> <span class="main">=</span> 
            <span class="main">-</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">-</span> <span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">s</span> <span class="main">*</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Ln'_times_of_real<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln'_i <span class="dynamic"><span class="dynamic">algebra_simps</span></span> exp_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span>exp <span class="main">(</span><span class="main">-</span> <span class="free">s</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">Res</span> <span class="free">s</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Res_def exp_diff powr_def exp_minus inverse_eq_divide Ln_Reals_eq mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">=</span> <span class="main">-</span>exp <span class="main">(</span><span class="main">-</span> <span class="free">s</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">Res</span> <span class="free">s</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S'_def exp_eq_polar<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> residue <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> of_nat <span class="bound">k</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
           <span class="main">-</span>exp <span class="main">(</span><span class="main">-</span> <span class="free">s</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="free">Res</span> <span class="free">s</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>

  <span class="comment1">―‹This gives us the final result:›</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"contour_integral <span class="skolem">γ</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
                  <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">s</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="free">Res</span> <span class="free">s</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="comment1">―‹Lastly, we decompose the contour integral into its four constituent integrals because this
     makes them somewhat nicer to work with later on.›</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span> <span class="keyword1">contour_integrable_on</span> <span class="skolem">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> contour_integrable_holomorphic_simple<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">γ</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="skolem">sngs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imp_closed<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sngs'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹open <span class="skolem">S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="skolem">sngs'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> holo<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"contour_integral <span class="skolem">γ</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> 
               contour_integral <span class="skolem">big_circle</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> contour_integral <span class="skolem">neg_line</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span>
               contour_integral <span class="skolem">small_circle</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> contour_integral <span class="skolem">pos_line</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> γ_altdef big_circle_def neg_line_def small_circle_def pos_line_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"contour_integral <span class="skolem">neg_line</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">{</span><span class="main">-</span><span class="free">R</span><span class="main">..</span><span class="main">-</span><span class="free">r</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="free">s</span> <span class="main">(</span>complex_of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> neg_line_def <span class="keyword1"><span class="command">using</span></span> r_R <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> contour_integral_linepath_Reals_eq<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> exp <span class="main">(</span><span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> 
                    integral <span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="free">R</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span>ln <span class="bound">x</span> <span class="main">*</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">*</span> <span class="var">?I</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> integral_mult_right <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> r_R
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Henstock_Kurzweil_Integration.integral_reflect_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> integral_cong<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def exp_of_real Ln'_of_real_neg exp_minus exp_Reals_eq
                   exp_diff exp_add <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">=</span> integral <span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="free">R</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_R
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_def Ln_Reals_eq exp_minus exp_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"contour_integral <span class="skolem">pos_line</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="free">R</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="free">s</span> <span class="main">(</span>complex_of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pos_line_def <span class="keyword1"><span class="command">using</span></span> r_R <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> contour_integral_linepath_Reals_eq<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> integral <span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="free">R</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r_R <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def Ln'_of_real_pos exp_diff exp_minus
                                                  exp_Reals_eq <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_def Ln_Reals_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> add_ac big_circle_def small_circle_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we need bounds on the integrands of the two semicircles.
›</span></span>
<span class="keyword1" id="Zeta_Function-hurwitz_formula_bound1"><span class="command">lemma</span></span> hurwitz_formula_bound1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> exp <span class="main">(</span>complex_of_real <span class="free">a</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">C</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">::</span>int<span class="main">.</span> ball <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">H</span> <span class="bound">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> cbox <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">-</span> ball <span class="main">0</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="skolem">z</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"exp <span class="skolem">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> exp_eq_1<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">≥</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> pi"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def in_cbox_complex_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> mult_le_cancel_right<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="skolem">A</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def H_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compact <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def compact_eq_bounded_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compact <span class="main">(</span><span class="free">H</span> <span class="main">`</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compact_continuous_image<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="free">H</span> <span class="main">`</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compact_imp_bounded<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> bound_inside<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">H</span> <span class="bound">z</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bounded_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> bound_outside<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">H</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">≤</span> exp <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="skolem">z</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">H</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def norm_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ norm_triangle_ineq3<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="skolem">z</span><span class="main">)</span> <span class="main">≤</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono mult_pos_pos<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> exp <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>exp <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> exp <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>exp <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono diff_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> exp <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">z</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_nonneg_nonpos<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">z</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> exp <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> max <span class="skolem">C</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def max.coboundedI2<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">H</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">::</span>int<span class="main">.</span> ball <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="skolem">z</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> bound_outside<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">⌊</span>Im <span class="skolem">z</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">⌋</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> frac <span class="main">(</span>Im <span class="skolem">z</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">-</span> pi"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def frac_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">..&lt;</span>pi<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> frac_lt_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">H</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bound_inside<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def in_cbox_complex_iff dist_norm n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">n</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_eq_polar<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">H</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> norm <span class="main">(</span><span class="free">H</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def norm_divide exp_diff mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≤</span> <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-hurwitz_formula_bound2"><span class="command">lemma</span></span> hurwitz_formula_bound2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">C</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">r</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main">&lt;</span> pi <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∈</span> sphere <span class="main">0</span> <span class="bound">r</span> <span class="main">⟹</span>
     norm <span class="main">(</span><span class="free">f</span> <span class="free">s</span> <span class="bound">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span> <span class="main">*</span> <span class="bound">r</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> exp <span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> exp <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> of_int <span class="skolem">n</span> <span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exp_eq_1 complex_eq_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>real_of_int <span class="skolem">n</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">⟷</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>complex<span class="main">.</span> <span class="main">1</span> <span class="main">-</span> exp <span class="bound">z</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_at_ball'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> nz <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"subdegree <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fps_exp <span class="main">(</span><span class="main">1</span> <span class="main">::</span> complex<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subdegreeI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="bound">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">z</span> <span class="main">::</span> complex<span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="keyword1">has_fps_expansion</span> fps_exp <span class="free">a</span> <span class="main">*</span> <span class="main">(</span>fps_X <span class="main">/</span> <span class="main">(</span>fps_const <span class="main">1</span> <span class="main">-</span> fps_exp <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">fps_expansion_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>complex<span class="main">.</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="bound">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">](</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> continuous_imp_bigo_1 has_fps_expansion_imp_continuous <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>complex<span class="main">.</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">](</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.in_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="keyword1">holomorphic_on</span> ball <span class="main">0</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>ball <span class="main">0</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">z</span> <span class="main">=</span> exp <span class="main">(</span>of_real <span class="free">a</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_extend <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> g <span class="main">=</span> this
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>ball <span class="main">0</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> holomorphic_on_imp_continuous_on<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cball <span class="main">0</span> pi<span class="main">)</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset<span class="main">)</span> <span class="main">(</span><span class="operator">subst</span> cball_subset_ball_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> pi_gt_zero <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"compact <span class="main">(</span><span class="skolem">g</span> <span class="main">`</span> cball <span class="main">0</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> compact_continuous_image<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="skolem">g</span> <span class="main">`</span> cball <span class="main">0</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compact_imp_bounded<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>cball <span class="main">0</span> pi<span class="main">.</span> norm <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bounded_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> pi"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> sphere <span class="main">0</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> Arg <span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span>pi <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">then</span> Arg <span class="skolem">z</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="keyword1">else</span> Arg <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_eq_polar<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> z <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r pi_gt_zero Arg_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_def exp_add distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">using</span></span> Arg_le_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> mpi_less_Arg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_def<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>›</span></span> this

    <span class="keyword1"><span class="command">from</span></span> x r <span class="keyword1"><span class="command">have</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> cball <span class="main">0</span> pi <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pi_gt3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cball <span class="main">0</span> pi <span class="main">⊆</span> ball <span class="main">(</span><span class="main">0</span><span class="main">::</span>complex<span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cball_subset_ball_iff<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> pi_gt_zero <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cball <span class="main">0</span> pi <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> ball <span class="main">0</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>complex<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> z''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> bound<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> g <span class="keyword2"><span class="keyword">and</span></span> z'
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="skolem">z</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nz z'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> bound z'' <span class="keyword1"><span class="command">have</span></span> bound'<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">/</span> norm <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide <span class="dynamic"><span class="dynamic">field_simps</span></span> norm_mult<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ln'</span> <span class="skolem">z</span> <span class="main">=</span> of_real <span class="main">(</span>ln <span class="skolem">r</span><span class="main">)</span> <span class="main">+</span> <span class="free">Ln'</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> of_real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln'_times_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_eq_polar<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ln'</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> of_real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Ln <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> of_real <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Ln'_def exp_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x pi_gt3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Ln_exp<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">Ln'</span> <span class="skolem">z</span> <span class="main">*</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> Im <span class="free">s</span> <span class="main">-</span> ln <span class="skolem">r</span> <span class="main">*</span> Re <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> Im <span class="free">s</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">*</span> Im <span class="free">s</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_ge_self<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="main">¦</span>Im <span class="free">s</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> abs_mult <span class="keyword1"><span class="command">using</span></span> x
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> Im <span class="free">s</span> <span class="main">-</span> ln <span class="skolem">r</span> <span class="main">*</span> Re <span class="free">s</span><span class="main">)</span> <span class="main">≤</span> exp <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>Im <span class="free">s</span><span class="main">¦</span> <span class="main">-</span> ln <span class="skolem">r</span> <span class="main">*</span> Re <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">Ln'</span> <span class="skolem">z</span> <span class="main">*</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                    exp <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>Im <span class="free">s</span><span class="main">¦</span> <span class="main">-</span> ln <span class="skolem">r</span> <span class="main">*</span> Re <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">/</span> norm <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> norm_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"exp <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">t</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono bound'<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x norm_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>Im <span class="free">s</span><span class="main">¦</span> <span class="main">-</span> ln <span class="skolem">r</span> <span class="main">*</span> Re <span class="free">s</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>Im <span class="free">s</span><span class="main">¦</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_diff powr_def exp_minus inverse_eq_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">s</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">*</span> exp <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>Im <span class="free">s</span><span class="main">¦</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def exp_diff exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> max <span class="main">0</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">*</span> exp <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>Im <span class="free">s</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono max.coboundedI2<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">s</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="main">0</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">*</span> exp <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>Im <span class="free">s</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now relate the integral along a partial Hankel contour that is cut off at $-\pi$ to
  $\zeta(1 - s, a) / \Gamma(s)$.
›</span></span>
<span class="keyword1" id="Zeta_Function-rGamma_hurwitz_zeta_eq_contour_integral"><span class="command">lemma</span></span> rGamma_hurwitz_zeta_eq_contour_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">err1</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="bound">r</span> pi <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">err2</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> cnj <span class="main">(</span>contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="bound">r</span> pi <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>cnj <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> rGamma <span class="free">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
             <span class="free">err2</span> <span class="free">s</span> <span class="free">r</span> <span class="main">-</span> <span class="free">err1</span> <span class="free">s</span> <span class="free">r</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="free">s</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="free">s</span> <span class="main">=</span> <span class="var">?g</span> <span class="free">s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>

  <span class="comment1">―‹We first show that the integrals along the Hankel contour cut off at $-\pi$ all have the
     same value, no matter what the radius of the circle is (as long as it is small enough).
     We call this value <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>C›</span></span>.

     This argument could be done by a homotopy argument, but it is easier to simply re-use the
     above result about the contour integral along the annulus where we fix the radius of the 
     outer circle to $\pi$.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">-</span>contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> pi <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span>
                       cnj <span class="main">(</span>contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> pi <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>cnj <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="skolem">A</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> sets lborel"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Gamma_times_hurwitz_zeta_integrable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> s a
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def exp_of_real exp_minus integrable_completion set_integrable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r'</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> r'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> hurwitz_formula_integral_semiannulus<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r'</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> r'
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">s</span> <span class="keyword1">contour_integrable_on</span> part_circlepath <span class="main">0</span> <span class="skolem">r'</span> pi <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hankel_semiannulus_def add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> integrable_circle <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r'</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> r'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> hurwitz_formula_integral_semiannulus<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r'</span></span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> r'
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>cnj <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">contour_integrable_on</span> part_circlepath <span class="main">0</span> <span class="skolem">r'</span> pi <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hankel_semiannulus_def add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> integrable_circle' <span class="main">=</span> this

  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="skolem">r</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">err1</span> <span class="skolem">s</span> <span class="skolem">r</span> <span class="main">-</span> <span class="free">err2</span> <span class="skolem">s</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cnj <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> cnj <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cnj_powr g_def exp_of_real exp_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cnj <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> cnj <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cnj_powr<span class="main">)</span>
  
    <span class="keyword1"><span class="command">from</span></span> hurwitz_formula_integral_semiannulus<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> hurwitz_formula_integral_semiannulus<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span>
            integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span>real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span>
            integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span>real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
            contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span>
            contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r</span> pi <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">-</span> cnj <span class="main">(</span>
          exp <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span>pi <span class="main">*</span> cnj <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span>
            integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span>real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> cnj <span class="skolem">s</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
            integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span>real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> cnj <span class="skolem">s</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
            contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>cnj <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
            contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r</span> pi <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>cnj <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> hurwitz_formula_integral_semiannulus<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="free">err1</span> <span class="skolem">s</span> <span class="skolem">r</span> <span class="main">-</span> <span class="free">err2</span> <span class="skolem">s</span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq1 eq2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> integral_cnj exp_cnj err1_def err2_def sin_exp_eq <span class="dynamic"><span class="dynamic">algebra_simps</span></span> C_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="skolem">r</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_borel_integral_eq_integral<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> integrable<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="skolem">r</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">err1</span> <span class="skolem">s</span> <span class="skolem">r</span> <span class="main">-</span> <span class="free">err2</span> <span class="skolem">s</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">―‹Next, compute the value of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">C</span></span><span class="antiquote">}</span></span> by letting the radius tend to 0 so that the contribution
     of the circle vanishes.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="bound">r</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span>  <span class="main">+</span> <span class="main">(</span><span class="free">err1</span> <span class="skolem">s</span> <span class="bound">r</span> <span class="main">-</span> <span class="free">err2</span> <span class="skolem">s</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span>
             <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> tendsto_set_lebesgue_integral_at_right integrable<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> hurwitz_formula_bound2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> C1 <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> C1 <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> hurwitz_formula_bound2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">s</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> C2 <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> C2 <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">2</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_at_right_real<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="free">err1</span> <span class="skolem">s</span> <span class="bound">r</span> <span class="main">-</span> <span class="free">err2</span> <span class="skolem">s</span> <span class="bound">r</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_null_comparison<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">err1</span> <span class="skolem">s</span> <span class="skolem">r</span> <span class="main">-</span> <span class="free">err2</span> <span class="skolem">s</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="free">err1</span> <span class="skolem">s</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="free">err2</span> <span class="skolem">s</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_triangle_ineq4<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">err1</span> <span class="skolem">s</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C1</span> <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> Re <span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">*</span> <span class="main">¦</span><span class="main">0</span> <span class="main">-</span> pi<span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> err1_def <span class="keyword1"><span class="command">using</span></span> C1<span class="main">(</span>1<span class="main">)</span> C1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> pi_gt3 integrable_circle<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
          path_image_part_circlepath_subset'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted">pi</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> r
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> contour_integral_bound_part_circlepath<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">C1</span> <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">using</span></span> r
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">err2</span> <span class="skolem">s</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C2</span> <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> Re <span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">*</span> <span class="main">¦</span><span class="main">0</span> <span class="main">-</span> pi<span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> err2_def complex_mod_cnj <span class="keyword1"><span class="command">using</span></span> C2<span class="main">(</span>1<span class="main">)</span> C2<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> r
          pi_gt3 integrable_circle'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> path_image_part_circlepath_subset'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted">pi</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> contour_integral_bound_part_circlepath<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">C2</span> <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">using</span></span> r
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">+</span> <span class="skolem">C2</span> <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">=</span>
                   <span class="main">(</span><span class="skolem">C1</span> <span class="main">+</span> <span class="skolem">C2</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">err1</span> <span class="skolem">s</span> <span class="skolem">r</span> <span class="main">-</span> <span class="free">err2</span> <span class="skolem">s</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">C1</span> <span class="main">+</span> <span class="skolem">C2</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">powr</span> <span class="main">-</span> Re <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C1</span> <span class="main">+</span> <span class="skolem">C2</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> Re <span class="skolem">s</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">2</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_at_right_real<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="bound">r</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span>
           <span class="main">(</span><span class="free">err1</span> <span class="skolem">s</span> <span class="bound">r</span> <span class="main">-</span> <span class="free">err2</span> <span class="skolem">s</span> <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> eq <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="bound">r</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span>  <span class="main">+</span> <span class="main">(</span><span class="free">err1</span> <span class="skolem">s</span> <span class="bound">r</span> <span class="main">-</span> <span class="free">err2</span> <span class="skolem">s</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="skolem">C</span><span class="main">)</span>
            <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tendsto_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="comment1">―‹We now rearrange everything and obtain the result.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="free">err2</span> <span class="skolem">s</span> <span class="free">r</span> <span class="main">-</span> <span class="free">err1</span> <span class="skolem">s</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>pi<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="free">r</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">r</span><span class="main">..</span>pi<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r pi_gt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">…</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..</span>pi<span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r pi_gt3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_integral_Un<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ integrable integrable<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="free">r</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r pi_gt3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_integral_Un<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ integrable integrable<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="free">r</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">r</span><span class="main">..}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> Gamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Gamma_times_hurwitz_zeta_integral<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> s a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def exp_of_real exp_minus integral_completion set_lebesgue_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> Gamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>
                  <span class="free">err2</span> <span class="skolem">s</span> <span class="free">r</span> <span class="main">-</span> <span class="free">err1</span> <span class="skolem">s</span> <span class="free">r</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> Gamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> pi <span class="main">*</span> rGamma <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Gamma_reflection_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> sin_eq_0 Ints_def rGamma_inverse_Gamma mult_ac <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rGamma <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rGamma_eq_zero_iff nonpos_Ints_def Ints_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sin_eq_0<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> rGamma <span class="skolem">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>
                  <span class="free">err2</span> <span class="skolem">s</span> <span class="free">r</span> <span class="main">-</span> <span class="free">err1</span> <span class="skolem">s</span> <span class="free">r</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">―‹By analytic continuation, we lift the result to the case of any non-zero <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">s</span></span><span class="antiquote">}</span></span>.›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> rGamma <span class="bound">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">err2</span> <span class="bound">s</span> <span class="free">r</span> <span class="main">-</span> <span class="free">err1</span> <span class="bound">s</span> <span class="free">r</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">*</span> <span class="bound">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">s</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
           <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">err2</span> <span class="bound">s</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">-</span> cnj <span class="main">(</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="free">h</span> <span class="free">r</span> <span class="main">(</span>cnj <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> err2_def contour_integral_part_circlepath_reverse'
                    contour_integral_part_circlepath_h<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">-</span> cnj <span class="main">(</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="free">h</span> <span class="free">r</span> <span class="main">(</span>cnj <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="free">r</span> <span class="bound">s</span> <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_cnj h_def exp_cnj cis_cnj Ln_Reals_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> integral <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span><span class="main">0</span><span class="main">}</span> <span class="main">(</span><span class="free">h</span> <span class="free">r</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Henstock_Kurzweil_Integration.integral_reflect_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">err2</span> <span class="bound">s</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> integral <span class="main">{</span><span class="main">-</span>pi<span class="main">..</span><span class="main">0</span><span class="main">}</span> <span class="main">(</span><span class="free">h</span> <span class="free">r</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_h_holomorphic<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">err2</span> <span class="bound">s</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">-</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="free">h</span> <span class="free">r</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> integral_h_holomorphic<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">-</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>pi<span class="main">}</span> <span class="main">(</span><span class="free">h</span> <span class="free">r</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">err1</span> <span class="bound">s</span> <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> err1_def <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contour_integral_part_circlepath_reverse' contour_integral_part_circlepath_h<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">err1</span> <span class="bound">s</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">s</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_on_balls_imp_entire'<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="main">::</span> <span class="quoted">real</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">&gt;</span> <span class="free">r</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_gt_at_top<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> continuous_on <span class="main">(</span>cball <span class="main">0</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                                <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">s</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> ball <span class="main">0</span> <span class="skolem">R</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">b</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> r
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> borel_integrable_atLeastAtMost' <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> integral <span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> r
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_g_holomorphic<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> integral <span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">s</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext set_borel_integral_eq_integral<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> integrable<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">holomorphic_on</span> UNIV"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> holomorphic_on_imp_continuous_on<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"uniform_limit <span class="main">(</span>cball <span class="main">0</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">s</span> <span class="bound">x</span><span class="main">)</span>
                 <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">s</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> uniform_limit_set_lebesgue_integral_at_top<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
        <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> cball <span class="main">0</span> <span class="skolem">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span>Re <span class="skolem">s</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x r
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def norm_mult norm_divide in_Reals_norm norm_powr_real_powr<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="skolem">R</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r s x abs_Re_le_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono divide_right_mono powr_mono<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="skolem">R</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">r</span><span class="main">..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">R</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> r a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integrable_Gamma_hurwitz_aux2_real<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def g_def<span class="main">)</span>
  
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="free">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">s</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> ball <span class="main">0</span> <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> holomorphic_uniform_limit<span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="keyword3">,</span></span> 
     <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> connected_punctured_universe open_halfspace_Re_lt <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finally, we obtain Hurwitz's formula by letting the radius of the outer circle tend to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∞›</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Zeta_Function-hurwitz_zeta_formula_aux"><span class="command">lemma</span></span> hurwitz_zeta_formula_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rGamma <span class="free">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> 
                  <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="free">a</span> <span class="free">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> <span class="free">F</span> <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bigc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bigc</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="main">(</span><span class="skolem">R</span> <span class="bound">n</span><span class="main">)</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span>
                                 cnj <span class="main">(</span>contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="main">(</span><span class="skolem">R</span> <span class="bound">n</span><span class="main">)</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">smallc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">smallc</span> <span class="main">=</span> contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r</span> pi <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> 
                                cnj <span class="main">(</span>contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r</span> pi <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="skolem">r</span><span class="main">..</span><span class="skolem">R</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="free">s</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">F2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">F1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">F2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> exp <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">n</span> <span class="main">≥</span> pi"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>pi <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pi_gt_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword1"><span class="command">have</span></span> integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="skolem">A</span> <span class="main">(</span><span class="free">g</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> sets lborel"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">r</span><span class="main">..}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="skolem">r</span><span class="main">..}</span> <span class="main">(</span><span class="free">g</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_integrable_Gamma_hurwitz_aux2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> a r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def exp_of_real exp_minus<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">from</span></span> hurwitz_formula_integral_semiannulus<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> r R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span> <span class="keyword1">contour_integrable_on</span> part_circlepath <span class="main">0</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">0</span> pi"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hankel_semiannulus_def R_def add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> integrable_circle <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">from</span></span> hurwitz_formula_integral_semiannulus<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"cnj <span class="free">s</span>"</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> r R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span> <span class="keyword1">contour_integrable_on</span> part_circlepath <span class="main">0</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">0</span> pi"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hankel_semiannulus_def R_def add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> integrable_circle' <span class="main">=</span> this

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span>
            integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
            contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span>
            contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r</span> pi <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> cnj <span class="main">(</span>
           exp <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> cnj <span class="free">s</span><span class="main">)</span> <span class="main">*</span> integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
            integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>cnj <span class="free">s</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
            contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
            contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r</span> pi <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">s</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">Res</span> <span class="free">s</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span>
             cnj <span class="main">(</span><span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> cnj <span class="free">s</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">Res</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> R_def g_def <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> hurwitz_formula_integral_semiannulus<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">Res</span> <span class="free">s</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span>
                                     exp <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">Res</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_cnj sum.distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum_distrib_left sum_distrib_right sum_negf<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">Res</span> <span class="free">s</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">k</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?S1</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Res_def powr_times_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">Res</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">k</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Res_def cnj_powr powr_times_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span> exp_cnj sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="var">?S1</span> <span class="main">+</span> exp <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span>
                 <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span>
                   <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">k</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    exp <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">k</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">I</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_borel_integral_eq_integral<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> integrable<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="free">g</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">unfolding</span></span> integral_cnj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def cnj_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> cnj <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> cnj <span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             integral <span class="main">{</span><span class="skolem">r</span><span class="main">..</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> of_real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> I_def g_def <span class="keyword1"><span class="command">using</span></span> r R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_cong<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cnj_powr<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">s</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">-</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">s</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">I</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">bigc</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">smallc</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_cnj cnj_powr <span class="dynamic"><span class="dynamic">algebra_simps</span></span> exp_cnj
                    bigc_def smallc_def g_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">s</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">-</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">s</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_exp_eq' <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="skolem">I</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">smallc</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">bigc</span> <span class="skolem">n</span> <span class="main">=</span> 
                    <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">F1</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">F2</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F1_F2_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> eq <span class="main">=</span> this

  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="skolem">I</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">smallc</span> <span class="main">+</span> <span class="skolem">bigc</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span>
           <span class="main">(</span><span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="skolem">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="free">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">smallc</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> I_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_set_lebesgue_integral_at_top<span class="main"><span class="main">]</span></span> integrable<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">R</span> at_top sequentially"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_at_top_mult_tendsto_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span> pi_gt_zero
                filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_real_sequentially<span class="main"><span class="main">]</span></span> filterlim_subseq<span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_Suc_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> hurwitz_formula_bound1<span class="main">[</span><span class="operator">OF</span> pi_gt_zero<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> C <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> C <span class="main">=</span> this
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="skolem">C</span> <span class="main">*</span> exp <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>Im <span class="free">s</span><span class="main">¦</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bigc</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_null_comparison<span class="main"><span class="main">[</span></span><span class="operator">OF</span> always_eventually<span class="main"><span class="main">[</span></span><span class="operator">OF</span> allI<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">have</span></span> bound<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">s'</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">D</span> <span class="main">*</span> <span class="skolem">R</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="skolem">s'</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> sphere <span class="main">0</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s'</span> <span class="main">=</span> Re <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Im <span class="skolem">s'</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>Im <span class="free">s</span><span class="main">¦</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> <span class="skolem">s'</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> z <span class="keyword2"><span class="keyword">and</span></span> r R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> not_in_ball<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> ball <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> pi"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">int</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">z</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">≥</span> <span class="main">¦</span>dist <span class="skolem">z</span> <span class="main">0</span> <span class="main">-</span> dist <span class="main">0</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">¦</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_dist_diff_le<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">0</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">*</span> pi"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> z <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">z</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">n</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">*</span> pi <span class="main">=</span> <span class="main">(</span>int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span><span class="main">)</span> <span class="main">*</span> pi"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">…</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span><span class="main">¦</span> <span class="main">*</span> pi"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> abs_mult<span class="main">)</span> <span class="operator">simp_all</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">*</span> pi <span class="main">≥</span> <span class="main">1</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">s'</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> norm <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">Ln'</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span>exp <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def exp_diff norm_mult norm_divide mult_ac exp_minus norm_inverse
                        <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> norm_exp_eq_Re<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">Ln'</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_in_ball
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono C<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">Ln'</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                     exp <span class="main">(</span>Im <span class="skolem">s'</span> <span class="main">*</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span>Re <span class="skolem">s'</span> <span class="main">*</span> ln <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> z r R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> pi_gt_zero
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln'_def norm_mult norm_divide exp_add exp_diff exp_minus
                        norm_inverse <span class="dynamic"><span class="dynamic">algebra_simps</span></span> inverse_eq_divide<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> exp <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>Im <span class="skolem">s'</span><span class="main">¦</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span>Re <span class="skolem">s'</span> <span class="main">*</span> ln <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> exp_le_cancel_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">s'</span> <span class="main">*</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">¦</span>Im <span class="skolem">s'</span> <span class="main">*</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">¦</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_ge_self<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">¦</span>Im <span class="skolem">s'</span><span class="main">¦</span> <span class="main">*</span> <span class="main">(</span>pi <span class="main">+</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> abs_mult <span class="keyword1"><span class="command">using</span></span> mpi_less_Im_Ln<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span><span class="main">]</span> Im_Ln_le_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs_triangle_ineq<span class="main"><span class="main">]</span></span> add_mono<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">s'</span> <span class="main">*</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>Im <span class="skolem">s'</span><span class="main">¦</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span>Re <span class="skolem">s'</span> <span class="main">*</span> ln <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">R</span> <span class="skolem">n</span> <span class="keyword1">powr</span> Re <span class="skolem">s'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> r R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="skolem">s'</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">D</span> <span class="main">*</span> <span class="skolem">R</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">≥</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  that D_def powr_minus mult_right_mono mult_left_mono <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">bigc</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span>contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              norm <span class="main">(</span>cnj <span class="main">(</span>contour_integral <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>cnj <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> norm <span class="var">?err1</span> <span class="main">+</span> norm <span class="var">?err2</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> bigc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_triangle_ineq4<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?err1</span> <span class="main">≤</span> <span class="skolem">D</span> <span class="main">*</span> <span class="skolem">R</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">R</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">¦</span>pi <span class="main">-</span> <span class="main">0</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> r R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> pi_gt3 <span class="keyword2"><span class="keyword">and</span></span> integrable_circle <span class="keyword2"><span class="keyword">and</span></span>
              path_image_part_circlepath_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted">pi</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> bound<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> contour_integral_bound_part_circlepath<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">D</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">R</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> pi_gt3
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="var">?err2</span> <span class="main">≤</span> <span class="skolem">D</span> <span class="main">*</span> <span class="skolem">R</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>Re <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">R</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">¦</span>pi <span class="main">-</span> <span class="main">0</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> complex_mod_cnj
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> r R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> pi_gt3 <span class="keyword2"><span class="keyword">and</span></span> integrable_circle'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
              path_image_part_circlepath_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted">pi</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> bound<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"cnj <span class="free">s</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> contour_integral_bound_part_circlepath<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">D</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">R</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> pi_gt3
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">bigc</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">D</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">R</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="free">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">R</span> at_top at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">D</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">D</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">unfolding</span></span> R_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> tendsto_neg_powr<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">D</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="skolem">I</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">smallc</span> <span class="main">+</span> <span class="skolem">bigc</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">F1</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">F2</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eq<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="skolem">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="free">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">smallc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">F1</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">F2</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span>
                   <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> 
                   <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="free">a</span> <span class="free">s</span> <span class="main">+</span> exp <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F1_F2_def F_def <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> sum_tendsto_fds_perzeta<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> 
                       <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="free">a</span> <span class="free">s</span> <span class="main">+</span> exp <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
                     <span class="main">(</span><span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">CLBINT</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="skolem">r</span><span class="main">..}</span><span class="main">.</span> <span class="free">g</span> <span class="free">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">smallc</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tendsto_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi <span class="main">*</span> rGamma <span class="free">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s r a
    <span class="keyword1"><span class="command">using</span></span> rGamma_hurwitz_zeta_eq_contour_integral<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def smallc_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span> <span class="free">s</span> <span class="main">*</span> complex_of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="free">s</span> <span class="main">*</span> complex_of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rGamma <span class="free">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> 
                  <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="free">a</span> <span class="free">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> <span class="free">F</span> <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now use Hurwitz's formula to prove the following nice formula that expresses the periodic 
  zeta function in terms of the Hurwitz zeta function:
  \[F(s, a) = (2\pi)^{s-1} i \Gamma(1 - s)
                \left(i^{-s} \zeta(1 - s, a) - i^{s} \zeta(1 - s, 1 - a)\right)\]
  This holds for all <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span> with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>\mathfrak{R}(s) &gt; 0›</span></span></span></span> as long as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a ∉ ℤ›</span></span></span></span>. For convenience, we
  move the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Γ›</span></span></span></span> function to the left-hand side in order to avoid having to account for its poles.
›</span></span>
<span class="keyword1" id="Zeta_Function-perzeta_conv_hurwitz_zeta_aux"><span class="command">lemma</span></span> perzeta_conv_hurwitz_zeta_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rGamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> eval_fds <span class="main">(</span>fds_perzeta <span class="free">a</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span>
             <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span>
              <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="free">s</span> <span class="main">=</span> <span class="var">?rhs</span> <span class="free">s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> convex_connected convex_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> rGamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span> <span class="main">*</span> eval_fds <span class="main">(</span>fds_perzeta <span class="free">a</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> perzeta_def <span class="keyword1"><span class="command">using</span></span> a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv_abscissa_perzeta'<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">s</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_perzeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> fds_perzeta <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fds_perzeta.plus_of_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fds_perzeta <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> fds_perzeta <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fds_perzeta.minus_of_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Gamma <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Gamma_eq_zero_iff <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Ints_cases<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>rGamma <span class="skolem">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                              <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span>rGamma <span class="skolem">s</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>rGamma <span class="skolem">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                               <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>rGamma <span class="skolem">s</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>
          eval_fds <span class="main">(</span>fds_perzeta <span class="free">a</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
          eval_fds <span class="main">(</span>fds_perzeta <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> hurwitz_zeta_formula_aux<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> complex_of_real pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> exp <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> complex_of_real pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def exp_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_eq_polar<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def exp_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def exp_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> cos <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def cos_exp_eq <span class="dynamic"><span class="dynamic">algebra_simps</span></span> minus_divide_left cos_sin_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span>pi <span class="main">-</span> <span class="skolem">s</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cos_sin_eq <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">s</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>rGamma <span class="skolem">s</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">-</span>
                     rGamma <span class="skolem">s</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">s</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> eval_fds <span class="main">(</span>fds_perzeta <span class="free">a</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span>
           <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">-</span>
            <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         Gamma <span class="skolem">s</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">s</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> eval_fds <span class="main">(</span>fds_perzeta <span class="free">a</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> rGamma_inverse_Gamma<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="skolem">s</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">s</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> pi <span class="main">*</span> rGamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Gamma_reflection_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> rGamma_inverse_Gamma mult_ac <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="skolem">s</span> <span class="main">=</span> <span class="var">?rhs</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> s<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now use the above equation as a defining equation to continue the periodic
  zeta function $F$ to the entire complex plane except at non-negative integer values for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span>.
  However, the positive integers are already covered by the original Dirichlet series definition
  of $F$, so we only need to take care of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s = 0›</span></span></span></span>. We do this by cancelling the pole of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Γ›</span></span></span></span> at <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>0›</span></span></span></span>
  with the zero of $i^{-s} \zeta(1 - s, a) - i^s \zeta(1 - s, 1 - a)$.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q'</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   holomorphic_perzeta'<span class="main">:</span> <span class="quoted"><span class="quoted">"perzeta <span class="free">q'</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   perzeta_altdef2<span class="main">:</span>   <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> perzeta <span class="free">q'</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_perzeta <span class="free">q'</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> frac <span class="free">q'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q_def frac_lt_1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"frac <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> complex_of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> Gamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span> <span class="main">*</span>
                        <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="bound">s</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="skolem">q</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span> <span class="main">-</span>
                         <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="bound">s</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="main">ℤ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span> <span class="main">=</span> of_int <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Ints_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> of_int <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Nats_altdef1 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">ℕ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def Nats_altdef2 nonpos_Ints_altdef not_le <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> perzeta <span class="skolem">q</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">ℕ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perzeta_def Let_def f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> holo<span class="main">:</span> <span class="quoted"><span class="quoted">"perzeta <span class="skolem">q</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">ℕ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> f_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_perzeta <span class="skolem">q</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> <span class="main">ℕ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">using</span></span> perzeta_conv_hurwitz_zeta_aux<span class="main">[</span><span class="operator">OF</span> q<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> that *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rGamma_inverse_Gamma Gamma_eq_zero_iff <span class="dynamic"><span class="dynamic">divide_simps</span></span> f_def perzeta_def
             <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perzeta <span class="free">q'</span> <span class="skolem">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_perzeta <span class="free">q'</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">using</span></span> f_altdef<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> that assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def perzeta_def Let_def q_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>perzeta <span class="skolem">q</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> of_nat <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nats_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="main">ℕ</span> <span class="main">-</span> <span class="main">{</span>of_nat <span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Nats_subset_Ints
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> open_Diff closed_subset_Ints open_halfspace_Re_gt<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="main">ℕ</span> <span class="main">-</span> <span class="main">{</span>of_nat <span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">(</span>of_nat <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open *<span class="main">)</span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">hence</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eval_fds <span class="main">(</span>fds_perzeta <span class="skolem">q</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> perzeta <span class="skolem">q</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">(</span>of_nat <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">s</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> q f_altdef<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perzeta_def dist_of_nat f_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nats_cases Ints_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>eval_fds <span class="main">(</span>fds_perzeta <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_nat <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_eval_fds le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv_abscissa_perzeta'<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> isCont <span class="main">(</span>perzeta <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>of_nat <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ev
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> isCont_cong ev<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Complex <span class="main">(</span>ln <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span>pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> Complex <span class="main">(</span>ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> <span class="main">ℕ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_topological <span class="keyword1"><span class="command">using</span></span> Nats_subset_Ints
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">ℕ</span><span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> conjI open_Compl closed_subset_Ints<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> perzeta <span class="skolem">q</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> Gamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span>
                 <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="bound">s</span> <span class="main">*</span> pre_zeta <span class="skolem">q</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span> <span class="main">-</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="bound">s</span> <span class="main">*</span> pre_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span> <span class="main">+</span>
                 <span class="main">(</span>exp <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span> <span class="main">-</span> exp <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>complex<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">_</span> <span class="main">=</span> <span class="var">?f</span> <span class="bound">s</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">s</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perzeta <span class="skolem">q</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> Gamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span>
              <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="skolem">q</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">-</span>
               <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">*</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perzeta_def powr_diff powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> pre_zeta <span class="skolem">q</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> pre_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span>
                      <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elim
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hurwitz_zeta_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">=</span> exp <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def exp_add <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Ln_Reals_eq Complex_eq b_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">=</span> exp <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def exp_add Ln_Reals_eq exp_diff exp_minus diff_divide_distrib 
                      ring_distribs inverse_eq_divide mult_ac Complex_eq a_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>pi <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pi_gt_zero <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_le<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span> <span class="keyword1">else</span> <span class="main">(</span>exp <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span> <span class="main">-</span> exp <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="bound">s</span><span class="main">)</span>
                <span class="keyword1">has_fps_expansion</span> <span class="main">(</span>fps_exp <span class="skolem">b</span> <span class="main">-</span> fps_exp <span class="skolem">a</span><span class="main">)</span> <span class="main">/</span> fps_X"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f'</span> <span class="keyword1">has_fps_expansion</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">fps_expansion_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> subdegree_geI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ln_Reals_eq a_def b_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"isCont <span class="var">?f'</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_fps_expansion_imp_continuous<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f'</span> <span class="main">─</span><span class="main">0</span><span class="main">→</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isCont_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>exp <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span> <span class="main">-</span> exp <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="bound">s</span><span class="main">)</span> <span class="main">─</span><span class="main">0</span><span class="main">→</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">─</span><span class="main">0</span><span class="main">→</span> of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> Gamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span>
                    <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">0</span> <span class="main">*</span> pre_zeta <span class="skolem">q</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span> <span class="main">-</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">0</span> <span class="main">*</span> pre_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">_</span> <span class="main">(</span>nhds <span class="var">?c</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> isContD<span class="main">)</span>
                 <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">=</span> perzeta <span class="skolem">q</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus perzeta_def Ln_Reals_eq a_def b_def
                    Complex_eq mult_ac inverse_eq_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">─</span><span class="main">0</span><span class="main">→</span> <span class="main">…</span> <span class="main">⟷</span> perzeta <span class="skolem">q</span> <span class="main">─</span><span class="main">0</span><span class="main">→</span> <span class="main">…</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> filterlim_cong refl ev<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>perzeta <span class="skolem">q</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isCont_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perzeta <span class="skolem">q</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> holo <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perzeta <span class="skolem">q</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="skolem">s</span> <span class="keyword1">within</span> <span class="main">-</span><span class="main">ℕ</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> holomorphic_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="skolem">s</span> <span class="keyword1">within</span> <span class="main">-</span><span class="main">ℕ</span> <span class="main">=</span> <span class="keyword1">at</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> at_within_open<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"perzeta <span class="skolem">q</span> <span class="keyword1">holomorphic_on</span> <span class="main">(</span>ball <span class="skolem">s</span> <span class="main">1</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> holo<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nats_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_of_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perzeta <span class="skolem">q</span> <span class="keyword1">holomorphic_on</span> ball <span class="skolem">s</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cont True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> no_isolated_singularity'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> at_within_open<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"ball <span class="skolem">s</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span> isCont_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"perzeta <span class="skolem">q</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="skolem">s</span> <span class="keyword1">within</span> ball <span class="skolem">s</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> holomorphic_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> at_within_open<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"ball <span class="skolem">s</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"perzeta <span class="skolem">q</span> <span class="keyword1">holomorphic_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> holomorphic_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perzeta <span class="skolem">q</span> <span class="main">=</span> perzeta <span class="free">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perzeta <span class="free">q'</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-perzeta_altdef1"><span class="command">lemma</span></span> perzeta_altdef1<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> perzeta <span class="free">q'</span> <span class="free">s</span> <span class="main">=</span> eval_fds <span class="main">(</span>fds_perzeta <span class="free">q'</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q'</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perzeta_int eval_fds_zeta fds_perzeta_int perzeta_altdef2<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-holomorphic_perzeta"><span class="command">lemma</span></span> holomorphic_perzeta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∉</span> <span class="main">ℤ</span> <span class="main">∨</span> <span class="main">1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> perzeta <span class="free">q</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perzeta_int <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> holomorphic_perzeta' holomorphic_zeta<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-holomorphic_perzeta''"><span class="command">lemma</span></span> holomorphic_perzeta'' <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∉</span> <span class="main">ℤ</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> perzeta <span class="free">q</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perzeta <span class="free">q</span> <span class="main">∘</span> <span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_compose holomorphic_perzeta<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Using this analytic continuation of the periodic zeta function, Hurwitz's formula now
  holds (almost) on the entire complex plane.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> hurwitz_zeta_formula<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rGamma <span class="free">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">*</span> perzeta <span class="free">a</span> <span class="free">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> perzeta <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="free">s</span> <span class="main">=</span> <span class="var">?g</span> <span class="free">s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> UNIV <span class="main">-</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="main">0</span> <span class="main">::</span> complex<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="keyword1">holomorphic_on</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">holomorphic_on</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def minus_in_Ints_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">s</span> <span class="main">=</span> <span class="var">?g</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hurwitz_zeta_formula_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perzeta_altdef1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt A_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases
                           <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> connected_open_delete_finite exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The equation expressing the periodic zeta function in terms of the Hurwitz zeta function
  can be extened similarly.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> perzeta_conv_hurwitz_zeta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rGamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> perzeta <span class="free">a</span> <span class="free">s</span> <span class="main">=</span>
             <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span>
                                         <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="free">s</span> <span class="main">=</span> <span class="var">?g</span> <span class="free">s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">holomorphic_on</span> <span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">s</span> <span class="main">=</span> <span class="var">?g</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> perzeta_conv_hurwitz_zeta_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perzeta_altdef1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt connected_punctured_universe <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  As a simple corollary, we derive the reflection formula for the Riemann zeta function:
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> zeta_reflect<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rGamma <span class="free">s</span> <span class="main">*</span> zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> cos <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> zeta <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hurwitz_zeta_formula<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_def cos_exp_eq powr_def perzeta_int <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_reflect'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rGamma <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> zeta <span class="free">s</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">s</span> <span class="main">*</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zeta_reflect<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="free">s</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cos_sin_eq <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It is now easy to see that all the non-trivial zeroes of the Riemann zeta function must lie
  the critical strip $(0;1)$, and they must be symmetric around the
  $\mathfrak{R}(z) = \frac{1}{2}$ line.
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> zeta_zeroD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"zeta <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> even <span class="bound">n</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> <span class="main">-</span>real <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">≤</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> zeta_Re_ge_1_nonzero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> even <span class="bound">n</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">-</span>real <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> of_int <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">int</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> of_int <span class="skolem">n</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>int"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="skolem">n</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> even_nat_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">-</span>real <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span>of_nat <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zeta <span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>bernoulli' <span class="main">(</span>Suc <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> zeta_neg_of_nat<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bernoulli' <span class="main">(</span>Suc <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> False <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bernoulli'_zero_iff even_nat_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms True<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rGamma <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rGamma_eq_zero_iff nonpos_Ints_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zeta_reflect<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> True zeta_Re_ge_1_nonzero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="free">s</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-zeta_zero_reflect"><span class="command">lemma</span></span> zeta_zero_reflect<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"zeta <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rGamma <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rGamma_eq_zero_iff <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Ints_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> zeta_reflect<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_zero_reflect_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"zeta <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> zeta <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zeta_zero_reflect<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> zeta_zero_reflect<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="free">s</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More functional equations›</span></span>

<span class="keyword1" id="Zeta_Function-perzeta_conv_hurwitz_zeta_multiplication"><span class="command">lemma</span></span> perzeta_conv_hurwitz_zeta_multiplication<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> perzeta <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">a</span> <span class="main">/</span> <span class="free">k</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="free">s</span> <span class="main">=</span> <span class="var">?rhs</span> <span class="free">s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation_open<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?f</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?g</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">(</span><span class="main">-</span><span class="main">{</span><span class="main">1</span><span class="main">::</span>complex<span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> connected_punctured_universe<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">a</span> <span class="main">/</span> <span class="free">k</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="skolem">s</span> <span class="main">=</span> <span class="var">?rhs</span> <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_unique2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="bound">m</span> <span class="main">+</span> of_real <span class="main">(</span>real <span class="bound">n</span> <span class="main">/</span> real <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">sums</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span>real <span class="bound">n</span> <span class="main">/</span> real <span class="free">k</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_sum sums_mult sums_hurwitz_zeta<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="bound">m</span> <span class="main">+</span> of_real <span class="main">(</span>real <span class="bound">n</span> <span class="main">/</span> real <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> of_nat <span class="free">k</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_distrib_left
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_nonneg_pos<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">0</span> <span class="main">≠</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_nat_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="skolem">m</span> <span class="main">*</span> of_nat <span class="free">k</span> <span class="main">+</span> <span class="main">(</span>of_nat <span class="skolem">n</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">m</span> <span class="main">+</span> of_real <span class="main">(</span>real <span class="skolem">n</span> <span class="main">/</span> real <span class="free">k</span><span class="main">)</span> <span class="main">=</span> 
              <span class="main">(</span>inverse <span class="main">(</span>of_nat <span class="free">k</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="comment1">(* TODO: Field_as_Ring messing up things again *)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self1 div_mult_self2 div_mult_self3 div_mult_self4<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> nz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span> <span class="main">=</span> of_nat <span class="free">k</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_times_real<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_eq_0_iff powr_def exp_minus Ln_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span>real <span class="bound">n</span> <span class="main">/</span> real <span class="free">k</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span>real_of_int <span class="free">a</span> <span class="main">/</span> real <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="main">(</span>fds_perzeta <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_fds_perzeta<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> g_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span>fds_perzeta <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> perzeta <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perzeta_altdef1<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="bound">m</span><span class="main">*</span><span class="free">k</span><span class="main">..&lt;</span><span class="bound">m</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="free">k</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">sums</span> perzeta <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_group<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="bound">m</span><span class="main">*</span><span class="free">k</span><span class="main">..&lt;</span><span class="bound">m</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="free">k</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">m</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Suc <span class="bound">n</span> <span class="main">-</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">k</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">n</span> <span class="main">=</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ring_distribs add_divide_distrib exp_add mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cis <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_eq_polar mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cis_multiple_2pi<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> of_nat <span class="free">k</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="bound">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span>
                    <span class="main">(</span>of_nat <span class="free">k</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">*</span> perzeta <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> <span class="quasi_keyword">simp</span><span class="main">:</span> finite_imp_closed open_halfspace_Re_gt›</span><span class="main">)</span>

<span class="keyword1" id="Zeta_Function-perzeta_conv_hurwitz_zeta_multiplication'"><span class="command">lemma</span></span> perzeta_conv_hurwitz_zeta_multiplication'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"perzeta <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">a</span> <span class="main">/</span> <span class="free">k</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> perzeta_conv_hurwitz_zeta_multiplication<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Zeta_Function-zeta_conv_hurwitz_zeta_multiplication"><span class="command">lemma</span></span> zeta_conv_hurwitz_zeta_multiplication<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> zeta <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> hurwitz_zeta <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> perzeta_conv_hurwitz_zeta_multiplication<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perzeta_int<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-hurwitz_zeta_one_half_left"><span class="command">lemma</span></span> hurwitz_zeta_one_half_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"hurwitz_zeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> zeta <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zeta_conv_hurwitz_zeta_multiplication<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral zeta_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> hurwitz_zeta_functional_equation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∉</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≡</span> real <span class="free">h</span> <span class="main">/</span> real <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rGamma <span class="free">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
           <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> cos <span class="main">(</span><span class="free">s</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="bound">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> hk <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rGamma <span class="free">s</span> <span class="main">*</span> hurwitz_zeta <span class="free">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">*</span> perzeta <span class="free">a</span> <span class="free">s</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> perzeta <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> hurwitz_zeta_formula<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">s</span> <span class="main">*</span> perzeta <span class="main">(</span>of_int <span class="main">(</span>int <span class="free">h</span><span class="main">)</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span> <span class="main">+</span>
                                       <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> perzeta <span class="main">(</span>of_int <span class="main">(</span><span class="main">-</span>int <span class="free">h</span><span class="main">)</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span>
     <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> cis <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">h</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span>
       <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free">s</span>  <span class="main">*</span> cis <span class="main">(</span><span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">h</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">*</span> <span class="main">(</span><span class="var">?S1</span> <span class="main">+</span> <span class="var">?S2</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> hk a s
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> perzeta_conv_hurwitz_zeta_multiplication'<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> sum_distrib_left sum_distrib_right exp_eq_polar<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">k</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hk pi_gt_zero
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def Ln_times_Reals <span class="dynamic"><span class="dynamic">field_simps</span></span> exp_add exp_diff exp_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S1</span> <span class="main">+</span> <span class="var">?S2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> cis <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="bound">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> cis <span class="main">(</span><span class="main">-</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="bound">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                                    hurwitz_zeta <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">_</span><span class="main">.</span> <span class="var">?c</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">_</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum.distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> cos <span class="main">(</span><span class="free">s</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="bound">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> cis <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="skolem">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="main">-</span><span class="free">s</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">*</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="skolem">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> exp_add <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def cis_conv_exp mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">*</span> cis <span class="main">(</span><span class="main">-</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="skolem">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="free">s</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">*</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="skolem">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> exp_add <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def cis_conv_exp mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="skolem">n</span> <span class="main">=</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="skolem">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="skolem">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac ring_distribs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> cos <span class="main">(</span><span class="free">s</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="skolem">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cos_exp_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="skolem">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> cos <span class="main">(</span><span class="free">s</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="skolem">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">k</span> <span class="main">*</span> pi<span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">…</span> <span class="bound">n</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
               <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">s</span> <span class="main">*</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> cos <span class="main">(</span><span class="free">s</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="bound">n</span><span class="main">*</span><span class="free">h</span><span class="main">/</span><span class="free">k</span><span class="main">)</span> <span class="main">*</span> hurwitz_zeta <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> <span class="free">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left sum_distrib_right mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Function-perzeta_one_half_left"><span class="command">lemma</span></span> perzeta_one_half_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">⟹</span> perzeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> zeta <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> perzeta_conv_hurwitz_zeta_multiplication'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral hurwitz_zeta_one_half_left powr_minus
                <span class="dynamic"><span class="dynamic">field_simps</span></span> zeta_def powr_diff<span class="main">)</span>

<span class="keyword1" id="Zeta_Function-perzeta_one_half_left'"><span class="command">lemma</span></span> perzeta_one_half_left'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"perzeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span>
         <span class="main">(</span><span class="keyword1">if</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">-</span>ln <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pre_zeta <span class="main">1</span> <span class="free">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perzeta_one_half_left <span class="dynamic"><span class="dynamic">field_simps</span></span> zeta_def hurwitz_zeta_def<span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Zeta_Laurent_Expansion">
<div class="head">
<h1>Theory Zeta_Laurent_Expansion</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Laurent series expansion of $\zeta$ at 1›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Zeta_Laurent_Expansion
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Zeta_Function.html">Zeta_Function</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we shall derive the Laurent series expansion of $\zeta(s)$ at $s = 1$, which
  is of the form 
    \[\zeta(s) = \frac{1}{s-1} + \sum_{n=0}^\infty \frac{(-1)^n\,\gamma_n}{n!} (s-1)^n\]
  where the $\gamma_n$ are the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹Stieltjes constants›</span></span>. Notably, $\gamma_0$ is equal to
  the Euler--Mascheroni constant $\gamma$.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of the Stieltjes constants›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define the Stieltjes constants by their infinite series form, since it is fairly
  easy to show the convergence of the series by the comparison test.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span><span class="main">%</span>important <span class="entity">stieltjes_gamma</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> real_algebra_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stieltjes_gamma</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span>
     of_real <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Zeta_Laurent_Expansion-stieltjes_gamma_0"><span class="command">lemma</span></span> stieltjes_gamma_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"stieltjes_gamma <span class="main">0</span> <span class="main">=</span> euler_mascheroni"</span></span>
  <span class="keyword1"><span class="command">using</span></span> euler_mascheroni_sum_real <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff stieltjes_gamma_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Zeta_Laurent_Expansion-stieltjes_gamma_summable"><span class="command">lemma</span></span> stieltjes_gamma_summable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"summable <span class="var">?f</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_bigo<span class="main">)</span>
  <span class="comment1">(* TODO: good real_asymp example *)</span>
  <span class="comment1">(* TODO: investigate how to make this more automatic *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>inverse <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
           inverse <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_real_powr_iff<span class="main">)</span>

<span class="keyword1" id="Zeta_Laurent_Expansion-of_real_stieltjes_gamma"><span class="command">lemma</span></span> of_real_stieltjes_gamma <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span>stieltjes_gamma <span class="free">k</span><span class="main">)</span> <span class="main">=</span> stieltjes_gamma <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stieltjes_gamma_def<span class="main">)</span>

<span class="keyword1" id="Zeta_Laurent_Expansion-sums_stieltjes_gamma"><span class="command">lemma</span></span> sums_stieltjes_gamma<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">sums</span> stieltjes_gamma <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> stieltjes_gamma_summable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> stieltjes_gamma_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_sums<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now derive the alternative definition of the Stieltjes constants as a limit.
  This limit can also be written in the Euler--MacLaurin-style form
  \[\lim\limits_{m\to\infty} \left(\sum\limits_{k=1}^m \frac{\ln^n k}{k} - 
       \int_1^m \frac{\ln^n x}{x}\,\text{d}x\right)\,,\]
  which is perhaps a bit more illuminating.
›</span></span>
<span class="keyword1" id="Zeta_Laurent_Expansion-stieltjes_gamma_real_limit_form"><span class="command">lemma</span></span> stieltjes_gamma_real_limit_form<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="bound">m</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> real <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>real <span class="bound">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
     <span class="main">⇢</span> stieltjes_gamma <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="bound">m</span><span class="main">.</span>  ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⇢</span> stieltjes_gamma <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sums_stieltjes_gamma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac sums_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="bound">m</span><span class="main">.</span>  ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">m</span><span class="main">.</span> ln <span class="bound">k</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> ln <span class="main">(</span>Suc <span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_subtractf <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_divide_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">m</span><span class="main">.</span> ln <span class="bound">k</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted">Suc</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> ln <span class="main">(</span>Suc <span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_lessThan_telescope<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="skolem">m</span> <span class="main">=</span> <span class="var">?rhs</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="bound">m</span><span class="main">.</span> ln <span class="bound">k</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="bound">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">⇢</span> stieltjes_gamma <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> ln <span class="main">(</span><span class="bound">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">m</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">from</span></span> tendsto_add<span class="main">[</span><span class="operator">OF</span> * **<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Laurent_Expansion-stieltjes_gamma_limit_form"><span class="command">lemma</span></span> stieltjes_gamma_limit_form<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">m</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> real <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>real <span class="bound">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">⇢</span> <span class="main">(</span>stieltjes_gamma <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> real_normed_algebra_1<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span>  of_real <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">m</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> real <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">m</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⇢</span> <span class="main">(</span>of_real <span class="main">(</span>stieltjes_gamma <span class="free">n</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stieltjes_gamma_real_limit_form<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_of_real<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Laurent_Expansion-stieltjes_gamma_real_altdef"><span class="command">lemma</span></span> stieltjes_gamma_real_altdef<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>stieltjes_gamma <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span>
     lim <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="bound">m</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> real <span class="bound">k</span><span class="main">)</span> <span class="main">-</span>
              ln <span class="main">(</span>real <span class="bound">m</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> limI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> stieltjes_gamma_real_limit_form<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proof of the Laurent expansion›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We shall follow the proof by Briggs and Chowla~\cite{briggs55}, which examines the entire
  function $g(s) = (2^{1-s}-1)\zeta(s)$. They determine the value of $g^{(k)}(1)$ in two
  different ways: First by the Dirichlet series of $g$ and then by its power series expansion 
  around 1. We shall do the same here.  
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">G1</span> <span class="free">G2</span> <span class="free">G2'</span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex fps"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≡</span> perzeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">G1</span> <span class="main">≡</span> fps_shift <span class="main">1</span> <span class="main">(</span>fps_exp <span class="main">(</span><span class="main">-</span>ln <span class="numeral">2</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">G2</span> <span class="main">≡</span> fps_expansion <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pre_zeta <span class="main">1</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">G2'</span> <span class="main">≡</span> fps_expansion <span class="main">(</span>pre_zeta <span class="main">1</span><span class="main">)</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≡</span> <span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≡</span> fps_nth <span class="free">G2</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">G1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">G2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">G2'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">G2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are the formal power series
  expansions of functions around <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s = 1›</span></span></span></span> of the entire functions

    <span class="antiquoted"><span class="antiquoted">▪</span></span> $(2^{1-s} - 1) / (s - 1)$, 

    <span class="antiquoted"><span class="antiquoted">▪</span></span> $(s - 1) \zeta(s)$,

    <span class="antiquoted"><span class="antiquoted">▪</span></span> $\zeta(s) - \frac{1}{s-1}$,

    <span class="antiquoted"><span class="antiquoted">▪</span></span> $(2^{1-s}-1) \zeta(s)$,

  respectively.

  Our goal is to determine the coefficients of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G2'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and we shall do so
  by determining the coefficients of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G2</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (which are the same, but shifted by 1).
  This in turn will be done by determining the coefficients of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">G</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">G1</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">G2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

  Note that $(2^{1-s} - 1) \zeta(s)$ is written as <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"perzeta <span class="main"><span class="main">(</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in Isabelle
  (using the periodic <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ζ›</span></span></span></span> function) and the analytic continuation of $\zeta(s) - \frac{1}{s-1}$
  is written as <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"pre_zeta <span class="main"><span class="main">1</span></span> <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> pre_zeta<span class="antiquote"><span class="antiquote">}</span></span></span></span> is an artefact from the definition of
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> zeta<span class="antiquote"><span class="antiquote">}</span></span></span></span>, which comes in useful here).
›</span></span>

<span class="keyword1" id="Zeta_Laurent_Expansion-stieltjes_gamma_aux1"><span class="command">lemma</span></span> stieltjes_gamma_aux1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln<span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">/</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="main">(</span>deriv<span class="main">^^</span><span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> fds_perzeta <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"conv_abscissa <span class="skolem">H</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv_abscissa_perzeta'<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> fraction_not_in_ints<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fds <span class="skolem">H</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">unfolding</span></span> H_def g_def <span class="keyword1"><span class="command">using</span></span> fraction_not_in_ints<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> perzeta_altdef2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open open_halfspace_Re_gt<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>eval_fds <span class="skolem">H</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> higher_deriv_cong_ev eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fds_converges <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fds_converges le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv_abscissa_higher_deriv_le<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> conv <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">:</span> one_ereal_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fds_converges_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fds <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>eval_fds <span class="skolem">H</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eval_fds_higher_deriv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_ereal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fds_nth <span class="main">(</span><span class="main">(</span>fds_deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fds_nth_higher_deriv <span class="dynamic"><span class="dynamic">algebra_simps</span></span> H_def fds_perzeta_one_half Ln_Reals_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span>
                   <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span>
                     <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> complex_of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Laurent_Expansion-stieltjes_gamma_aux2"><span class="command">lemma</span></span> stieltjes_gamma_aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv<span class="main">^^</span><span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span> <span class="main">=</span> fact <span class="free">k</span> <span class="main">*</span> fps_nth <span class="free">G</span> <span class="free">k</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> stieltjes_gamma_aux3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G2</span> <span class="main">=</span> fps_X <span class="main">*</span> <span class="free">G2'</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fps_conv_radius <span class="free">G1</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fps_conv_radius_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fps_exp <span class="main">(</span><span class="main">-</span>Ln <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_conv_radius <span class="free">G2</span> <span class="main">≥</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> G2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conv_radius_fps_expansion <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fps_conv_radius <span class="free">G2</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_conv_radius <span class="free">G2'</span> <span class="main">≥</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> G2'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conv_radius_fps_expansion <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fps_conv_radius <span class="free">G2'</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fps_conv_radius <span class="free">G</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fps_conv_radius_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G1</span></span> <span class="quoted"><span class="free">G2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> eval_G1<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fps <span class="free">G1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
                   <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">-</span>ln <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
      <span class="keyword1"><span class="command">unfolding</span></span> G1_def <span class="keyword1"><span class="command">using</span></span> fps_conv_radius_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fps_exp <span class="main">(</span><span class="main">-</span>Ln <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eval_fps_shift<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> subdegree_geI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_fps_diff powr_def exp_diff exp_minus <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eval_G2<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fps <span class="free">G2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pre_zeta <span class="main">1</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">unfolding</span></span> G2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eval_fps_expansion<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main">∞</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eval_G<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fps <span class="free">G</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">unfolding</span></span> G_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fps_mult eval_G1 eval_G2 g_def perzeta_one_half_left'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eval_G'<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fps <span class="free">G</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">using</span></span> eval_G<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eval_G2'<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fps <span class="free">G2'</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> pre_zeta <span class="main">1</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">unfolding</span></span> G2'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eval_fps_expansion<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main">∞</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">G2</span> <span class="main">=</span> fps_X <span class="main">*</span> <span class="free">G2'</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> eval_fps_eqD always_eventually allI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fps_conv_radius <span class="main">(</span>fps_X <span class="main">*</span> <span class="free">G2'</span><span class="main">)</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fps_conv_radius_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted">fps_X</span> <span class="quoted"><span class="free">G2'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fps_conv_radius <span class="main">(</span>fps_X <span class="main">*</span> <span class="free">G2'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fps_conv_radius_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fps_X <span class="main">*</span> <span class="free">G2'</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_fps <span class="free">G2</span> <span class="skolem">s</span> <span class="main">=</span> eval_fps <span class="main">(</span>fps_X <span class="main">*</span> <span class="free">G2'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
      <span class="keyword1"><span class="command">using</span></span> * eval_G2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span><span class="main">]</span> eval_G2'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_fps_add eval_fps_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> fps_expansion <span class="free">g</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eval_fps_eqD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_conv_radius <span class="main">(</span>fps_expansion <span class="free">g</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fraction_not_in_ints<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conv_radius_fps_expansion<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fps_conv_radius <span class="main">(</span>fps_expansion <span class="free">g</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_fps <span class="main">(</span>fps_expansion <span class="free">g</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
      <span class="keyword1"><span class="command">using</span></span> fraction_not_in_ints<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eval_fps_expansion'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main">∞</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> eval_fps <span class="free">G</span> <span class="bound">z</span> <span class="main">=</span> eval_fps <span class="main">(</span>fps_expansion <span class="free">g</span> <span class="main">1</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span>nhds <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_G'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span> <span class="main">=</span> fact <span class="free">k</span> <span class="main">*</span> fps_nth <span class="free">G</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_eq_iff fps_expansion_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Laurent_Expansion-stieltjes_gamma_aux4"><span class="command">lemma</span></span> stieltjes_gamma_aux4<span class="main">:</span> <span class="quoted"><span class="quoted">"fps_nth <span class="free">G</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>ln <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="bound">i</span> <span class="main">*</span> <span class="free">A</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> fact <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="free">G</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> fps_nth <span class="free">G1</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">A</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> G_def fps_mult_nth A_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>ln <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G1_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>ln <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="bound">i</span> <span class="main">*</span> <span class="free">A</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> fact <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted">Suc</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_diff_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Laurent_Expansion-stieltjes_gamma_aux5"><span class="command">lemma</span></span> stieltjes_gamma_aux5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> Ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span> <span class="main">-</span>
             ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">x</span><span class="main">.</span> ln<span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">^</span><span class="bound">k</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span>
                         ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real<span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> stieltjes_gamma <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> h_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">.</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> ln <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> stieltjes_gamma <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">h</span> <span class="skolem">k</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">THEN</span> filterlim_compose<span class="main">,</span> <span class="operator">tendsto_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">t</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
    <span class="keyword1"><span class="command">using</span></span> tendsto_diff<span class="main">[</span><span class="operator">OF</span> stieltjes_gamma_real_limit_form<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span> tendsto_const<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"stieltjes_gamma <span class="skolem">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span>
              ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">h</span> <span class="free">k</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">h'</span> <span class="skolem">x</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?rhs</span> <span class="skolem">x</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">.</span> ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span><span class="main">^</span><span class="free">k</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_distrib_left
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span>ln <span class="skolem">n</span> <span class="main">+</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_mult add_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ln <span class="skolem">n</span> <span class="main">+</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">^</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> binomial_ring<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">n</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">^</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_distrib_left<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.swap<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span>
                      <span class="main">(</span>ln <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> stieltjes_gamma <span class="bound">t</span> <span class="main">+</span> <span class="skolem">h</span> <span class="bound">t</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">.</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="skolem">t</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_distrib_left<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">.</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="skolem">t</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> ln <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">t</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">t</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> stieltjes_gamma <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">h</span> <span class="skolem">t</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> h_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span>
                      <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">h'</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs sum.distrib h'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span>Suc <span class="free">k</span> <span class="keyword1">choose</span> Suc <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_nat_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="free">k</span> <span class="keyword1">choose</span> Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc_times_binomial_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">…</span> <span class="main">=</span> of_nat <span class="main">(</span>Suc <span class="free">k</span> <span class="keyword1">choose</span> Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_nat_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
                         <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">k</span> <span class="keyword1">choose</span> Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> of_nat_Suc <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> binomial_Suc_Suc<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">k</span><span class="main">.</span> <span class="main">(</span>Suc <span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">^</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted">Suc</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..</span>Suc <span class="free">k</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="main">(</span>Suc <span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">^</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">≤</span>Suc <span class="free">k</span><span class="main">.</span> <span class="main">(</span>Suc <span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">^</span> <span class="bound">t</span><span class="main">)</span> <span class="main">-</span>
                   ln <span class="numeral">2</span> <span class="main">^</span> Suc <span class="free">k</span> <span class="main">/</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_diff1<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">≤</span>Suc <span class="free">k</span><span class="main">.</span> <span class="main">(</span>Suc <span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="main">^</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span>ln <span class="skolem">x</span> <span class="main">+</span> ln <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">k</span> <span class="main">/</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> binomial_ring <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_divide_distrib<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="main">+</span> ln <span class="numeral">2</span> <span class="main">=</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">/</span> real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                         ln <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span>
                         <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">h'</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">.</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> stieltjes_gamma <span class="free">k</span> <span class="main">+</span> <span class="skolem">h</span> <span class="free">k</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> h_eq<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">.</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="bound">n</span> <span class="keyword1">then</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">.</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span>
                    <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">.</span> <span class="keyword1">if</span> even <span class="bound">n</span> <span class="keyword1">then</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_subtractf sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">.</span> <span class="keyword1">if</span> even <span class="bound">n</span> <span class="keyword1">then</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">n</span></span> <span class="main">|</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∧</span> even <span class="bound">n</span><span class="main">.</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">.</span> ln <span class="bound">n</span> <span class="main">^</span> <span class="free">k</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span>
                 ln <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span>
                <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span> <span class="main">-</span> stieltjes_gamma <span class="free">k</span><span class="main">)</span> <span class="main">+</span>
                <span class="skolem">h</span> <span class="free">k</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">h'</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> arg_cong2<span class="main">[</span><span class="operator">OF</span> eq1 eq2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(-)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">k</span><span class="main">}</span> <span class="main">=</span> insert <span class="free">k</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span> <span class="main">-</span> stieltjes_gamma <span class="free">k</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">⇢</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span>
                            <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> h'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span> refl mult_nat_left_at_top filterlim_ident <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?rhs</span> <span class="bound">x</span> <span class="main">=</span> <span class="var">?lhs</span> <span class="bound">x</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⇢</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span>
                                   <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> 
             <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">Suc</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_negf<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⇢</span> <span class="main">(</span>ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span>
                              <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> lim1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">⇢</span> <span class="main">-</span><span class="main">(</span>ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span>
                      <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs'</span> <span class="main">⇢</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> tendsto_of_real<span class="main">[</span><span class="operator">OF</span> tendsto_minus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">complex</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln_Reals_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs'</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> sequentially sequentially"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">/</span> real <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">⇢</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ **<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> stieltjes_gamma_aux1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">:</span> sums_def›</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span>ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span>
                      <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                   <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_unique<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln_Reals_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_Laurent_Expansion-stieltjes_gamma_aux6"><span class="command">lemma</span></span> stieltjes_gamma_aux6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> Ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span> <span class="main">-</span>
                  Ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> fact <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>Ln <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">A</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> fact <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> Ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span> <span class="main">-</span>
          Ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stieltjes_gamma_aux5<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="main">1</span> <span class="main">=</span> fact <span class="free">k</span> <span class="main">*</span> fps_nth <span class="free">G</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stieltjes_gamma_aux2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="free">G</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>Ln <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">A</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> fact <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stieltjes_gamma_aux4<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> higher_deriv_pre_zeta_1_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>pre_zeta <span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> stieltjes_gamma <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> stieltjes_gamma_aux6<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> Ln <span class="numeral">2</span> <span class="main">*</span> stieltjes_gamma <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> Ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">∈</span>insert <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> Ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..&lt;</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="skolem">k</span><span class="main">.</span> of_nat <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">choose</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> Ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">t</span><span class="main">)</span> <span class="main">=</span>
              Ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> fact <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> Ln <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> fact <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> stieltjes_gamma_aux6<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="numeral">2</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> fact <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> Ln <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> fact <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="numeral">2</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="skolem">k</span> <span class="main">*</span> fact <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> Ln <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> fact <span class="bound">i</span><span class="main">)</span>
                   <span class="main">-</span>Ln <span class="numeral">2</span> <span class="main">*</span> <span class="free">A</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> fact <span class="skolem">k</span> <span class="main">+</span>
                   <span class="main">(</span><span class="main">-</span>Ln <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">0</span> <span class="main">/</span> fact <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> fact <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main">)</span>
                       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum_distrib_left sum_distrib_right<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="numeral">2</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="skolem">k</span> <span class="main">*</span> fact <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>Ln <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> fact <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> Ln <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">k</span> <span class="main">-</span> <span class="bound">i</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> binomial_fact Suc_diff_le less <span class="dynamic"><span class="dynamic">field_simps</span></span> power_neg_one_If<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> Ln <span class="numeral">2</span> <span class="main">*</span> stieltjes_gamma <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
                       <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> fact <span class="skolem">k</span> <span class="main">*</span> Ln <span class="numeral">2</span> <span class="main">*</span> <span class="free">A</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less power_minus'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> fact <span class="skolem">k</span> <span class="main">/</span> Ln <span class="numeral">2</span> <span class="main">=</span> <span class="free">A</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> Ln <span class="numeral">2</span> <span class="main">*</span> stieltjes_gamma <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> fact <span class="skolem">k</span> <span class="main">/</span> Ln <span class="numeral">2</span> <span class="main">=</span>
                   <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> fact_reduce<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> stieltjes_gamma <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fps_nth <span class="free">G2'</span> <span class="free">k</span> <span class="main">=</span> fps_nth <span class="free">G2</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stieltjes_gamma_aux3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">A</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> stieltjes_gamma <span class="free">k</span> <span class="main">/</span> fact <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>pre_zeta <span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> stieltjes_gamma <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G2'_def fps_eq_iff fps_expansion_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> pre_zeta_1_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pre_zeta <span class="main">1</span> <span class="main">1</span> <span class="main">=</span> euler_mascheroni"</span></span>
  <span class="keyword1"><span class="command">using</span></span> higher_deriv_pre_zeta_1_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> zeta_minus_pole_limit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> zeta <span class="bound">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">─</span><span class="main">1</span><span class="main">→</span> euler_mascheroni"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> pre_zeta <span class="main">1</span> <span class="bound">s</span> <span class="main">=</span> zeta <span class="bound">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zeta_minus_pole_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> eventually_at_filter<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>pre_zeta <span class="main">1</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"pre_zeta <span class="main">1</span> <span class="main">─</span><span class="main">1</span><span class="main">→</span> euler_mascheroni"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isCont_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> fps_expansion_pre_zeta_1_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fps_expansion <span class="main">(</span>pre_zeta <span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> Abs_fps <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">*</span> stieltjes_gamma <span class="bound">n</span> <span class="main">/</span> fact <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fps_expansion_def higher_deriv_pre_zeta_1_1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Hadjicostas_Chapman">
<div class="head">
<h1>Theory Hadjicostas_Chapman</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Hadjicostas--Chapman formula›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Hadjicostas_Chapman
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Zeta_Laurent_Expansion.html">Zeta_Laurent_Expansion</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we will derive a formula for the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ζ›</span></span></span></span> function that was conjectured by 
  Hadjicostas~\cite{hadjicostas2004} and proven shortly afterwards by Chapman~\cite{chapman2004}.
  The formula is:
    \begin{align*}
    &amp;\int_0^1 \int_0^1 \frac{(-\ln (xy))^z (1-x)}{1-xy}\ \text{d}x\,\text{d}y\\
      &amp;\quad = \int_0^1 \frac{(-\ln u)^z(-\ln u + u - 1)}{1-u}\ \text{d}u\\
      &amp;\quad = \Gamma(z + 2) \left(\zeta(z + 2) - \frac{1}{z+1}\right)
    \end{align*}
  for any <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> with $\mathfrak{R}(z) &gt; -2$. In particular, setting $z = 1$, we can derive
  the following formula for the Euler--Mascheroni constant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>γ›</span></span></span></span>:
    \[-\int_0^1 \int_0^1 \frac{1-x}{(1-xy) \ln (xy)}\ \text{d}x\,\text{d}y = \gamma\]
  This formula was first proven by Sondow~\cite{sondow2002}.      
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The real case›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We first define the integral for real <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z &gt; -2›</span></span></span></span>. This is then a non-negative integral,
  so that we can ignore the issue of integrability and use the Lebesgue integral on the
  extended non-negative reals

  We first show the equivalence of the single-integral and the double-integral form.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Hadjicostas_nn_integral</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> ennreal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Hadjicostas_nn_integral</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span>
     set_nn_integral lborel <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>
       <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span> <span class="main">+</span> <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Hadjicostas_integral</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Hadjicostas_integral</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">/</span> of_real <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span> <span class="main">+</span> <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hadjicostas_Chapman-Hadjicostas_nn_integral_altdef"><span class="command">lemma</span></span> Hadjicostas_nn_integral_altdef<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Hadjicostas_nn_integral <span class="free">z</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span> <span class="main">+</span> <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Gamma <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span> <span class="main">+</span> <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">×</span> real<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">u</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">u</span><span class="main">&lt;..&lt;</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D1</span> <span class="main">∈</span> sets <span class="main">(</span>lborel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> lborel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D1</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span>space <span class="main">(</span>lborel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> lborel<span class="main">)</span><span class="main">.</span> snd <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">&gt;</span> snd <span class="bound">x</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D1_def space_pair_measure<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> sets <span class="main">(</span>lborel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> lborel<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">measurable</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D2</span> <span class="main">∈</span> sets <span class="main">(</span>lborel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> lborel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D2</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span>space <span class="main">(</span>lborel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> lborel<span class="main">)</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">&lt;</span> snd <span class="bound">x</span> <span class="main">∧</span> snd <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D2_def space_pair_measure<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> sets <span class="main">(</span>lborel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> lborel<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">measurable</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="skolem">D</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lborel_prod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> case_prod_unfold D_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel.nn_integral_fst<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_nn_integral_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space lborel <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_distr_mult'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nn_integral_density nn_integral_distr indicator_def <span class="dynamic"><span class="dynamic">field_simps</span></span>
               <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult' <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">∈</span><span class="skolem">D1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lborel_prod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> case_prod_unfold D_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel.nn_integral_fst<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">measurable</span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def D1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">.</span> indicator <span class="skolem">D2</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main">)</span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D1_def D2_def indicator_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">u</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold lborel_prod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_pair.nn_integral_snd <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">measurable</span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D2_def indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span> <span class="main">+</span> <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_nn_integral_cong refl<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> space lborel <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> ln <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">u</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">(</span><span class="main">-</span> ln <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">u</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">(</span><span class="main">-</span> ln <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_cong_AE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> AE_I<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">u</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emeasure_lborel_countable indicator_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="var">?F</span> <span class="main">1</span> <span class="main">-</span> <span class="var">?F</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_FTC_Icc<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">1</span> <span class="main">-</span> <span class="var">?F</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span>ln <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ln <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">u</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> ln <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> ennreal <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Hadjicostas_nn_integral <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hadjicostas_nn_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now solve the single integral for real <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z &gt; -1›</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Hadjicostas_Chapman-Hadjicostas_Chapman_aux"><span class="command">lemma</span></span> Hadjicostas_Chapman_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span> <span class="main">+</span> <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_integral</span> <span class="main">(</span>Gamma <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Gamma <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">+</span> exp <span class="main">(</span><span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">+</span> exp <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_left_mono exp_ge_add_one_self<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">-</span>ln <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>ln <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>exp <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">z</span> <span class="main">/</span> exp <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="var">?I</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> z <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nonpos_Reals_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∉</span> <span class="main">ℤ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nonpos_Ints_subset_nonpos_Reals <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>exp <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">x</span><span class="main">)</span>
            <span class="keyword1">has_integral</span> <span class="main">(</span>Gamma <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Gamma <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_diff Gamma_integral_real' Gamma_times_zeta_has_integral_real<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Gamma <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
                 Gamma <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Gamma_plus1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> z z' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">-</span>exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="var">?I</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_add powr_def exp_add<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> exp_add<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">-</span>exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="var">?I</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">-</span>exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">)</span> <span class="main">∧</span>
                  integral <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">-</span>exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?I</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI nonnegative_absolutely_integrable_1<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">-</span>exp <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> nonneg
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> scaleR_nonneg_nonneg mult_nonneg_nonneg divide_nonneg_nonneg<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> * <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> has_integral_iff›</span><span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">∧</span>
                       integral <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="var">?I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_absolute_integral_change_of_variables_1'<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> exp <span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_integral</span> <span class="var">?I</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_integral_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_lebesgue_integral_eq_integral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hadjicostas_Chapman-real_zeta_ge_one_over_minus_one"><span class="command">lemma</span></span> real_zeta_ge_one_over_minus_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>zeta <span class="main">(</span>complex_of_real <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">-</span> ln <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">using</span></span> ln_le_minus_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">-</span> ln <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
           Gamma <span class="free">z</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span>complex_of_real <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Hadjicostas_Chapman_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ineq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="free">z</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span>complex_of_real <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_nonneg<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span> z mult_nonneg_nonneg divide_nonneg_nonneg<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="free">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Gamma_real_pos<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>zeta <span class="main">(</span>complex_of_real <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> zero_le_mult_iff<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now have the formula for real <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z &gt; -1›</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Hadjicostas_Chapman-Hadjicostas_Chapman_formula_real"><span class="command">lemma</span></span> Hadjicostas_Chapman_formula_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Hadjicostas_nn_integral <span class="free">z</span> <span class="main">=</span>
             ennreal <span class="main">(</span>Gamma <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">-</span> ln <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> ln <span class="skolem">x</span> <span class="main">+</span> exp <span class="main">(</span>ln <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_left_mono exp_ge_add_one_self<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Hadjicostas_nn_integral_def <span class="keyword1"><span class="command">using</span></span> nonneg Hadjicostas_Chapman_aux<span class="main">[</span><span class="operator">OF</span> z<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_has_integral_lebesgue' mult_nonneg_nonneg divide_nonneg_nonneg<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Analyticity of the integral›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  To extend the formula to its full domain of validity (any complex <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> with
  $\mathfrak{R}(z)&gt;-2$), we will use analytic continuation. To do this, we first
  have to show that the integral is an analytic function of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> on that domain.
  This is unfortunately somewhat involved, since the integral is an improper one
  and we first need to show uniform convergence so that we can pull the derivative
  inside the integral sign.

  We will use the single-integral form so that we only have to deal with one integral
  and not two.
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> real <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">u</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="bound">z</span> <span class="main">/</span> of_real <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span> <span class="main">+</span> <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g1</span> <span class="free">g2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> ln <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">-</span> ln <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Hadjicostas_Chapman-integrable_bound1"><span class="command">lemma</span></span> integrable_bound1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">0</span> <span class="main">(</span>ereal <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zero_ereal_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> interval_lebesgue_integrable_bigo_left<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∈</span> <span class="keyword1">O[</span>at_right <span class="main">0</span><span class="main">](</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> g1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>exp<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> g1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span>einterval <span class="main">0</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> interval_integral_FTC_nonneg<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> ereal <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">u</span> <span class="main">&lt;</span> ereal <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> real_of_ereal<span class="main">)</span> <span class="main">⤏</span> <span class="numeral">2</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>at_left <span class="main">(</span>ereal <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ereal_tendsto_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> real_of_ereal<span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> zero_ereal_def <span class="keyword1"><span class="command">unfolding</span></span> ereal_tendsto_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">(</span>ereal <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ereal <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def zero_ereal_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g1_def set_borel_measurable_def<span class="main">)</span>

<span class="keyword1" id="Hadjicostas_Chapman-integrable_bound2"><span class="command">lemma</span></span> integrable_bound2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> one_ereal_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> interval_lebesgue_integrable_bigo_right<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">∈</span> <span class="keyword1">O[</span>at_left <span class="main">1</span><span class="main">](</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> g2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> exp <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="main">&lt;</span> ln <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="free">g2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> g2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span>einterval <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> interval_integral_FTC_nonneg<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?F</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> ereal <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"ereal <span class="skolem">u</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F</span> <span class="keyword1">has_field_derivative</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_ereal_def add_ac<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> real_of_ereal<span class="main">)</span> <span class="main">⤏</span>
            <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">(</span>ereal <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ereal_tendsto_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> real_of_ereal<span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> one_ereal_def <span class="keyword1"><span class="command">unfolding</span></span> ereal_tendsto_simps
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">(</span>ereal <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>ereal <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def one_ereal_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g2_def set_borel_measurable_def<span class="main">)</span>

<span class="keyword1" id="Hadjicostas_Chapman-bound2"><span class="command">lemma</span></span> bound2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">z</span> <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g2</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="main">{</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">z</span> <span class="free">u</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> u <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> ln_u<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="free">u</span> <span class="main">&gt;</span> ln <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> z u <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">z</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> ln <span class="free">u</span><span class="main">)</span> <span class="keyword1">powr</span> Re <span class="free">z</span> <span class="main">*</span> <span class="main">¦</span><span class="free">u</span> <span class="main">-</span> ln <span class="free">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def norm_mult norm_divide norm_of_real
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_powr_real_powr einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">u</span> <span class="main">-</span> ln <span class="free">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">¦</span> <span class="main">=</span> <span class="free">u</span> <span class="main">-</span> ln <span class="free">u</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> u <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> ln_add_one_self_le_self2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> ln <span class="free">u</span><span class="main">)</span> <span class="keyword1">powr</span> Re <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="free">u</span> <span class="main">-</span> ln <span class="free">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">≤</span>
               <span class="main">(</span><span class="main">-</span> ln <span class="free">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">u</span> <span class="main">-</span> ln <span class="free">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> z u <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> ln_u ln_add_one_self_le_self2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono divide_right_mono powr_mono'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">z</span> <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g2</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g2_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hadjicostas_Chapman-integrable2_aux"><span class="command">lemma</span></span> integrable2_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">z</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ AE_I2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> impI<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">z</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g2</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bound2<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span><span class="free">g2</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">z</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="free">g2</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> integrable_bound2 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> interval_lebesgue_integrable_def
         one_ereal_def set_borel_measurable_def f_def›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def one_ereal_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hadjicostas_Chapman-uniform_limit2"><span class="command">lemma</span></span> uniform_limit2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"uniform_limit <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span><span class="main">}</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> uniform_limit_interval_integral_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">g2</span></span><span class="main"><span class="main">]</span></span> AE_I2 impI<span class="main">)</span>
     <span class="main">(</span><span class="operator">use</span> bound2 integrable_bound2 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> einterval_def f_def set_borel_measurable_def›</span><span class="main">)</span>

<span class="keyword1" id="Hadjicostas_Chapman-uniform_limit2'"><span class="command">lemma</span></span> uniform_limit2'<span class="main">:</span>
    <span class="quoted"><span class="quoted">"uniform_limit <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span><span class="main">}</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">..</span>ereal <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> sequentially"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> uniform_limit2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span>Suc <span class="bound">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filtermap ereal <span class="main">(</span>filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> sequentially<span class="main">)</span> <span class="main">≤</span>
        filtermap ereal <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filterlim_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filtermap_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> one_ereal_def at_left_ereal <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_def filtermap_filtermap<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hadjicostas_Chapman-bound1"><span class="command">lemma</span></span> bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">z</span> <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g1</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">z</span> <span class="free">u</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≤</span> exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> exp <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> exp_less_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">u</span> <span class="main">&lt;</span> ln <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> ln_u<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="free">u</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> z u <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">z</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> ln <span class="free">u</span><span class="main">)</span> <span class="keyword1">powr</span> Re <span class="free">z</span> <span class="main">*</span> <span class="main">¦</span><span class="free">u</span> <span class="main">-</span> ln <span class="free">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">¦</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def norm_mult norm_divide norm_of_real
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_powr_real_powr einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">u</span> <span class="main">-</span> ln <span class="free">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">¦</span> <span class="main">=</span> <span class="free">u</span> <span class="main">-</span> ln <span class="free">u</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> u ln_add_one_self_le_self2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> ln <span class="free">u</span><span class="main">)</span> <span class="keyword1">powr</span> Re <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="free">u</span> <span class="main">-</span> ln <span class="free">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">≤</span>
               <span class="main">(</span><span class="main">-</span> ln <span class="free">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">u</span> <span class="main">-</span> ln <span class="free">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> z u ln_u <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono divide_right_mono powr_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">z</span> <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g1</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g1_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hadjicostas_Chapman-integrable1_aux"><span class="command">lemma</span></span> integrable1_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">0</span> <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">z</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span><span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ AE_I2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> impI<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">z</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g1</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bound1<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span><span class="free">g1</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="free">z</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="free">g1</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> integrable_bound1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> interval_lebesgue_integrable_def
         zero_ereal_def set_borel_measurable_def f_def›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def zero_ereal_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hadjicostas_Chapman-uniform_limit1"><span class="command">lemma</span></span> uniform_limit1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"uniform_limit <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span><span class="main">}</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="bound">a</span><span class="main">..</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="main">0</span><span class="main">..</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> uniform_limit_interval_integral_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">g1</span></span><span class="main"><span class="main">]</span></span> AE_I2 impI<span class="main">)</span>
     <span class="main">(</span><span class="operator">use</span> bound1 integrable_bound1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> einterval_def f_def set_borel_measurable_def›</span><span class="main">)</span>

<span class="keyword1" id="Hadjicostas_Chapman-uniform_limit1'"><span class="command">lemma</span></span> uniform_limit1'<span class="main">:</span>
    <span class="quoted"><span class="quoted">"uniform_limit <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span><span class="main">}</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>ereal <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">..</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="main">0</span><span class="main">..</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> sequentially"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> uniform_limit1<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span>Suc <span class="bound">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filtermap ereal <span class="main">(</span>filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> sequentially<span class="main">)</span> <span class="main">≤</span>
        filtermap ereal <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filterlim_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filtermap_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> zero_ereal_def at_right_ereal <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_def filtermap_filtermap<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  With all of the above bounds, we have shown that the integral exists for any
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> with $\mathfrak{R}(z) &gt; -2$.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Hadjicostas_integral_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> dense<span class="main">[</span><span class="operator">OF</span> z<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">0</span> <span class="main">(</span>exp<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integrable1_aux<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">(</span>exp<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integrable2_aux<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> interval_lebesgue_integrable_combine<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def set_borel_measurable_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hadjicostas_Chapman-integral_holo_aux"><span class="command">lemma</span></span> integral_holo_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>ereal <span class="free">a</span><span class="main">..</span>ereal <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> real <span class="main">⇒</span> complex"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">u</span><span class="main">.</span> ln <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> has_field_derivative_complex_powr_right'

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> leibniz_rule_holomorphic<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">f'</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">z</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> 1 ab<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f'_def <span class="dynamic"><span class="dynamic">field_simps</span></span> f_def Ln_of_real<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>UNIV <span class="main">×</span> cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold f'_def f_def Ln_of_real <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">complex</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">z</span> <span class="keyword1">integrable_on</span> cbox <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def f'_def <span class="keyword1"><span class="command">using</span></span> ab
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_continuous <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> convex_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∫</span><span class="bound">u</span><span class="main">∈</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext set_borel_integral_eq_integral<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">complex</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complex_set_integrable lborel <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> ab
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_imp_set_integrable_cbox <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ln_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_integral_Icc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_on_subset<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hadjicostas_Chapman-integral_holo"><span class="command">lemma</span></span> integral_holo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"max <span class="free">a</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>ereal <span class="free">a</span><span class="main">..</span>ereal <span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms integral_holo_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>ereal <span class="free">b</span><span class="main">..</span>ereal <span class="free">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> integral_holo_aux<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_integral_endpoints_reverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Hadjicostas_Chapman-holo1"><span class="command">lemma</span></span> holo1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="main">0</span><span class="main">..</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_uniform_sequence
    <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>ereal <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">..</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ε</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">=</span> <span class="main">(</span>Re <span class="skolem">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ε_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"cball <span class="skolem">z</span> <span class="skolem">ε</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span>Re <span class="skolem">z</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">..</span>Re <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> cball <span class="skolem">z</span> <span class="skolem">ε</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_Re_le_cmod<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">ε</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span>Re <span class="skolem">z</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">..</span>Re <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">ε</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cball <span class="skolem">z</span> <span class="skolem">ε</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span>Re <span class="skolem">z</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">..</span>Re <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ε_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cball <span class="skolem">z</span> <span class="skolem">ε</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">-</span> <span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ε_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"uniform_limit <span class="main">(</span>cball <span class="skolem">z</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>ereal <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span><span class="main">..</span>ereal <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="main">0</span><span class="main">..</span>ereal <span class="main">(</span>exp<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uniform_limit_on_subset<span class="main">[</span><span class="operator">OF</span> uniform_limit1' subset<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">^</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> power_strict_decreasing_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>ereal <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">n</span><span class="main">)</span><span class="main">..</span>ereal <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_holo<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>

<span class="keyword1" id="Hadjicostas_Chapman-holo2"><span class="command">lemma</span></span> holo2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_uniform_sequence
    <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">..</span>ereal <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ε</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">=</span> <span class="main">(</span>Re <span class="skolem">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ε_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"cball <span class="skolem">z</span> <span class="skolem">ε</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span>Re <span class="skolem">z</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">..</span>Re <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> cball <span class="skolem">z</span> <span class="skolem">ε</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_Re_le_cmod<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">ε</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span>Re <span class="skolem">z</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">..</span>Re <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">ε</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cball <span class="skolem">z</span> <span class="skolem">ε</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span>Re <span class="skolem">z</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">..</span>Re <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">ε</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ε_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cball <span class="skolem">z</span> <span class="skolem">ε</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">-</span> <span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ε_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"uniform_limit <span class="main">(</span>cball <span class="skolem">z</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>ereal <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">..</span>ereal <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>ereal <span class="main">(</span>exp<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> sequentially"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uniform_limit_on_subset<span class="main">[</span><span class="operator">OF</span> uniform_limit2' subset<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">^</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> power_strict_decreasing_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>ereal <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">..</span>ereal <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_holo<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finally, we have shown that Hadjicostas's integral is an analytic function
  of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> in the domain $\mathfrak{R}(z) &gt; -2$.
›</span></span>
<span class="keyword1" id="Hadjicostas_Chapman-holomorphic_Hadjicostas_integral"><span class="command">lemma</span></span> holomorphic_Hadjicostas_integral<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Hadjicostas_integral <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="main">0</span><span class="main">..</span>exp<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span>exp<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span>
          <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> holo1 holo2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Hadjicostas_integral_integrable
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_cong interval_integral_sum<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_ereal_def one_ereal_def min_def max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> Hadjicostas_integral"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hadjicostas_integral_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hadjicostas_Chapman-analytic_Hadjicostas_integral"><span class="command">lemma</span></span> analytic_Hadjicostas_integral<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Hadjicostas_integral <span class="keyword1">analytic_on</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytic_on_open open_halfspace_Re_gt holomorphic_Hadjicostas_integral<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Analytic continuation and main result›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since we have already shown the formula for any real <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z &gt; -1›</span></span></span></span> and e.\,g.\ 0 is a limit
  point of that set, it extends to the full domain by analytic continuation.

  As a caveat, note that $\zeta(s)$ is <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹not›</span></span> analytic at <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z = 1›</span></span></span></span>, so that we use
  an analytic continuation of $\zeta(z) - \frac{1}{z-1}$ to state the formula. This
  continuation is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"pre_zeta <span class="main"><span class="main">1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Hadjicostas_Chapman-Hadjicostas_Chapman_formula_aux"><span class="command">lemma</span></span> Hadjicostas_Chapman_formula_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Hadjicostas_integral <span class="free">z</span> <span class="main">=</span> Gamma <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> pre_zeta <span class="main">1</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="free">z</span> <span class="main">=</span> <span class="var">?f</span> <span class="free">z</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> analytic_continuation'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">Hadjicostas_integral</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Hadjicostas_integral <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_Hadjicostas_integral<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> convex_connected convex_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_divide_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_of_nat<span class="main"><span class="main">]</span></span> filterlim_Suc<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">islimpt</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> islimpt_sequential
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">::</span> complex"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">&lt;</span> Re <span class="bound">z</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Reals_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∉</span> <span class="main">ℤ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonpos_Ints_subset_nonpos_Reals <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> Re <span class="bound">z</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> complex_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> ln <span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">using</span></span> ln_le_minus_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Re <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> of_real <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_def complex_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hadjicostas_integral <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span> <span class="main">+</span> <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Hadjicostas_integral_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> interval_lebesgue_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> einterval_def powr_Reals_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_real <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ln <span class="bound">u</span> <span class="main">+</span> <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_lebesgue_integral_of_real<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">u</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> ln <span class="bound">u</span> <span class="main">+</span> <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∫</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> ln <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> ln <span class="bound">u</span> <span class="main">+</span> <span class="bound">u</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="bound">u</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_integral_Ioo zero_ereal_def one_ereal_def set_lebesgue_integral_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> enn2real <span class="main">(</span>Hadjicostas_nn_integral <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Hadjicostas_nn_integral_def <span class="keyword1"><span class="command">using</span></span> ineq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_eq_nn_integral<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AE_I2 divide_nonneg_nonneg mult_nonneg_nonneg arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted">enn2real</span><span class="main"><span class="main">]</span></span>
               nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> enn2real <span class="main">(</span>ennreal <span class="main">(</span>Gamma <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Hadjicostas_Chapman_formula_real<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Gamma <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x real_zeta_ge_one_over_minus_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> enn2real_ennreal mult_nonneg_nonneg Gamma_real_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">…</span> <span class="main">=</span> Gamma <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>zeta <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span>  <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x Gamma_complex_of_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeta_real'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>zeta <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span>  <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pre_zeta <span class="main">1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> zeta_minus_pole_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Hadjicostas_integral <span class="skolem">s</span> <span class="main">=</span> Gamma <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> pre_zeta <span class="main">1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following form and the corollary are perhaps a bit nicer to read.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Hadjicostas_Chapman_formula<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Hadjicostas_integral <span class="free">z</span> <span class="main">=</span> Gamma <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>zeta <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> z <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Hadjicostas_Chapman_formula_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> zeta_minus_pole_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> euler_mascheroni_integral_form<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Hadjicostas_integral <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> euler_mascheroni"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Hadjicostas_Chapman_formula_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>