<div id="List_Vector">
<div class="head">
<h1>Theory List_Vector</h1>
</div>
<pre class="source"><span class="comment1">(*
Author:  Florian Messner &lt;florian.g.messner@uibk.ac.at&gt;
Author:  Julian Parsert &lt;julian.parsert@gmail.com&gt;
Author:  Jonas Schöpf &lt;jonas.schoepf@uibk.ac.at&gt;
Author:  Christian Sternagel &lt;c.sternagel@gmail.com&gt;
License: LGPL
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Vectors as Lists of Naturals›</span></span>

<span class="keyword1"><span class="command">theory</span></span> List_Vector
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> lex_lengthD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> lex <span class="free">P</span> <span class="main">⟹</span> length <span class="free">x</span> <span class="main">=</span> length <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lexord_lex<span class="main">)</span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> lex_take_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">∈</span> lex <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"take <span class="free">i</span> <span class="free">xs</span> <span class="main">=</span> take <span class="free">i</span> <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">,</span> <span class="free">ys</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">∈</span> lexn <span class="free">r</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">us</span> <span class="main">@</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="skolem">us</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lex_def lexn_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"length <span class="skolem"><span class="skolem"><span class="skolem">us</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> mods_with_nats<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&gt;</span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left' assms left_diff_distrib'
      less_imp_le mod_mult_self1_is_0 mult_le_mono1 nat_mod_eq_lemma<span class="main">)</span>

<span class="comment1">― ‹The 0-vector of length <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>n›</span></span>.›</span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">zeroes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">zeroes</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> replicate <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rep_upd_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span>zeroes <span class="free">n</span><span class="main">)</span><span class="main">[</span><span class="free">i</span> <span class="main">:=</span> <span class="free">a</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> length <span class="free">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span> <span class="main">≠</span> <span class="free">i</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">j</span> <span class="main">=</span> <span class="free">i</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> nonzero_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nonzero</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonzero_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nonzero <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> nonzero <span class="free">xs</span> <span class="main">∨</span> nonzero <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nonzero_iff<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Inner Product›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dotprod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat list <span class="main">⇒</span> nat"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∙</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">∙</span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>min <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∙</span> <span class="free">ys</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dotprod_def sum_list_sum_nth lessThan_atLeast0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∙</span> <span class="free">ys</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">∙</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dotprod_def mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∙</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dotprod_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">xs</span> <span class="main">∙</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dotprod_def <span class="keyword2"><span class="keyword">and</span></span> length_Cons <span class="keyword2"><span class="keyword">and</span></span> min_Suc_Suc <span class="keyword2"><span class="keyword">and</span></span> sum.lessThan_Suc_shift <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_1_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∙</span> replicate <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> sum_list <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_0_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∙</span> zeroes <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_unit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="main">(</span>zeroes <span class="free">n</span><span class="main">)</span><span class="main">[</span><span class="free">k</span> <span class="main">:=</span> <span class="free">zk</span><span class="main">]</span> <span class="main">=</span> <span class="free">a</span> <span class="main">!</span> <span class="free">k</span> <span class="main">*</span> <span class="free">zk</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_gt0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_gt0D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ex_less_Suc2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_gt0_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> dotprod_gt0D <span class="keyword2"><span class="keyword">and</span></span> dotprod_gt0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> length <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">@</span> <span class="free">x</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">b</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">+</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_le_take<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> length <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> length <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"take <span class="free">k</span> <span class="free">a</span> <span class="main">∙</span> take <span class="free">k</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> append_take_drop_id <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> append_take_drop_id <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_cancel leI length_append length_drop not_add_less1 dotprod_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_le_drop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> length <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> length <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"drop <span class="free">k</span> <span class="free">a</span> <span class="main">∙</span> drop <span class="free">k</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> append_take_drop_id <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> append_take_drop_id <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dotprod_append length_take order_refl trans_le_add2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_is_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dotprod_gt0_iff neq0_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_eq_0_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> set <span class="free">x</span><span class="main">.</span> <span class="bound">e</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_eq_nonzero_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> length <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="free">x</span> <span class="main">⟷</span> nonzero <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nonzero_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> dotprod_commute dotprod_eq_0_iff neq0_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_0_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> zeroes <span class="free">n</span> <span class="main">⟷</span> length <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> in_set_replicate <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> replicate_eqI <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> not_nonzero_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nonzero <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> zeroes <span class="main">(</span>length <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nonzero_iff replicate_length_same eq_0_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> neq_0_iff'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> zeroes <span class="free">n</span> <span class="main">⟷</span> length <span class="free">xs</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_0_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_pointwise_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">as</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">as</span> <span class="main">∙</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">∙</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>min <span class="main">(</span>length <span class="free">as</span><span class="main">)</span> <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dotprod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> member_le_sum<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> replicate_dotprod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"replicate <span class="free">n</span> <span class="free">x</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> sum_list <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>length <span class="free">y</span><span class="main">.</span>  <span class="free">y</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>length <span class="free">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dotprod_def sum_list_sum_nth atLeast0LessThan<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Pointwise Order on Vectors›</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword3">/ </span><span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> _"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1"><span class="free">≤<span class="hidden">⇩</span><sub>v</sub></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">⟷</span> length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword3">/ </span><span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> _"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1"><span class="free">&lt;<span class="hidden">⇩</span><sub>v</sub></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> order_vec<span class="main">:</span> order <span class="quoted">less_eq</span> <span class="quoted">less</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_def less_eq_def dual_order.antisym nth_equalityI<span class="main">)</span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_eqI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le0 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"zeroes <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_list_update <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">ys</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">[</span><span class="free">i</span> <span class="main">:=</span> <span class="free">z</span><span class="main">]</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def nth_list_update<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_def nth_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zeroes <span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> eq_0_iff order_vec.dual_order.strict_iff_order
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nonzero_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">vs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">vs</span> <span class="main">∧</span> <span class="free">ys</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ws</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def nth_append<span class="main">)</span>
    <span class="main">(</span><span class="operator">metis</span> add.commute add_diff_cancel_left' nat_add_left_cancel_less not_add_less2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_Cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">∧</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_def less_eq_def All_less_Suc2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> leD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_length <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_length <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">vs</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ws</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">vs</span> <span class="main">@</span> <span class="free">ws</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span>  <span class="main">=</span> length <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Cons le_append le_length<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> less_appendD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">vs</span> <span class="main">@</span> <span class="free">ws</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">vs</span> <span class="main">∨</span> <span class="free">ys</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ws</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms le_append order_vec.order.strict_iff_order<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_append_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">vs</span> <span class="main">@</span> <span class="free">ws</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ws</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ws</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_append less_appendD order_vec.order.strict_implies_order<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_append_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">@</span> <span class="free">y</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u</span> <span class="main">@</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">@</span> <span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">@</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_vec.order.strict_iff_order le_Cons le_append le_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_sum_list_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="free">xs</span> <span class="main">&lt;</span> sum_list <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">ys</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sum_list <span class="free">xs</span> <span class="main">&lt;</span> sum_list <span class="free">ys</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Cons All_less_Suc2 less_eq_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_le_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">b</span> <span class="main">=</span> length <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dotprod_def less_eq_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_pointwise_le_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">z</span> <span class="main">=</span> length <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">u</span> <span class="main">=</span> length <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">v</span><span class="main">.</span> <span class="free">u</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∙</span> <span class="free">u</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">∙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dotprod_le_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_eqI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_le_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">b</span> <span class="main">=</span> length <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">∙</span> <span class="free">b</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dotprod_le_right dotprod_commute le_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> length <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v</span> <span class="main">=</span> length <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">∙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dotprod_le_left dotprod_le_right le_length le_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dotprod_less_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">b</span> <span class="main">=</span> length <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">w</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v</span> <span class="main">=</span> length <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> less_eq_def order_vec.order.strict_implies_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Cons add_mono_thms_linordered_field dotprod_le_left<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_append_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> length <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">@</span> <span class="free">y</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span> <span class="main">@</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">@</span> <span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">@</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_Cons le_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_append_swap_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> length <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">@</span> <span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">@</span> <span class="free">w</span>  <span class="main">⟷</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span> <span class="main">@</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> le_append_swap
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_left_imp_eq le_length length_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unit_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>zeroes <span class="free">n</span><span class="main">)</span><span class="main">[</span><span class="free">i</span> <span class="main">:=</span> <span class="free">b</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">!</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="free">i</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">!</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms less_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>zeroes <span class="free">n</span><span class="main">)</span><span class="main">[</span><span class="free">i</span> <span class="main">:=</span> <span class="free">b</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms order_vec.less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="free">i</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_sum_list_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="free">xs</span> <span class="main">≤</span> sum_list <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> sum_list_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ys</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(!)</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(!)</span> <span class="free">ys</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> map_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_less_diff_Ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="free">u</span> <span class="main">&lt;</span> sum_list <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">y</span><span class="main">.</span> <span class="free">u</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">u</span> <span class="main">=</span> length <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">y</span><span class="main">.</span> <span class="free">u</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sum_list <span class="free">u</span> <span class="main">&lt;</span> sum_list <span class="free">y</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ex_less_Suc2 All_less_Suc2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> less_vec_sum_list_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="free">v</span> <span class="main">&lt;</span> sum_list <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v</span> <span class="main">=</span> length <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms less_eq_def less_imp_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> length_replicate less_Cons order_vec.order.strict_iff_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">maxne0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat list <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">maxne0</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> length <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>
      <span class="keyword1">then</span> Max <span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>
      <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> maxne0_le_Max<span class="main">:</span>
  <span class="quoted"><span class="quoted">"maxne0 <span class="free">x</span> <span class="free">a</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> maxne0_def nonzero_iff in_set_conv_nth<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> maxne0_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"maxne0 <span class="main">[]</span> <span class="free">as</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"maxne0 <span class="free">xs</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> maxne0_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> maxne0_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"maxne0 <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">as</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> length <span class="free">xs</span> <span class="main">=</span> length <span class="free">as</span> <span class="keyword1">then</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> maxne0 <span class="free">xs</span> <span class="free">as</span> <span class="keyword1">else</span> max <span class="free">a</span> <span class="main">(</span>maxne0 <span class="free">xs</span> <span class="free">as</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">#</span> <span class="free">as</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?a</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="var">?a</span> <span class="main">∧</span> <span class="var">?x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">as</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Suc_pred<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> maxne0_def <span class="keyword2"><span class="keyword">and</span></span> eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Suc_eq_0_disj nth_Cons' <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Max_insert2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> maxne0_times_sum_list_gt_dotprod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">b</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maxne0 <span class="free">ys</span> <span class="free">b</span> <span class="main">*</span> sum_list <span class="free">ys</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span>  <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def ring_distribs add_mono_thms_linordered_semiring<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> leI le_trans mult_less_cancel2 nat_less_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> max_times_sum_list_gt_dotprod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">b</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span> <span class="main">*</span> sum_list <span class="free">ys</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e</span> <span class="main">∈</span> set <span class="free">b</span> <span class="main">.</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span> <span class="main">≥</span> <span class="bound">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"replicate <span class="main">(</span>length <span class="free">ys</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">ys</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">ys</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rep</span> <span class="main">≥</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dotprod_pointwise_le_right dotprod_commute
        length_replicate nth_mem nth_replicate<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span> <span class="main">*</span> sum_list <span class="free">ys</span> <span class="main">=</span> <span class="var">?rep</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> replicate_dotprod <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ys</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> maxne0_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maxne0 <span class="free">y</span> <span class="free">a</span> <span class="main">≤</span> maxne0 <span class="free">x</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> length <span class="free">a</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> length <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> True
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def All_less_Suc2 le_max_iff_disj<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> maxne0_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> all_leq_Max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xi</span> <span class="main">∈</span> set <span class="free">x</span><span class="main">.</span> <span class="bound">xi</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> List.finite_set Max_ge_iff
      assms in_set_conv_nth length_0_conv less_eq_def set_empty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_not_less_replicate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> replicate <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">=</span> replicate <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_replicateI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> replicate <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_Cons<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_take<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> length <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"take <span class="free">i</span> <span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> take <span class="free">i</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>measure sum_list<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span><span class="main">}</span> <span class="main">⊆</span> measure sum_list"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_vec_sum_list_less<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Pointwise Subtraction›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vdiff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat list <span class="main">⇒</span> nat list"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span>"</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1"><span class="free">-<span class="hidden">⇩</span><sub>v</sub></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vdiff_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vdiff_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> upt_Cons_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">j</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">j</span> <span class="main">#</span> <span class="main">[</span><span class="free">j</span><span class="main">+</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms upt_eq_Cons_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_upt_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">[</span>Suc <span class="free">m</span> <span class="main">..&lt;</span> Suc <span class="free">n</span><span class="main">]</span> <span class="main">=</span> map <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">[</span><span class="free">m</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> list.map_comp <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[</span></span></span><span class="free"><span class="free"><span class="free">m</span></span></span> <span class="main"><span class="main"><span class="main">..&lt;</span></span></span> <span class="free"><span class="free"><span class="free">n</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_Suc_upt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vdiff_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">xs</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vdiff_def upt_Cons_conv <span class="main"><span class="main">[</span></span><span class="operator">OF</span> zero_less_Suc<span class="main"><span class="main">]</span></span> map_upt_Suc <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> upt_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vdiff_alt_def<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">w</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> vdiff_dotprod_distr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">b</span> <span class="main">=</span> length <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">=</span> <span class="free">w</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">-</span> <span class="free">v</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v</span> <span class="main">=</span> length <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">w</span><span class="main">.</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms less_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">b</span> <span class="main">=</span> length <span class="free">w</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> All_less_Suc2 diff_mult_distrib
          dotprod_commute dotprod_pointwise_le_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_vdiff_distr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="free">u</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="free">u</span> <span class="main">-</span> sum_list <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms diff_zero dotprod_1_right
      length_map length_replicate length_upt
      less_eq_def vdiff_def vdiff_dotprod_distr<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vdiff_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v</span> <span class="main">=</span> length <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_def vdiff_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mods_with_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">b</span> <span class="main">=</span> length <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">w</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dotprod_less_left <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> vdiff_dotprod_distr <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">-</span> <span class="free">v</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">mod</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mods_with_nats <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∙</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∙</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="operator">OF</span> *<span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mods_with_vec_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">b</span> <span class="main">=</span> length <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">v</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms diff_zero dotprod_commute
      length_map length_upt less_eq_def order_vec.less_imp_le
      mods_with_vec vdiff_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Lexicographic Order on Vectors›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">lex_less_than</span> <span class="main">(</span><span class="quoted">"_<span class="keyword3">/ </span><span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> _"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1"><span class="free">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">∈</span> lex less_than"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rlex</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1"><span class="free">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">⟷</span> rev <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> rev <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rev_le <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rev <span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> rev <span class="free">ys</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">ys</span><span class="main">.</span> rev <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> rev <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rev <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">ys</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> rev <span class="free">ys</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">ys</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">ys</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_nth<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def rev_nth<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rev_less <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rev <span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> rev <span class="free">ys</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_imp_lex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Cons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> less_imp_rlex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> less_imp_lex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"rev <span class="free">ys</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rlex_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lex_not_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">ys</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">i</span> <span class="free">xs</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> lex_take_index<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">j</span> <span class="free">xs</span> <span class="main">=</span> take <span class="skolem">j</span> <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">ys</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> lex_take_index<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_antisym nat_less_le nat_neq_iff nth_take<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rlex_not_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">ys</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">i</span> <span class="free">xs</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms lex_not_sym rlex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">j</span> <span class="free">xs</span> <span class="main">=</span> take <span class="skolem">j</span> <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">&gt;</span> <span class="free">ys</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms rlex_def ass lex_not_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leD nat_less_le nat_neq_iff nth_take<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lex_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> antisym_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> transD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> lex_transI<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rlex_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lex_trans rlex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lex_append_rightD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">us</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">ys</span> <span class="main">@</span> <span class="free">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">us</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rlex_Cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">ys</span> <span class="main">∨</span> <span class="free">ys</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rlex_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> lex_append_rightI lex_append_leftI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lex_append_rightD lex_lengthD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rlex_irrefl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rlex_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lex_append_rightD<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code Equations›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">exists2</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">exists2</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">⟷</span> False"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">exists2</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∨</span> <span class="free">exists2</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">exists2</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_le_code <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">xs</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span> <span class="main">⟷</span> exists2 True <span class="main">(&gt;)</span> <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"True"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&gt;)</span> <span class="main">::</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> exists2.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_Cons<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Linear_Diophantine_Equations">
<div class="head">
<h1>Theory Linear_Diophantine_Equations</h1>
</div>
<pre class="source"><span class="comment1">(*
Author:  Florian Messner &lt;florian.g.messner@uibk.ac.at&gt;
Author:  Julian Parsert &lt;julian.parsert@gmail.com&gt;
Author:  Jonas Schöpf &lt;jonas.schoepf@uibk.ac.at&gt;
Author:  Christian Sternagel &lt;c.sternagel@gmail.com&gt;
License: LGPL
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Homogeneous Linear Diophantine Equations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Linear_Diophantine_Equations
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="List_Vector.html">List_Vector</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> lcm_div_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lcm <span class="free">a</span> <span class="free">b</span> <span class="keyword1">div</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_by_0 div_le_dividend div_le_mono div_mult_self_is_m lcm_nat_def neq0_conv<span class="main">)</span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> lcm_div_le'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lcm <span class="free">a</span> <span class="free">b</span> <span class="keyword1">div</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lcm.commute lcm_div_le<span class="main">)</span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> lcm_div_gt_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lcm <span class="free">a</span> <span class="free">b</span> <span class="keyword1">div</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcm <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lcm_nat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms calculation lcm_pos_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_by_0 div_mult2_eq div_positive gcd_le2_nat nat_mult_div_cancel_disj neq0_conv
              semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> sum_list_list_update_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="free">u</span><span class="main">[</span><span class="free">i</span> <span class="main">:=</span> Suc <span class="main">(</span><span class="free">u</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>sum_list <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> lessThan_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_subset_eq subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given a non-empty list <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>xs›</span></span></span></span> of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> natural numbers,
  either there is a value in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>xs›</span></span></span></span> that is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>0›</span></span></span></span> modulo <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>,
  or there are two values whose moduli coincide.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> list_mod_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">`</span> <span class="var">?X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>eq<span class="main">)</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="var">?X</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?X</span>"</span></span> <span class="main">|</span> <span class="main">(</span>less<span class="main">)</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="var">?X</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> antisym_conv2 <span class="keyword2"><span class="keyword">and</span></span> card_image_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> eq
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="var">?X</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="free">xs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms card_distinct distinct_card<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> lessThan_conv <span class="main">[</span><span class="operator">OF</span> this *<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imageE lessThan_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> distinct_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> less
    <span class="keyword1"><span class="command">from</span></span> pigeonhole <span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Homogeneous linear Diophantine equations:
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a<span class="hidden">⇩</span><sub>1</sub>x<span class="hidden">⇩</span><sub>1</sub> + ⋯ + a<span class="hidden">⇩</span><sub>m</sub>x<span class="hidden">⇩</span><sub>m</sub> = b<span class="hidden">⇩</span><sub>1</sub>y<span class="hidden">⇩</span><sub>1</sub> + ⋯ + b<span class="hidden">⇩</span><sub>n</sub>y<span class="hidden">⇩</span><sub>n</sub>›</span></span></span></span>
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> hlde_ops <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> length <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> length <span class="free">b</span>"</span></span>

<span class="comment1">― ‹The set of all solutions.›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Solutions</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat list <span class="main">×</span> nat list<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Solutions</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">y</span> <span class="main">∧</span> length <span class="bound">x</span> <span class="main">=</span> m <span class="main">∧</span> length <span class="bound">y</span> <span class="main">=</span> n<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_Solutions_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="main">⟷</span> length <span class="free">x</span> <span class="main">=</span> m <span class="main">∧</span> length <span class="free">y</span> <span class="main">=</span> n <span class="main">∧</span> <span class="free">a</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Solutions_def<span class="main">)</span>

<span class="comment1">― ‹The set of pointwise minimal solutions.›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Minimal_Solutions</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat list <span class="main">×</span> nat list<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Minimal_Solutions</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">x</span></span><span class="main">,</span> <span class="bound"><span class="bound">y</span></span><span class="main">)</span> <span class="main">∈</span> Solutions<span class="main">.</span> nonzero <span class="bound">x</span> <span class="main">∧</span>
      <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> Solutions<span class="main">.</span> nonzero <span class="bound">u</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dij</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">dij</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> lcm <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eij</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">eij</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> lcm <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">b</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sij</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span>nat list <span class="main">×</span> nat list<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sij</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>zeroes m<span class="main">)</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">:=</span> dij <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">]</span><span class="main">,</span> <span class="main">(</span>zeroes n<span class="main">)</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">:=</span> eij <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Further Constraints on Minimal Solutions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Ej</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list <span class="main">⇒</span> nat set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Ej</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">{</span> eij <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="main">1</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≥</span> dij <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Di</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list <span class="main">⇒</span> nat set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Di</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">{</span> dij <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">|</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≥</span> eij <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Di'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list <span class="main">⇒</span> nat set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Di'</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">{</span> dij <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">|</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≥</span> eij <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ej_take_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ej <span class="free">j</span> <span class="main">(</span>take <span class="free">k</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊆</span> Ej <span class="free">j</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ej_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Di_take_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Di <span class="free">i</span> <span class="main">(</span>take <span class="free">l</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊆</span> Di <span class="free">i</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Di_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Di'_drop_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Di' <span class="free">i</span> <span class="main">(</span>drop <span class="free">l</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊆</span> Di' <span class="free">i</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Di'_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> add.assoc add.commute less_diff_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_Ej<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Ej <span class="free">j</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> eij <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="free"><span class="free"><span class="free">j</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">`</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span> <span class="main"><span class="main"><span class="main">..&lt;</span></span></span> length <span class="free"><span class="free"><span class="free">x</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ej_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_Di<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Di <span class="free">i</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> dij <span class="free"><span class="free"><span class="free">i</span></span></span> <span class="bound"><span class="bound"><span class="bound">j</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">`</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span> <span class="main"><span class="main"><span class="main">..&lt;</span></span></span> length <span class="free"><span class="free"><span class="free">y</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Di_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_Di'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Di' <span class="free">i</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> dij <span class="free"><span class="free"><span class="free">i</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">j</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> length <span class="free"><span class="free"><span class="free">b</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> length <span class="free"><span class="free"><span class="free">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">`</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span> <span class="main"><span class="main"><span class="main">..&lt;</span></span></span> length <span class="free"><span class="free"><span class="free">y</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Di'_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">max_y</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">&lt;</span> n <span class="main">∧</span> Ej <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="keyword1">then</span> Min <span class="main">(</span>Ej <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">else</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">max_x</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> m <span class="main">∧</span> Di <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="keyword1">then</span> Min <span class="main">(</span>Di <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">else</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_x'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">max_x'</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> m <span class="main">∧</span> Di' <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="keyword1">then</span> Min <span class="main">(</span>Di' <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">else</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Min_Ej_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> Ej <span class="free">j</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">≤</span> m"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>Ej <span class="free">j</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∈</span> Ej <span class="free">j</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> finite_Ej <span class="keyword2"><span class="keyword">and</span></span> Min_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">=</span> eij <span class="skolem">i</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≥</span> dij <span class="skolem">i</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ej_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcm <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">b</span> <span class="main">!</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lcm_div_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> i <span class="keyword2"><span class="keyword">and</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eij_def<span class="main">)</span>
      <span class="main">(</span><span class="operator">meson</span> List.finite_set Max_ge diff_le_self le_trans less_le_trans nth_mem<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Min_Di_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> m"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> Di <span class="free">i</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">≤</span> n"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>Di <span class="free">i</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∈</span> Di <span class="free">i</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> finite_Di <span class="keyword2"><span class="keyword">and</span></span> Min_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">=</span> dij <span class="free">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">≥</span> eij <span class="free">i</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Di_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcm <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">a</span> <span class="main">!</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lcm_div_le'<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> j <span class="keyword2"><span class="keyword">and</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dij_def<span class="main">)</span>
      <span class="main">(</span><span class="operator">meson</span> List.finite_set Max_ge diff_le_self le_trans less_le_trans nth_mem<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Min_Di'_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> m"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> Di' <span class="free">i</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">≤</span> n"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>Di' <span class="free">i</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∈</span> Di' <span class="free">i</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> finite_Di' <span class="keyword2"><span class="keyword">and</span></span> Min_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">=</span> dij <span class="free">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free">y</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">≥</span> eij <span class="free">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Di'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free">y</span> <span class="main">&lt;</span> length <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcm <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">a</span> <span class="main">!</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lcm_div_le'<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> j <span class="keyword2"><span class="keyword">and</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dij_def<span class="main">)</span>
      <span class="main">(</span><span class="operator">meson</span> List.finite_set Max_ge diff_le_self le_trans less_le_trans nth_mem<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_y_le_take<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">≤</span> m"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_y <span class="free">x</span> <span class="free">j</span> <span class="main">≤</span> max_y <span class="main">(</span>take <span class="free">k</span> <span class="free">x</span><span class="main">)</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> Min_Ej_le <span class="keyword2"><span class="keyword">and</span></span> Ej_take_subset <span class="keyword2"><span class="keyword">and</span></span> Min.subset_imp <span class="main">[</span><span class="operator">OF</span> _ _ finite_Ej<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_y_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> max_x_le_take<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">≤</span> n"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_x <span class="free">y</span> <span class="free">i</span> <span class="main">≤</span> max_x <span class="main">(</span>take <span class="free">l</span> <span class="free">y</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> Min_Di_le <span class="keyword2"><span class="keyword">and</span></span> Di_take_subset <span class="keyword2"><span class="keyword">and</span></span> Min.subset_imp <span class="main">[</span><span class="operator">OF</span> _ _ finite_Di<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_x_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> max_x'_le_drop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">≤</span> n"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_x' <span class="free">y</span> <span class="free">i</span> <span class="main">≤</span> max_x' <span class="main">(</span>drop <span class="free">l</span> <span class="free">y</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> Min_Di'_le <span class="keyword2"><span class="keyword">and</span></span> Di'_drop_subset <span class="keyword2"><span class="keyword">and</span></span> Min.subset_imp <span class="main">[</span><span class="operator">OF</span> _ _ finite_Di'<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_x'_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Solutions</span> <span class="main">≡</span> hlde_ops.Solutions"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Minimal_Solutions</span> <span class="main">≡</span> hlde_ops.Minimal_Solutions"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">dij</span> <span class="main">≡</span> hlde_ops.dij"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">eij</span> <span class="main">≡</span> hlde_ops.eij"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">sij</span> <span class="main">≡</span> hlde_ops.sij"</span></span>

<span class="keyword1"><span class="command">declare</span></span> hlde_ops.dij_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> hlde_ops.eij_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> hlde_ops.sij_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> Solutions_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="free">a</span> <span class="free">b</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.in_Solutions_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Minimal_Solutions_imp_Solutions<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.Minimal_Solutions_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Minimal_SolutionsI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="free">a</span> <span class="free">b</span><span class="main">.</span> nonzero <span class="bound">u</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.Minimal_Solutions_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> minimize_nonzero_solution<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">u</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">v</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">@</span> <span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_less<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">@</span> <span class="skolem">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.Minimal_Solutions_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> uv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">@</span> <span class="skolem">v'</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">u</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u'</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">@</span> <span class="skolem">v'</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword2"><span class="keyword">and</span></span> uv' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Minimal_SolutionsI'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">a</span> <span class="free">b</span><span class="main">.</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Minimal_SolutionsI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="free">a</span> <span class="free">b</span><span class="main">.</span> nonzero <span class="bound">u</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="free">a</span> <span class="free">b</span><span class="main">.</span> nonzero <span class="bound">u</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="skolem">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">@</span> <span class="skolem">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u'</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> uv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">@</span> <span class="skolem">v'</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">u</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> minimize_nonzero_solution<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">@</span> <span class="skolem">v'</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword2"><span class="keyword">and</span></span> uv' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Minimal_Solutions_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> length <span class="free">x</span> <span class="main">=</span> length <span class="free">a</span> <span class="main">∧</span> length <span class="free">y</span> <span class="main">=</span> length <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.Minimal_Solutions_def hlde_ops.in_Solutions_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Minimal_Solutions_gt0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> zeroes <span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.Minimal_Solutions_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Minimal_Solutions_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ys</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.Minimal_Solutions_def hlde_ops.Solutions_def
           <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dotprod_eq_nonzero_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> less_append_swap <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> hlde <span class="main">=</span> hlde_ops <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonzero_Solutions_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="free">x</span> <span class="main">⟷</span> nonzero <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> no0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_Solutions_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dotprod_eq_nonzero_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Minimal_Solutions_min<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">@</span> <span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="free">u</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">u</span> <span class="main">=</span> m"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> non0<span class="main">:</span> <span class="quoted"><span class="quoted">"nonzero <span class="main">(</span><span class="free">u</span> <span class="main">@</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">v</span> <span class="main">=</span> n"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> less_appendD Minimal_Solutions_length<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∙</span> <span class="free">u</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_Solutions_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> nonzero_Solutions_iff <span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> non0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.Minimal_Solutions_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Solutions_snd_not_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nonzero_Solutions_iff<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Pointwise Restricting Solutions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Constructing the list of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>u›</span></span></span></span> vectors from Huet's proof <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Huet1978"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, satisfying
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∀i&lt;length u. u ! i ≤ y ! i›</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>0 &lt; sum_list u ≤ a<span class="hidden">⇩</span><sub>k</sub>›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span>, increment a "previous" <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>u›</span></span></span></span> vector at first position
  starting from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i›</span></span></span></span> where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>u›</span></span></span></span> is strictly smaller than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span>. If this
  is not possible, return <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>u›</span></span></span></span> unchanged.
›</span></span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">inc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> nat list <span class="main">⇒</span> nat list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">inc</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span>
        <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>
        <span class="keyword1">else</span> <span class="free">inc</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>
      <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pat_completeness</span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">inc</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> max <span class="main">(</span>length <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>length <span class="bound">u</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="comment1">(*inc.simps may cause simplification to loop*)</span>
<span class="keyword1"><span class="command">declare</span></span> inc.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Starting from the 0-vector produce <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>u›</span></span></span></span>s by iteratively
  incrementing with respect to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">huets_us</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> nat list"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>u</b></span>"</span> 1000<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>u</b></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>inc <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">^^</span> Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> huets_us_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="main">0</span> <span class="main">=</span> inc <span class="free">y</span> <span class="main">0</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> inc <span class="free">y</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> huets_us_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_inc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>inc <span class="free">y</span> <span class="free">i</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> length <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inc.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_us <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> length <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>inc›</span></span></span></span> produces vectors that are pointwise smaller than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span>
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> inc_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">u</span> <span class="main">=</span> length <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inc <span class="free">y</span> <span class="free">i</span> <span class="free">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inc.simps nth_list_update less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> us_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">i</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inc_le le_length<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_inc_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span> <span class="main">⟹</span> sum_list <span class="main">(</span>inc <span class="free">y</span> <span class="free">i</span> <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> sum_list <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inc.simps <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_sum_list_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_inc_gt0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="free">u</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> length <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>inc <span class="free">y</span> <span class="free">i</span> <span class="free">u</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">y</span> <span class="skolem">i</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inc.simps<span class="main">)</span>
      <span class="main">(</span><span class="operator">meson</span> Suc_neq_Zero gr_zeroI set_update_memI sum_list_eq_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_inc_gt0'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">u</span> <span class="main">=</span> length <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">!</span> <span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>inc <span class="free">y</span> <span class="free">j</span> <span class="free">u</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">y</span> <span class="skolem">i</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inc.simps <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span> sum_list_update<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> elem_le_sum_list le_antisym le_zero_eq neq0_conv not_less_eq_eq sum_list_inc_gt0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_us_gt0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> sum_list <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_nth sum_list_inc_gt0' sum_list_inc_gt0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_inc_le'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">u</span> <span class="main">=</span> length <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>inc <span class="free">y</span> <span class="free">i</span> <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> sum_list <span class="free">u</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inc.simps sum_list_update<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_us_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_list_update<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 in_set_replicate length_replicate sum_list_eq_0_iff sum_list_inc_le'<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> Suc_le_mono add.commute le_trans length_us plus_1_eq_Suc sum_list_inc_le'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_us_bounded<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> sum_list_us_le <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_inc_eq_sum_list_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">u</span> <span class="main">=</span> length <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="free">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">y</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">!</span> <span class="bound">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>inc <span class="free">y</span> <span class="free">i</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>sum_list <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">metis</span>  inc.simps Suc_eq_plus1 Suc_leI antisym_conv2 leD sum_list_list_update_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_us_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> sum_list <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1 gr_implies_not0 length_pos_if_in_set
       length_us less_Suc_eq_le less_imp_le_nat antisym_conv2 not_less_eq_eq
       sum_list_eq_0_iff sum_list_inc_eq_sum_list_Suc sum_list_less_diff_Ex us_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_leI antisym_conv gr_implies_not0 sum_list_us_gt0 sum_list_us_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inc_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">u</span> <span class="main">=</span> length <span class="free">y</span> <span class="main">⟹</span> <span class="free">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> inc <span class="free">y</span> <span class="free">i</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inc.simps nth_list_update less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> us_le_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">i</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="free">i</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems inc_ge order.strict_implies_order order_vec.lift_Suc_mono_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> us_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> sum_list <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">i</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">y</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> us_le_mono <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="var">?u</span> <span class="main">&lt;</span> sum_list <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_list_us_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_sum_list_less<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> hlde
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_coeff_bound_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> maxne0 <span class="free">ys</span> <span class="free">b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="var">?m</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="var">?m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Minimal_Solutions_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"m <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_Solutions_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> max_suml<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">*</span> sum_list <span class="free">ys</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> maxne0_times_sum_list_gt_dotprod sol <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_Solutions_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> is_sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="free">ys</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∙</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sol <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_Solutions_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a_ge_ak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="free">xs</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">xs</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dotprod_pointwise_le k_def len <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ak_gt_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">xs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">*</span> <span class="var">?m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no0 in_set_conv_nth k_def len <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sl_ys_g_ak<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="free">ys</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_ge_ak is_sol less_le_trans max_suml
        mult.commute mult_le_mono1 not_le<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Seq</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    Seq_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Seq</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>u</b></span> <span class="free">ys</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ak_n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">*</span> <span class="var">?m</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">xs</span> <span class="main">!</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zeroes <span class="main">(</span>length <span class="free">ys</span><span class="main">)</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> zero_less<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> gr_implies_not0 nonzero_iff sl_ys_g_ak sum_list_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">Seq</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ak_n0 Seq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> u_in_nton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> set <span class="skolem">Seq</span><span class="main">.</span> length <span class="bound">u</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Seq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> prop_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> set <span class="skolem">Seq</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sl_ys_g_ak <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> us_le <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ys</span></span> <span class="main">]</span> less_eq_def Seq_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> prop_4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> set <span class="skolem">Seq</span><span class="main">.</span> sum_list <span class="bound">u</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_def sl_ys_g_ak gr_implies_not_zero imageE
        set_map sum_list_us_gt0<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> prop_4_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> set <span class="skolem">Seq</span><span class="main">.</span> sum_list <span class="bound">u</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Seq_def sum_list_us_bounded<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> prop_5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> length <span class="bound">u</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">∧</span> <span class="bound">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span> <span class="main">∧</span> sum_list <span class="bound">u</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> sum_list <span class="bound">u</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">Seq</span>›</span></span> nth_mem prop_3 prop_4_1 prop_4_2 u_in_nton <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Us</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">Us</span> <span class="main">=</span> <span class="main">{</span><span class="bound">u</span><span class="main">.</span> length <span class="bound">u</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">∧</span> <span class="bound">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span> <span class="main">∧</span> sum_list <span class="bound">u</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> sum_list <span class="bound">u</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="skolem">Us</span><span class="main">.</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">u</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> neg_th<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Seq_p</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">Seq_p</span> <span class="main">=</span> map <span class="main">(</span>dotprod <span class="free">b</span><span class="main">)</span> <span class="skolem">Seq</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">Seq</span> <span class="main">=</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Seq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>eq_0<span class="main">)</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">Seq_p</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">|</span>
      <span class="main">(</span>not_0<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">Seq_p</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="skolem">Seq_p</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">∧</span>
               <span class="main">(</span><span class="skolem">Seq_p</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Seq_p</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> list_mod_cases<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Seq_p</span></span><span class="main">]</span> Seq_p_def ak_n0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> eq_0
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> set <span class="skolem">Seq</span><span class="main">.</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">u</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Seq_p_def eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Us_def mem_Collect_eq
            neg_th prop_3 prop_4_1 prop_4_2 u_in_nton<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> not_0
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        i_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span>length <span class="skolem">Seq_p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span>length <span class="skolem">Seq_p</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
        <span class="quoted"><span class="quoted">" <span class="skolem">Seq_p</span> <span class="main">!</span> <span class="skolem">i</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">Seq_p</span> <span class="main">!</span> <span class="skolem">j</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> not_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        v_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">Seq</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        w_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="skolem">Seq</span><span class="main">!</span><span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> mod_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="skolem">v</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">!</span><span class="skolem">k</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="skolem">w</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">!</span><span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Seq_p_def i_j w_def v_def i_j  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">w</span> <span class="main">∨</span> <span class="skolem">w</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_j
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Seq_p_def sl_ys_g_ak i_j<span class="main">(</span>2<span class="main">)</span> local.Seq_def us_mono v_def w_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Seq_p_def sl_ys_g_ak <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>›</span></span> i_j<span class="main">(</span>1<span class="main">)</span> local.Seq_def us_mono v_def w_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">w</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          u_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">w</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Seq_p_def w_def i_j<span class="main">(</span>2<span class="main">)</span> prop_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> prop_3<span class="main">:</span> <span class="quoted"><span class="quoted">"less_eq <span class="skolem">u</span> <span class="free">ys</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vdiff_le ass less_eq_def order_vec.less_imp_le u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> prop_4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">u</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> le_sum_list_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> ass u_def sum_list_vdiff_distr <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_vec_sum_list_less<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> prop_4_2<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">u</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u_def
            <span class="keyword1"><span class="command">using</span></span> ass less_eq_def order_vec.less_imp_le vdiff_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_p_def i_j<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> length_map le_sum_list_mono
                less_le_trans not_le nth_mem prop_4_2 w_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="skolem">u</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> in_Solutions_iff <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>›</span></span> u_def ass no0<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
              less_eq_def mem_Collect_eq mod_eq mods_with_vec_2 prod.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sol<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> neg_th
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Us_def less_eq_def mem_Collect_eq
              prop_3 prop_4_1 prop_4_2<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          u_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Seq_p_def v_def i_j<span class="main">(</span>1<span class="main">)</span> prop_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> prop_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vdiff_le ass less_eq_def order_vec.less_imp_le u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> prop_4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">u</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> le_sum_list_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> sum_list_vdiff_distr <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≡</span> <span class="skolem">v</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">w</span>›</span></span> ass less_vec_sum_list_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> prop_4_2<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">u</span> <span class="main">≤</span> <span class="free">a</span><span class="main">!</span><span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u_def
            <span class="keyword1"><span class="command">using</span></span> ass less_eq_def order_vec.less_imp_le vdiff_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_p_def i_j<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_neq_implies_less length_map less_imp_le_nat
                less_le_trans nth_mem prop_4_2 le_sum_list_mono v_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="skolem">u</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> in_Solutions_iff <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>›</span></span> u_def ass no0<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
              less_eq_def mem_Collect_eq mod_eq mods_with_vec_2 prod.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sol<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> neg_th Us_def less_eq_def mem_Collect_eq prop_3 prop_4_1 prop_4_2<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    u3_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">u</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">u</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="free">b</span> <span class="main">∙</span> <span class="skolem">u</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">u</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Us_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> u_b_len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">u</span> <span class="main">=</span> n"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  less_eq_def u3_4 in_Solutions_iff sol <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="skolem">u</span> <span class="main">≤</span> maxne0 <span class="skolem">u</span> <span class="free">b</span> <span class="main">*</span> sum_list <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maxne0_times_sum_list_gt_dotprod u_b_len<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?m</span> <span class="main">*</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_le_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u3_4 maxne0_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">xs</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ak_gt_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zk</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    zk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">zk</span> <span class="main">*</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> u3_4<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&gt;</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zk</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">∈</span> set <span class="skolem">u</span><span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u3_4
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neq0_conv sum_list_eq_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="skolem">u</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms no0 u3_4
      <span class="keyword1"><span class="command">unfolding</span></span> dotprod_gt0_iff<span class="main">[</span><span class="operator">OF</span> u_b_len <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_set_conv_nth u_b_len<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∙</span> <span class="skolem">u</span>›</span></span> zk <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    z_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="skolem">k</span> <span class="main">:=</span> <span class="skolem">zk</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zk_zk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">zk</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">z</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms z_def <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bu_eq_akzk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∙</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">zk</span> <span class="main">*</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">k</span>›</span></span> zk_zk<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">!</span><span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ak_gt_max  calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z_less_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> le0 le_list_update less_def
        less_imp_le order_vec.dual_order.antisym nat_neq_iff z_def zk_zk<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">@</span> <span class="skolem">u</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> less_append<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u3_4<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> z_less_xs<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bu_eq_akzk in_Solutions_iff z_def u_b_len <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> len<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">z</span> <span class="main">=</span> length <span class="free">xs</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">zk</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> k_def <span class="keyword2"><span class="keyword">and</span></span> zk_zk <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nonzero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Minimal_Solutions_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proof of Lemma 1 of Huet's paper.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> max_coeff_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> maxne0 <span class="free">ys</span> <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> set <span class="free">ys</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> maxne0 <span class="free">xs</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> ba<span class="main">:</span> hlde <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> no0<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> Minimal_Solutions_sym <span class="main">[</span><span class="operator">OF</span> no0<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_coeff_bound_right ba.max_coeff_bound_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_coeff_bound'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">x</span><span class="main">.</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">y</span><span class="main">.</span> <span class="free">y</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> max_coeff_bound <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> maxne0_le_Max
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> le_eq_less_or_eq less_le_trans nth_mem<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Minimal_Solutions_alt_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Minimal_Solutions <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">x</span></span><span class="main">,</span> <span class="bound"><span class="bound">y</span></span><span class="main">)</span><span class="main">∈</span>Solutions<span class="main">.</span>
    <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>zeroes m<span class="main">,</span> zeroes n<span class="main">)</span> <span class="main">∧</span>
    <span class="bound">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> replicate m <span class="main">(</span>Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="bound">y</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> replicate n <span class="main">(</span>Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span>Solutions<span class="main">.</span> nonzero <span class="bound">u</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_nonzero_iff Minimal_Solutions_imp_Solutions less_eq_def Minimal_Solutions_length max_coeff_bound'
    <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Minimal_SolutionsI' <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Minimal_Solutions_gt0<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Minimal_Solutions_def nonzero_Solutions_iff not_nonzero_iff<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Special Solutions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Special_Solutions</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat list <span class="main">×</span> nat list<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Special_Solutions</span> <span class="main">=</span> <span class="main">{</span>sij <span class="bound">i</span> <span class="bound">j</span> <span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> m <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> n<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dij_neq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> m"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dij <span class="free">i</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">!</span> <span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">!</span> <span class="free">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> no0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dij <span class="free">i</span> <span class="free">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lcm_div_gt_0 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">!</span> <span class="free">j</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dij_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eij_neq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> m"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eij <span class="free">i</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">!</span> <span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">!</span> <span class="free">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> no0  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eij <span class="free">i</span> <span class="free">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lcm_div_gt_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">!</span> <span class="free">j</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">!</span> <span class="free">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eij_def lcm.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Special_Solutions_in_Solutions<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> Special_Solutions <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> Solutions"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_Solutions_iff Special_Solutions_def sij_def dij_def eij_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Special_Solutions_in_Minimal_Solutions<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Special_Solutions"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Minimal_SolutionsI'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Special_Solutions_in_Solutions <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> m"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> n"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_Solutions_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> dij_neq_0
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Special_Solutions_def sij_def nonzero_iff<span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> length_replicate set_update_memI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span>Minimal_Solutions<span class="main">.</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span>Minimal_Solutions<span class="main">.</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">@</span> <span class="skolem">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">u</span> <span class="main">=</span> m"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">v</span> <span class="main">=</span> n"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Minimal_Solutions_def in_Solutions_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> less_append_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> m"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> n"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> less_dij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">&lt;</span> dij <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>zeroes m<span class="main">)</span><span class="main">[</span><span class="skolem">i</span> <span class="main">:=</span> dij <span class="skolem">i</span> <span class="skolem">j</span><span class="main">]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>zeroes n<span class="main">)</span><span class="main">[</span><span class="skolem">j</span> <span class="main">:=</span> eij <span class="skolem">i</span> <span class="skolem">j</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Special_Solutions_def sij_def unit_less<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>zeroes m<span class="main">)</span><span class="main">[</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">u</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>zeroes n<span class="main">)</span><span class="main">[</span><span class="skolem">j</span> <span class="main">:=</span> <span class="skolem">v</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def list_eq_iff_nth_eq<span class="main">)</span>
          <span class="main">(</span><span class="operator">metis</span> le_zero_eq length_list_update length_replicate rep_upd_unit<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nonzero <span class="skolem">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> ij
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr_implies_not0 neq0_conv unit_less zero_less<span class="main">)</span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span> <span class="keyword1">dvd</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Minimal_Solutions_def in_Solutions_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ij <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> u<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span>v<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> u<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> v<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span> <span class="keyword1">dvd</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> dij <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less_dij <span class="keyword2"><span class="keyword">and</span></span> no0 <span class="keyword2"><span class="keyword">and</span></span> ij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&lt;</span> lcm <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dij_def c_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcm <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ac bc<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> no0 <span class="keyword2"><span class="keyword">and</span></span> ij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def in_set_conv_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ac <span class="keyword2"><span class="keyword">and</span></span> bc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> nat_dvd_not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> m"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> n"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> less_dij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">&lt;</span> eij <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>zeroes m<span class="main">)</span><span class="main">[</span><span class="skolem">i</span> <span class="main">:=</span> dij <span class="skolem">i</span> <span class="skolem">j</span><span class="main">]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>zeroes n<span class="main">)</span><span class="main">[</span><span class="skolem">j</span> <span class="main">:=</span> eij <span class="skolem">i</span> <span class="skolem">j</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Special_Solutions_def sij_def unit_less<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>zeroes m<span class="main">)</span><span class="main">[</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">u</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>zeroes n<span class="main">)</span><span class="main">[</span><span class="skolem">j</span> <span class="main">:=</span> <span class="skolem">v</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def list_eq_iff_nth_eq<span class="main">)</span>
          <span class="main">(</span><span class="operator">metis</span> le_zero_eq length_list_update length_replicate rep_upd_unit<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nonzero <span class="skolem">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> Minimal_Solutions_imp_Solutions Solutions_snd_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ij
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr_implies_not0 neq0_conv unit_less zero_less<span class="main">)</span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span> <span class="keyword1">dvd</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Minimal_Solutions_def in_Solutions_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ij <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> u<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span>v<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> u<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> v<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span> <span class="keyword1">dvd</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">*</span> eij <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less_dij <span class="keyword2"><span class="keyword">and</span></span> no0 <span class="keyword2"><span class="keyword">and</span></span> ij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&lt;</span> lcm <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eij_def c_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcm <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ac bc<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> no0 <span class="keyword2"><span class="keyword">and</span></span> ij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def in_set_conv_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ac <span class="keyword2"><span class="keyword">and</span></span> bc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> nat_dvd_not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*Lemma 2 of Huet*)</span>
<span class="keyword1"><span class="command">lemma</span></span> non_special_solution_non_minimal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions <span class="main">-</span> Special_Solutions"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> m"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">!</span> <span class="free">i</span> <span class="main">≥</span> dij <span class="free">i</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">!</span> <span class="free">j</span> <span class="main">≥</span> eij <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∉</span> Minimal_Solutions"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sij <span class="free">i</span> <span class="free">j</span> <span class="main">∈</span> Solutions"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Special_Solutions_in_Solutions<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Special_Solutions_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> sij <span class="free">i</span> <span class="free">j</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span><span class="main">)</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> min
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sij <span class="free">i</span> <span class="free">j</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sij_def Special_Solutions_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List_Vector.le0 Minimal_Solutions_length le_append le_list_update less_append order_vec.dual_order.strict_iff_order same_append_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> sij <span class="free">i</span> <span class="free">j</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> nonzero <span class="bound">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sij_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dij_neq_0 ij length_replicate nonzero_iff set_update_memI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Minimal_Solutions_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Huet's conditions›</span></span>

<span class="comment1">(*A*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cond_A</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> maxne0 <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free">b</span><span class="main">)</span>"</span></span>

<span class="comment1">(*B*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cond_B</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>m<span class="main">.</span> take <span class="bound">k</span> <span class="free">a</span> <span class="main">∙</span> take <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> map <span class="main">(</span>max_y <span class="main">(</span>take <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> n<span class="main">]</span><span class="main">)</span>"</span></span>

<span class="comment1">(*C*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">boundr</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>n<span class="main">.</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≤</span> max_y <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="comment1">(*D*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cond_D</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">l</span></span><span class="main">≤</span>n<span class="main">.</span> take <span class="bound">l</span> <span class="free">b</span> <span class="main">∙</span> take <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹New conditions: facilitating generation of candidates from right to left›</span></span>

<span class="comment1">(*condition on right sub-dotproduct*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">subdprodr</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">l</span></span><span class="main">≤</span>n<span class="main">.</span> take <span class="bound">l</span> <span class="free">b</span> <span class="main">∙</span> take <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x <span class="main">(</span>take <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> m<span class="main">]</span><span class="main">)</span>"</span></span>

<span class="comment1">(*condition on left sub-dotproduct*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">subdprodl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>m<span class="main">.</span> take <span class="bound">k</span> <span class="free">a</span> <span class="main">∙</span> take <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*bound on elements of left vector*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">boundl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>m<span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> max_x <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> boundr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∉</span> Special_Solutions"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"boundr <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> boundr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> n"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ln<span class="main">:</span> <span class="quoted"><span class="quoted">"m <span class="main">=</span> length <span class="free">x</span> <span class="main">∧</span> n <span class="main">=</span> length <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Minimal_Solutions_def in_Solutions_iff min <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> is_sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Minimal_Solutions_def min <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> j_less_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> n"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ass le_less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>notemp<span class="main">)</span> <span class="quoted"><span class="quoted">"Ej <span class="skolem">j</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>  <span class="main">|</span> <span class="main">(</span>empty<span class="main">)</span> <span class="quoted"><span class="quoted">" Ej <span class="skolem">j</span> <span class="free">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">≤</span> max_y <span class="free">x</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> notemp
    <span class="keyword1"><span class="command">have</span></span> max_y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"max_y <span class="free">x</span> <span class="skolem">j</span> <span class="main">=</span>  Min <span class="main">(</span>Ej <span class="skolem">j</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> j_less_l max_y_def notemp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fin_e<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Ej <span class="skolem">j</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_Ej <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> e_def'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> Ej <span class="skolem">j</span> <span class="free">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">x</span><span class="main">.</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≥</span> dij <span class="bound">i</span> <span class="skolem">j</span> <span class="main">∧</span> eij <span class="bound">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ej_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">x</span><span class="main">.</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≥</span> dij <span class="bound">i</span> <span class="skolem">j</span> <span class="main">∧</span> eij <span class="bound">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> Min <span class="main">(</span>Ej <span class="skolem">j</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> notemp Min_in e_def' fin_e <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≥</span> dij <span class="skolem">i</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"eij <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> Min <span class="main">(</span>Ej <span class="skolem">j</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> non_special_solution_non_minimal <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span>
        <span class="keyword2"><span class="keyword">and</span></span> i <span class="keyword2"><span class="keyword">and</span></span> ln <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> is_sol <span class="keyword2"><span class="keyword">and</span></span> j_less_l
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> sij <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_y_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">case</span> sij <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Special_Solutions_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> append_eq_append_conv
            i<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> j_less_l length_list_update length_replicate sij_def
            order_vec.le_neq_trans ln prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        u_v<span class="main">:</span> <span class="quoted"><span class="quoted">"sij <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">@</span> <span class="skolem">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> dij_gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"dij <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> dij_neq_0 i<span class="main">(</span>1<span class="main">)</span> j_less_l ln <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> not_0_u<span class="main">:</span> <span class="quoted"><span class="quoted">"nonzero <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> nonzero_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>zeroes m<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ln<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">∈</span>set <span class="skolem">u</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Pair_inject dij_gt0 set_update_memI sij_def u_v<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neq0_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sij <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">∈</span> Solutions"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Special_Solutions_def i<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
            Special_Solutions_in_Solutions j_less_l ln mem_Collect_eq u_v<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> assms cs u_v not_0_u Minimal_Solutions_def min <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> max_coeff_bound <span class="keyword2"><span class="keyword">and</span></span> maxne0_le_Max
      <span class="keyword1"><span class="command">using</span></span> le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> empty j_less_l ln max_y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> boundl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∉</span> Special_Solutions"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"boundl <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> boundl_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> m"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ln<span class="main">:</span> <span class="quoted"><span class="quoted">"n <span class="main">=</span> length <span class="free">y</span> <span class="main">∧</span> m <span class="main">=</span> length <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Minimal_Solutions_def in_Solutions_iff min <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> is_sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Minimal_Solutions_def min <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> i_less_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> m"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ass le_less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>notemp<span class="main">)</span> <span class="quoted"><span class="quoted">"Di <span class="skolem">i</span> <span class="free">y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>  <span class="main">|</span> <span class="main">(</span>empty<span class="main">)</span> <span class="quoted"><span class="quoted">" Di <span class="skolem">i</span> <span class="free">y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≤</span> max_x <span class="free">y</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> notemp
    <span class="keyword1"><span class="command">have</span></span> max_x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"max_x <span class="free">y</span> <span class="skolem">i</span> <span class="main">=</span>  Min <span class="main">(</span>Di <span class="skolem">i</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i_less_l max_x_def notemp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fin_e<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Di <span class="skolem">i</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_Di <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> e_def'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> Di <span class="skolem">i</span> <span class="free">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">y</span><span class="main">.</span> <span class="free">y</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≥</span> eij <span class="skolem">i</span> <span class="bound">j</span> <span class="main">∧</span> dij <span class="skolem">i</span> <span class="bound">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Di_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">y</span><span class="main">.</span> <span class="free">y</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≥</span> eij <span class="skolem">i</span> <span class="bound">j</span> <span class="main">∧</span> dij <span class="skolem">i</span> <span class="bound">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> Min <span class="main">(</span>Di <span class="skolem">i</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> notemp Min_in e_def' fin_e <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">≥</span> eij <span class="skolem">i</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"dij <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> Min <span class="main">(</span>Di <span class="skolem">i</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> non_special_solution_non_minimal <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span>
        <span class="keyword2"><span class="keyword">and</span></span> j <span class="keyword2"><span class="keyword">and</span></span> ln <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> is_sol <span class="keyword2"><span class="keyword">and</span></span> i_less_l
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> sij <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_x_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> sij <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Special_Solutions_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> append_eq_append_conv
            j<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> i_less_l length_list_update length_replicate sij_def
            order_vec.le_neq_trans ln prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        u_v<span class="main">:</span> <span class="quoted"><span class="quoted">"sij <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">@</span> <span class="skolem">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> dij_gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"dij <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> dij_neq_0 j<span class="main">(</span>1<span class="main">)</span> i_less_l ln <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> not_0_u<span class="main">:</span> <span class="quoted"><span class="quoted">"nonzero <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> nonzero_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>zeroes m<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">∈</span>set <span class="skolem">u</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Pair_inject dij_gt0 set_update_memI sij_def u_v<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neq0_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sij <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">∈</span> Solutions"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Special_Solutions_def j<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
            Special_Solutions_in_Solutions i_less_l ln mem_Collect_eq u_v<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> assms cs u_v not_0_u Minimal_Solutions_def min <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> max_coeff_bound <span class="keyword2"><span class="keyword">and</span></span> maxne0_le_Max
      <span class="keyword1"><span class="command">using</span></span> le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> empty i_less_l ln max_x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Solution_imp_cond_D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cond_D <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> dotprod_le_take <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_D_def in_Solutions_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Solution_imp_subdprodl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subdprodl <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> dotprod_le_take
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdprodl_def in_Solutions_iff<span class="main">)</span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">theorem</span></span> conds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> cond_A<span class="main">:</span> <span class="quoted"><span class="quoted">"cond_A <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cond_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∉</span> Special_Solutions <span class="main">⟹</span> cond_B <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∉</span> Special_Solutions <span class="main">⟹</span> boundr <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cond_D<span class="main">:</span> <span class="quoted"><span class="quoted">"cond_D <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> subdprodr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∉</span> Special_Solutions <span class="main">⟹</span> subdprodr <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> subdprodl<span class="main">:</span> <span class="quoted"><span class="quoted">"subdprodl <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ln<span class="main">:</span> <span class="quoted"><span class="quoted">"m <span class="main">=</span> length <span class="free">x</span> <span class="main">∧</span> n <span class="main">=</span> length <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> min <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Minimal_Solutions_def in_Solutions_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>m<span class="main">.</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> maxne0 <span class="free">y</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> min max_coeff_bound_right nth_mem<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cond_A <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> min <span class="keyword2"><span class="keyword">and</span></span> le_less_trans <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_A_def max_coeff_bound<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∉</span> Special_Solutions <span class="main">⟹</span> cond_B <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> cond_B_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> non_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∉</span> Special_Solutions"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> m"</span></span>
    <span class="keyword1"><span class="command">from</span></span> k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">k</span> <span class="free">a</span> <span class="main">∙</span> take <span class="skolem">k</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dotprod_le_take ln <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> map_b_dot_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> map <span class="main">(</span>max_y <span class="free">x</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>n<span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="main">_</span> <span class="free">b</span> <span class="main">∙</span> <span class="var">?nt</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> non_spec <span class="keyword2"><span class="keyword">and</span></span> less_eq_def <span class="keyword2"><span class="keyword">and</span></span> ln <span class="keyword2"><span class="keyword">and</span></span> boundr <span class="keyword2"><span class="keyword">and</span></span> min
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dotprod_le_right <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> boundr_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> map <span class="main">(</span>max_y <span class="main">(</span>take <span class="skolem">k</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>n<span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="main">_</span> <span class="main">∙</span> <span class="var">?t</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>n<span class="main">.</span> <span class="var">?nt</span><span class="main">!</span><span class="bound">j</span> <span class="main">≤</span> <span class="var">?t</span><span class="main">!</span><span class="bound">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> min <span class="keyword2"><span class="keyword">and</span></span> ln <span class="keyword2"><span class="keyword">and</span></span> max_y_le_take <span class="keyword2"><span class="keyword">and</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?nt</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?t</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  dotprod_le_right<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">k</span> <span class="free">a</span> <span class="main">∙</span> take <span class="skolem">k</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> map <span class="main">(</span>max_y <span class="main">(</span>take <span class="skolem">k</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>n<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_B_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∉</span> Special_Solutions <span class="main">⟹</span> subdprodr <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> subdprodr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> non_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∉</span> Special_Solutions"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> n"</span></span>
    <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">l</span> <span class="free">b</span> <span class="main">∙</span> take <span class="skolem">l</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dotprod_le_take ln <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∙</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sol<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> map_b_dot_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x <span class="free">y</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>m<span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="main">_</span> <span class="free">a</span> <span class="main">∙</span> <span class="var">?nt</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> non_spec <span class="keyword2"><span class="keyword">and</span></span> less_eq_def <span class="keyword2"><span class="keyword">and</span></span> ln <span class="keyword2"><span class="keyword">and</span></span> boundl <span class="keyword2"><span class="keyword">and</span></span> min
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dotprod_le_right <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> boundl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x <span class="main">(</span>take <span class="skolem">l</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>m<span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="main">_</span> <span class="main">∙</span> <span class="var">?t</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>m<span class="main">.</span> <span class="var">?nt</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="var">?t</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> min <span class="keyword2"><span class="keyword">and</span></span> ln <span class="keyword2"><span class="keyword">and</span></span> max_x_le_take <span class="keyword2"><span class="keyword">and</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?nt</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?t</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> less_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  dotprod_le_right<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">l</span> <span class="free">b</span> <span class="main">∙</span> take <span class="skolem">l</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x <span class="main">(</span>take <span class="skolem">l</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>m<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_B_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∉</span> Special_Solutions <span class="main">⟹</span> boundr <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boundr <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> min <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cond_D <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ln <span class="keyword2"><span class="keyword">and</span></span> dotprod_le_take <span class="keyword2"><span class="keyword">and</span></span> sol <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_D_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subdprodl <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ln <span class="keyword2"><span class="keyword">and</span></span> dotprod_le_take <span class="keyword2"><span class="keyword">and</span></span> sol <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdprodl_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_imp_Ej_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ej <span class="free">j</span> <span class="free">u</span> <span class="main">⊆</span> Ej <span class="free">j</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> le_trans <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ej_def less_eq_def dij_def eij_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_imp_max_y_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">≤</span> m"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_y <span class="free">u</span> <span class="free">j</span> <span class="main">≥</span> max_y <span class="free">x</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> le_imp_Ej_subset <span class="keyword2"><span class="keyword">and</span></span> Min_Ej_le <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">j</span></span><span class="main">,</span> <span class="operator">OF</span> _ _ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Min.subset_imp Min_in emptyE finite_Ej max_y_def order_refl subsetCE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_imp_Di_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Di <span class="free">i</span> <span class="free">v</span> <span class="main">⊆</span> Di <span class="free">i</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> le_trans <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Di_def less_eq_def dij_def eij_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_imp_max_x_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">≤</span> n"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_x <span class="free">v</span> <span class="free">i</span> <span class="main">≥</span> max_x <span class="free">y</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> le_imp_Di_subset <span class="keyword2"><span class="keyword">and</span></span> Min_Di_le <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main">,</span> <span class="operator">OF</span> _ _ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Min.subset_imp Min_in emptyE finite_Di max_x_def order_refl subsetCE<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sorted_Wrt">
<div class="head">
<h1>Theory Sorted_Wrt</h1>
</div>
<pre class="source"><span class="comment1">(*
Author:  Christian Sternagel &lt;c.sternagel@gmail.com&gt;
License: LGPL
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Sorted_Wrt
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_filter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">P</span> <span class="free">xs</span> <span class="main">⟹</span> sorted_wrt <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_map_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">Q</span> <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">P</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_concat_map_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">Q</span> <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">Q</span> <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">u</span> <span class="bound">v</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">P</span> <span class="main">[</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> y <span class="main">←</span> <span class="free">ys</span><span class="main">,</span> x <span class="main">←</span> <span class="free">xs</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sorted_wrt_append <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_wrt_map_mono <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">Q</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_concat_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">P</span> <span class="main">(</span>map <span class="free">h</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> sorted_wrt <span class="free">P</span> <span class="main">(</span>map <span class="free">h</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">u</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">h</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">P</span> <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span>map <span class="free">h</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sorted_wrt_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_map_distr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_tl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> sorted_wrt <span class="free">P</span> <span class="free">xs</span> <span class="main">⟹</span> sorted_wrt <span class="free">P</span> <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Minimize_Wrt">
<div class="head">
<h1>Theory Minimize_Wrt</h1>
</div>
<pre class="source"><span class="comment1">(*
Author:  Christian Sternagel &lt;c.sternagel@gmail.com&gt;
License: LGPL
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Minimization›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Minimize_Wrt
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Sorted_Wrt.html">Sorted_Wrt</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">minimize_wrt</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">minimize_wrt</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">minimize_wrt</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> filter <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">minimize_wrt</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> minimize_wrt_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>minimize_wrt <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> minimize_wrtD <span class="main">=</span> minimize_wrt_subset <span class="main">[</span><span class="operator">THEN</span> subsetD<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_minimize_wrt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">P</span> <span class="main">(</span>minimize_wrt <span class="free">P</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sorted_wrt_filter<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_imp_sorted_wrt_minimize_wrt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">Q</span> <span class="free">xs</span> <span class="main">⟹</span> sorted_wrt <span class="free">Q</span> <span class="main">(</span>minimize_wrt <span class="free">P</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sorted_wrt_filter <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> minimize_wrtD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_minimize_wrt_False<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">Q</span> <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>minimize_wrt <span class="free">P</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="free">y</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">y</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> minimize_wrtD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_minimize_wrtI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>minimize_wrt <span class="free">P</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> minimize_wrt_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minimize_wrt <span class="free">P</span> <span class="free">xs</span> <span class="main">=</span> minimize_wrt <span class="free">Q</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> contra_subsetD filter_cong minimize_wrt_subset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> minimize_wrt_ni<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span>minimize_wrt <span class="free">Q</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="free">Q</span> <span class="bound">y</span> <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_minimize_wrtD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">Q</span> <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>minimize_wrt <span class="free">P</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> in_minimize_wrt_False <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> minimize_wrt_subset <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>3-5<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> in_minimize_wrt_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">Q</span> <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>minimize_wrt <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> in_minimize_wrtD <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> _ assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_minimize_wrtI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_minimize_wrt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">Q</span> <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>minimize_wrt <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_minimize_wrt_iff <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> minimize_wrt_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minimize_wrt <span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>minimize_wrt <span class="free">P</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> filter_cong<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Simple_Algorithm">
<div class="head">
<h1>Theory Simple_Algorithm</h1>
</div>
<pre class="source"><span class="comment1">(*
Author:  Christian Sternagel &lt;c.sternagel@gmail.com&gt;
License: LGPL
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Simple_Algorithm
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Linear_Diophantine_Equations.html">Linear_Diophantine_Equations</a>
    <a href="Minimize_Wrt.html">Minimize_Wrt</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*TODO: move?*)</span>
<span class="keyword1"><span class="command">lemma</span></span> concat_map_nth0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> concat <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Reverse-Lexicographic Enumeration of Potential Minimal Solutions›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rlex2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat list <span class="main">×</span> nat list<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat list <span class="main">×</span> nat list<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub></span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">us</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="free"><span class="bound"><span class="entity">us</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rlex2_irrefl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rlex_irrefl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rlex2_not_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub></span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">y</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rlex_not_sym <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_imp_rlex2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span><span class="main">)</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_imp_rlex <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Generate all lists (of natural numbers) of length <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> with elements bounded by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>B›</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">gen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat list list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span> <span class="main">.</span> xs <span class="main">←</span> <span class="free">gen</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> x <span class="main">←</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">generate</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> tl <span class="main">[</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">.</span> y <span class="main">←</span> gen <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> x <span class="main">←</span> gen <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">check</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∙</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">minimize</span> <span class="main">=</span> minimize_wrt <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">solutions</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> Max <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">B</span> <span class="main">=</span> Max <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">m</span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">;</span> <span class="bound">n</span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">b</span></span></span>
  <span class="keyword1">in</span> minimize <span class="main">(</span>check <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>generate <span class="bound">A</span> <span class="bound">B</span> <span class="bound">m</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_gen<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>gen <span class="free">B</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">B</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?A</span> <span class="free">n</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> set <span class="main">(</span>gen <span class="free">B</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> All_less_Suc2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Suc_eq_0_disj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen2</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">[</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">.</span> y <span class="main">←</span> gen <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> x <span class="main">←</span> gen <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_gen<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sorted_wrt <span class="keyword1">(&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub>)</span> <span class="main">(</span>gen <span class="free">B</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rlex_Cons sorted_wrt_append sorted_wrt_map rlex_irrefl
    <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sorted_wrt_concat_map <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> h <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted">id</span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_gen2<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="keyword1">(&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub>)</span> <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sorted_wrt_concat_map_map <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">(&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub>)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> sorted_wrt_gen<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_gen rlex_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>  lex_append_leftI lex_append_rightI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gen_ne <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gen <span class="free">B</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> gen2_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_generate<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="keyword1">(&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub>)</span> <span class="main">(</span>generate <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> generate_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_wrt_tl sorted_wrt_gen2<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">check_generate</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> check <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>generate <span class="main">(</span>Max <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_check_generate<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="keyword1">(&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub>)</span> <span class="main">(</span>check_generate <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> check_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_wrt_filter sorted_wrt_generate<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_tl_gen2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list.set_sel<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> gen_nth0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gen <span class="free">B</span> <span class="free">n</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> zeroes <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append concat_map_nth0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gen2_nth0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span>zeroes <span class="free">m</span><span class="main">,</span> zeroes <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> concat_map_nth0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_gen2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> length <span class="bound">x</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> length <span class="bound">y</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="bound">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">y</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">B</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_gen<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gen2_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span> <span class="main">!</span> <span class="free">i</span> <span class="main">≠</span> gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span> <span class="main">!</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sorted_wrt_nth_less <span class="main">[</span><span class="operator">OF</span> sorted_wrt_gen2 assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rlex2_irrefl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zeroes_ni_tl_gen2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>zeroes <span class="free">m</span><span class="main">,</span> zeroes <span class="free">n</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span>zeroes <span class="free">m</span><span class="main">,</span> zeroes <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> generate_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> gen2_unique<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="main">_</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1 in_set_conv_nth length_tl less_diff_conv nth_tl zero_less_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_generate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>generate <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>zeroes <span class="free">m</span><span class="main">,</span> zeroes <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>generate <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span>
    <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>zeroes <span class="free">m</span><span class="main">,</span> zeroes <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_tl_gen2 <span class="keyword2"><span class="keyword">and</span></span> mem_Collect_eq <span class="keyword2"><span class="keyword">and</span></span> zeroes_ni_tl_gen2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> generate_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>zeroes <span class="free">m</span><span class="main">,</span> zeroes <span class="free">n</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>generate <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span>zeroes <span class="free">m</span><span class="main">,</span> zeroes <span class="free">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_empty_right generate_def Un_insert_right gen2_ne calculation list.exhaust_sel list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>zeroes <span class="free">m</span><span class="main">,</span> zeroes <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span>
    <span class="main">⊆</span> set <span class="main">(</span>generate <span class="free">A</span> <span class="free">B</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_check_generate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>check_generate <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span>
    <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    length <span class="bound">x</span> <span class="main">=</span> length <span class="free">a</span> <span class="main">∧</span> length <span class="bound">y</span> <span class="main">=</span> length <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">y</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">a</span><span class="main">.</span> <span class="bound">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">b</span><span class="main">.</span> <span class="bound">y</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> check_def <span class="keyword2"><span class="keyword">and</span></span> set_filter <span class="keyword2"><span class="keyword">and</span></span> set_generate <span class="keyword2"><span class="keyword">and</span></span> set_gen2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> set_minimize_check_generate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>minimize <span class="main">(</span>check_generate <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">x</span></span><span class="main">,</span> <span class="bound"><span class="bound">y</span></span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>check_generate <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>check_generate <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minimize_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_minimize_wrt <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ sorted_wrt_check_generate<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rlex_not_sym less_imp_rlex<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_solutions_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">x</span></span><span class="main">,</span> <span class="bound"><span class="bound">y</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>check_generate <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>check_generate <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> solutions_def set_minimize_check_generate<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness: every minimal solution is generated by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>solutions›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> solutions_complete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Minimal_Solutions <span class="main">⊆</span> set <span class="main">(</span>solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subrelI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>check <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>generate <span class="var">?A</span> <span class="var">?B</span> m n<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Minimal_Solutions_alt_def set_check_generate less_eq_def in_Solutions_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>check <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>generate <span class="var">?A</span> <span class="var">?B</span> m n<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> min <span class="keyword2"><span class="keyword">and</span></span> no0
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> check_def set_generate neq_0_iff' set_gen nonzero_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Minimal_Solutions_min<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_solutions_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Correctness: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>solutions›</span></span></span></span> generates only minimal solutions.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> solutions_sound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊆</span> Minimal_Solutions"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subrelI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Minimal_SolutionsI'<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sol <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_solutions_iff in_Solutions_iff check_def set_generate set_gen<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sol <span class="keyword2"><span class="keyword">and</span></span> nonzero_iff <span class="keyword2"><span class="keyword">and</span></span> replicate_eqI <span class="keyword2"><span class="keyword">and</span></span> nonzero_Solutions_iff <span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> solutions_def minimize_def check_def set_generate set_gen <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> minimize_wrtD<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span>Minimal_Solutions<span class="main">.</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> min_cg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>minimize <span class="main">(</span>check_generate <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sol <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> solutions_def<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> in_minimize_wrt_False <span class="main">[</span><span class="operator">OF</span> _ sorted_wrt_check_generate min_cg <span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> minimize_def<span class="main"><span class="main">]</span></span><span class="main">]</span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span>Minimal_Solutions<span class="main">.</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span> <span class="keyword2"><span class="keyword">and</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">@</span> <span class="skolem">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> solutions_complete <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>check_generate <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> solutions_def minimize_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> minimize_wrtD<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> * <span class="main">[</span><span class="operator">OF</span> _ _ _ this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> less_imp_rlex <span class="keyword2"><span class="keyword">and</span></span> rlex_not_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> set_solutions <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Minimal_Solutions"</span></span>
  <span class="keyword1"><span class="command">using</span></span> solutions_sound <span class="keyword2"><span class="keyword">and</span></span> solutions_complete <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Algorithm">
<div class="head">
<h1>Theory Algorithm</h1>
</div>
<pre class="source"><span class="comment1">(*
Author:  Christian Sternagel &lt;c.sternagel@gmail.com&gt;
License: LGPL
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Computing Minimal Complete Sets of Solutions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Algorithm
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Simple_Algorithm.html">Simple_Algorithm</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> all_Suc_le_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span>Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_Suc_eq_0_disj nat_less_le order_refl<span class="main">)</span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> concat_map_filter_filter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">⟹</span> filter <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>map <span class="main">(</span>filter <span class="free">P</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>filter <span class="free">P</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> filter_pairs_conj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">y</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="free">Q</span> <span class="main">∘</span> snd<span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(*TODO: move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> concat_map_filter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"concat <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">alls</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">alls</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">alls</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>xs<span class="main">,</span> s<span class="main">)</span> <span class="main">←</span> <span class="free">alls</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">,</span> x <span class="main">←</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> alls_ne <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"alls <span class="free">B</span> <span class="free">as</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> append_is_Nil_conv case_prod_conv list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
     neq_Nil_conv old.prod.exhaust<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_alls<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>alls <span class="free">B</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> length <span class="bound">x</span> <span class="main">=</span> length <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">a</span><span class="main">.</span> <span class="bound">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">B</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="free">a</span> <span class="main">=</span> <span class="var">?R</span> <span class="free">a</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="free">a</span> <span class="main">⊆</span> <span class="var">?R</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="free">a</span> <span class="main">⊆</span> <span class="var">?L</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">∈</span> <span class="var">?R</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">,</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">as</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">as</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> All_less_Suc2<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">as</span> <span class="main">∙</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?L</span> <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">∈</span> <span class="var">?L</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> B
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bexI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">xs</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="main"><span class="main">∙</span></span> <span class="skolem"><span class="skolem">xs</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> alls_nth0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"alls <span class="free">A</span> <span class="free">as</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">as</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append concat_map_nth0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> alls_Cons_tl_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"alls <span class="free">A</span> <span class="free">as</span> <span class="main">=</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">as</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> tl <span class="main">(</span>alls <span class="free">A</span> <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons nth_tl <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_alls<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sorted_wrt <span class="keyword1">(&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub>)</span> <span class="main">(</span>map fst <span class="main">(</span>alls <span class="free">B</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_concat rlex_Cons sorted_wrt_append
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sorted_wrt_concat_map sorted_wrt_map_mono <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">alls2</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span><span class="main">.</span> ys <span class="main">←</span> alls <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> xs <span class="main">←</span> alls <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> alls2_ne <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"alls2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alls2_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> alls_ne list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neq_Nil_conv surj_pair<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_alls2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>alls2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> length <span class="bound">x</span> <span class="main">=</span> length <span class="free">a</span> <span class="main">∧</span> length <span class="bound">y</span> <span class="main">=</span> length <span class="free">b</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">a</span><span class="main">.</span> <span class="bound">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">b</span><span class="main">.</span> <span class="bound">y</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">B</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alls2_def set_alls<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> alls2_nth0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"alls2 <span class="free">A</span> <span class="free">B</span> <span class="free">as</span> <span class="free">bs</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">as</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">bs</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alls2_def concat_map_nth0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> alls2_Cons_tl_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"alls2 <span class="free">A</span> <span class="free">B</span> <span class="free">as</span> <span class="free">bs</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">as</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">bs</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> tl <span class="main">(</span>alls2 <span class="free">A</span> <span class="free">B</span> <span class="free">as</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alls2_def nth_Cons nth_tl length_concat concat_map_nth0 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"alls <span class="free">B</span> <span class="free">bs</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">gen2</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">gen2</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">,</span> fst <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>alls2 <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_gen2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sorted_wrt <span class="keyword1">(&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub>)</span> <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sorted_wrt_map_mono <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">u</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">v</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span>fst <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> fst <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">(</span></span>fst <span class="bound"><span class="bound">u</span></span><span class="main"><span class="main">,</span></span> fst <span class="bound"><span class="bound">v</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alls2_def map_concat<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> rlex2.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sorted_wrt_concat_map_map<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sorted_wrt_map_distr<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sorted_wrt_alls<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sorted_wrt_map_distr<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sorted_wrt_alls<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rlex_def set_alls <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> lex_append_leftI lex_append_rightI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">generate'</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">generate'</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> tl <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">,</span> fst <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>alls2 <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_generate'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sorted_wrt <span class="keyword1">(&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub>)</span> <span class="main">(</span>generate' <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> generate'_def sorted_wrt_gen2 sorted_wrt_tl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gen2_nth0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> gen2_ne <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gen2 <span class="free">m</span> <span class="free">n</span> <span class="free">b</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> in_generate'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>generate' <span class="free">m</span> <span class="free">n</span> <span class="free">c</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>gen2 <span class="free">m</span> <span class="free">n</span> <span class="free">c</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> generate'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list.set_sel<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cond_cons</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ys</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">ys</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> True <span class="main">|</span> <span class="bound">ys</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">ys</span> <span class="bound">s</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cond_cons_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cond_cons <span class="free">P</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
  <span class="quoted"><span class="quoted">"cond_cons <span class="free">P</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_cons_def<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">suffs</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">suffs</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">⟷</span>
      length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">∧</span>
      <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> cond_cons <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>drop <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> drop <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">∙</span> drop <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">declare</span></span> suffs.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> suffs_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"suffs <span class="free">P</span> <span class="main">[]</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suffs.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> suffs_Cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"suffs <span class="free">P</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">as</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⟷</span>
    <span class="free">s</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">as</span> <span class="main">∙</span> <span class="free">xs</span> <span class="main">∧</span> cond_cons <span class="free">P</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∧</span> suffs <span class="free">P</span> <span class="free">as</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">as</span> <span class="main">∙</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suffs.simps cond_cons_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Suc_le_mono drop_Suc_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_le_mono Suc_pred dotprod_Cons drop_Cons' le_0_eq not_le_imp_less<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Algorithm›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">maxne0_impl</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">maxne0_impl</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxne0_impl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxne0_impl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> max <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free">maxne0_impl</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">maxne0_impl</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> maxne0_impl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maxne0_impl <span class="free">x</span> <span class="free">a</span> <span class="main">=</span> maxne0 <span class="free">x</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> maxne0_impl_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"maxne0_impl <span class="free">x</span> <span class="free">a</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="main">(</span><span class="free">a</span><span class="main">::</span>nat list<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> maxne0_impl.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max.coboundedI2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.finite_set Max_insert Nat.le0 le_max_iff_disj maxne0_impl.elims maxne0_impl.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_empty<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">special_solutions</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat list <span class="main">×</span> nat list<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">special_solutions</span> <span class="main">=</span> <span class="main">[</span>sij <span class="free">a</span> <span class="free">b</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> i <span class="main">←</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">a</span><span class="main">]</span><span class="main">,</span> j <span class="main">←</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">b</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">big_e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> nat list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">big_e</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> eij <span class="free">a</span> <span class="free">b</span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≥</span> dij <span class="free">a</span> <span class="free">b</span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">big_d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> nat list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">big_d</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> dij <span class="free">a</span> <span class="free">b</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≥</span> eij <span class="free">a</span> <span class="free">b</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">big_d'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> nat list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">big_d'</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">l</span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">;</span> <span class="bound">n</span> <span class="main">=</span> length <span class="free">b</span> <span class="keyword1">in</span>
      <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">&gt;</span> <span class="bound">n</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">k</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">-</span> <span class="bound">l</span> <span class="keyword1">in</span>
      map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> dij <span class="free">a</span> <span class="free">b</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≥</span> eij <span class="free">a</span> <span class="free">b</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_y_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">max_y_impl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">&lt;</span> length <span class="free">b</span> <span class="main">∧</span> big_e <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="keyword1">then</span> Min <span class="main">(</span>set <span class="main">(</span>big_e <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">else</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_x_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">max_x_impl</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="free">a</span> <span class="main">∧</span> big_d <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="keyword1">then</span> Min <span class="main">(</span>set <span class="main">(</span>big_d <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">else</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_x_impl'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">max_x_impl'</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="free">a</span> <span class="main">∧</span> big_d' <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="keyword1">then</span> Min <span class="main">(</span>set <span class="main">(</span>big_d' <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">else</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cond_a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">cond_a</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> maxne0 <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cond_b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">cond_b</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>length <span class="free">a</span><span class="main">.</span>
      take <span class="bound">k</span> <span class="free">a</span> <span class="main">∙</span> take <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="main">(</span>map <span class="main">(</span>max_y_impl <span class="main">(</span>take <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">b</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">boundr_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">boundr_impl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">b</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">!</span> <span class="bound">j</span> <span class="main">≤</span> max_y_impl <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cond_d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">cond_d</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">l</span></span><span class="main">≤</span>length <span class="free">b</span><span class="main">.</span> take <span class="bound">l</span> <span class="free">b</span> <span class="main">∙</span> take <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subdprodr_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">subdprodr_impl</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">l</span></span><span class="main">≤</span>length <span class="free">b</span><span class="main">.</span>
      take <span class="bound">l</span> <span class="free">b</span> <span class="main">∙</span> take <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x_impl <span class="main">(</span>take <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">a</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subdprodl_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">subdprodl_impl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>length <span class="free">a</span><span class="main">.</span> take <span class="bound">k</span> <span class="free">a</span> <span class="main">∙</span> take <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">boundl_impl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">a</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> max_x_impl <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">static_bounds</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">static_bounds</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">mx</span> <span class="main">=</span> maxne0_impl <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free">b</span><span class="main">;</span> <span class="bound">my</span> <span class="main">=</span> maxne0_impl <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free">a</span> <span class="keyword1">in</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">mx</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">my</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">check_cond</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> static_bounds <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">y</span> <span class="main">∧</span> boundr_impl <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> subdprodl_impl <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> subdprodr_impl <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">check'</span> <span class="main">=</span> filter check_cond"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">non_special_solutions</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">;</span> <span class="bound">B</span> <span class="main">=</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>
  <span class="keyword1">in</span> minimize <span class="main">(</span>check' <span class="main">(</span>generate' <span class="bound">A</span> <span class="bound">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">solve</span> <span class="main">=</span> special_solutions <span class="main">@</span> non_special_solutions"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_wrt_check_generate'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sorted_wrt <span class="keyword1">(&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>2</sub>)</span> <span class="main">(</span>check' <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>generate' <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> check'_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sorted_wrt_filter sorted_wrt_generate' sorted_wrt_tl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> big_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>big_e <span class="free">a</span> <span class="free">b</span> <span class="free">xs</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> hlde_ops.Ej <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.Ej_def big_e_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> big_d<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>big_d <span class="free">a</span> <span class="free">b</span> <span class="free">ys</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> hlde_ops.Di <span class="free">a</span> <span class="free">b</span> <span class="free">i</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.Di_def big_d_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> big_d'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">≤</span> length <span class="free">b</span> <span class="main">⟹</span> set <span class="main">(</span>big_d' <span class="free">a</span> <span class="free">b</span> <span class="free">ys</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> hlde_ops.Di' <span class="free">a</span> <span class="free">b</span> <span class="free">i</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.Di'_def big_d'_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> max_y_impl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"max_y_impl <span class="free">a</span> <span class="free">b</span> <span class="free">x</span> <span class="free">j</span> <span class="main">=</span> hlde_ops.max_y <span class="free">a</span> <span class="free">b</span> <span class="free">x</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_y_impl_def big_e hlde_ops.max_y_def set_empty <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> max_x_impl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"max_x_impl <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span> <span class="main">=</span> hlde_ops.max_x <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_x_impl_def big_d hlde_ops.max_x_def set_empty <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> max_x_impl'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">≤</span> length <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_x_impl' <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span> <span class="main">=</span> hlde_ops.max_x' <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_x_impl'_def big_d' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> hlde_ops.max_x'_def set_empty <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> cond_a <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cond_a <span class="free">b</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> cond_A <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cond_a_def cond_A_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> cond_b <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cond_b <span class="free">a</span> <span class="free">b</span> <span class="free">x</span> <span class="main">=</span> cond_B <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> max_y_impl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_b_def cond_B_def<span class="main">)</span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> boundr_impl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"boundr_impl <span class="free">a</span> <span class="free">b</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> boundr <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundr_impl_def boundr_def max_y_impl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> cond_d <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cond_d <span class="free">a</span> <span class="free">b</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> cond_D <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cond_d_def cond_D_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> subdprodr_impl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"subdprodr_impl <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="main">=</span> subdprodr <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> max_x_impl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdprodr_impl_def subdprodr_def<span class="main">)</span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> subdprodl_impl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"subdprodl_impl <span class="free">a</span> <span class="free">b</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> subdprodl <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdprodl_impl_def subdprodl_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> cond_bound_impl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"boundl_impl <span class="free">a</span> <span class="free">b</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> boundl <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundl_impl_def boundl_def max_x_impl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> check <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"check' <span class="free">a</span> <span class="free">b</span> <span class="main">=</span>
    filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> static_bounds <span class="free">a</span> <span class="free">b</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">y</span> <span class="main">∧</span> boundr <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span>
    subdprodl <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span>
    subdprodr <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> check'_def check_cond_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  conditions B, C, and D from Huet as well as "subdprodr" and "subdprodl" are
  preserved by smaller solutions
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> le_imp_conds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> m"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> n"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cond_B <span class="free">x</span> <span class="main">⟹</span> cond_B <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"boundr <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> boundr <span class="free">u</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="free">u</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">v</span> <span class="main">⟹</span> cond_D <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> cond_D <span class="free">u</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="free">u</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">v</span> <span class="main">⟹</span> subdprodl <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> subdprodl <span class="free">u</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subdprodr <span class="free">y</span> <span class="main">⟹</span> subdprodr <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"cond_B <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">u</span> <span class="main">=</span> m"</span></span> <span class="keyword1"><span class="command">using</span></span> len <span class="keyword2"><span class="keyword">and</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cond_B <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> cond_B_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> m"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="skolem">k</span> <span class="free">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> take <span class="skolem">k</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> m"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> le <span class="keyword2"><span class="keyword">and</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_take<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> len<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">k</span> <span class="free">a</span> <span class="main">∙</span> take <span class="skolem">k</span> <span class="free">u</span> <span class="main">≤</span> take <span class="skolem">k</span> <span class="free">a</span> <span class="main">∙</span> take <span class="skolem">k</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dotprod_le_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> len<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> map <span class="main">(</span>max_y <span class="main">(</span>take <span class="skolem">k</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>n<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> k <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_B_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> map <span class="main">(</span>max_y <span class="main">(</span>take <span class="skolem">k</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>n<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_imp_max_y_ge <span class="main">[</span><span class="operator">OF</span> * <span class="main"><span class="main">[</span></span><span class="operator">OF</span> k<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> len <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dotprod_le_right less_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">k</span> <span class="free">a</span> <span class="main">∙</span> take <span class="skolem">k</span> <span class="free">u</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> map <span class="main">(</span>max_y <span class="main">(</span>take <span class="skolem">k</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>n<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> subdprodr<span class="main">:</span> <span class="quoted"><span class="quoted">"subdprodr <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v</span> <span class="main">=</span> n"</span></span> <span class="keyword1"><span class="command">using</span></span> len <span class="keyword2"><span class="keyword">and</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subdprodr <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> subdprodr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
    <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> n"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="skolem">l</span> <span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> take <span class="skolem">l</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> n"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span>
      <span class="keyword1"><span class="command">using</span></span> le <span class="keyword2"><span class="keyword">and</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_take<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> len<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">l</span> <span class="free">b</span> <span class="main">∙</span> take <span class="skolem">l</span> <span class="free">v</span> <span class="main">≤</span> take <span class="skolem">l</span> <span class="free">b</span> <span class="main">∙</span> take <span class="skolem">l</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dotprod_le_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> len<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x <span class="main">(</span>take <span class="skolem">l</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>m<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> l <span class="keyword2"><span class="keyword">and</span></span> subdprodr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdprodr_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x <span class="main">(</span>take <span class="skolem">l</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>m<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_imp_max_x_ge <span class="main">[</span><span class="operator">OF</span> * <span class="main"><span class="main">[</span></span><span class="operator">OF</span> l<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> len <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dotprod_le_right less_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">l</span> <span class="free">b</span> <span class="main">∙</span> take <span class="skolem">l</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x <span class="main">(</span>take <span class="skolem">l</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>m<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"boundr <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"boundr <span class="free">u</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_imp_max_y_ge <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span>›</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> le
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> boundr_def len less_eq_def<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="free">u</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cond_D <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cond_D <span class="free">u</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_D_def len le_length <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dotprod_le_take<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="free">u</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subdprodl <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subdprodl <span class="free">u</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subdprodl_def dotprod_le_take le_length len<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> special_solutions <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>special_solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Special_Solutions"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>special_solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊆</span> Special_Solutions"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Special_Solutions_def special_solutions_def<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Special_Solutions <span class="main">⊆</span> set <span class="main">(</span>special_solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Special_Solutions_def special_solutions_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_gen2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> replicate <span class="main">(</span>length <span class="free">a</span><span class="main">)</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">y</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> replicate <span class="main">(</span>length <span class="free">b</span><span class="main">)</span> <span class="free">B</span><span class="main">}</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subrelI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="skolem">ys</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">=</span> length <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="free">a</span> <span class="main">∙</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> <span class="free">b</span> <span class="main">∙</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>alls2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_alls2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">,</span> fst <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="free">a</span> <span class="main">∙</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> <span class="free">b</span> <span class="main">∙</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">,</span> fst <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set <span class="main">(</span>alls2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def set_alls2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_gen2'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">,</span> fst <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set <span class="main">(</span>alls2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> replicate <span class="main">(</span>length <span class="free">a</span><span class="main">)</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">y</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> replicate <span class="main">(</span>length <span class="free">b</span><span class="main">)</span> <span class="free">B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_gen2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> in_non_special_solutions<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>non_special_solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> minimize_wrtD in_generate'
    <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> non_special_solutions_def in_Solutions_iff minimize_def set_alls2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> generate_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span>generate <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="main">!</span> <span class="free">i</span> <span class="main">≠</span> generate <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="main">!</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sorted_wrt_nth_less <span class="main">[</span><span class="operator">OF</span> sorted_wrt_generate assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rlex2_irrefl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gen2_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="main">!</span> <span class="free">i</span> <span class="main">≠</span> gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="main">!</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sorted_wrt_nth_less <span class="main">[</span><span class="operator">OF</span> sorted_wrt_gen2 assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rlex2_irrefl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zeroes_ni_generate'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>generate' <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> gen2_unique <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="main">_</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_nth nth_tl generate'_def<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_eq_plus1 less_diff_conv zero_less_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_generate'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>generate' <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>generate' <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>
        <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_generate' <span class="keyword2"><span class="keyword">and</span></span> mem_Collect_eq <span class="keyword2"><span class="keyword">and</span></span> zeroes_ni_generate' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>tl <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_empty_right Un_insert_right gen2_ne calculation list.exhaust_sel list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>gen2 <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">}</span>
        <span class="main">⊆</span> set <span class="main">(</span>generate' <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> generate'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_generate''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>generate' <span class="free">A</span> <span class="free">B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> replicate <span class="main">(</span>length <span class="free">a</span><span class="main">)</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">y</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> replicate <span class="main">(</span>length <span class="free">b</span><span class="main">)</span> <span class="free">B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_generate' set_gen2'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> zeroes_ni_non_special_solutions<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>zeroes m<span class="main">,</span> zeroes n<span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>non_special_solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">All_lex</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    All_lex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">All_lex</span> <span class="main">=</span> gen2 <span class="main">(</span>Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span>zeroes m<span class="main">,</span> zeroes n<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>non_special_solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>tl <span class="main">(</span><span class="skolem">All_lex</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> All_lex generate'_def non_special_solutions_def minimize_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> minimize_wrtD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="main">(</span><span class="skolem">All_lex</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeroes_ni_generate' All_lex z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> generate'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Correctness: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>solve›</span></span></span></span> generates only minimal solutions.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> solve_subset_Minimal_Solutions<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>solve <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊆</span> Minimal_Solutions"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subrelI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>solve <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>special_solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>non_special_solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> solve_def <span class="keyword2"><span class="keyword">and</span></span> set_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Special_Solutions"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> special_solutions <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Special_Solutions_in_Minimal_Solutions<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">←</span> generate' <span class="var">?b</span> <span class="var">?a</span> <span class="free">a</span> <span class="free">b</span><span class="main">.</span>
      static_bounds <span class="free">a</span> <span class="free">b</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">y</span> <span class="main">∧</span> boundr <span class="bound">x</span> <span class="bound">y</span> <span class="comment1">⌦‹∧ cond_B x ∧ cond_D x y›</span> <span class="main">∧</span>
      subdprodl <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span>
      subdprodr <span class="bound">y</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> conds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">∈</span>set <span class="skolem">x</span><span class="main">.</span> <span class="bound">e</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"boundr <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="comment1">(*"cond_B x" "cond_D x y"*)</span>
      <span class="quoted"><span class="quoted">"subdprodl <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"subdprodr <span class="skolem">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>minimize <span class="var">?xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> non_special_solutions_def minimize_def set_alls2
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> minimize_wrtD in_generate'<span class="main">)</span>
        <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Solutions"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> solve_def Special_Solutions_in_Solutions in_non_special_solutions<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> m"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">y</span> <span class="main">=</span> n"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Solutions_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonzero <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sol Solutions_snd_not_0 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"2"</span> eq_0_iff len nonzero_Solutions_iff nonzero_iff zeroes_ni_non_special_solutions<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions<span class="main">.</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> static_bounds <span class="free">a</span> <span class="free">b</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">y</span> <span class="main">∧</span> boundr <span class="bound">x</span> <span class="bound">y</span> <span class="comment1">⌦‹∧ cond_B x ∧ cond_D x y›</span> <span class="main">∧</span>
        subdprodl <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span>
        subdprodr <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">note</span></span> sorted <span class="main">=</span> sorted_wrt_generate' <span class="main">[</span><span class="operator">THEN</span> sorted_wrt_filter<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> in_minimize_wrt_False <span class="main">[</span><span class="operator">OF</span> _ sorted<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">,</span> <span class="operator">OF</span> _ xs <span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> minimize_def<span class="main"><span class="main">]</span></span><span class="main">]</span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span>Minimal_Solutions<span class="main">.</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span> <span class="keyword2"><span class="keyword">and</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">@</span> <span class="skolem">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> uv <span class="keyword2"><span class="keyword">and</span></span> less <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sol'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"nonzero <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sol <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Minimal_Solutions_def Solutions_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> less_append_cases<span class="main">)</span>
      <span class="comment1">(*with le_imp_conds [OF le conds(2-)]*)</span>
      <span class="keyword1"><span class="command">with</span></span> le_imp_conds<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> le<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> conds<span class="main">(</span>2-<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> conds'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">∈</span>set <span class="skolem">u</span><span class="main">.</span> <span class="bound">e</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"boundr <span class="skolem">u</span> <span class="skolem">v</span>"</span></span> <span class="comment1">(*"cond_B u" "cond_D u v"*)</span>
        <span class="quoted"><span class="quoted">"subdprodl <span class="skolem">u</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"subdprodr <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> conds<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> len less_eq_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth le_trans len<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"static_bounds <span class="free">a</span> <span class="free">b</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> max_coeff_bound <span class="main">[</span><span class="operator">OF</span> uv<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> Minimal_Solutions_length <span class="main">[</span><span class="operator">OF</span> uv<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> static_bounds_def maxne0_impl<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> replicate m <span class="var">?b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xs set_generate' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
          cond_A_def conds<span class="main">(</span>1<span class="main">)</span> le_replicateI len <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> replicate n <span class="var">?a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eqI minimize_def set_generate' set_alls2 <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> minimize_wrtD<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?xs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sol' <span class="keyword2"><span class="keyword">and</span></span> set_generate'' <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> uv <span class="main">[</span><span class="operator">THEN</span> Minimal_Solutions_imp_Solutions<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> nonzero
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_gen2<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> in_set_replicate le order_vec.dual_order.trans nonzero_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> * <span class="main">[</span><span class="operator">OF</span> _ _ _ this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> less_imp_rlex <span class="keyword2"><span class="keyword">and</span></span> rlex_not_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Minimal_SolutionsI' sol<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness: every minimal solution is generated by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>solve›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> Minimal_Solutions_subset_solve<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Minimal_Solutions <span class="main">⊆</span> set <span class="main">(</span>solve <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subrelI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Minimal_Solutions"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> m"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">y</span> <span class="main">=</span> n"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> zeroes m <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">=</span> zeroes n <span class="main">⟹</span> False"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Minimal_Solutions_def Solutions_def nonzero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>special<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Special_Solutions"</span></span>
    <span class="main">|</span> <span class="main">(</span>not_special<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> Special_Solutions"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>solve <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> special
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> no0 solve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">all</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">all</span> <span class="main">=</span> generate' <span class="main">(</span>Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>check' <span class="free">a</span> <span class="free">b</span> <span class="skolem">all</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> min <span class="keyword2"><span class="keyword">and</span></span> no0
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> all_def set_generate'' neq_0_iff' nonzero_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Minimal_Solutions_min<span class="main">)</span>

    <span class="keyword3"><span class="command">case</span></span> not_special
    <span class="keyword1"><span class="command">from</span></span> conds <span class="main">[</span><span class="operator">OF</span> min<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> not_special
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>check' <span class="free">a</span> <span class="free">b</span> <span class="skolem">all</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> max_coeff_bound <span class="main">[</span><span class="operator">OF</span> min<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> maxne0_le_Max
        <span class="keyword2"><span class="keyword">and</span></span> Minimal_Solutions_length <span class="main">[</span><span class="operator">OF</span> min<span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sol all_def set_generate'' cond_A_def less_eq_def static_bounds_def maxne0_impl<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> le_trans nth_mem sol<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_trans nth_mem sol<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> in_minimize_wrtI <span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">u</span> <span class="main">@</span> <span class="bound">v</span>"</span></span><span class="main">]</span> *
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>non_special_solutions <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> non_special_solutions_def minimize_def all_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solve_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The main correctness and completeness result of our algorithm.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> hlde<span class="main">)</span> solve <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>solve <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Minimal_Solutions"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Minimal_Solutions_subset_solve <span class="keyword2"><span class="keyword">and</span></span> solve_subset_Minimal_Solutions <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Making the Algorithm More Efficient›</span></span>

<span class="keyword1"><span class="command">locale</span></span> bounded_gen_check <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xs</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> False"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cond_antimono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">x'</span> <span class="bound">xs</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">s'</span> <span class="main">≤</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">(</span><span class="bound">x'</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">incs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span>nat list <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat list <span class="main">×</span> nat<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">incs</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">t</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">in</span>
      <span class="keyword1">if</span> <span class="free">C</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="bound">t</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">#</span> <span class="free">incs</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">termination</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="free">B</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> wf_measure<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">&gt;</span> <span class="free">B</span>"</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">use</span> bound <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> incs.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> in_incs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ys</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>incs <span class="free">a</span> <span class="free">x</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">t</span> <span class="main">=</span> <span class="free">s</span> <span class="main">+</span> hd <span class="free">ys</span> <span class="main">*</span> <span class="free">a</span> <span class="main">∧</span> tl <span class="free">ys</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">C</span> <span class="free">ys</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> incs.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> incs.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> incs_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="free">B</span> <span class="main">⟹</span> incs <span class="free">a</span> <span class="free">x</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> incs.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incs.simps bound<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> incs_filter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"incs <span class="free">a</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> filter <span class="main">(</span>cond_cons <span class="free">C</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free">x</span> <span class="main">..&lt;</span> <span class="free">B</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xss</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"incs <span class="free">a</span> <span class="free">x</span> <span class="skolem">xss</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> filter <span class="main">(</span>cond_cons <span class="free">C</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free">x</span> <span class="main">..&lt;</span> <span class="free">B</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xss</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="skolem">xss</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> incs.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> incs.simps <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">B</span>"</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_empty_conv Let_def cond_cons_def upt_conv_Cons <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cond_antimono<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">gen_check</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> <span class="main">(</span>nat list <span class="main">×</span> nat<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">gen_check</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen_check</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>incs <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">gen_check</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gen_check_len<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ys</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>gen_check <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">la</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>gen_check <span class="skolem">as</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>incs <span class="skolem">a</span> <span class="main">0</span> <span class="main">(</span><span class="bound">la</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span>  <span class="skolem"><span class="skolem">la</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">la</span><span class="main">,</span><span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>gen_check <span class="skolem">as</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">=</span> length <span class="skolem">la</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cons.hyps case_prodE in_incs<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">la</span> <span class="main">=</span> length <span class="skolem">as</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation
    <span class="keyword1"><span class="command">using</span></span> Cons.hyps Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_gen_check<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>gen_check <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">as</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> <span class="free">as</span> <span class="main">∙</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_incs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_incs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> gen_check_filter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_check <span class="free">as</span> <span class="main">=</span> filter <span class="main">(</span>suffs <span class="free">C</span> <span class="free">as</span><span class="main">)</span> <span class="main">(</span>alls <span class="free">B</span> <span class="free">as</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span>suffs <span class="free">C</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>alls <span class="free">B</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> cond_cons <span class="free">C</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> suffs <span class="free">C</span> <span class="skolem">as</span> <span class="main">(</span>tl <span class="bound">xs</span><span class="main">,</span> <span class="skolem">as</span> <span class="main">∙</span> tl <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>alls <span class="free">B</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filter_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_alls suffs.simps all_Suc_le_conv <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
    concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> filter <span class="main">(</span>cond_cons <span class="free">C</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">B</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>filter <span class="main">(</span>suffs <span class="free">C</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">(</span>alls <span class="free">B</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> alls.simps
    <span class="keyword1"><span class="command">unfolding</span></span> filter_concat
    <span class="keyword1"><span class="command">unfolding</span></span> map_map
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> concat_map_filter_filter <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"suffs <span class="free"><span class="free"><span class="free">C</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">as</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_alls <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> arg_cong <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted">concat</span><span class="main"><span class="main">]</span></span> filter_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span>suffs <span class="free">C</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>alls <span class="free">B</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span>
      filter <span class="main">(</span>cond_cons <span class="free">C</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">B</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span>suffs <span class="free">C</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">(</span>alls <span class="free">B</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_check <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">=</span> filter <span class="main">(</span>suffs <span class="free">C</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>alls <span class="free">B</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incs_filter <span class="main"><span class="main">[</span></span><span class="operator">OF</span> zero_le<span class="main"><span class="main">]</span></span> Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> in_gen_check_cond<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>gen_check <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span>length <span class="free">xs</span><span class="main">.</span> drop <span class="bound">j</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">C</span> <span class="main">(</span>drop <span class="bound">j</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> take <span class="bound">j</span> <span class="free">as</span> <span class="main">∙</span> take <span class="bound">j</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">j</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_incs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_gen_check<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sorted_wrt <span class="keyword1">(&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub>)</span> <span class="main">(</span>map fst <span class="main">(</span>gen_check <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> sort_map<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>map fst <span class="main">(</span>alls <span class="free">B</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sorted_wrt_alls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> fst <span class="bound">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> fst <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>alls <span class="free">B</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sorted_wrt_map_distr <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub>)</span>"</span></span> <span class="quoted">fst</span> <span class="quoted"><span class="quoted">"alls <span class="free">B</span> <span class="free">xs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> fst <span class="bound">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub></span> fst <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span>suffs <span class="free">C</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>alls <span class="free">B</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sorted_wrt_alls sorted_wrt_filter sorted_wrt_map
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> gen_check_filter
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold sorted_wrt_map_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> bounded_generate_check <span class="main">=</span>
  c2<span class="main">:</span> bounded_gen_check <span class="quoted"><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quoted"><span class="free">B<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">B<span class="hidden">⇩</span><sub>1</sub></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cond1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span> <span class="bound">ys</span><span class="main">.</span> <span class="bound">ys</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="main">(</span>c2.gen_check <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> bounded_gen_check <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">b</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">(</span><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">generate_check</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
  <span class="main">[</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span><span class="main">.</span> ys <span class="main">←</span> c2.gen_check <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> xs <span class="main">←</span> bounded_gen_check.gen_check <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>fst <span class="bound">ys</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> generate_check_filter_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"generate_check <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span><span class="main">.</span>
    ys <span class="main">←</span> filter <span class="main">(</span>suffs <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>alls <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">b</span><span class="main">)</span><span class="main">,</span>
    xs <span class="main">←</span> filter <span class="main">(</span>suffs <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span>fst <span class="bound">ys</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>alls <span class="main">(</span><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bounded_gen_check.gen_check_filter <span class="main">[</span><span class="operator">OF</span> cond1<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> generate_check_def c2.gen_check_filter <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> arg_cong <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted">concat</span><span class="main"><span class="main">]</span></span> map_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> generate_check_filter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"generate_check <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">←</span> alls2 <span class="main">(</span><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span><span class="main">)</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">a</span> <span class="free">b</span><span class="main">.</span> suffs <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span>fst <span class="bound">ys</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="bound">xs</span> <span class="main">∧</span> suffs <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">b</span> <span class="bound">ys</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arg_cong <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted">concat</span><span class="main"><span class="main">]</span></span>
    <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> generate_check_filter_conv alls2_def filter_concat concat_map_filter filter_map o_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tl_generate_check_filter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"suffs <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffs <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">b</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tl <span class="main">(</span>generate_check <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">←</span> tl <span class="main">(</span>alls2 <span class="main">(</span><span class="free">B<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span><span class="main">)</span> <span class="free">B<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">.</span> suffs <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span>fst <span class="bound">ys</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="bound">xs</span> <span class="main">∧</span> suffs <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">b</span> <span class="bound">ys</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> generate_check_filter<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> alls2_Cons_tl_conv<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">cond1</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">cond1</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟷</span> True"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">cond1</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> maxne0_impl <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free">b</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_x_impl'_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">a</span> <span class="main">⟹</span> length <span class="free">y</span> <span class="main">=</span> length <span class="free">b</span> <span class="main">⟹</span> max_x_impl' <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span> <span class="main">=</span> max_x_impl <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_x_impl'_def max_x_impl_def Let_def big_d'_def big_d_def<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">cond2</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">cond2</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟷</span> True"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">cond2</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x_impl' <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">a</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_imp_big_d'_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>big_d' <span class="free">a</span> <span class="free">b</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>big_d' <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> le_trans
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def big_d'_def less_eq_def hlde_ops.dij_def hlde_ops.eij_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_big_d'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="main">(</span>big_d' <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">j</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> dij <span class="free"><span class="free"><span class="free">a</span></span></span> <span class="free"><span class="free"><span class="free">b</span></span></span> <span class="free"><span class="free"><span class="free">i</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">j</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> length <span class="free"><span class="free"><span class="free">b</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> length <span class="free"><span class="free"><span class="free">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">`</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span> <span class="main"><span class="main"><span class="main">..&lt;</span></span></span> length <span class="free"><span class="free"><span class="free">y</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def big_d'_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Min_big_d'_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"big_d' <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">≤</span> length <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>set <span class="main">(</span>big_d' <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∈</span> set <span class="main">(</span>big_d' <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> finite_big_d' <span class="keyword2"><span class="keyword">and</span></span> Min_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">=</span> dij <span class="free">a</span> <span class="free">b</span> <span class="free">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free">y</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">≥</span> eij <span class="free">a</span> <span class="free">b</span> <span class="free">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> big_d'_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free">y</span> <span class="main">&lt;</span> length <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcm <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">a</span> <span class="main">!</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> length <span class="free">b</span> <span class="main">-</span> length <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lcm_div_le'<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> j <span class="keyword2"><span class="keyword">and</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hlde_ops.dij_def<span class="main">)</span>
      <span class="main">(</span><span class="operator">meson</span> List.finite_set Max_ge diff_le_self le_trans less_le_trans nth_mem<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_imp_max_x_impl'_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_x_impl' <span class="free">a</span> <span class="free">b</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≥</span> max_x_impl' <span class="free">a</span> <span class="free">b</span> <span class="free">y</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> le_imp_big_d'_subset <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> Min_in <span class="main">[</span><span class="operator">OF</span> finite_big_d'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> finite_big_d' <span class="keyword2"><span class="keyword">and</span></span> Min_le
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_x_impl'_def Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Min_big_d'_le <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> big_d'_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> leI<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> c12<span class="main">:</span> bounded_generate_check <span class="quoted"><span class="quoted">"<span class="main">(</span>cond2 <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"cond1"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span><span class="main">.</span> Max <span class="main">(</span>set <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> c2_gen_check <span class="main">=</span> <span class="quoted">c12.c2.gen_check</span> <span class="keyword2"><span class="keyword">and</span></span> c2_incs <span class="main">=</span> <span class="quoted">c12.c2.incs</span>
    <span class="keyword2"><span class="keyword">and</span></span> c12_generate_check <span class="main">=</span> <span class="quoted">c12.generate_check</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cond2 <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> this

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">x'</span> <span class="skolem">xs</span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cond2 <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≤</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>max_x_impl' <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">a</span><span class="main">]</span> <span class="keyword1">≤<span class="hidden">⇩</span><sub>v</sub></span> map <span class="main">(</span>max_x_impl' <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">x'</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">a</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_imp_max_x_impl'_ge <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">#</span> <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">≤</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_Cons less_eq_def All_less_Suc2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cond2 <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">x'</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">s'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_Cons<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> dotprod_le_right le_trans length_map map_nth<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> 2 <span class="main">=</span> this

  <span class="keyword1"><span class="command">interpret</span></span> c2<span class="main">:</span> bounded_gen_check <span class="quoted"><span class="quoted">"cond2 <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">ys</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="main">(</span>c2.gen_check <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cond1 <span class="skolem">b</span> <span class="skolem">ys</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> False"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> c2.in_gen_check<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> leD less_le_trans maxne0_impl maxne0_le_Max<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> 3 <span class="main">=</span> this

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">ys</span> <span class="skolem">x</span> <span class="skolem">x'</span> <span class="skolem">xs</span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="main">(</span>c2.gen_check <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cond1 <span class="skolem">b</span> <span class="skolem">ys</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≤</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cond1 <span class="skolem">b</span> <span class="skolem">ys</span> <span class="main">(</span><span class="skolem">x'</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> 4 <span class="main">=</span> this

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bounded_generate_check <span class="main">(</span>cond2 <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span><span class="main">)</span> cond1 <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> Max <span class="main">(</span>set <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword2"><span class="keyword">and</span></span> 3 <span class="keyword2"><span class="keyword">and</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">post_cond</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> static_bounds <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∙</span> <span class="bound">y</span> <span class="main">∧</span> boundr_impl <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fast_filter</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
  filter <span class="main">(</span>post_cond <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">,</span> fst <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>tl <span class="main">(</span>c12_generate_check <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cond1_cond2_zeroes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"suffs <span class="main">(</span>cond1 <span class="free">b</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"suffs <span class="main">(</span>cond2 <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span>zeroes <span class="main">(</span>length <span class="free">b</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suffs.simps cond_cons_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> dotprod_0_right length_drop<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cons_replicate_eq Nat.le0<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cons_replicate_eq Nat.le0<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.le0 dotprod_0_right length_drop<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> suffs_cond1I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">aa</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> maxne0_impl <span class="free">aaa</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">aa</span> <span class="main">=</span> length <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="free">aa</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">aaa</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"suffs <span class="main">(</span>cond1 <span class="free">b</span> <span class="free">aaa</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span><span class="free">aa</span><span class="main">,</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">aaa</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suffs.simps cond_cons_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> dotprod_le_drop<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_dropD list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> suffs_cond2_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"suffs <span class="main">(</span>cond2 <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">ys</span><span class="main">,</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">ys</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> subdprodr_impl <span class="free">a</span> <span class="free">b</span> <span class="free">ys</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">ys</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suffs.simps cond_cons_def in_set_conv_nth <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hd_drop_conv_nth <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"drop <span class="improper">i</span> <span class="free">ys</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">using</span></span> less_or_eq_imp_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> length <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">l</span> <span class="free">b</span> <span class="main">∙</span> take <span class="skolem">l</span> <span class="free">ys</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">ys</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> l <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dotprod_le_take<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x_impl' <span class="free">a</span> <span class="free">b</span> <span class="free">ys</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">a</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suffs.simps cond_cons_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x_impl <span class="free">a</span> <span class="free">b</span> <span class="free">ys</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">a</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> max_x_impl'_conv <span class="main">[</span><span class="operator">OF</span> _ assms<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> atLeastLessThan_iff map_eq_conv set_upt<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x_impl <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>take <span class="skolem">l</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">a</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> max_x_impl <span class="keyword1"><span class="command">using</span></span> hlde_ops.max_x_le_take <span class="main">[</span><span class="operator">OF</span> eq_imp_le<span class="main">,</span> <span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dotprod_le_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">l</span> <span class="free">b</span> <span class="main">∙</span> take <span class="skolem">l</span> <span class="free">ys</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x_impl <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>take <span class="skolem">l</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">a</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdprodr_impl_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">ys</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subdprodr_impl <span class="free">a</span> <span class="free">b</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> length <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="skolem">i</span> <span class="free">b</span> <span class="main">∙</span> drop <span class="skolem">i</span> <span class="free">ys</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">ys</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dotprod_le_drop<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x_impl <span class="free">a</span> <span class="free">b</span> <span class="free">ys</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">a</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdprodr_impl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x_impl' <span class="free">a</span> <span class="free">b</span> <span class="free">ys</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">a</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> max_x_impl'_conv <span class="main">[</span><span class="operator">OF</span> _ assms<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> atLeastLessThan_iff map_eq_conv set_upt<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x_impl' <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>drop <span class="skolem">i</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">a</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hlde_ops.max_x'_le_drop <span class="main">[</span><span class="operator">OF</span> eq_imp_le<span class="main">,</span> <span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dotprod_le_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_def max_x_impl' i assms<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="skolem">i</span> <span class="free">b</span> <span class="main">∙</span> drop <span class="skolem">i</span> <span class="free">ys</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∙</span> map <span class="main">(</span>max_x_impl' <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>drop <span class="skolem">i</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="free">a</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suffs.simps cond_cons_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> in_set_dropD list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> suffs_cond2I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">aaa</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">aaa</span> <span class="main">=</span> length <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subdprodr_impl <span class="free">a</span> <span class="free">b</span> <span class="free">aaa</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"suffs <span class="main">(</span>cond2 <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">aaa</span><span class="main">,</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">aaa</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> suffs_cond2_conv<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> check_cond_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>alls2 <span class="main">(</span>Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"check_cond <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">,</span> fst <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span>
    static_bounds <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∙</span> fst <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> fst <span class="free">y</span> <span class="main">∧</span> boundr_impl <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="main">∧</span>
    suffs <span class="main">(</span>cond1 <span class="free">b</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">x</span> <span class="main">∧</span>
    suffs <span class="main">(</span>cond2 <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">b</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> static_bounds_def check_cond_def set_alls2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> suffs_cond1I suffs_cond2I <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdprodl_impl_def suffs_cond2_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dotprod_le_take<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tune<span class="main">:</span>
  <span class="quoted"><span class="quoted">"check' <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>generate' <span class="main">(</span>Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span>set <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> fast_filter <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cond1_cond2_zeroes
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c12.tl_generate_check_filter check'_def generate'_def map_tl <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
      filter_map post_cond_def fast_filter_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> map_cong filter_cong <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> list.set_sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> check_cond_conv<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> alls2_ne<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> bounded_incs <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xs</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">cond</span> <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> False"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">incs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span>nat list <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat list <span class="main">×</span> nat<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">incs</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">t</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">in</span>
      <span class="keyword1">if</span> <span class="free">cond</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="bound">t</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">#</span> <span class="free">incs</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">termination</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">xs</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="free">B</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> wf_measure<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">&gt;</span> <span class="free">B</span>"</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">use</span> bound <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">declare</span></span> incs.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> in_incs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ys</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>incs <span class="free">a</span> <span class="free">x</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">t</span> <span class="main">=</span> <span class="free">s</span> <span class="main">+</span> hd <span class="free">ys</span> <span class="main">*</span> <span class="free">a</span> <span class="main">∧</span> tl <span class="free">ys</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">cond</span> <span class="free">ys</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> incs.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> incs.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> incs_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="free">B</span> <span class="main">⟹</span> incs <span class="free">a</span> <span class="free">x</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> incs.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def incs.simps bound<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> incs1<span class="main">:</span>
  bounded_incs <span class="quoted"><span class="quoted">"<span class="main">(</span>cond1 <span class="free">b</span> <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">b</span> <span class="free">ys</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> c1_incs <span class="main">=</span> <span class="quoted">incs1.incs</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cond1 <span class="free">b</span> <span class="free">ys</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> maxne0_impl_le <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">c1_gen_check</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">c1_gen_check</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">c1_gen_check</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>c1_incs <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">c1_gen_check</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">generate_check</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span><span class="main">.</span> ys <span class="main">←</span> c2_gen_check <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> xs <span class="main">←</span> c1_gen_check <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>fst <span class="bound">ys</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> c1_gen_check_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ys</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>c2_gen_check <span class="free">a</span> <span class="free">b</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"c1_gen_check <span class="free">b</span> <span class="free">ys</span> <span class="free">a</span> <span class="main">=</span> bounded_gen_check.gen_check <span class="main">(</span>cond1 <span class="free">b</span> <span class="free">ys</span><span class="main">)</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> c1<span class="main">:</span> bounded_gen_check <span class="quoted"><span class="quoted">"<span class="main">(</span>cond1 <span class="free">b</span> <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> leD less_le_trans maxne0_impl_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"c1_incs <span class="free">b</span> <span class="free">ys</span> <span class="skolem">a1</span> <span class="main">0</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">ba</span><span class="main">)</span> <span class="main">=</span> c1.incs <span class="skolem">a1</span> <span class="main">0</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">ba</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">ba</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>c1.gen_check <span class="skolem">a2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">a1</span> <span class="skolem">a2</span> <span class="skolem">ba</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> c1.incs.induct<span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> c1.in_gen_check <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def incs1.incs.simps c1.incs.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> arg_cong <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted">concat</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code Generation›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> solve_efficient <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"solve <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> special_solutions <span class="free">a</span> <span class="free">b</span> <span class="main">@</span> minimize <span class="main">(</span>fast_filter <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> solve_def non_special_solutions_def tune<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> c12_generate_check_code <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"c12_generate_check <span class="free">a</span> <span class="free">b</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> generate_check <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> generate_check_def c12.generate_check_def c1_gen_check_conv <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> arg_cong <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted">concat</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Solver_Code">
<div class="head">
<h1>Theory Solver_Code</h1>
</div>
<pre class="source"><span class="comment1">(*
Author:  Christian Sternagel &lt;c.sternagel@gmail.com&gt;
License: LGPL
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Generating Code for the Solver›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Solver_Code
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Algorithm.html">Algorithm</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">external_file</span></span> <span class="quoted">‹src/Main.hs›</span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">solve</span></span> <span class="keyword2"><span class="keyword">checking</span></span> Haskell <span class="comment1">― ‹test whether Haskell code generation works›</span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">solve</span></span> <span class="quoted"><span class="quoted">integer_of_nat</span></span> <span class="quoted"><span class="quoted">nat_of_integer</span></span> <span class="keyword2"><span class="keyword">in</span></span> Haskell <span class="keyword2"><span class="keyword">module_name</span></span> HLDE <span class="keyword2"><span class="keyword">file_prefix</span></span> generated

<span class="keyword1"><span class="command">compile_generated_files</span></span> <span class="comment1">✐<span class="quoted">‹contributor Makarius›</span></span>
  <span class="quoted"><span class="entity">‹code/generated/HLDE.hs›</span></span>
  <span class="keyword2"><span class="keyword">external_files</span></span> <span class="quoted">‹Main.hs›</span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> src<span class="main">)</span>
  <span class="keyword2"><span class="keyword">export_files</span></span> <span class="quoted">‹hlde›</span> <span class="main">(</span>exe<span class="main">)</span>
  <span class="keyword2"><span class="keyword">export_prefix</span></span> <span class="quoted">‹code/generated›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted">‹<span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">dir</span> <span class="main">=&gt;</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">exec</span> <span class="main">=</span> <span class="entity">Generated_Files.execute</span> <span class="entity">dir</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span>
        <span class="entity">exec</span> <span class="antiquoted"><span class="entity"><span class="operator">‹</span>Compilation›</span></span> <span class="main">(</span><span class="inner_quoted">"mv code/generated/HLDE.hs . &amp;&amp; "</span> ^
          File.bash_path <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">path</span><span class="hidden">&gt;</span></span>‹$ISABELLE_GHC›</span></span> ^ <span class="inner_quoted">" -o hlde Main.hs"</span><span class="main">)</span><span class="main">;</span>

      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">print_coeffs</span> <span class="main">=</span> enclose <span class="inner_quoted">"["</span> <span class="inner_quoted">"]"</span> o commas o map string_of_int<span class="main">;</span>
      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">print_hlde</span> <span class="main">(</span><span class="entity">xs</span><span class="main">,</span> <span class="entity">ys</span><span class="main">)</span> <span class="main">=</span>
        writeln <span class="main">(</span><span class="entity">exec</span> <span class="antiquoted"><span class="entity"><span class="operator">‹</span>Test›</span></span> <span class="main">(</span><span class="inner_quoted">"./hlde &lt;&lt;&lt; '("</span> ^ <span class="entity">print_coeffs</span> <span class="entity">xs</span> ^ <span class="inner_quoted">", "</span> ^ <span class="entity">print_coeffs</span> <span class="entity">ys</span> ^ <span class="inner_quoted">")'"</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">print_hlde</span> <span class="main">(</span><span class="main">[</span><span class="inner_numeral">3</span><span class="main">,</span> <span class="inner_numeral">5</span><span class="main">,</span> <span class="inner_numeral">1</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="inner_numeral">2</span><span class="main">,</span> <span class="inner_numeral">7</span><span class="main">]</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="files/src/Main.hs">
<div class="head">
<h1>File ‹src/Main.hs›</h1>
</div>
<pre class="source">{-
Author:  Christian Sternagel &lt;c.sternagel@gmail.com&gt; (2017)
License: LGPL
-}
module Main (main) where

import HLDE -- for solve: computing solutions to homogeneous linear diophantine equations
import System.Environment -- for getArgs
import System.IO -- for file reading
import System.Exit -- for error codes
import System.Directory -- for doesFileExist

main = getArgs &gt;&gt;= parse

parse [] = do
  input &lt;- getContents
  start input
parse ["--help"] =  do
  hPutStrLn stdout usage
  exitWith ExitSuccess
parse [s] = do
  b &lt;- doesFileExist s
  if b then do
    input &lt;- readFile s
    start input
  else
    start s
parse _ = do
  hPutStrLn stderr usage
  exitWith (ExitFailure 1)

start input = do
  let (a, b) = read input :: ([Integer], [Integer])
  if 0 `elem` a || 0 `elem` b then do
    hPutStrLn stderr "0-coefficients are not allowed"
    exitWith (ExitFailure 2)
  else if null a || null b then do
    hPutStrLn stderr "empty lists of coefficients are not allowed"
    exitWith (ExitFailure 3)
  else
    mapM_ (putStrLn . show . (\(x, y) -&gt; (map integer_of_nat x, map integer_of_nat y))) $
      solve (map nat_of_integer a) (map nat_of_integer b)

usage = "usage: hlde [string]\n\
        \  \n\
        \  If a string argument is given and a file of the same name exists\n\
        \  then read from this file, if no such file exists read directly from\n\
        \  the given string, and otherwise read from stdin.\n\
        \  \n\
        \  As input a pair of lists of coefficients is expected (representing a\n\
        \  homogeneous linear Diophantine equation, or HLDE for short). E.g.\n\
        \  \n\
        \    ([1,1],[2])\n\
        \  \n\
        \  corresponds to the HLDE\n\
        \  \n\
        \    x1 + x2 = 2*y1"

</pre>
</div>