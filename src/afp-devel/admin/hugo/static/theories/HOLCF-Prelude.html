<div id="HOLCF_Main">
<div class="head">
<h1>Theory HOLCF_Main</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Initial Setup for HOLCF-Prelude›</span></span>

<span class="keyword1"><span class="command">theory</span></span> HOLCF_Main
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../../HOL/HOLCF/HOLCF.html">HOLCF</a>
    <span class="quoted">"<a href="../../HOL/HOLCF-Library/Int_Discrete.html">HOLCF-Library.Int_Discrete</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Adhoc_Overloading.html">HOL-Library.Adhoc_Overloading</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  All theories from the Isabelle distribution which are used
  anywhere in the HOLCF-Prelude library must be imported via this file.
  This way, we only have to hide constant names and syntax in one place.
›</span></span>

<span class="keyword1"><span class="command">hide_type</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> list

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span>
  List.append List.concat List.Cons List.distinct List.filter List.last
  List.foldr List.foldl List.length List.lists List.map List.Nil List.nth
  List.partition List.replicate List.set List.take List.upto List.zip
  Orderings.less Product_Type.fst Product_Type.snd

<span class="keyword1"><span class="command">no_notation</span></span> Map.map_add <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">++</span>"</span> 100<span class="main">)</span>

<span class="keyword1"><span class="command">no_notation</span></span> List.upto <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">[</span>_<span class="keyword1">..</span><span class="keyword3">/</span>_<span class="keyword1">]</span><span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">no_notation</span></span>
  Rings.divide <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">div</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Rings.modulo <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">mod</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">no_notation</span></span>
  Set.member  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">:</span><span class="keyword3">)</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Set.member  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">:</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">no_translations</span></span>
  <span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">xs</span><span class="main">]</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="main">[</span><span class="free">xs</span><span class="main">]</span>"</span>
  <span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="main">[]</span>"</span>

<span class="keyword1"><span class="command">no_syntax</span></span>
  <span class="quoted">"_list"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"args <span class="main">⇒</span> <span class="tfree">'a</span> List.list"</span></span>    <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1">]</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">no_notation</span></span>
  List.Nil <span class="main">(</span><span class="quoted">"<span class="keyword1">[]</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">no_syntax</span></span> <span class="quoted">"_bracket"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"types <span class="main">⇒</span> type <span class="main">⇒</span> type"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[</span>_<span class="keyword1">]</span><span class="keyword3">/ </span><span class="keyword1">=&gt;</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">]</span> 0<span class="main">)</span>
<span class="keyword1"><span class="command">no_syntax</span></span> <span class="quoted">"_bracket"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"types <span class="main">⇒</span> type <span class="main">⇒</span> type"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[</span>_<span class="keyword1">]</span><span class="keyword3">/ </span><span class="keyword1">⇒</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">]</span> 0<span class="main">)</span>

<span class="keyword1"><span class="command">no_translations</span></span>
  <span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">&lt;-</span><span class="free">xs</span> <span class="main">.</span> <span class="free">P</span><span class="main">]</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> List.filter <span class="main">(</span><span class="main">%</span><span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="free">xs</span>"</span>

<span class="keyword1"><span class="command">no_syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_filter"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> List.list <span class="main">⇒</span> bool <span class="main">⇒</span> <span class="tfree">'a</span> List.list"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">[</span>_<span class="keyword1">&lt;-</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword1">]</span><span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">no_syntax</span></span>
  <span class="quoted">"_filter"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> List.list <span class="main">⇒</span> bool <span class="main">⇒</span> <span class="tfree">'a</span> List.list"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">[</span>_<span class="keyword1">←</span>_ <span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword1">]</span><span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Declarations that belong in HOLCF/Tr.thy:›</span></span>

<span class="keyword1"><span class="command">declare</span></span> trE <span class="main">[</span><span class="operator">cases</span> <span class="quasi_keyword">type</span><span class="main"><span class="main">:</span></span> tr<span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> tr_induct <span class="main">[</span><span class="operator">induct</span> <span class="quasi_keyword">type</span><span class="main"><span class="main">:</span></span> tr<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Type_Classes">
<div class="head">
<h1>Theory Type_Classes</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Type Classes›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Type_Classes
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="HOLCF_Main.html">HOLCF_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Eq class›</span></span>

<span class="keyword1"><span class="command">class</span></span> Eq <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">eq</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> tr"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The Haskell type class does allow /= to be specified separately. For now, we assume
  that all modeled type classes use the default implementation, or an equivalent.
›</span></span>
<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">neq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>Eq <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neq</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> neg<span class="main">⋅</span><span class="main">(</span>eq<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> Eq_strict <span class="main">=</span> Eq <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> Eq_sym <span class="main">=</span> Eq_strict <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> eq<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">x</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> Eq_equiv <span class="main">=</span> Eq_sym <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq_self_neq_FF <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">≠</span> FF"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> TT <span class="main">⟹</span> eq<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> TT <span class="main">⟹</span> eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> TT"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span>"</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> Eq_eq <span class="main">=</span> Eq_sym <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq_self_neq_FF'<span class="main">:</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">≠</span> FF"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq_TT_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> TT <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> Eq_equiv
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_self_neq_FF' <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> eq_TT_dest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eqD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> TT <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> FF <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eq_TT_dest<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Class instances›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> lift <span class="main">::</span> <span class="main">(</span><span class="quoted">countable</span><span class="main">)</span> <span class="quoted">Eq_eq</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"eq <span class="main">≡</span> <span class="main">(</span><span class="keyword1">Λ</span><span class="main">(</span>Def x<span class="main">)</span> <span class="main">(</span>Def y<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_lift_def flift1_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> lift.splits<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_ONE_ONE <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span>ONE<span class="main">⋅</span>ONE <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ONE_def eq_lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ord class›</span></span>

<span class="keyword1"><span class="command">domain</span></span> Ordering <span class="main">=</span> LT <span class="main">|</span> EQ <span class="main">|</span> GT

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">oppOrdering</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Ordering <span class="main">→</span> Ordering"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">oppOrdering</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> LT <span class="main">⇒</span> GT <span class="main">|</span> EQ <span class="main">⇒</span> EQ <span class="main">|</span> GT <span class="main">⇒</span> LT<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> oppOrdering_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span>LT <span class="main">=</span> GT"</span></span>
  <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span>EQ <span class="main">=</span> EQ"</span></span>
  <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span>GT <span class="main">=</span> LT"</span></span>
  <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> oppOrdering_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">class</span></span> Ord <span class="main">=</span> Eq <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">compare</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> Ordering"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lt</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> x y<span class="main">.</span> <span class="keyword1">case</span> compare<span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span> <span class="keyword1">of</span> LT <span class="main">⇒</span> TT <span class="main">|</span> EQ <span class="main">⇒</span> FF <span class="main">|</span> GT <span class="main">⇒</span> FF<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">le</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">le</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> x y<span class="main">.</span> <span class="keyword1">case</span> compare<span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span> <span class="keyword1">of</span> LT <span class="main">⇒</span> TT <span class="main">|</span> EQ <span class="main">⇒</span> TT <span class="main">|</span> GT <span class="main">⇒</span> FF<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lt_eq_TT_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> TT <span class="main">⟷</span> compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> LT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> Ord_strict <span class="main">=</span> Ord <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> compare_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lt_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹TODO: It might make sense to have a class for preorders too,
analogous to class <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>eq_equiv›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">class</span></span> Ord_linear <span class="main">=</span> Ord_strict <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq_conv_compare<span class="main">:</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> is_EQ<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> oppOrdering_compare <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> compare<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> compare_EQ_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> EQ <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> compare_self_below_EQ<span class="main">:</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">⊑</span> EQ"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> compare_LT_trans<span class="main">:</span>
    <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> LT <span class="main">⟹</span> compare<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> LT <span class="main">⟹</span> compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> LT"</span></span>
  <span class="comment1">(*BH: Is this set of axioms complete?*)</span>
  <span class="comment1">(*CS: How about totality of the order?*)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_TT_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> TT <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_conv_compare<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_iff_lt_or_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> TT <span class="main">⟷</span> lt<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> TT <span class="main">∨</span> eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_def lt_def eq_conv_compare<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compare_sym<span class="main">:</span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> compare<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">x</span> <span class="keyword1">of</span> LT <span class="main">⇒</span> GT <span class="main">|</span> EQ <span class="main">⇒</span> EQ <span class="main">|</span> GT <span class="main">⇒</span> LT<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> oppOrdering_compare <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oppOrdering_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compare_self_neq_LT <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">≠</span> LT"</span></span>
  <span class="keyword1"><span class="command">using</span></span> compare_self_below_EQ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

<span class="keyword1"><span class="command">lemma</span></span> compare_self_neq_GT <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">≠</span> GT"</span></span>
  <span class="keyword1"><span class="command">using</span></span> compare_self_below_EQ <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

<span class="keyword1"><span class="command">declare</span></span> compare_self_below_EQ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> lt_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> TT <span class="main">⟹</span> lt<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> TT <span class="main">⟹</span> lt<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lt_eq_TT_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compare_LT_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compare_GT_iff_LT<span class="main">:</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> GT <span class="main">⟷</span> compare<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> LT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compare_sym <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compare_GT_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> GT <span class="main">⟹</span> compare<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> GT <span class="main">⟹</span> compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> GT"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compare_GT_iff_LT <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compare_LT_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compare_EQ_iff_eq_TT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> EQ <span class="main">⟷</span> eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_EQ_def eq_conv_compare<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compare_EQ_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> EQ <span class="main">⟹</span> compare<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> EQ <span class="main">⟹</span> compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> EQ"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> TT <span class="main">⟹</span> le<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> TT <span class="main">⟹</span> le<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> eq_TT_dest lt_trans <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_iff_lt_or_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> neg_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="main">(</span>lt<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> le<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_def lt_def compare_sym <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> neg_le<span class="main">:</span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="main">(</span>le<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> lt<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_def lt_def compare_sym <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> Eq_eq
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> eq<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_conv_compare
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compare_sym <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_conv_compare <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_conv_compare <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">≠</span> FF"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_conv_compare
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq_conv_compare
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A combinator for defining Ord instances for datatypes.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thenOrdering</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Ordering <span class="main">→</span> Ordering <span class="main">→</span> Ordering"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">thenOrdering</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> x y<span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> LT <span class="main">⇒</span> LT <span class="main">|</span> EQ <span class="main">⇒</span> <span class="bound">y</span> <span class="main">|</span> GT <span class="main">⇒</span> GT<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> thenOrdering_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"thenOrdering<span class="main">⋅</span>LT<span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> LT"</span></span>
  <span class="quoted"><span class="quoted">"thenOrdering<span class="main">⋅</span>EQ<span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"thenOrdering<span class="main">⋅</span>GT<span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> GT"</span></span>
  <span class="quoted"><span class="quoted">"thenOrdering<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> thenOrdering_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> thenOrdering_LT_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"thenOrdering<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> LT <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> LT <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> EQ <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> LT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> thenOrdering_EQ_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"thenOrdering<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> EQ <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> EQ <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> EQ"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> thenOrdering_GT_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"thenOrdering<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> GT <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> GT <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> EQ <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> GT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> thenOrdering_below_EQ_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"thenOrdering<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">⊑</span> EQ <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊑</span> EQ <span class="main">∧</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">⊑</span> EQ<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> is_EQ_thenOrdering <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_EQ<span class="main">⋅</span><span class="main">(</span>thenOrdering<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_EQ<span class="main">⋅</span><span class="free">x</span> <span class="keyword1">andalso</span> is_EQ<span class="main">⋅</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> oppOrdering_thenOrdering<span class="main">:</span>
  <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span><span class="main">(</span>thenOrdering<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span>
    thenOrdering<span class="main">⋅</span><span class="main">(</span>oppOrdering<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>oppOrdering<span class="main">⋅</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">instantiation</span></span> lift <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>linorder<span class="main">,</span>countable<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">Ord_linear</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"compare <span class="main">≡</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>Def x<span class="main">)</span> <span class="main">(</span>Def y<span class="main">)</span><span class="main">.</span>
    <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="keyword1">then</span> LT <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="bound">y</span> <span class="keyword1">then</span> GT <span class="keyword1">else</span> EQ<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lift"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compare_lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compare_lift_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> compare<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compare_lift_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_less less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> EQ"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> compare_lift_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> LT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> LT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> LT"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> compare_lift_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> is_EQ<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_lift_def compare_lift_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">⊑</span> EQ"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compare_lift_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lt_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>Ord_linear<span class="main">)</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">(</span>le<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="keyword1">andalso</span> neq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lt_def le_def eq_conv_compare<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Numeral_Cpo">
<div class="head">
<h1>Theory Numeral_Cpo</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cpo for Numerals›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Numeral_Cpo
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="HOLCF_Main.html">HOLCF_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">class</span></span> plus_cpo <span class="main">=</span> plus <span class="main">+</span> cpo <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_plus1<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>cpo<span class="main">}</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_plus2<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>cpo<span class="main">}</span><span class="main">.</span> <span class="free">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">plus_section</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(+')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span> <span class="main">≡</span> <span class="keyword1">Λ</span> x y<span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">plus_section_left</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">+')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">+)</span></span> <span class="main">≡</span> <span class="keyword1">Λ</span> y<span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">plus_section_right</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(+</span>_<span class="keyword1">')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+</span></span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> <span class="keyword1">Λ</span> x<span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> minus_cpo <span class="main">=</span> minus <span class="main">+</span> cpo <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_minus1<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>minus<span class="main">,</span>cpo<span class="main">}</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_minus2<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>minus<span class="main">,</span>cpo<span class="main">}</span><span class="main">.</span> <span class="free">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">minus_section</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(-')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(-)</span></span> <span class="main">≡</span> <span class="keyword1">Λ</span> x y<span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">minus_section_left</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">-')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">-)</span></span> <span class="main">≡</span> <span class="keyword1">Λ</span> y<span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">minus_section_right</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(-</span>_<span class="keyword1">')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(-</span></span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> <span class="keyword1">Λ</span> x<span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> times_cpo <span class="main">=</span> times <span class="main">+</span> cpo <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_times1<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>times<span class="main">,</span>cpo<span class="main">}</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_times2<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>times<span class="main">,</span>cpo<span class="main">}</span><span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*
This clashes with comment syntax
abbreviation times_section :: "'a → 'a → 'a" ("'(?')") where
  "(?) ≡ Λ x y. x * y"

abbreviation times_section_left :: "'a ⇒ 'a → 'a" ("'(_?')") where
  "(x?) ≡ Λ y. x * y"

abbreviation times_section_right :: "'a ⇒ 'a → 'a" ("'(?_')") where
  "(?y) ≡ Λ x. x - y"
*)</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">lemma</span></span> cont2cont_plus <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">cont2cont</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>plus_cpo<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cont_apply <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cont_plus1<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cont_apply <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cont_plus2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cont_const<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont2cont_minus <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">cont2cont</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>minus_cpo<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cont_apply <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cont_minus1<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cont_apply <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cont_minus2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cont_const<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont2cont_times <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">cont2cont</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>times_cpo<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cont_apply <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cont_times1<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cont_apply <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cont_times2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cont_const<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">instantiation</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>zero<span class="main">,</span>cpo<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">zero_u</span></span> <span class="main">=</span> up<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>one<span class="main">,</span>cpo<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">one</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">one_u</span></span> <span class="main">=</span> up<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted">plus_cpo</span><span class="main">)</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">plus_u</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span><span class="main">(</span>up<span class="main">⋅</span>a<span class="main">)</span> <span class="main">(</span>up<span class="main">⋅</span>b<span class="main">)</span><span class="main">.</span> up<span class="main">⋅</span><span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main"><span class="hidden">⇩</span><sub>⊥</sub></span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted">minus_cpo</span><span class="main">)</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">minus_u</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span><span class="main">(</span>up<span class="main">⋅</span>a<span class="main">)</span> <span class="main">(</span>up<span class="main">⋅</span>b<span class="main">)</span><span class="main">.</span> up<span class="main">⋅</span><span class="main">(</span><span class="bound">a</span> <span class="main">-</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main"><span class="hidden">⇩</span><sub>⊥</sub></span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted">times_cpo</span><span class="main">)</span> <span class="quoted">times</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">times_u</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span><span class="main">(</span>up<span class="main">⋅</span>a<span class="main">)</span> <span class="main">(</span>up<span class="main">⋅</span>b<span class="main">)</span><span class="main">.</span> up<span class="main">⋅</span><span class="main">(</span><span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main"><span class="hidden">⇩</span><sub>⊥</sub></span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> plus_u_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> u"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> plus_u_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> minus_u_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> u"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">-</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minus_u_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> times_u_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> u"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> times_u_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> plus_up_up <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"up<span class="main">⋅</span><span class="free">x</span> <span class="main">+</span> up<span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> up<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> plus_u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> minus_up_up <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"up<span class="main">⋅</span><span class="free">x</span> <span class="main">-</span> up<span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> up<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minus_u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> times_up_up <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"up<span class="main">⋅</span><span class="free">x</span> <span class="main">*</span> up<span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> up<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> times_u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted">plus_cpo</span><span class="main">)</span> <span class="quoted">plus_cpo</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_u_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted">minus_cpo</span><span class="main">)</span> <span class="quoted">minus_cpo</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_u_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted">times_cpo</span><span class="main">)</span> <span class="quoted">times_cpo</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_u_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>semigroup_add<span class="main">,</span>plus_cpo<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">semigroup_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> u"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> plus_u_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>ab_semigroup_add<span class="main">,</span>plus_cpo<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">ab_semigroup_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> u"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>monoid_add<span class="main">,</span>plus_cpo<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">monoid_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> u"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> zero_u_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> zero_u_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>comm_monoid_add<span class="main">,</span>plus_cpo<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">comm_monoid_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> u"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> zero_u_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> u <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>numeral<span class="main">,</span> plus_cpo<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">numeral</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instance</span></span> int <span class="main">::</span> <span class="quoted">plus_cpo</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">instance</span></span> int <span class="main">::</span> <span class="quoted">minus_cpo</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Data_Function">
<div class="head">
<h1>Theory Data_Function</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Data: Functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Data_Function
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="HOLCF_Main.html">HOLCF_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">flip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'b</span> <span class="main">-&gt;</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">-&gt;</span> <span class="tfree">'b</span> <span class="main">-&gt;</span> <span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'c</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">flip</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">const</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">const</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">dollar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">-&gt;</span> <span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dollar</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">dollarBang</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">-&gt;</span> <span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dollarBang</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> seq<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">-&gt;</span> <span class="tfree">'b</span> <span class="main">-&gt;</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">-&gt;</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">-&gt;</span> <span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'c</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">on</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Data_Bool">
<div class="head">
<h1>Theory Data_Bool</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Data: Bool›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Data_Bool
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Type_Classes.html">Type_Classes</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Class instances›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Eq›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_eqI<span class="main">[</span><span class="operator">case_names</span> bottomLTR bottomRTL LTR RTL<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> TT <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> TT<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main">=</span> TT <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> TT<span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Exh_tr<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_tr_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span>TT<span class="main">⋅</span>TT <span class="main">=</span> TT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span>TT<span class="main">⋅</span>FF <span class="main">=</span> FF"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span>FF<span class="main">⋅</span>TT <span class="main">=</span> FF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span>FF<span class="main">⋅</span>FF <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> TT_def FF_def eq_lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Ord›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compare_tr_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span>FF<span class="main">⋅</span>FF <span class="main">=</span> EQ"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span>FF<span class="main">⋅</span>TT <span class="main">=</span> LT"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span>TT<span class="main">⋅</span>FF <span class="main">=</span> GT"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span>TT<span class="main">⋅</span>TT <span class="main">=</span> EQ"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> TT_def FF_def compare_lift_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> andalso_eq_TT_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">andalso</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> TT <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> TT <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> andalso_eq_FF_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">andalso</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> FF <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> FF <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> TT <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> FF<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> andalso_eq_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">andalso</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> TT <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> orelse_eq_FF_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">orelse</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> FF <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> FF <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> FF"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> orelse_assoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="keyword1">orelse</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">orelse</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">orelse</span> <span class="free">y</span> <span class="keyword1">orelse</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> andalso_assoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="keyword1">andalso</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">andalso</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">andalso</span> <span class="free">y</span> <span class="keyword1">andalso</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> neg_orelse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="keyword1">orelse</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>neg<span class="main">⋅</span><span class="free">x</span> <span class="keyword1">andalso</span> neg<span class="main">⋅</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> neg_andalso <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="keyword1">andalso</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>neg<span class="main">⋅</span><span class="free">x</span> <span class="keyword1">orelse</span> neg<span class="main">⋅</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Not suitable as default simp rules, because they cause the
  simplifier to loop:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> neg_eq_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> TT <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> FF <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> neg_eq_TT_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> TT <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> FF"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> neg_eq_FF_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> FF <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> neg_eq_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="comment1">(* TODO: set up reorient_proc for TT and FF *)</span>

<span class="keyword1"><span class="command">lemma</span></span> neg_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> neg<span class="main">⋅</span><span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> neg_neg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="main">(</span>neg<span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> neg_comp_neg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"neg <span class="keyword1">oo</span> neg <span class="main">=</span> ID"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cfun_eqI cfcomp2 neg_neg ID1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Data_Tuple">
<div class="head">
<h1>Theory Data_Tuple</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Data: Tuple›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Data_Tuple
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Type_Classes.html">Type_Classes</a>
    <a href="Data_Bool.html">Data_Bool</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Datatype definitions›</span></span>

<span class="keyword1"><span class="command">domain</span></span> Unit <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">⟨⟩</span></span></span>"</span><span class="main">)</span> <span class="main">=</span> Unit <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨⟩</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">domain</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Tuple2 <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">⟨</span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1">,</span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1">⟩</span></span></span>"</span><span class="main">)</span> <span class="main">=</span>
  Tuple2 <span class="main">(</span><span class="keyword2"><span class="keyword">lazy</span></span> fst <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="keyword2"><span class="keyword">lazy</span></span> snd <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">,</span> _<span class="keyword1">⟩</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> Tuple2 <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨,⟩</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">uncurry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">→</span> <span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">⟩</span> <span class="main">→</span> <span class="tfree">'c</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">uncurry</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span>fst<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>snd<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">curry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">⟩</span>  <span class="main">→</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'c</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">curry</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">domain</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Tuple3 <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">⟨</span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1">,</span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1">,</span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1">⟩</span></span></span>"</span><span class="main">)</span> <span class="main">=</span>
  Tuple3 <span class="main">(</span><span class="keyword2"><span class="keyword">lazy</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="keyword2"><span class="keyword">lazy</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="keyword2"><span class="keyword">lazy</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">⟩</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> Tuple3 <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨,,⟩</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Type class instances›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Unit <span class="main">::</span> <span class="quoted">Ord_linear</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"eq <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">⟨⟩</span> <span class="main">⟨⟩</span><span class="main">.</span> TT<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"compare <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">⟨⟩</span> <span class="main">⟨⟩</span><span class="main">.</span> EQ<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> eq_Unit_def compare_Unit_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x y<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x y<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x y<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x y z<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Tuple2 <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq</span><span class="main">,</span> <span class="quoted">Eq</span><span class="main">)</span> <span class="quoted">Eq_strict</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"eq <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">⟨</span>x1<span class="main">,</span> y1<span class="main">⟩</span> <span class="main">⟨</span>x2<span class="main">,</span> y2<span class="main">⟩</span><span class="main">.</span> eq<span class="main">⋅</span><span class="bound">x1</span><span class="main">⋅</span><span class="bound">x2</span> <span class="keyword1">andalso</span> eq<span class="main">⋅</span><span class="bound">y1</span><span class="main">⋅</span><span class="bound">y2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_Tuple2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_Tuple2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_Tuple2_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">⟨</span><span class="free">x1</span><span class="main">,</span> <span class="free">y1</span><span class="main">⟩</span><span class="main">⋅</span><span class="main">⟨</span><span class="free">x2</span><span class="main">,</span> <span class="free">y2</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span>eq<span class="main">⋅</span><span class="free">x1</span><span class="main">⋅</span><span class="free">x2</span> <span class="keyword1">andalso</span> eq<span class="main">⋅</span><span class="free">y1</span><span class="main">⋅</span><span class="free">y2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eq_Tuple2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span> Tuple2 <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_sym</span><span class="main">,</span> <span class="quoted">Eq_sym</span><span class="main">)</span> <span class="quoted">Eq_sym</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> eq<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_Tuple2_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_sym<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> Tuple2 <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_equiv</span><span class="main">,</span> <span class="quoted">Eq_equiv</span><span class="main">)</span> <span class="quoted">Eq_equiv</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">≠</span> FF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> TT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> TT"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eq_trans<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> Tuple2 <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_eq</span><span class="main">,</span> <span class="quoted">Eq_eq</span><span class="main">)</span> <span class="quoted">Eq_eq</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">≠</span> FF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Tuple2 <span class="main">::</span> <span class="main">(</span><span class="quoted">Ord</span><span class="main">,</span> <span class="quoted">Ord</span><span class="main">)</span> <span class="quoted">Ord_strict</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"compare <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">⟨</span>x1<span class="main">,</span> y1<span class="main">⟩</span> <span class="main">⟨</span>x2<span class="main">,</span> y2<span class="main">⟩</span><span class="main">.</span>
    thenOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="bound">x1</span><span class="main">⋅</span><span class="bound">x2</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="bound">y1</span><span class="main">⋅</span><span class="bound">y2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compare_Tuple2_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compare_Tuple2_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compare_Tuple2_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">⟨</span><span class="free">x1</span><span class="main">,</span> <span class="free">y1</span><span class="main">⟩</span><span class="main">⋅</span><span class="main">⟨</span><span class="free">x2</span><span class="main">,</span> <span class="free">y2</span><span class="main">⟩</span> <span class="main">=</span> thenOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="free">x1</span><span class="main">⋅</span><span class="free">x2</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="free">y1</span><span class="main">⋅</span><span class="free">y2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compare_Tuple2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span> Tuple2 <span class="main">::</span> <span class="main">(</span><span class="quoted">Ord_linear</span><span class="main">,</span> <span class="quoted">Ord_linear</span><span class="main">)</span> <span class="quoted">Ord_linear</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> is_EQ<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_conv_compare<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> compare<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oppOrdering_thenOrdering<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> EQ"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> LT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> LT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> LT"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> disjE conjE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> compare_LT_trans<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> compare_EQ_dest<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> compare_LT_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">⊑</span> EQ"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Tuple3 <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq</span><span class="main">,</span> <span class="quoted">Eq</span><span class="main">,</span> <span class="quoted">Eq</span><span class="main">)</span> <span class="quoted">Eq_strict</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"eq <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">⟨</span>x1<span class="main">,</span> y1<span class="main">,</span> z1<span class="main">⟩</span> <span class="main">⟨</span>x2<span class="main">,</span> y2<span class="main">,</span> z2<span class="main">⟩</span><span class="main">.</span>
    eq<span class="main">⋅</span><span class="bound">x1</span><span class="main">⋅</span><span class="bound">x2</span> <span class="keyword1">andalso</span> eq<span class="main">⋅</span><span class="bound">y1</span><span class="main">⋅</span><span class="bound">y2</span> <span class="keyword1">andalso</span> eq<span class="main">⋅</span><span class="bound">z1</span><span class="main">⋅</span><span class="bound">z2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_Tuple3_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_Tuple3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_Tuple3_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">⟨</span><span class="free">x1</span><span class="main">,</span> <span class="free">y1</span><span class="main">,</span> <span class="free">z1</span><span class="main">⟩</span><span class="main">⋅</span><span class="main">⟨</span><span class="free">x2</span><span class="main">,</span> <span class="free">y2</span><span class="main">,</span> <span class="free">z2</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span>eq<span class="main">⋅</span><span class="free">x1</span><span class="main">⋅</span><span class="free">x2</span> <span class="keyword1">andalso</span> eq<span class="main">⋅</span><span class="free">y1</span><span class="main">⋅</span><span class="free">y2</span> <span class="keyword1">andalso</span> eq<span class="main">⋅</span><span class="free">z1</span><span class="main">⋅</span><span class="free">z2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eq_Tuple3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span> Tuple3 <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_sym</span><span class="main">,</span> <span class="quoted">Eq_sym</span><span class="main">,</span> <span class="quoted">Eq_sym</span><span class="main">)</span> <span class="quoted">Eq_sym</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> eq<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_Tuple3_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_sym<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> Tuple3 <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_equiv</span><span class="main">,</span> <span class="quoted">Eq_equiv</span><span class="main">,</span> <span class="quoted">Eq_equiv</span><span class="main">)</span> <span class="quoted">Eq_equiv</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">≠</span> FF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> TT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> TT"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eq_trans<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> Tuple3 <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_eq</span><span class="main">,</span> <span class="quoted">Eq_eq</span><span class="main">,</span> <span class="quoted">Eq_eq</span><span class="main">)</span> <span class="quoted">Eq_eq</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">≠</span> FF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Tuple3 <span class="main">::</span> <span class="main">(</span><span class="quoted">Ord</span><span class="main">,</span> <span class="quoted">Ord</span><span class="main">,</span> <span class="quoted">Ord</span><span class="main">)</span> <span class="quoted">Ord_strict</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"compare <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">⟨</span>x1<span class="main">,</span> y1<span class="main">,</span> z1<span class="main">⟩</span> <span class="main">⟨</span>x2<span class="main">,</span> y2<span class="main">,</span> z2<span class="main">⟩</span><span class="main">.</span>
    thenOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="bound">x1</span><span class="main">⋅</span><span class="bound">x2</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>thenOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="bound">y1</span><span class="main">⋅</span><span class="bound">y2</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="bound">z1</span><span class="main">⋅</span><span class="bound">z2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compare_Tuple3_def<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compare_Tuple3_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compare_Tuple3_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">⟨</span><span class="free">x1</span><span class="main">,</span> <span class="free">y1</span><span class="main">,</span> <span class="free">z1</span><span class="main">⟩</span><span class="main">⋅</span><span class="main">⟨</span><span class="free">x2</span><span class="main">,</span> <span class="free">y2</span><span class="main">,</span> <span class="free">z2</span><span class="main">⟩</span> <span class="main">=</span>
    thenOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="free">x1</span><span class="main">⋅</span><span class="free">x2</span><span class="main">)</span><span class="main">⋅</span>
      <span class="main">(</span>thenOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="free">y1</span><span class="main">⋅</span><span class="free">y2</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="free">z1</span><span class="main">⋅</span><span class="free">z2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compare_Tuple3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span> Tuple3 <span class="main">::</span> <span class="main">(</span><span class="quoted">Ord_linear</span><span class="main">,</span> <span class="quoted">Ord_linear</span><span class="main">,</span> <span class="quoted">Ord_linear</span><span class="main">)</span> <span class="quoted">Ord_linear</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> is_EQ<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_conv_compare<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> compare<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oppOrdering_thenOrdering<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> EQ"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> LT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> LT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> LT"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> disjE conjE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> compare_LT_trans<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> compare_EQ_dest<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> compare_LT_trans<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> compare_LT_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">⊑</span> EQ"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Data_Integer">
<div class="head">
<h1>Theory Data_Integer</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Data: Integers›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Data_Integer
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Numeral_Cpo.html">Numeral_Cpo</a>
    <a href="Data_Bool.html">Data_Bool</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">domain</span></span> Integer <span class="main">=</span> MkI <span class="main">(</span><span class="keyword2"><span class="keyword">lazy</span></span> <span class="quoted">int</span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> Integer <span class="main">::</span> <span class="quoted">flat</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">Integer</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Integer <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>plus<span class="main">,</span>times<span class="main">,</span>minus<span class="main">,</span>uminus<span class="main">,</span>zero<span class="main">,</span>one<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span> <span class="main">(</span>MkI<span class="main">⋅</span>y<span class="main">)</span><span class="main">.</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span> <span class="main">(</span>MkI<span class="main">⋅</span>y<span class="main">)</span><span class="main">.</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span> <span class="main">(</span>MkI<span class="main">⋅</span>y<span class="main">)</span><span class="main">.</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span><span class="main">.</span> MkI<span class="main">⋅</span><span class="main">(</span>uminus <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Integer_arith_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">Integer</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">-</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊥</span><span class="main">::</span>Integer<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> plus_Integer_def times_Integer_def
  <span class="keyword1"><span class="command">unfolding</span></span> minus_Integer_def uminus_Integer_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Integer_arith_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"MkI<span class="main">⋅</span><span class="free">a</span> <span class="main">+</span> MkI<span class="main">⋅</span><span class="free">b</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"MkI<span class="main">⋅</span><span class="free">a</span> <span class="main">*</span> MkI<span class="main">⋅</span><span class="free">b</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"MkI<span class="main">⋅</span><span class="free">a</span> <span class="main">-</span> MkI<span class="main">⋅</span><span class="free">b</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span> MkI<span class="main">⋅</span><span class="free">a</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span>uminus <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> plus_Integer_def times_Integer_def
  <span class="keyword1"><span class="command">unfolding</span></span> minus_Integer_def uminus_Integer_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> plus_MkI_MkI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"MkI<span class="main">⋅</span><span class="free">x</span> <span class="main">+</span> MkI<span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> plus_Integer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span> Integer <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>plus_cpo<span class="main">,</span>minus_cpo<span class="main">,</span>times_cpo<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> flatdom_strict2cont<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> Integer <span class="main">::</span> <span class="quoted">comm_monoid_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">Integer</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> zero_Integer_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> Integer <span class="main">::</span> <span class="quoted">comm_monoid_mult</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">Integer</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> one_Integer_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> Integer <span class="main">::</span> <span class="quoted">comm_semiring</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">Integer</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> Integer <span class="main">::</span> <span class="quoted">semiring_numeral</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Integer_add_diff_cancel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_Integer_neq_bottom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> one_Integer_neq_bottom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> plus_Integer_eq_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Integer</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> diff_Integer_eq_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Integer</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_Integer_eq_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Integer</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> minus_Integer_eq_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">Integer</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> numeral_Integer_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"numeral <span class="free">k</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> numeral.simps one_Integer_def plus_MkI_MkI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> numeral_Integer_neq_bottom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>numeral <span class="free">k</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> numeral_Integer_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Symmetric versions are also needed, because the reorient
  simproc does not apply to these comparisons.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bottom_neq_zero_Integer <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊥</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bottom_neq_one_Integer <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊥</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bottom_neq_numeral_Integer <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊥</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">≠</span> numeral <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> numeral_Integer_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instantiation</span></span> Integer <span class="main">::</span> <span class="quoted">Ord_linear</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"eq <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span> <span class="main">(</span>MkI<span class="main">⋅</span>y<span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">then</span> TT <span class="keyword1">else</span> FF<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"compare <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span> <span class="main">(</span>MkI<span class="main">⋅</span>y<span class="main">)</span><span class="main">.</span>
    <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="keyword1">then</span> LT <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="bound">y</span> <span class="keyword1">then</span> GT <span class="keyword1">else</span> EQ<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">Integer</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compare_Integer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compare_Integer_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> compare<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compare_Integer_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_less less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> EQ"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> compare_Integer_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> LT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> LT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> LT"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> compare_Integer_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> is_EQ<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_Integer_def compare_Integer_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">⊑</span> EQ"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compare_Integer_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_MkI_MkI <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> TT <span class="keyword1">else</span> FF<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_Integer_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compare_MkI_MkI <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="keyword1">then</span> LT <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="free">y</span> <span class="keyword1">then</span> GT <span class="keyword1">else</span> EQ<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compare_Integer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lt_MkI_MkI <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="keyword1">then</span> TT <span class="keyword1">else</span> FF<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> le_MkI_MkI <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="keyword1">then</span> TT <span class="keyword1">else</span> FF<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> le_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_Integer_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Integer</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compare_Integer_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Integer</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lt_Integer_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Integer</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_Integer_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">Integer</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compare_refl_Integer <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> EQ"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_refl_Integer <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> lt_refl_Integer <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> lt<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> FF"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> le_refl_Integer <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> le<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_Integer_numeral_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> Num.One <span class="main">⟹</span> eq<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> Num.One <span class="main">⟹</span> eq<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">then</span> TT <span class="keyword1">else</span> FF<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zero_Integer_def one_Integer_def numeral_Integer_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> compare_Integer_numeral_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> EQ"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> LT"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> GT"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> EQ"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span> <span class="main">=</span> LT"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">=</span> GT"</span></span>
  <span class="quoted"><span class="quoted">"Num.One <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> compare<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span> <span class="main">=</span> LT"</span></span>
  <span class="quoted"><span class="quoted">"Num.One <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> compare<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">=</span> GT"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">l</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">l</span> <span class="keyword1">then</span> LT <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">k</span> <span class="main">&gt;</span> <span class="free">l</span> <span class="keyword1">then</span> GT <span class="keyword1">else</span> EQ<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zero_Integer_def one_Integer_def numeral_Integer_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> lt_Integer_numeral_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span> <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"Num.One <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> lt<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span> <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"lt<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">l</span> <span class="keyword1">then</span> TT <span class="keyword1">else</span> FF<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zero_Integer_def one_Integer_def numeral_Integer_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> le_Integer_numeral_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span> <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span> <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"Num.One <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> le<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">k</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">l</span> <span class="keyword1">then</span> TT <span class="keyword1">else</span> FF<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zero_Integer_def one_Integer_def numeral_Integer_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> MkI_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"MkI<span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zero_Integer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> MkI_eq_1_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"MkI<span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> one_Integer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> MkI_eq_numeral_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"MkI<span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> numeral <span class="free">k</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> numeral <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> numeral_Integer_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> MkI_0<span class="main">:</span> <span class="quoted"><span class="quoted">"MkI<span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> MkI_1<span class="main">:</span> <span class="quoted"><span class="quoted">"MkI<span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> le_plus_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">m</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">m</span><span class="main">⋅</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> TT"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> TT"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> le_MkI_MkI less_add_one less_le_not_le one_Integer_def plus_MkI_MkI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Induction rules that do not break the abstraction›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_Integer_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> 0 step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="main">::</span> <span class="quoted">Integer</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">0</span><span class="main">⋅</span><span class="free">i</span> <span class="main">=</span> TT"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> le<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="bound">i</span> <span class="main">=</span> TT <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> bottom
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> i_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MkI <span class="skolem">integer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">integer</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> neg
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> i_nonneg MkI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nonneg <span class="skolem">nat</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">nat</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TT"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nonneg MkI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Data_List">
<div class="head">
<h1>Theory Data_List</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Data: List›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Data_List
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Type_Classes.html">Type_Classes</a>
    <a href="Data_Function.html">Data_Function</a>
    <a href="Data_Bool.html">Data_Bool</a>
    <a href="Data_Tuple.html">Data_Tuple</a>
    <a href="Data_Integer.html">Data_Integer</a>
    <a href="Numeral_Cpo.html">Numeral_Cpo</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  Set.member  <span class="main">(</span><span class="quoted">"<span class="keyword1">'(:')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Set.member  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">:</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Datatype definition›</span></span>

<span class="keyword1"><span class="command">domain</span></span> <span class="tfree">'a</span> list <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">[</span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1">]</span></span></span>"</span><span class="main">)</span> <span class="main">=</span>
  Nil <span class="main">(</span><span class="quoted">"<span class="keyword1">[]</span>"</span><span class="main">)</span> <span class="main">|</span>
  Cons <span class="main">(</span><span class="keyword2"><span class="keyword">lazy</span></span> head <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword2"><span class="keyword">lazy</span></span> tail <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">:</span>"</span> 65<span class="main">)</span>
<span class="comment1">(*FIXME: We need to standardize a mapping from Haskell fixities
(0 to 9) to Isabelle ones (between 50 and 100).*)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Section syntax for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Cons<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_Cons_section"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(:')</span>"</span><span class="main">)</span>
  <span class="quoted">"_Cons_section_left"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">:')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">:)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="main">(</span><span class="keyword1">CONST</span> Rep_cfun<span class="main">)</span> <span class="main">(</span><span class="keyword1">CONST</span> Cons<span class="main">)</span> <span class="free">x</span>"</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Cons_section_right</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(:</span>_<span class="keyword1">')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(:</span></span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> <span class="keyword1">Λ</span> x<span class="main">.</span> <span class="bound">x</span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_lazy_list"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"args <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1">]</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">xs</span><span class="main">]</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="free">x</span> <span class="main">:</span> <span class="main">[</span><span class="free">xs</span><span class="main">]</span>"</span>
  <span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="free">x</span> <span class="main">:</span> <span class="main">[]</span>"</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">null</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">null</span> <span class="main">≡</span> is_Nil"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Haskell function definitions›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq</span><span class="main">)</span> <span class="quoted">Eq_strict</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity"><span class="class_parameter">eq_list</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eq_list</span><span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> TT"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">eq_list</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> FF"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">eq_list</span><span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> FF"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">eq_list</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>eq<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">andalso</span> <span class="free">eq_list</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fixrec_simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_sym</span><span class="main">)</span> <span class="quoted">Eq_sym</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">ys</span> <span class="main">=</span> eq<span class="main">⋅</span><span class="skolem">ys</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Cons
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_equiv</span><span class="main">)</span> <span class="quoted">Eq_equiv</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">≠</span> FF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">ys</span> <span class="main">=</span> TT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">ys</span><span class="main">⋅</span><span class="skolem">zs</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">zs</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ys</span></span> <span class="quoted"><span class="skolem">zs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Nil <span class="skolem">ys</span> <span class="skolem">zs</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eq_trans Cons.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_eq</span><span class="main">)</span> <span class="quoted">Eq_eq</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">≠</span> FF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">ys</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Cons
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">Ord</span><span class="main">)</span> <span class="quoted">Ord_strict</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity"><span class="class_parameter">compare_list</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> Ordering"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">compare_list</span><span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> EQ"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">compare_list</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> GT"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">compare_list</span><span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> LT"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">compare_list</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span>
    thenOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">compare_list</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fixrec_simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">Ord_linear</span><span class="main">)</span> <span class="quoted">Ord_linear</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> compare<span class="main">⋅</span><span class="skolem">ys</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Cons
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oppOrdering_thenOrdering<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">ys</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">ys</span> <span class="main">=</span> EQ"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Cons
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> compare_EQ_dest<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">zs</span> <span class="main">=</span> LT"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">ys</span> <span class="main">=</span> LT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">ys</span><span class="main">⋅</span><span class="skolem">zs</span> <span class="main">=</span> LT"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ys</span></span> <span class="quoted"><span class="skolem">zs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> compare_EQ_dest compare_LT_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">ys</span> <span class="main">=</span> is_EQ<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Cons
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_conv_compare<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">⊑</span> EQ"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">zipWith</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'b</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">zipWith</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free">zipWith</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">zipWith</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">zipWith</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'b</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">⟩</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">zip</span> <span class="main">=</span> zipWith<span class="main">⋅</span><span class="main">⟨,⟩</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">zipWith3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'c</span> <span class="main">→</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'b</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'d</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">zipWith3</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">:</span> <span class="free">zipWith3</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">zs</span></span></span>"</span></span> <span class="main">|</span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">unchecked</span></span><span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">zipWith3</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">zs</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zip3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'b</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">⟩</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">zip3</span> <span class="main">=</span> zipWith3<span class="main">⋅</span><span class="main">⟨,,⟩</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">map</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'b</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">map</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">map</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free">map</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> tr<span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">filter</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">filter</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="keyword1">If</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free">filter</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">else</span> <span class="free">filter</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">repeat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">repeat</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free">repeat</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">takeWhile</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> tr<span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">takeWhile</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="main">[]</span>     <span class="main">=</span>  <span class="main">[]</span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">takeWhile</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">If</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free">takeWhile</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">else</span>  <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">dropWhile</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> tr<span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">dropWhile</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="main">[]</span>     <span class="main">=</span>  <span class="main">[]</span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">dropWhile</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">If</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="free">dropWhile</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">span</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">-&gt;</span> tr<span class="main">)</span> <span class="main">-&gt;</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">-&gt;</span> <span class="main">⟨</span><span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">span</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="main">[]</span>     <span class="main">=</span> <span class="main">⟨</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">span</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">If</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">span</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">of</span> <span class="main">⟨</span><span class="bound">ys</span><span class="main">,</span> <span class="bound">zs</span><span class="main">⟩</span> <span class="main">⇒</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="bound">ys</span><span class="main">,</span><span class="bound">zs</span><span class="main">⟩</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">⟨</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">break</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">-&gt;</span> tr<span class="main">)</span> <span class="main">-&gt;</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">-&gt;</span> <span class="main">⟨</span><span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">break</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> span<span class="main">⋅</span><span class="main">(</span>neg <span class="keyword1">oo</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">nth</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> Integer <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nth</span><span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="main">|</span>
  nth_Cons <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">nth</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="keyword1">If</span> eq<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⋅</span><span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="free">nth</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="comment1">(* bh: Perhaps we should rename this to 'index',
to match the standard Haskell function named 'genericIndex'. *)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">nth_syn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> Integer <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">!!</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">!!</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> nth<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">partition</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> tr<span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">partition</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> P xs<span class="main">.</span> <span class="main">⟨</span>filter<span class="main">⋅</span><span class="bound">P</span><span class="main">⋅</span><span class="bound">xs</span><span class="main">,</span> filter<span class="main">⋅</span><span class="main">(</span>neg <span class="keyword1">oo</span> <span class="bound">P</span><span class="main">)</span><span class="main">⋅</span><span class="bound">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">iterate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iterate</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free">iterate</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">foldl</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'b</span> <span class="main">-&gt;</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">-&gt;</span> <span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="main">[</span><span class="tfree">'b</span><span class="main">]</span> <span class="main">-&gt;</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">foldl</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">⋅</span><span class="main">[]</span>     <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">foldl</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">foldl</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">foldl1</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'a</span> <span class="main">-&gt;</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">-&gt;</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">-&gt;</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">foldl1</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">[]</span>     <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">foldl1</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> foldl<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">foldr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">foldr</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">foldr</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free">foldr</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">foldr1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">foldr1</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">foldr1</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">foldr1</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x'</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free">foldr1</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x'</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">elem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>Eq <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">elem</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> FF"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">elem</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>eq<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">orelse</span> <span class="free">elem</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">notElem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>Eq <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">notElem</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> TT"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">notElem</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>neq<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">andalso</span> <span class="free">notElem</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">append</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">append</span><span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">append</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free">append</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">append_syn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">++</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">++</span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≡</span> append<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">concat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">concat</span> <span class="main">=</span> foldr<span class="main">⋅</span>append<span class="main">⋅</span><span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">concatMap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'b</span><span class="main">]</span><span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'b</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">concatMap</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> f<span class="main">.</span> concat <span class="keyword1">oo</span> map<span class="main">⋅</span><span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">last</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">-&gt;</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">last</span><span class="main">⋅</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">last</span><span class="main">⋅</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">:</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">last</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">-&gt;</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">init</span><span class="main">⋅</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">init</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="main">(</span><span class="free">init</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">reverse</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">-&gt;</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">reverse</span> <span class="main">=</span> foldl<span class="main">⋅</span><span class="main">(</span>flip<span class="main">⋅</span><span class="main">(:)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">the_and</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>tr<span class="main">]</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">the_and</span> <span class="main">=</span> foldr<span class="main">⋅</span>trand<span class="main">⋅</span>TT"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">the_or</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>tr<span class="main">]</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">the_or</span> <span class="main">=</span> foldr<span class="main">⋅</span>tror<span class="main">⋅</span>FF"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> tr<span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">all</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> the_and <span class="keyword1">oo</span> <span class="main">(</span>map<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">any</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> tr<span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">any</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> the_or <span class="keyword1">oo</span> <span class="main">(</span>map<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">tails</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tails</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">tails</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">:</span> <span class="free">tails</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">inits</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inits</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">inits</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="main">++</span> map<span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:)</span><span class="main">⋅</span><span class="main">(</span><span class="free">inits</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">scanr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'b</span><span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">scanr</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">q0</span></span></span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">q0</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">scanr</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">q0</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">qs</span> <span class="main">=</span> <span class="free">scanr</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">q0</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">in</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="bound">qs</span> <span class="keyword1">of</span>
      <span class="main">[]</span> <span class="main">⇒</span> <span class="main">⊥</span>
    <span class="main">|</span> <span class="bound">q</span> <span class="main">:</span> <span class="bound">qs'</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="bound">q</span> <span class="main">:</span> <span class="bound">qs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">scanr1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">scanr1</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">scanr1</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">of</span>
      <span class="main">[]</span> <span class="main">⇒</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span>
    <span class="main">|</span> <span class="bound">x'</span> <span class="main">:</span> <span class="bound">xs'</span> <span class="main">⇒</span> <span class="main">(</span>
      <span class="keyword1">let</span> <span class="bound">qs</span> <span class="main">=</span> <span class="free">scanr1</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">in</span>
      <span class="main">(</span><span class="keyword1">case</span> <span class="bound">qs</span> <span class="keyword1">of</span>
        <span class="main">[]</span> <span class="main">⇒</span> <span class="main">⊥</span>
      <span class="main">|</span> <span class="bound">q</span> <span class="main">:</span> <span class="bound">qs'</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="bound">q</span> <span class="main">:</span> <span class="bound">qs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">scanl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'b</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">scanl</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">:</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="keyword1">of</span>
    <span class="main">[]</span> <span class="main">⇒</span> <span class="main">[]</span>
  <span class="main">|</span> <span class="bound">x</span> <span class="main">:</span> <span class="bound">xs</span> <span class="main">⇒</span> <span class="free">scanl</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="bound">xs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">scanl1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">scanl1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> f ls<span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">ls</span> <span class="keyword1">of</span>
    <span class="main">[]</span> <span class="main">⇒</span> <span class="main">[]</span>
  <span class="main">|</span> <span class="bound">x</span> <span class="main">:</span> <span class="bound">xs</span> <span class="main">⇒</span> scanl<span class="main">⋅</span><span class="bound">f</span><span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Arithmetic Sequences›</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">upto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer <span class="main">→</span> Integer <span class="main">→</span> <span class="main">[</span>Integer<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">upto</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="keyword1">If</span> le<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free">upto</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">else</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">intsFrom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer <span class="main">→</span> <span class="main">[</span>Integer<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intsFrom</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> seq<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free">intsFrom</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> Enum <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">toEnum</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer <span class="main">→</span> <span class="tfree">'a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">fromEnum</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> Integer"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">succ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">succ</span> <span class="main">=</span> toEnum <span class="keyword1">oo</span> <span class="main">(+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">oo</span> fromEnum"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pred</span> <span class="main">=</span> toEnum <span class="keyword1">oo</span> <span class="main">(-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">oo</span> fromEnum"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">enumFrom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">enumFrom</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> map<span class="main">⋅</span>toEnum<span class="main">⋅</span><span class="main">(</span>intsFrom<span class="main">⋅</span><span class="main">(</span>fromEnum<span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">enumFromTo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">enumFromTo</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> x y<span class="main">.</span> map<span class="main">⋅</span>toEnum<span class="main">⋅</span><span class="main">(</span>upto<span class="main">⋅</span><span class="main">(</span>fromEnum<span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>fromEnum<span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">enumFrom_To_syn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>Enum <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">[</span>_<span class="keyword1">..</span><span class="keyword3">/</span>_<span class="keyword1">]</span><span class="keyword3">)</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">..</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">≡</span> enumFromTo<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">enumFrom_syn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>Enum <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">[</span>_<span class="keyword1">..]</span><span class="keyword3">)</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">..]</span></span> <span class="main">≡</span> enumFrom<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Integer <span class="main">::</span> <span class="quoted">Enum</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"toEnum <span class="main">=</span> ID"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fromEnum <span class="main">=</span> ID"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">take</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">take</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="keyword1">If</span> le<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⋅</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">[]</span> <span class="main">|</span> <span class="bound">y</span> <span class="main">:</span> <span class="bound">ys</span> <span class="main">⇒</span> <span class="bound">y</span> <span class="main">:</span> <span class="free">take</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="bound">ys</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">drop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">drop</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="keyword1">If</span> le<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⋅</span><span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">else</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">[]</span> <span class="main">|</span> <span class="bound">y</span> <span class="main">:</span> <span class="bound">ys</span> <span class="main">⇒</span> <span class="free">drop</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="bound">ys</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">isPrefixOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>Eq<span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">isPrefixOf</span><span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> TT"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">isPrefixOf</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> FF"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">isPrefixOf</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>eq<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">andalso</span> <span class="free">isPrefixOf</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">isSuffixOf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>Eq<span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">isSuffixOf</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> isPrefixOf<span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">intersperse</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">intersperse</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">sep</span></span></span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">intersperse</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">sep</span></span></span><span class="main">⋅</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">intersperse</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">sep</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">sep</span></span></span><span class="main">:</span><span class="free">intersperse</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">sep</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">intercalate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">intercalate</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xss</span></span></span> <span class="main">=</span> concat<span class="main">⋅</span><span class="main">(</span>intersperse<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xss</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">replicate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">replicate</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> n x<span class="main">.</span> take<span class="main">⋅</span><span class="bound">n</span><span class="main">⋅</span><span class="main">(</span>repeat<span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">findIndices</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> tr<span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span>Integer<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">findIndices</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> P xs<span class="main">.</span>
    map<span class="main">⋅</span>snd<span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">⟨</span>x<span class="main">,</span> i<span class="main">⟩</span><span class="main">.</span> <span class="bound">P</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>zip<span class="main">⋅</span><span class="bound">xs</span><span class="main">⋅</span><span class="main">[</span><span class="main">0</span><span class="main">..]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> Integer"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">length</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">length</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">length</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">+</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">delete</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>Eq <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">delete</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">delete</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">If</span> eq<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free">delete</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">diff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>Eq<span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diff</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">diff</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">diff</span><span class="main">⋅</span><span class="main">(</span>delete<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">diff_syn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>Eq<span class="main">]</span> <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"\<span class="keyword1">\\\</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> \<span class="main"><span class="free">\\\</span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≡</span> diff<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Logical predicates on lists›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">finite_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  Nil <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">finite_list</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  Cons <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">finite_list</span> <span class="bound">xs</span> <span class="main">⟹</span> <span class="free">finite_list</span> <span class="main">(</span><span class="bound">x</span> <span class="main">:</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> finite_listE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite_list <span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_list_upwards<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">⊑</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">:</span> <span class="skolem">xs</span> <span class="main">⊑</span> <span class="skolem">ys</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">:</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">:</span> <span class="skolem">xs</span> <span class="main">⊑</span> <span class="skolem">ys</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">⊑</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="skolem">ys'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ys</span> <span class="main">=</span> <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> adm_finite_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"adm finite_list"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_list_upwards adm_upward<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bot_not_finite_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_list <span class="main">⊥</span> <span class="main">=</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_list.cases<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">listmem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">listmem</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">listmem</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟹</span> <span class="free">listmem</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> listmem_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> listmem <span class="free">x</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> listmem <span class="free">x</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"listmem <span class="free">x</span> <span class="main">(</span><span class="free">y</span> <span class="main">:</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∨</span> listmem <span class="free">x</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> listmem.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> listmem.intros<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> listmem <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">⊥</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">x</span> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">distinct</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  Nil <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">distinct</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  Cons <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">distinct</span> <span class="bound">xs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∉</span> set <span class="bound">xs</span> <span class="main">⟹</span> <span class="free">distinct</span> <span class="main">(</span><span class="bound">x</span> <span class="main">:</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_ID <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map<span class="main">⋅</span>ID<span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> enumFrom_intsFrom_conv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"enumFrom <span class="main">=</span> intsFrom"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cfun_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enumFrom_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> enumFromTo_upto_conv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"enumFromTo <span class="main">=</span> upto"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cfun_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enumFromTo_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zipWith_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"zipWith<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">ys</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"zipWith<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zip_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"zip<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">y</span> <span class="main">:</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main">:</span> zip<span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="free">ys</span>"</span></span>
  <span class="quoted"><span class="quoted">"zip<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"zip<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"zip<span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"zip<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">ys</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zip_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> zip_Nil2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> zip<span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nth<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"nth<span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fixrec_simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> upto_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"upto<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"upto<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> upto_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> upto<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> upto<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="free">m</span> <span class="main">:</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">+</span><span class="main">1</span><span class="main">..</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> upto.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filter_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_Cons_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> TT <span class="main">⟹</span> nth<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF <span class="main">⟹</span> nth<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> nth<span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nth.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nth_Cons_split<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>nth<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>eq<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span>nth<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                              <span class="main">(</span>eq<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> TT <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span>nth<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                              <span class="main">(</span><span class="free">n</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span>nth<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(*   "!!x. P (test x) = (~ (∃a b. x = (a, b) &amp; ~ P (test (a, b))))" *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">lemma</span></span> nth_Cons_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">!!</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">!!</span> <span class="main">1</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!!</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">!!</span> numeral <span class="main">(</span>Num.Bit0 <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!!</span> numeral <span class="main">(</span>Num.BitM <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">!!</span> numeral <span class="main">(</span>Num.Bit1 <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!!</span> numeral <span class="main">(</span>Num.Bit0 <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons numeral_Integer_eq
    zero_Integer_def one_Integer_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> take_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> take_strict_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="free">i</span> <span class="main">=</span> TT <span class="main">⟹</span> take<span class="main">⋅</span><span class="free">i</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> take.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">i</span><span class="main">⋅</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> drop_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"drop<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> isPrefixOf_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"isPrefixOf<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"isPrefixOf<span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">:</span><span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"last<span class="main">⋅</span><span class="main">⊥</span><span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"last<span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">:</span><span class="main">⊥</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"last<span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_spine_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> finite_list <span class="free">xs</span> <span class="main">⟹</span> last<span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> init_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"init<span class="main">⋅</span><span class="main">⊥</span><span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"init<span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">:</span><span class="main">⊥</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> init_nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"init<span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_foldr_strict2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">)</span> <span class="main">⟹</span> foldr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="operator">fixrec_simp</span>

<span class="keyword1"><span class="command">lemma</span></span> foldr_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">d</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">d</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> foldr_Cons_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="main">(:)</span><span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> append_strict1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">++</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span>

<span class="keyword1"><span class="command">lemma</span></span> foldr_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> foldr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span>foldr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">ys</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> foldl_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">d</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> foldr1_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"foldr1<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">⊥</span><span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"foldr1<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">:</span><span class="main">⊥</span><span class="main">)</span><span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> foldl1_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"foldl1<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">⊥</span><span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span>

<span class="keyword1"><span class="command">lemma</span></span> foldl_spine_strict<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> finite_list <span class="free">xs</span> <span class="main">⟹</span> foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> foldl_assoc_foldr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">⋅</span><span class="bound">z</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="bound">y</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> neutr1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> neutr2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="free">z</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> foldr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite_list <span class="free">xs</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite_list <span class="skolem">xs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">⋅</span><span class="bound">y</span><span class="main">⋅</span><span class="main">(</span>foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="main">(</span>foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="main">(</span>foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="skolem">x</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="main">(</span>foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Cons.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Cons.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">x</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neutr1 neutr2<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="skolem">x</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="main">(</span>foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> step<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="main">(</span>foldr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Cons.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>foldr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">(</span><span class="skolem">x</span><span class="main">:</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> elem_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"elem<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span>

<span class="keyword1"><span class="command">lemma</span></span> notElem_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"notElem<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span>

<span class="keyword1"><span class="command">lemma</span></span> list_eq_nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">l</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> TT <span class="main">⟷</span> <span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="free">l</span> <span class="main">=</span> TT <span class="main">⟷</span> <span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> take<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> take.simps<span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> take_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">0</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">0</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> take.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="free">i</span> <span class="main">=</span> TT <span class="main">⟹</span> take<span class="main">⋅</span><span class="free">i</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">:</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">:</span> take<span class="main">⋅</span><span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> take.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">i</span><span class="main">⋅</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> take_MkI_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> take<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">:</span> take<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> take.simps<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> take_numeral_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>
  <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">(</span>numeral <span class="main">(</span>Num.Bit0 <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">:</span> take<span class="main">⋅</span><span class="main">(</span>numeral <span class="main">(</span>Num.BitM <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">(</span>numeral <span class="main">(</span>Num.Bit1 <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">:</span> take<span class="main">⋅</span><span class="main">(</span>numeral <span class="main">(</span>Num.Bit0 <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> take.simps<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def numeral_Integer_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> drop_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"drop<span class="main">⋅</span><span class="main">0</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="quoted"><span class="quoted">"drop<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">0</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> drop.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> drop_pos <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF <span class="main">⟹</span> drop<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">xs</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">[]</span> <span class="main">|</span> <span class="bound">y</span> <span class="main">:</span> <span class="bound">ys</span> <span class="main">⇒</span> drop<span class="main">⋅</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="bound">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> drop.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> drop_numeral_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"drop<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="quoted"><span class="quoted">"drop<span class="main">⋅</span><span class="main">(</span>numeral <span class="main">(</span>Num.Bit0 <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> drop<span class="main">⋅</span><span class="main">(</span>numeral <span class="main">(</span>Num.BitM <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="quoted"><span class="quoted">"drop<span class="main">⋅</span><span class="main">(</span>numeral <span class="main">(</span>Num.Bit1 <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> drop<span class="main">⋅</span><span class="main">(</span>numeral <span class="main">(</span>Num.Bit0 <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> drop.simps<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def numeral_Integer_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_drop_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">i</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">++</span> drop<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">i</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nonneg <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span> <span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> drop.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> take.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>neg <span class="skolem">nat</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> drop.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> take.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_intsFrom_enumFrom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="free">i</span><span class="main">..]</span> <span class="main">=</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="free">i</span><span class="main">..</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> int <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> int <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span> <span class="main">=</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span> <span class="main">=</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">i</span><span class="main">..]</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="skolem">i</span> <span class="main">:</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">..]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> intsFrom.simps<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">i</span><span class="main">..]</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="skolem">i</span> <span class="main">:</span> take<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> IH * <span class="keyword1"><span class="command">using</span></span> gt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">-</span> int <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> take.simps<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> drop_intsFrom_enumFrom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"drop<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="free">i</span><span class="main">..]</span> <span class="main">=</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">i</span><span class="main">)</span><span class="main">..]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> int <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">i</span></span> <span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> enumFrom_intsFrom_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> drop.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cfun_arg_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cfun_arg_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_append_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span> <span class="main">⟹</span> last<span class="main">⋅</span><span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_list.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> init_append_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span> <span class="main">⟹</span> init<span class="main">⋅</span><span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_list.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> append_Nil2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">++</span> <span class="main">[]</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> append_assoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">++</span> <span class="free">zs</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span> <span class="main">++</span> <span class="free">zs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> concat_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"concat<span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"concat<span class="main">⋅</span><span class="main">(</span><span class="free">xs</span> <span class="main">:</span> <span class="free">xss</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">++</span> concat<span class="main">⋅</span><span class="free">xss</span>"</span></span>
  <span class="quoted"><span class="quoted">"concat<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> concat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> concatMap_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"concatMap<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"concatMap<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="free">x</span> <span class="main">++</span> concatMap<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="quoted"><span class="quoted">"concatMap<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> concatMap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> filter_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">++</span> filter<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> If_and_if<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> elem_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"elem<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>elem<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">xs</span> <span class="keyword1">orelse</span> elem<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> filter_filter <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="free">Q</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> <span class="free">Q</span><span class="main">⋅</span><span class="bound">x</span> <span class="keyword1">andalso</span> <span class="free">P</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> If2_def <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> split_If2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> filter_const_TT <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">_</span><span class="main">.</span> TT<span class="main">)</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> tails_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"tails<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span>

<span class="keyword1"><span class="command">lemma</span></span> inits_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inits<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span>

<span class="keyword1"><span class="command">lemma</span></span> the_and_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"the_and<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span>

<span class="keyword1"><span class="command">lemma</span></span> the_or_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"the_or<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span>

<span class="keyword1"><span class="command">lemma</span></span> all_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"all<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span>

<span class="keyword1"><span class="command">lemma</span></span> any_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"any<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fixrec_simp</span>

<span class="keyword1"><span class="command">lemma</span></span> tails_neq_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"tails<span class="main">⋅</span><span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> inits_neq_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inits<span class="main">⋅</span><span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> Nil_neq_tails <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≠</span> tails<span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> Nil_neq_inits <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≠</span> inits<span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_list_not_bottom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> head_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"head<span class="main">⋅</span><span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">If</span> null<span class="main">⋅</span><span class="free">xs</span> <span class="keyword1">then</span> head<span class="main">⋅</span><span class="free">ys</span> <span class="keyword1">else</span> head<span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> filter_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">p</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">=</span> <span class="free">q</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">⟹</span> filter<span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> filter.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> filter_TT <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_cong <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">Λ</span></span></span> <span class="main"><span class="main"><span class="main">_</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> TT"</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> filter_FF <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">=</span> FF"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> map_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">p</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">=</span> <span class="free">q</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">⟹</span> map<span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> map<span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> map.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_list_upto<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_list <span class="main">(</span>upto<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">m</span> <span class="free">n</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="free">m</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="free">m</span> <span class="main">=</span> int <span class="skolem">d</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">m</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">d</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> int <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="free">m</span> <span class="main">=</span> <span class="main">-</span> int <span class="skolem">d</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">m</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">m</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filter_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span><span class="main">⋅</span><span class="bound">x</span> <span class="keyword1">andalso</span> <span class="free">P</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">⋅</span><span class="bound">x</span> <span class="keyword1">andalso</span> <span class="free">Q</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="free">Q</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="free">Q</span><span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> filter_cong <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Λ</span> x<span class="main">.</span> <span class="free">Q</span><span class="main">⋅</span><span class="bound">x</span> <span class="keyword1">andalso</span> <span class="free">P</span><span class="main">⋅</span><span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Λ</span> x<span class="main">.</span> <span class="free">P</span><span class="main">⋅</span><span class="bound">x</span> <span class="keyword1">andalso</span> <span class="free">Q</span><span class="main">⋅</span><span class="bound">x</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> upto_append_intsFrom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"upto<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span> <span class="main">++</span> intsFrom<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> intsFrom<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="free">m</span> <span class="free">n</span> <span class="main">++</span> <span class="main">_</span> <span class="main">=</span> <span class="var">?i</span> <span class="free">m</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="free">m</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nonneg <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> int <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">++</span> <span class="var">?i</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="main">++</span> <span class="var">?i</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">m</span> <span class="main">:</span> <span class="var">?u</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">++</span> <span class="var">?i</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="skolem">m</span> <span class="main">:</span> <span class="var">?i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> intsFrom.simps<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> intsFrom.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>neg <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_upto <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>upto<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>MkI<span class="main">⋅</span><span class="bound">i</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?u</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?R</span> <span class="free">m</span> <span class="free">n</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="free">m</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nonneg <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> int <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?u</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?R</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?u</span> <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">m</span> <span class="main">:</span> <span class="var">?u</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> insert <span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="var">?R</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?R</span> <span class="skolem">m</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Nil_append_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This version of definedness rule for Nil is made necessary by
the reorient simproc.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bottom_neq_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Simproc to rewrite <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Nil <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">=</span></span> Nil"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹
  <span class="entity">Reorient_Proc.add</span>
    <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> Const<span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Nil<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> true <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> false<span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">simproc_setup</span></span> reorient_Nil <span class="main">(</span><span class="quoted"><span class="quoted">"Nil <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span> <span class="main">=</span> <span class="entity">Reorient_Proc.proc</span>


<span class="keyword1"><span class="command">lemma</span></span> set_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> set <span class="free">xs</span> <span class="main">∪</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟷</span> distinct <span class="free">xs</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_list_append <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_list <span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> finite_list <span class="free">xs</span> <span class="main">∧</span> finite_list <span class="free">ys</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">presume</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> distinct <span class="free">xs</span> <span class="main">∧</span> distinct <span class="free">ys</span> <span class="main">∧</span> set <span class="free">xs</span> <span class="main">∩</span> set <span class="free">ys</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">xs</span> <span class="free">ys</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> Cons' <span class="main">=</span> Cons
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">u</span> <span class="skolem">us</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="skolem">us</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">us</span> <span class="main">++</span> <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">us</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"MkI<span class="main">⋅</span><span class="main">(</span>int <span class="main">(</span>card <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length<span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def plus_MkI_MkI <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> one_Integer_def <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_delete <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>Eq_eq<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>delete<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> set <span class="free">xs</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_delete <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>Eq_eq<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>delete<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> set_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="free">ys</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>Eq_eq<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> eq<span class="main">⋅</span><span class="bound">a</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">xs</span> \<span class="main">\\\</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> set <span class="free">xs</span> <span class="main">-</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> distinct.induct<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"delete<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> eq<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> set_delete <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">xs</span>›</span></span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?xs</span> <span class="main">=</span> set <span class="skolem">xs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="skolem">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?xs</span><span class="main">.</span> eq<span class="main">⋅</span><span class="bound">a</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">xs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?xs</span> \<span class="main">\\\</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> set <span class="var">?xs</span> <span class="main">-</span> set <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> **<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_delete_filter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>Eq_eq<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"delete<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> neq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"delete<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> neq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> TT
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> neq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">_</span><span class="main">.</span> TT<span class="main">)</span><span class="main">⋅</span><span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> TT <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> FF"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> eqD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> trE<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> neq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">_</span><span class="main">.</span> TT<span class="main">)</span><span class="main">⋅</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> filter_cong <span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> TT
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_diff_filter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="free">ys</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>Eq_eq<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> eq<span class="main">⋅</span><span class="bound">a</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> \<span class="main">\\\</span> <span class="free">ys</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> neg<span class="main">⋅</span><span class="main">(</span>elem<span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="free">ys</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"delete<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> eq<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> set_delete <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">xs</span>›</span></span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?xs</span> <span class="main">=</span> set <span class="skolem">xs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="skolem">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?xs</span><span class="main">.</span> eq<span class="main">⋅</span><span class="bound">a</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">xs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs</span> \<span class="main">\\\</span> <span class="skolem">ys</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> neg<span class="main">⋅</span><span class="main">(</span>elem<span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="var">?xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">xs</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_delete_filter<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_upto <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"distinct <span class="main">[</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">..</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="free">m</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nonneg <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> int <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> set_intsFrom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>intsFrom<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>MkI<span class="main">⋅</span><span class="bound">n</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?i</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="var">?I</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?i</span> <span class="free">m</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?I</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?i</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"listmem <span class="skolem">n</span> <span class="main">(</span><span class="var">?i</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="var">?I</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?i</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">:</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="var">?i</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">:</span> <span class="skolem">xs</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="skolem">m</span> <span class="main">:</span> <span class="var">?i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> intsFrom.simps<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="var">?i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>MkI<span class="main">⋅</span><span class="bound">n</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"listmem <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="var">?i</span> <span class="bound">m</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>MkI<span class="main">⋅</span><span class="bound">n</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">:</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="var">?i</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">:</span> <span class="skolem">xs</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="skolem">m</span> <span class="main">:</span> <span class="var">?i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> intsFrom.simps<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="var">?i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> IH <span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>MkI<span class="main">⋅</span><span class="bound">n</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">m</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>MkI<span class="main">⋅</span><span class="bound">n</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">⊆</span> set <span class="main">(</span><span class="var">?i</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?I</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> upto_append_intsFrom <span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?i</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>upto<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span><span class="var">?i</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_list_upto <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?i</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> * one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> If_eq_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="comment1">(* FIXME: move *)</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">b</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">=</span> TT <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">=</span> FF <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> upto_eq_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"upto<span class="main">⋅</span><span class="free">m</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">m</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> upto.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> seq_eq_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="comment1">(* FIXME: move *)</span>
  <span class="quoted"><span class="quoted">"seq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_conv_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> intsFrom_eq_bottom_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"intsFrom<span class="main">⋅</span><span class="free">m</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">m</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> intsFrom_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">..]</span> <span class="main">=</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="free">n</span> <span class="main">..</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">++</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">..]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">-</span> <span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">..]</span> <span class="main">=</span> <span class="main">(</span>take<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">..]</span><span class="main">)</span> <span class="main">++</span> <span class="main">(</span>drop<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">..]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> take_drop_append<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">..</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">++</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">..]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> drop_intsFrom_enumFrom<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ge<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>take_intsFrom_enumFrom<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filter_fast_forward<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">n'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span> <span class="main">.</span> Def <span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span> <span class="main">.</span> Def <span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="free">n'</span><span class="main">..]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span> <span class="main">=</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="free">n'</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">++</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="free">n'</span><span class="main">..]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?l1</span> <span class="main">++</span> <span class="var">?l2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom_split<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">n</span></span></span><span class="main"><span class="main"><span class="main">+</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span> <span class="main">.</span> Def <span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="free">n'</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_FF<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_list_upto<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> null_eq_TT_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"null<span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> TT <span class="main">⟷</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> null_set_empty_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> null<span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> TT <span class="main">⟷</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> elem_TT <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>Eq_eq"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"elem<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> TT <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> elem.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> xs<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a list<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="improper">a</span><span class="main">⋅</span><span class="free">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> elem_FF <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>Eq_equiv"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"elem<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> FF <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> elem.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="main">(</span><span class="operator">rename_tac</span> xs<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> repeat_neq_bottom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"repeat<span class="main">⋅</span><span class="free">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> repeat.simps<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> list_case_repeat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_case<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span>repeat<span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">(</span>repeat<span class="main">⋅</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> repeat.simps<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> length_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> length<span class="main">⋅</span><span class="free">xs</span> <span class="main">+</span> length<span class="main">⋅</span><span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> replicate_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"replicate<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> replicate_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> replicate_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"replicate<span class="main">⋅</span><span class="main">0</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">0</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> replicate_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Integer_add_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"MkI<span class="main">⋅</span><span class="main">0</span> <span class="main">+</span> <span class="free">n</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> replicate_MkI_plus_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">:</span> replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">:</span> replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> replicate_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> take.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def zero_Integer_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> replicate_append_plus_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span> <span class="main">++</span> replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span>
    <span class="main">=</span> replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span> <span class="main">+</span> MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nonneg <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ge<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="skolem">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">m</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span> <span class="main">++</span> replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">:</span> <span class="main">(</span>replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span> <span class="main">++</span> replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span> <span class="main">:</span> replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ge <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>neg <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> replicate_MkI_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">:</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> replicate_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> take.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_replicate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="main">(</span>replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nonneg <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> replicate_append_plus_conv zero_Integer_def one_Integer_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>neg <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> replicate_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_oo <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> map<span class="main">⋅</span><span class="main">(</span><span class="free">f</span> <span class="keyword1">oo</span> <span class="free">g</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_Cons_MkI <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">!!</span> <span class="main">(</span>MkI<span class="main">⋅</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!!</span> <span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nth_Cons
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def<span class="main">)</span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_plus_intsFrom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="main">(+</span> MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>intsFrom<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> intsFrom<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> list.take_lemma<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_take <span class="skolem">i</span><span class="main">⋅</span><span class="var">?l</span> <span class="main">=</span> list_take <span class="skolem">i</span><span class="main">⋅</span><span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> intsFrom.simps<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> plus_eq_MkI_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">+</span> <span class="free">n</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="free">m</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">l'</span> <span class="bound">n'</span><span class="main">.</span> <span class="free">l</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="bound">l'</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="bound">n'</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> <span class="bound">l'</span> <span class="main">+</span> <span class="bound">n'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_ge_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="free">n</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_Integer_def plus_eq_MkI_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_0_conv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">0</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="improper">list</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> length_ge_0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> length_ge_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> int <span class="free">n</span><span class="main">)</span>
    <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">us</span><span class="main">.</span> <span class="free">xs</span> <span class="main">=</span> <span class="bound">u</span> <span class="main">:</span> <span class="bound">us</span> <span class="main">∧</span> length<span class="main">⋅</span><span class="bound">us</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span>int <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">:</span> <span class="skolem">us</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> length<span class="main">⋅</span><span class="skolem">us</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> int <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="skolem">us</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="skolem">us</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="skolem">us</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span>int <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="skolem">us</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span>int <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="skolem">us</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_list_length_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> length<span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span>int <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nth_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">!!</span> MkI<span class="main">⋅</span><span class="free">m</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!!</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> length_ge_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_eq_MkI_conv one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> ge <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> ge <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> length_ge_0 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_Integer_def plus_eq_MkI_conv<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">OF</span> len le<span class="main"><span class="main">]</span></span> zero_Integer_def one_Integer_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> replicate_nth <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>replicate<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span> <span class="main">++</span> <span class="free">xs</span><span class="main">)</span> <span class="main">!!</span> MkI<span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!!</span> MkI<span class="main">⋅</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nth_append <span class="main">[</span><span class="operator">OF</span> length_replicate <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> map2_zip<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span><span class="main">⟨</span>x<span class="main">,</span> y<span class="main">⟩</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="free">f</span><span class="main">⋅</span><span class="bound">y</span><span class="main">⟩</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>zip<span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> zip<span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map2_filter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span><span class="main">⟨</span>x<span class="main">,</span> y<span class="main">⟩</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="free">f</span><span class="main">⋅</span><span class="bound">y</span><span class="main">⟩</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span><span class="main">⟨</span>x<span class="main">,</span> y<span class="main">⟩</span><span class="main">.</span> <span class="free">P</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>
    <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span><span class="main">⟨</span>x<span class="main">,</span> y<span class="main">⟩</span><span class="main">.</span> <span class="free">P</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span><span class="main">⟨</span>x<span class="main">,</span> y<span class="main">⟩</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="free">f</span><span class="main">⋅</span><span class="bound">y</span><span class="main">⟩</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x xs<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a b<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">⋅</span><span class="improper">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_map_snd<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟹</span> map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span>snd<span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>
    <span class="main">=</span> map<span class="main">⋅</span>snd<span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span><span class="main">⟨</span>x<span class="main">,</span> y<span class="main">⟩</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="free">f</span><span class="main">⋅</span><span class="bound">y</span><span class="main">⟩</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> findIndices_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"findIndices<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span>
    <span class="keyword1">If</span> <span class="free">P</span><span class="main">⋅</span><span class="free">a</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="main">:</span> map<span class="main">⋅</span><span class="main">(+</span><span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>findIndices<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>
    <span class="keyword1">else</span> map<span class="main">⋅</span><span class="main">(+</span><span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>findIndices<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> findIndices_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> intsFrom.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">⋅</span><span class="free">a</span>"</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span>
       <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> map_oo
       <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_oo <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> map_map_snd one_Integer_def zero_Integer_def
       map_plus_intsFrom <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
       map2_zip <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(+</span> MkI<span class="main">⋅</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span>
       map2_filter <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(+</span> MkI<span class="main">⋅</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> filter_alt_def<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> map<span class="main">⋅</span><span class="main">(</span>nth<span class="main">⋅</span><span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>findIndices<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer <span class="main">→</span> <span class="tfree">'a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> tr"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">i</span> <span class="skolem">xs</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="skolem">i</span><span class="main">.</span> <span class="skolem">f</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="skolem">f</span><span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span>snd<span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span><span class="main">⟨</span>x<span class="main">,</span> i<span class="main">⟩</span><span class="main">.</span> <span class="skolem">P</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>zip<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">i</span><span class="main">..]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span> map<span class="main">⋅</span><span class="skolem">g</span><span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span>snd<span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span><span class="main">⟨</span>x<span class="main">,</span> i<span class="main">⟩</span><span class="main">.</span> <span class="skolem">P</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>zip<span class="main">⋅</span><span class="skolem">xs</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">i</span><span class="main">..]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> intsFrom.simps<span class="main">)</span>
        <span class="main">(</span><span class="operator">rename_tac</span> a b c<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">⋅</span><span class="improper">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ys</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> nth<span class="main">⋅</span><span class="skolem">ys</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>nth<span class="main">⋅</span><span class="main">(</span><span class="skolem">a</span> <span class="main">:</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword1">oo</span> <span class="main">(+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_Integer_def zero_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> 2 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ys</span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="main">(</span>nth<span class="main">⋅</span><span class="main">(</span><span class="skolem">a</span> <span class="main">:</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword1">oo</span> <span class="main">(+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>findIndices<span class="main">⋅</span><span class="skolem">P</span><span class="main">⋅</span><span class="skolem">xs</span><span class="main">)</span>
      <span class="main">=</span> map<span class="main">⋅</span><span class="main">(</span>nth<span class="main">⋅</span><span class="skolem">ys</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>findIndices<span class="main">⋅</span><span class="skolem">P</span><span class="main">⋅</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> findIndices_def 1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">ys</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span> zero_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> 3 <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> findIndices_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> findIndices_def<span class="main">)</span>
       <span class="main">(</span><span class="operator">rename_tac</span> a b<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">⋅</span><span class="improper">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> findIndices_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">cfun_image</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">`⋅</span>"</span> 90<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">`⋅</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> Rep_cfun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`⋅</span> set <span class="free">xs</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"listmem <span class="skolem">a</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"listmem <span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="operator">simp_all</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">⊆</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"listmem <span class="skolem">a</span> <span class="main">(</span>map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="bound">b</span> <span class="main">∧</span> listmem <span class="bound">b</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">xs</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">rename_tac</span> xsa<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">xsa</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⊆</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> reverse<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> reverse<span class="antiquote"><span class="antiquote">}</span></span></span></span> induction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Alternative simplification rules for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> reverse<span class="antiquote"><span class="antiquote">}</span></span></span></span> (easier
to use for equational reasoning):›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> reverse_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"reverse<span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reverse.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reverse_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"reverse<span class="main">⋅</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reverse.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reverse_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"reverse<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reverse.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> foldl_flip_Cons_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span><span class="main">(</span>flip<span class="main">⋅</span><span class="main">(:)</span><span class="main">)</span><span class="main">⋅</span><span class="free">ys</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> foldl<span class="main">⋅</span><span class="main">(</span>flip<span class="main">⋅</span><span class="main">(:)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Cons append.simps append_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reverse_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"reverse<span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">:</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> reverse<span class="main">⋅</span><span class="free">xs</span> <span class="main">++</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reverse.simps<span class="main">)</span>
     <span class="main">(</span><span class="operator">subst</span> foldl_flip_Cons_append<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reverse_append_below<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reverse<span class="main">⋅</span><span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⊑</span> reverse<span class="main">⋅</span><span class="free">ys</span> <span class="main">++</span> reverse<span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_assoc <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> monofun_cfun append_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> reverse_reverse_below<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reverse<span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="free">xs</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reverse<span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="main">(</span><span class="skolem">x</span><span class="main">:</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> reverse<span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">++</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊑</span> reverse<span class="main">⋅</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">++</span> reverse<span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reverse_append_below<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">:</span> reverse<span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊑</span> <span class="skolem">x</span> <span class="main">:</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reverse_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reverse<span class="main">⋅</span><span class="main">(</span><span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> reverse<span class="main">⋅</span><span class="free">ys</span> <span class="main">++</span> reverse<span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reverse_spine_strict<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> finite_list <span class="free">xs</span> <span class="main">⟹</span> reverse<span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reverse.simps foldl_spine_strict<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reverse_finite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="main">(</span>reverse<span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reverse_reverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_list <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reverse<span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reverse_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Nil snoc<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite_list <span class="free">xs</span><span class="main">;</span> <span class="free">P</span> <span class="main">[]</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span> <span class="bound">xs</span> <span class="main">.</span> finite_list <span class="bound">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">xs</span> <span class="main">++</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> reverse_reverse <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_list.induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"reverse<span class="main"><span class="main">⋅</span></span><span class="free"><span class="free">xs</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> length_plus_not_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> TT <span class="main">⟹</span> le<span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">xs</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> TT <span class="main">⟹</span> False"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_class.le_trans dist_eq_tr<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> le_Integer_numeral_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_plus_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_length_plus_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="free">xs</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> take<span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">xs</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">y</span><span class="main">:</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">:</span> take<span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> take.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">xs</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="main">0</span>"</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> length_plus_not_0 le_Integer_numeral_simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_length_plus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="free">xs</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> le<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">xs</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> TT"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="skolem">n</span><span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="main">⊥</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_plus_1 le_refl_Integer<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="skolem">n</span><span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_take_length_isPrefixOf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="main">(</span>take<span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">ys</span><span class="main">)</span> <span class="main">⊑</span> isPrefixOf<span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> bottom
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False
        <span class="keyword1"><span class="command">using</span></span> le_length_plus <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword2"><span class="keyword">and</span></span> IH <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_length_plus_1 monofun_cfun_arg<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Data_Maybe">
<div class="head">
<h1>Theory Data_Maybe</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Data: Maybe›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Data_Maybe
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Type_Classes.html">Type_Classes</a>
    <a href="Data_Function.html">Data_Function</a>
    <a href="Data_List.html">Data_List</a>
    <a href="Data_Bool.html">Data_Bool</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">domain</span></span> <span class="tfree">'a</span> Maybe <span class="main">=</span> Nothing <span class="main">|</span> Just <span class="main">(</span><span class="keyword2"><span class="keyword">lazy</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">maybe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">→</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">→</span> <span class="tfree">'a</span> Maybe <span class="main">→</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">maybe</span> <span class="main">≡</span> Maybe_case"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">isJust</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">isJust</span><span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> TT"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">isJust</span><span class="main">⋅</span>Nothing <span class="main">=</span> FF"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">isNothing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">isNothing</span> <span class="main">=</span> neg <span class="keyword1">oo</span> isJust"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">fromJust</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fromJust</span><span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fromJust</span><span class="main">⋅</span>Nothing <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">fromMaybe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> Maybe <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fromMaybe</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">⋅</span>Nothing <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fromMaybe</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">maybeToList</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">maybeToList</span><span class="main">⋅</span>Nothing <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">maybeToList</span><span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">listToMaybe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="tfree">'a</span> Maybe"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">listToMaybe</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> Nothing"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">listToMaybe</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">:</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> Just<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="comment1">(* FIXME: The Prelude definition uses list comps, which are too advanced for our syntax *)</span>
<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">catMaybes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> Maybe<span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">catMaybes</span> <span class="main">=</span> concatMap<span class="main">⋅</span>maybeToList"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">mapMaybe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span> Maybe<span class="main">)</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'b</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mapMaybe</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> catMaybes <span class="keyword1">oo</span> map<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Maybe <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq</span><span class="main">)</span> <span class="quoted">Eq_strict</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"eq <span class="main">=</span> maybe<span class="main">⋅</span><span class="main">(</span>maybe<span class="main">⋅</span>TT<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> y<span class="main">.</span> FF<span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> maybe<span class="main">⋅</span>FF<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> y<span class="main">.</span> eq<span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_Maybe_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_Maybe_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eq_Maybe_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span>Nothing<span class="main">⋅</span>Nothing <span class="main">=</span> TT"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span>Nothing<span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span>Nothing <span class="main">=</span> FF"</span></span>
  <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eq_Maybe_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">instance</span></span> Maybe <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_sym</span><span class="main">)</span> <span class="quoted">Eq_sym</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> eq<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> Maybe <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_equiv</span><span class="main">)</span> <span class="quoted">Eq_equiv</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">≠</span> FF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> TT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> TT"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eq_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> Maybe <span class="main">::</span> <span class="main">(</span><span class="quoted">Eq_eq</span><span class="main">)</span> <span class="quoted">Eq_eq</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">≠</span> FF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Maybe <span class="main">::</span> <span class="main">(</span><span class="quoted">Ord</span><span class="main">)</span> <span class="quoted">Ord_strict</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"compare <span class="main">=</span> maybe<span class="main">⋅</span><span class="main">(</span>maybe<span class="main">⋅</span>EQ<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> y<span class="main">.</span> LT<span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> maybe<span class="main">⋅</span>GT<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> y<span class="main">.</span> compare<span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compare_Maybe_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compare_Maybe_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compare_Maybe_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span>Nothing<span class="main">⋅</span>Nothing <span class="main">=</span> EQ"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span>Nothing<span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> LT"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span>Nothing <span class="main">=</span> GT"</span></span>
  <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> compare<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compare_Maybe_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">instance</span></span> Maybe <span class="main">::</span> <span class="main">(</span><span class="quoted">Ord_linear</span><span class="main">)</span> <span class="quoted">Ord_linear</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> is_EQ<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_conv_compare<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"oppOrdering<span class="main">⋅</span><span class="main">(</span>compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> compare<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">⊑</span> EQ"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> EQ"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> compare_EQ_dest<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> LT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> LT"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare<span class="main">⋅</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> LT"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> compare_LT_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> isJust_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isJust<span class="main">⋅</span><span class="main">⊥</span>  <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> fromMaybe_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fromMaybe<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">⊥</span>  <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> maybeToList_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"maybeToList<span class="main">⋅</span><span class="main">⊥</span>  <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Definedness">
<div class="head">
<h1>Theory Definedness</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Definedness›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Definedness
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Data_List.html">Data_List</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This is an attempt for a setup for better handling bottom, by a better
  simp setup, and less breaking the abstractions.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">defined</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> pcpo <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">defined</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> defined_bottom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> defined <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> defined_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> defined_seq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="free">x</span> <span class="main">⟹</span> seq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> defined_def<span class="main">)</span>

<span class="keyword1"><span class="command">consts</span></span> val <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>type <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>type"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟦</span>_<span class="keyword1">⟧</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹val for booleans›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">val_Bool</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tr <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">val_Bool</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Def <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  val <span class="quoted">val_Bool</span>

<span class="keyword1"><span class="command">lemma</span></span> defined_Bool_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"defined <span class="main">(</span>Def <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"defined TT"</span></span>
  <span class="quoted"><span class="quoted">"defined FF"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> defined_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> val_Bool_simp1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Def <span class="free">i</span><span class="main">⟧</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> val_Bool_def TT_def FF_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> val_Bool_simp2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>TT<span class="main">⟧</span> <span class="main">=</span> True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>FF<span class="main">⟧</span> <span class="main">=</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TT_def FF_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> IF_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"defined <span class="free">b</span> <span class="main">⟹</span> <span class="main">⟦</span> <span class="free">b</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">If</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"defined <span class="free">b</span> <span class="main">⟹</span> <span class="main">⟦</span> <span class="free">b</span> <span class="main">⟧</span> <span class="main">=</span> False <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">If</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> defined_neg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="main">(</span>neg<span class="main">⋅</span><span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> defined <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> val_Bool_neg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="free">b</span> <span class="main">⟹</span> <span class="main">⟦</span> neg <span class="main">⋅</span> <span class="free">b</span> <span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">⟦</span> <span class="free">b</span> <span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹val for integers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">val_Integer</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">val_Integer</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">adhoc_overloading</span></span>
  val <span class="quoted">val_Integer</span>

<span class="keyword1"><span class="command">lemma</span></span> defined_Integer_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"defined <span class="main">(</span>MkI<span class="main">⋅</span><span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"defined <span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"defined <span class="main">(</span><span class="main">1</span><span class="main">::</span>Integer<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> defined_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> defined_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="main">(</span>numeral <span class="free">x</span> <span class="main">::</span> Integer<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> defined_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> val_Integer_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>MkI<span class="main">⋅</span><span class="free">i</span><span class="main">⟧</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">1</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> val_Integer_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> val_Integer_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> numeral <span class="free">x</span> <span class="main">::</span> Integer <span class="main">⟧</span> <span class="main">=</span> numeral <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> val_Integer_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> val_Integer_to_MkI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"defined <span class="free">i</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>MkI <span class="main">⋅</span> <span class="main">⟦</span> <span class="free">i</span> <span class="main">⟧</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> val_Integer_def defined_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> defined_Integer_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="free">i</span> <span class="main">⟹</span> defined <span class="free">j</span> <span class="main">⟹</span> defined <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">(</span><span class="free">j</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> val_Integer_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="free">i</span> <span class="main">⟹</span> defined <span class="free">j</span> <span class="main">⟹</span> <span class="main">⟦</span> <span class="free">i</span> <span class="main">-</span> <span class="free">j</span> <span class="main">⟧</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">i</span> <span class="main">⟧</span> <span class="main">-</span> <span class="main">⟦</span> <span class="free">j</span> <span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> defined_Integer_plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="free">i</span> <span class="main">⟹</span> defined <span class="free">j</span> <span class="main">⟹</span> defined <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> val_Integer_plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="free">i</span> <span class="main">⟹</span> defined <span class="free">j</span> <span class="main">⟹</span> <span class="main">⟦</span> <span class="free">i</span> <span class="main">+</span> <span class="free">j</span> <span class="main">⟧</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">i</span> <span class="main">⟧</span> <span class="main">+</span> <span class="main">⟦</span> <span class="free">j</span> <span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> defined_Integer_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="main">(</span>eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> defined <span class="free">a</span> <span class="main">∧</span> defined <span class="main">(</span><span class="free">b</span><span class="main">::</span>Integer<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> val_Integer_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="free">a</span> <span class="main">⟹</span> defined <span class="free">b</span> <span class="main">⟹</span> <span class="main">⟦</span> eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span> <span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟦</span> <span class="free">a</span> <span class="main">⟧</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟦</span> <span class="free">b</span> <span class="main">⟧</span> <span class="main">::</span> int<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Full induction for non-negative integers›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_full_Int_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> neg Suc<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> defined<span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> defined <span class="bound">i</span> <span class="main">⟹</span> <span class="main">⟦</span><span class="bound">i</span><span class="main">⟧</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> defined <span class="bound">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">⟦</span><span class="bound">i</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span> <span class="bound">j</span><span class="main">.</span> defined <span class="bound">j</span> <span class="main">⟹</span> <span class="main">⟦</span> <span class="bound">j</span> <span class="main">⟧</span> <span class="main">&lt;</span> <span class="main">⟦</span> <span class="bound">i</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">i</span><span class="main">::</span>Integer<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> bottom
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> defined <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MkI <span class="skolem">integer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">integer</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> neg
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> MkI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nonneg <span class="skolem">nat</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">nat</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>full_nat_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">nat</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defined <span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="skolem">nat</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">⟦</span> MkI<span class="main">⋅</span><span class="main">(</span>int <span class="skolem">nat</span><span class="main">)</span> <span class="main">⟧</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">Integer</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"defined <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="skolem">j</span> <span class="main">⟧</span> <span class="main">&lt;</span> <span class="main">⟦</span> MkI<span class="main">⋅</span><span class="main">(</span>int <span class="skolem">nat</span><span class="main">)</span> <span class="main">⟧</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> bottom <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹defined <span class="skolem">j</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MkI <span class="skolem">integer</span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">integer</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>neg <span class="skolem">nat</span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">j</span><span class="main">⟧</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg MkI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹defined <span class="skolem">j</span>›</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>nonneg <span class="skolem">m</span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">nat</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le nonneg MkI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1.IH"</span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nonneg MkI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nonneg MkI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some list lemmas re-done with the new setup.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nth_tail<span class="main">:</span> <span class="comment1">(* TODO: move *)</span>
  <span class="quoted"><span class="quoted">"defined <span class="free">n</span> <span class="main">⟹</span> <span class="main">⟦</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">≥</span> <span class="main">0</span>  <span class="main">⟹</span> tail<span class="main">⋅</span><span class="free">xs</span> <span class="main">!!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!!</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def zero_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> nth_zipWith<span class="main">:</span> <span class="comment1">(* TODO: move *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="bound">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zipWith<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="free">ys</span> <span class="main">!!</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="free">xs</span> <span class="main">!!</span> <span class="free">n</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">ys</span> <span class="main">!!</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nth_Cons_split<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">lemma</span></span> nth_neg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defined <span class="free">n</span> <span class="main">⟹</span> <span class="main">⟦</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> nth<span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">n</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> TT <span class="main">⟷</span> <span class="main">(</span><span class="skolem">n</span><span class="main">::</span>Integer<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">n</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">n</span><span class="main">⋅</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Cons.IH<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_Cons_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"defined <span class="free">n</span> <span class="main">⟹</span> <span class="main">⟦</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> nth<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"defined <span class="free">n</span> <span class="main">⟹</span> <span class="main">⟦</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> nth<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> nth<span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"defined <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"defined <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth<span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">:</span> <span class="free">xs</span><span class="main">)</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> nth<span class="main">⋅</span><span class="free">xs</span><span class="main">⋅</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="List_Comprehension">
<div class="head">
<h1>Theory List_Comprehension</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹List Comprehension›</span></span>

<span class="keyword1"><span class="command">theory</span></span> List_Comprehension
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Data_List.html">Data_List</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  disj <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">|</span>"</span> 30<span class="main">)</span>

<span class="keyword1"><span class="command">nonterminal</span></span> llc_qual <span class="keyword2"><span class="keyword">and</span></span> llc_quals

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_llc"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> llc_qual <span class="main">⇒</span> llc_quals <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_ <span class="keyword1">|</span> __"</span><span class="main">)</span>
  <span class="quoted">"_llc_gen"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> llc_qual"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">&lt;-</span> _"</span><span class="main">)</span>
  <span class="quoted">"_llc_guard"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tr <span class="main">⇒</span> llc_qual"</span></span> <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_llc_let"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"letbinds <span class="main">⇒</span> llc_qual"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">let</span> _"</span><span class="main">)</span>
  <span class="quoted">"_llc_quals"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"llc_qual <span class="main">⇒</span> llc_quals <span class="main">⇒</span> llc_quals"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">,</span> __"</span><span class="main">)</span>
  <span class="quoted">"_llc_end"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"llc_quals"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="quoted">"_llc_abs"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">[</span><span class="free">e</span> <span class="main">|</span> <span class="free">p</span> <span class="main">&lt;-</span> <span class="free">xs</span><span class="main">]</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> concatMap<span class="main">⋅</span><span class="main">(</span>_llc_abs <span class="free">p</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span>
  <span class="quoted">"_llc <span class="free">e</span> <span class="main">(</span>_llc_gen <span class="free">p</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>_llc_quals <span class="free">q</span> <span class="free">qs</span><span class="main">)</span>"</span>
    <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> concatMap<span class="main">⋅</span><span class="main">(</span>_llc_abs <span class="free">p</span> <span class="main">(</span>_llc <span class="free">e</span> <span class="free">q</span> <span class="free">qs</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span>
  <span class="quoted">"<span class="main">[</span><span class="free">e</span> <span class="main">|</span> <span class="free">b</span><span class="main">]</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">If</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[]</span>"</span>
  <span class="quoted">"_llc <span class="free">e</span> <span class="main">(</span>_llc_guard <span class="free">b</span><span class="main">)</span> <span class="main">(</span>_llc_quals <span class="free">q</span> <span class="free">qs</span><span class="main">)</span>"</span>
    <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">If</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">(</span>_llc <span class="free">e</span> <span class="free">q</span> <span class="free">qs</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">[]</span>"</span>
  <span class="quoted">"_llc <span class="free">e</span> <span class="main">(</span>_llc_let <span class="free">b</span><span class="main">)</span> <span class="main">(</span>_llc_quals <span class="free">q</span> <span class="free">qs</span><span class="main">)</span>"</span>
    <span class="main">=&gt;</span> <span class="quoted">"_Let <span class="free">b</span> <span class="main">(</span>_llc <span class="free">e</span> <span class="free">q</span> <span class="free">qs</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">parse_translation</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">let</span></span> <span class="keyword3"><span class="keyword">open</span></span> HOLCF_Library <span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">NilC</span> <span class="main">=</span> Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "Nil"<span class="antiquote">}</span></span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">Lam</span> <span class="entity">x</span> <span class="main">=</span> Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "Abs_cfun"<span class="antiquote">}</span></span> $ <span class="entity">x</span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">fresh_var</span> <span class="entity">ts</span> <span class="entity">ctxt</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt'</span> <span class="main">=</span> fold Variable.declare_term <span class="entity">ts</span> <span class="entity">ctxt</span>
      <span class="keyword2"><span class="keyword">in</span></span>
        singleton <span class="main">(</span>Variable.variant_frees <span class="entity">ctxt'</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="inner_quoted">"x"</span><span class="main">,</span> dummyT<span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">pat_tr</span> <span class="entity">ctxt</span> <span class="entity">p</span> <span class="entity">e</span> <span class="main">=</span> <span class="comment1">(* %x. case x of p =&gt; e | _ =&gt; [] *)</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">x</span> <span class="main">=</span> Free <span class="main">(</span><span class="entity">fresh_var</span> <span class="main">[</span><span class="entity">p</span><span class="main">,</span> <span class="entity">e</span><span class="main">]</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">case1</span> <span class="main">=</span> Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_case1"<span class="antiquote">}</span></span> $ <span class="entity">p</span> $ <span class="entity">e</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">case2</span> <span class="main">=</span>
          Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_case1"<span class="antiquote">}</span></span> $
            Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> Pure.dummy_pattern<span class="antiquote">}</span></span> $ <span class="entity">NilC</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">cs</span> <span class="main">=</span> Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_case2"<span class="antiquote">}</span></span> $ <span class="entity">case1</span> $ <span class="entity">case2</span><span class="main">;</span>
      <span class="keyword2"><span class="keyword">in</span></span>
        <span class="comment1">(* FIXME: handle HOLCF patterns correctly *)</span>
        Syntax_Trans.abs_tr <span class="main">[</span><span class="entity">x</span><span class="main">,</span> <span class="entity">Case_Translation.case_tr</span> false <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">x</span><span class="main">,</span> <span class="entity">cs</span><span class="main">]</span><span class="main">]</span>
        |&gt; <span class="entity">Lam</span>
      <span class="keyword2"><span class="keyword">end</span></span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">abs_tr</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">p</span><span class="main">,</span> <span class="entity">e</span><span class="main">]</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> Term_Position.strip_positions <span class="entity">p</span> <span class="keyword2"><span class="keyword">of</span></span>
        Free <span class="main">(</span><span class="entity">s</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">Lam</span> <span class="main">(</span>Syntax_Trans.abs_tr <span class="main">[</span><span class="entity">p</span><span class="main">,</span> <span class="entity">e</span><span class="main">]</span><span class="main">)</span>
      <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">pat_tr</span> <span class="entity">ctxt</span> <span class="entity">p</span> <span class="entity">e</span><span class="main">)</span>

  <span class="keyword2"><span class="keyword">in</span></span> <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_llc_abs"<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">abs_tr</span><span class="main">)</span><span class="main">]</span> <span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">lemma</span></span> concatMap_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"concatMap<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> <span class="main">[</span><span class="free">f</span><span class="main">⋅</span><span class="bound">x</span><span class="main">]</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> listcompr_filter <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span> <span class="main">&lt;-</span> <span class="free">xs</span><span class="main">,</span> <span class="free">P</span><span class="main">⋅</span><span class="bound">x</span><span class="main">]</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="free">P</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">⋅</span><span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">y</span> <span class="main">|</span> <span class="keyword1">let</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="numeral">2</span><span class="main">;</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">x</span> <span class="main">&lt;-</span> <span class="free">xs</span><span class="main">]</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Num_Class">
<div class="head">
<h1>Theory Num_Class</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Num Class›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Num_Class
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Type_Classes.html">Type_Classes</a>
    <a href="Data_Integer.html">Data_Integer</a>
    <a href="Data_Tuple.html">Data_Tuple</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Num class›</span></span>

<span class="comment1">(* TODO: Show class (jb) *)</span>

<span class="keyword1"><span class="command">class</span></span> Num_syn <span class="main">=</span>
  Eq <span class="main">+</span>
  plus <span class="main">+</span>
  minus <span class="main">+</span>
  times <span class="main">+</span>
  zero <span class="main">+</span>
  one <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>  <span class="free"><span class="free"><span class="free">negate</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free"><span class="free"><span class="free">abs</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free"><span class="free"><span class="free">signum</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free"><span class="free"><span class="free">fromInteger</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer <span class="main">→</span> <span class="tfree">'a</span>"</span></span>

<span class="comment1">(* If I create this class in one step I get problems with Num_faithful... (jb) *)</span>
<span class="keyword1"><span class="command">class</span></span> Num <span class="main">=</span> Num_syn <span class="main">+</span> plus_cpo <span class="main">+</span> minus_cpo <span class="main">+</span> times_cpo

<span class="keyword1"><span class="command">class</span></span> Num_strict <span class="main">=</span> Num <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> plus_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊥</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>Num<span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> minus_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">-</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> negate_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"negate<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abs_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"abs<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> signum_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"signum<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fromInteger_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"fromInteger<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="comment1">(* TODO: How to name the type class that adds the reqiured relations? For Eq, we have Eq_equiv
resp. Eq_eq, but for Num I don't see a nice name. Also, a generic name might be nicer. (jb) *)</span>

<span class="keyword1"><span class="command">class</span></span> Num_faithful <span class="main">=</span>
  <span class="comment1">(* TODO: Why is it not possible to use Num here? I get
     Type unification failed: No type arity lift :: minus
     (jb)
  *)</span>
  Num_syn <span class="main">+</span>
  <span class="comment1">(* This is the only relation about Num required by the Haskell report. By using eq we leave it
  to the users choice of Eq_eq or Eq_equiv whether the relations should hold up to equivalence or
  syntactic equality. (jb) *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abs_signum_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eq<span class="main">⋅</span><span class="main">(</span><span class="main">(</span>abs<span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>signum<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>Num_syn<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> TT"</span></span>
  <span class="comment1">(* TODO: Should we add sensible relations on our own? (jb) *)</span>

  <span class="comment1">(* The zero and one type class are "artificial", so we ensure they do what expected. *)</span>
  <span class="comment1">(* Unfortunately, this is not working. Is isabelle trying to give all occurrences of 0
      the same type?
  assumes "0 = fromInteger⋅0"
  assumes "1 = fromInteger⋅1"
  *)</span>

<span class="keyword1"><span class="command">class</span></span> Integral <span class="main">=</span>
  Num <span class="main">+</span>
  <span class="comment1">(* fixes quot rem  *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">div</span></span></span> <span class="free"><span class="free"><span class="free">mod</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>Num<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">toInteger</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> Integer"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="comment1">(* fixrec quotRem :: "'a → 'a → ⟨'a, 'a⟩"  where "quotRem⋅x⋅y = ⟨quot⋅x⋅y, (rem⋅x⋅y)⟩" *)</span>
  <span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">divMod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="main">⟨</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">⟩</span>"</span></span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">divMod</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">⟨</span>div<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> mod<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">⟩</span>"</span></span>

  <span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">even</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">even</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> eq<span class="main">⋅</span><span class="main">(</span>div<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">(</span>fromInteger<span class="main">⋅</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">odd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">→</span> tr"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">odd</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> neg<span class="main">⋅</span><span class="main">(</span>even<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> Integral_strict <span class="main">=</span> Integral <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> div_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"div<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊥</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>Integral<span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"div<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mod_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"mod<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="quoted"><span class="quoted">"mod<span class="main">⋅</span><span class="main">⊥</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> toInteger_strict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"toInteger<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> Integral_faithful <span class="main">=</span>
  Integral <span class="main">+</span>
  Num_faithful <span class="main">+</span>
  <span class="comment1">(* assumes "¬(eq⋅y⋅0 = TT) ⟹ quot⋅x⋅y * y + rem⋅x⋅y = (x::'a::{Integral})" *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF <span class="main">⟹</span> div<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> mod<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>Integral<span class="main">}</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Instances for Integer›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Integer <span class="main">::</span> <span class="quoted">Num_syn</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"negate <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span><span class="main">.</span> MkI<span class="main">⋅</span><span class="main">(</span>uminus <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span> <span class="main">.</span> MkI<span class="main">⋅</span><span class="main">(</span><span class="main">¦</span><span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"signum <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span> <span class="main">.</span> MkI<span class="main">⋅</span><span class="main">(</span>sgn <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"fromInteger <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> Integer <span class="main">::</span> <span class="quoted">Num</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span>

<span class="keyword1"><span class="command">instance</span></span> Integer <span class="main">::</span> <span class="quoted">Num_faithful</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> signum_Integer_def abs_Integer_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute mult_sgn_abs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">instance</span></span> Integer <span class="main">::</span> <span class="quoted">Num_strict</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command">unfolding</span></span> signum_Integer_def abs_Integer_def negate_Integer_def fromInteger_Integer_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">instantiation</span></span> Integer <span class="main">::</span> <span class="quoted">Integral</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"div <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span> <span class="main">(</span>MkI<span class="main">⋅</span>y<span class="main">)</span><span class="main">.</span> MkI<span class="main">⋅</span><span class="main">(</span>Rings.divide <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"mod <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span> <span class="main">(</span>MkI<span class="main">⋅</span>y<span class="main">)</span><span class="main">.</span> MkI<span class="main">⋅</span><span class="main">(</span>Rings.modulo <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"toInteger <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> Integer <span class="main">::</span> <span class="quoted">Integral_strict</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command">unfolding</span></span> div_Integer_def mod_Integer_def toInteger_Integer_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">instance</span></span> Integer <span class="main">::</span> <span class="quoted">Integral_faithful</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command">unfolding</span></span> div_Integer_def mod_Integer_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> y x<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Integer_Integral_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"div<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span>Rings.divide <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"mod<span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="main">(</span>Rings.modulo <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"fromInteger<span class="main">⋅</span><span class="free">i</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mod_Integer_def div_Integer_def fromInteger_Integer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HOLCF_Prelude">
<div class="head">
<h1>Theory HOLCF_Prelude</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> HOLCF_Prelude
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="HOLCF_Main.html">HOLCF_Main</a>
    <a href="Type_Classes.html">Type_Classes</a>
    <a href="Numeral_Cpo.html">Numeral_Cpo</a>
    <a href="Data_Function.html">Data_Function</a>
    <a href="Data_Bool.html">Data_Bool</a>
    <a href="Data_Tuple.html">Data_Tuple</a>
    <a href="Data_Integer.html">Data_Integer</a>
    <a href="Data_List.html">Data_List</a>
    <a href="Data_Maybe.html">Data_Maybe</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Fibs">
<div class="head">
<h1>Theory Fibs</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Fibs"</span>
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="HOLCF_Prelude.html">../HOLCF_Prelude</a>"</span>
    <span class="quoted">"<a href="Definedness.html">../Definedness</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Fibonacci sequence›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this example, we show that the self-recursive lazy definition of the
  fibonacci sequence is actually defined and correct.
›</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">fibs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Integer<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fibs</span> <span class="main">=</span> <span class="main">0</span> <span class="main">:</span> <span class="main">1</span> <span class="main">:</span> zipWith<span class="main">⋅</span><span class="main">(+)</span><span class="main">⋅</span><span class="free">fibs</span><span class="main">⋅</span><span class="main">(</span>tail<span class="main">⋅</span><span class="free">fibs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fib</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fib</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free">fib</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">fib</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> fib.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> fibs_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fibs <span class="main">!!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fibs.simps<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fibs_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fibs <span class="main">!!</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fibs.simps<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹And the proof that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"fibs <span class="main"><span class="main">!!</span></span> <span class="free"><span class="free">i</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is defined and the fibs value.›</span></span>

<span class="comment1">(* Strange isabelle simplifier bug? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">+</span> <span class="main">⟦</span><span class="free">i</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">i</span> <span class="main">⟧</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">⟦</span><span class="free">i</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">i</span> <span class="main">⟧</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_fibs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"defined <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span> <span class="main">⟧</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"defined <span class="main">(</span>fibs <span class="main">!!</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> fibs <span class="main">!!</span> <span class="free">i</span> <span class="main">⟧</span> <span class="main">=</span> fib <span class="main">⟦</span> <span class="free">i</span> <span class="main">⟧</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nonneg_full_Int_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">i</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fibs.simps<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> fib.simps<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_zipWith nth_tail<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">i</span><span class="main">⟧</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fibs.simps<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> fib.simps<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_zipWith nth_tail<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fibs.simps<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> fib.simps<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_zipWith nth_tail<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">subst</span> fibs.simps<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> fib.simps<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_zipWith nth_tail<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sieve_Primes">
<div class="head">
<h1>Theory Sieve_Primes</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Sieve_Primes
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Primes.html">HOL-Computational_Algebra.Primes</a>"</span>
    <span class="quoted">"<a href="Num_Class.html">../Num_Class</a>"</span>
    <span class="quoted">"<a href="HOLCF_Prelude.html">../HOLCF_Prelude</a>"</span>
<span class="comment1">(*FIXME: import order matters, if HOLCF_Prelude is not imported last,
constants like "filter" etc. refer to List.thy; I'm afraid however
that the current order only works by accident*)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Sieve of Eratosthenes›</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted">int</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion_enabled</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This example proves that the well-known Haskell two-liner that lazily
  calculates the list of all primes does indeed do so. This proof is using
  coinduction.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We need to hide some constants again since we imported something from HOL
  not via <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> "<a href="HOLCF_Main.html"></a><a href="HOLCF_Main.html">HOLCF-Prelude.HOLCF_Main</a>"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  Rings.divide <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">div</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Rings.modulo <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">mod</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">no_notation</span></span>
  Set.member  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">:</span><span class="keyword3">)</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Set.member  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">:</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is the implementation. We also need a modulus operator.›</span></span>
<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">sieve</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Integer<span class="main">]</span> <span class="main">→</span> <span class="main">[</span>Integer<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sieve</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">:</span> <span class="main">(</span><span class="free">sieve</span><span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> neg<span class="main">⋅</span><span class="main">(</span>eq<span class="main">⋅</span><span class="main">(</span>mod<span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">primes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Integer<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">primes</span> <span class="main">=</span> sieve<span class="main">⋅</span><span class="main">[</span><span class="numeral">2</span><span class="main">..]</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Simplification rules for modI:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">MkI'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> Integer"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MkI'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> MkI<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> MkI'_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"MkI' <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"MkI' <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"MkI' <span class="main">(</span>numeral <span class="free">k</span><span class="main">)</span> <span class="main">=</span> numeral <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> MkI'_def zero_Integer_def one_Integer_def numeral_Integer_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modI_numeral_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mod<span class="main">⋅</span><span class="main">(</span>numeral <span class="free">i</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>numeral <span class="free">j</span><span class="main">)</span> <span class="main">=</span> MkI' <span class="main">(</span>Rings.modulo <span class="main">(</span>numeral <span class="free">i</span><span class="main">)</span> <span class="main">(</span>numeral <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> numeral_Integer_eq mod_Integer_def MkI'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some lemmas demonstrating evaluation of our list:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"primes <span class="main">!!</span> <span class="main">0</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> primes.simps
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> enumFrom_intsFrom_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"primes <span class="main">!!</span> <span class="main">1</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> primes.simps
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> enumFrom_intsFrom_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"primes <span class="main">!!</span> <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">5</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> primes.simps
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> enumFrom_intsFrom_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"primes <span class="main">!!</span> <span class="numeral">3</span> <span class="main">=</span> <span class="numeral">7</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> primes.simps
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> enumFrom_intsFrom_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> filter_FF filter_TT<span class="main">)</span>
  <span class="comment1">(* FIXME: remove these two from the default simpset *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary lemmas about prime numbers›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> find_next_prime_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&gt;</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">n'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="bound">n'</span> <span class="main">⟶</span> <span class="main">¬</span> prime <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ex_least_nat_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">k</span> <span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="free">n</span> <span class="main">∧</span> prime <span class="bound">k</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bigger_prime not_prime_0<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Simplification for andalso:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> andAlso_Def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Def <span class="free">x</span><span class="main">)</span> <span class="keyword1">andalso</span> <span class="main">(</span>Def <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Def <span class="main">(</span><span class="free">x</span> <span class="main">∧</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Def_bool2 Def_bool4 andalso_thms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> andalso_thms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This defines the bisimulation and proves it to be a list bisimulation.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> prim_bisim<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">prim_bisim</span> <span class="free"><span class="bound"><span class="entity">x1</span></span></span> <span class="free"><span class="bound"><span class="entity">x2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span> prime <span class="bound">n</span>  <span class="main">∧</span>
    <span class="free"><span class="bound"><span class="entity">x1</span></span></span> <span class="main">=</span> sieve<span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="bound">n</span><span class="main">..]</span><span class="main">)</span> <span class="main">∧</span>
    <span class="free"><span class="bound"><span class="entity">x2</span></span></span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="bound">n</span><span class="main">..]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prim_bisim_is_bisim<span class="main">:</span> <span class="quoted"><span class="quoted">"list_bisim prim_bisim"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prim_bisim <span class="skolem">xs</span> <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"prime <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> sieve<span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">..]</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sieve<span class="main">⋅</span><span class="var">?xs</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">..]</span>"</span></span>
      <span class="comment1">(* sledgehammer *)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span>prime <span class="bound">n</span><span class="main">;</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">;</span> <span class="skolem">xs</span> <span class="main">=</span> sieve<span class="main">⋅</span> <span class="main">(</span>Data_List.filter<span class="main">⋅</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="main">1</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&lt;</span> int <span class="bound">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="bound">n</span><span class="main">)</span><span class="main">..]</span><span class="main">)</span><span class="main">;</span> <span class="skolem">ys</span> <span class="main">=</span> Data_List.filter<span class="main">⋅</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="bound">n</span><span class="main">)</span><span class="main">..]</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ii</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
        f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">is</span> <span class="bound">isa</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> prim_bisim <span class="bound">is</span> <span class="bound">isa</span> <span class="main">∨</span> prime <span class="main">(</span><span class="skolem">ii</span> <span class="bound">is</span> <span class="bound">isa</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">is</span> <span class="main">=</span> sieve<span class="main">⋅</span> <span class="main">(</span>Data_List.filter<span class="main">⋅</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">ia</span></span><span class="main">&gt;</span><span class="main">1</span><span class="main">.</span> <span class="bound">ia</span> <span class="main">&lt;</span> <span class="skolem">ii</span> <span class="bound">is</span> <span class="bound">isa</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">ia</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">ii</span> <span class="bound">is</span> <span class="bound">isa</span><span class="main">)</span><span class="main">..]</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">isa</span> <span class="main">=</span> Data_List.filter<span class="main">⋅</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">ii</span> <span class="bound">is</span> <span class="bound">isa</span><span class="main">)</span><span class="main">..]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> prime <span class="bound">i</span> <span class="main">∨</span> <span class="bound">is</span> <span class="main">≠</span> sieve<span class="main">⋅</span> <span class="main">(</span>Data_List.filter<span class="main">⋅</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>ia<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">ib</span></span><span class="main">&gt;</span><span class="main">1</span><span class="main">.</span> <span class="bound">ib</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">ib</span> <span class="keyword1">dvd</span> <span class="bound">ia</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="bound">i</span><span class="main">..]</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">isa</span> <span class="main">≠</span> Data_List.filter<span class="main">⋅</span> <span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span> <span class="main">[</span>MkI<span class="main">⋅</span><span class="bound">i</span><span class="main">..]</span><span class="main">)</span> <span class="main">∨</span> prim_bisim <span class="bound">is</span> <span class="bound">isa</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prim_bisim <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="skolem">ii</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prim_bisim <span class="skolem">xs</span> <span class="skolem">ys</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nn</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        f4<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="skolem">nn</span> <span class="main">(</span><span class="skolem">ii</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ii</span> <span class="skolem">xs</span> <span class="skolem">ys</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> prime_gt_0_int zero_less_imp_eq_int<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="skolem">nn</span> <span class="main">(</span><span class="skolem">ii</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> prime_nat_int_transfer<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f4 f2 a1 <span class="quoted"><span class="quoted">‹prim_bisim <span class="skolem">xs</span> <span class="skolem">ys</span>›</span></span> prime_gt_1_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_prime<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">⟶</span> <span class="main">¬</span> prime <span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> find_next_prime_nat<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">n</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">int</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> int <span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> int <span class="skolem">k'</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> less_numeral_extra<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> of_nat_1 of_nat_dvd_iff prime_factor_nat prime_nat_int_transfer<span class="main">)</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">n'</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> zdvd_imp_le <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> not_prime
        <span class="keyword1"><span class="command">using</span></span> not_le prime_gt_0_int zero_less_imp_eq_int
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_nat_less_iff prime_nat_int_transfer<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">::</span>int<span class="main">&gt;</span><span class="main">1</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> of_nat_le_iff prime_gt_1_nat
          prime_gt_1_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> between_have_divisors<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">::</span>int<span class="main">&gt;</span><span class="main">1</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">k</span>"</span></span><span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> small<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">d</span></span><span class="main">::</span>int<span class="main">&gt;</span><span class="main">1</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> small <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="keyword1">dvd</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> between_have_divisors<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&lt;</span> <span class="skolem">n'</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">i</span>›</span></span> small <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> dvd_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> between_not_relvant<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">n</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">d</span></span><span class="main">::</span>int <span class="main">&gt;</span><span class="main">1</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> prime_int_altdef <span class="keyword1"><span class="command">using</span></span> int_one_le_iff_zero_less le_less
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_not_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs</span> <span class="main">=</span> <span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">xs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> intsFrom.simps<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> enumFrom_intsFrom_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def TT_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add.commute<span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> neg<span class="main">⋅</span><span class="main">(</span>eq<span class="main">⋅</span><span class="main">(</span>mod<span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span><span class="main">)</span>
            <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>x<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">¬</span> <span class="skolem">n</span> <span class="keyword1">dvd</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_cong<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Integer_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> FF_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TT_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_eq_mod_eq_0<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="skolem">n</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filter_cong<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_cong<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> of_nat_1 of_nat_add<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">n'</span><span class="main">..]</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_fast_forward<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="skolem">n</span>›</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> between_have_divisors<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">n'</span><span class="main">..]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> filter_cong<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> between_not_relvant<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> calculation
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> tmp <span class="main">=</span> this

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> sieve<span class="main">⋅</span><span class="var">?xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sieve<span class="main">⋅</span><span class="main">(</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">xs'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?xs</span> <span class="main">=</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sieve<span class="main">⋅</span><span class="main">(</span><span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">)</span> <span class="main">:</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs'</span> <span class="main">=</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">)</span> <span class="main">:</span> sieve<span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">n'</span><span class="main">..]</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> tmp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> calculation
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">..]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">)</span> <span class="main">:</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">n</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> intsFrom.simps<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> enumFrom_intsFrom_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def TT_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>MkI<span class="main">⋅</span><span class="skolem">n</span><span class="main">)</span> <span class="main">:</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="skolem">n'</span><span class="main">..]</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filter_fast_forward<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_prime
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span>int <span class="skolem">n</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">;</span> <span class="bound">k</span> <span class="main">&lt;</span> int <span class="skolem">n'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="main">1</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≤</span> int <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">k</span>›</span></span> le_less not_le prime_gt_0_int prime_int_not_dvd zdvd_imp_le<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> calculation
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">n'</span>›</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="bound">xs'</span> <span class="bound">ys'</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">:</span> <span class="bound">xs'</span> <span class="main">∧</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">:</span> <span class="bound">ys'</span> <span class="main">∧</span> prim_bisim <span class="bound">xs'</span> <span class="bound">ys'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prim_bisim
      <span class="keyword1"><span class="command">using</span></span> prime_nat_int_transfer <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> list.bisim_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we apply coinduction:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sieve_produces_primes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sieve<span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">..]</span><span class="main">)</span>
    <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="free">n</span><span class="main">..]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list.coinduct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prim_bisim_is_bisim<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prim_bisim<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> prime_nat_int_transfer <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹And finally show the correctness of primes.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> primes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"primes <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="numeral">2</span><span class="main">..]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"primes <span class="main">=</span> sieve<span class="main">⋅</span><span class="main">[</span><span class="numeral">2</span> <span class="main">..]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> primes.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sieve<span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="main">(</span>int <span class="numeral">2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="numeral">2</span><span class="main">)</span><span class="main">..]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> numeral_Integer_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> filter_TT<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="main">(</span>int <span class="numeral">2</span><span class="main">)</span><span class="main">..]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sieve_produces_primes<span class="main"><span class="main">[</span></span><span class="operator">OF</span> two_is_prime_nat<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> filter<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> <span class="main">(</span>MkI<span class="main">⋅</span>i<span class="main">)</span><span class="main">.</span> Def <span class="main">(</span>prime <span class="main">(</span>nat <span class="main">¦</span><span class="bound">i</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">[</span>MkI<span class="main">⋅</span><span class="numeral">2</span><span class="main">..]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="GHC_Rewrite_Rules">
<div class="head">
<h1>Theory GHC_Rewrite_Rules</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹GHC's "fold/build" Rule›</span></span>

<span class="keyword1"><span class="command">theory</span></span> GHC_Rewrite_Rules
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="HOLCF_Prelude.html">../HOLCF_Prelude</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Approximating the Rewrite Rule›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The original rule looks as follows (see also \cite{ghc-rewriting}):
  \begin{verbatim}
  "fold/build"
    forall k z (g :: forall b. (a -&gt; b -&gt; b) -&gt; b -&gt; b).
    foldr k z (build g) = g k z
  \end{verbatim}
  Since we do not have rank-2 polymorphic types in Isabelle/HOL, we try to imitate a similar
  statement by introducing a new type that combines possible folds with their argument lists, i.e.,
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> below is a function that, in a way, represents the list <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, but where list
  constructors are functionally abstracted.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">abstract_list</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">abstract_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">Λ</span> c n<span class="main">.</span> foldr<span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="bound">n</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">cpodef</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">f</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'b</span><span class="main">,</span> <span class="bound">xs</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="main">=</span> abstract_list <span class="bound">xs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">listfun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun <span class="main">→</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">listfun</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> g<span class="main">.</span> Product_Type.fst <span class="main">(</span>Rep_listfun <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">build</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">build</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> g<span class="main">.</span> Product_Type.snd <span class="main">(</span>Rep_listfun <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">augment</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">→</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">augment</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> g xs<span class="main">.</span> build<span class="main">⋅</span><span class="bound">g</span> <span class="main">++</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">listfun_comp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun <span class="main">→</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun <span class="main">→</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">listfun_comp</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> g h<span class="main">.</span>
    Abs_listfun <span class="main">(</span><span class="keyword1">Λ</span> c n<span class="main">.</span> listfun<span class="main">⋅</span><span class="bound">g</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="main">(</span>listfun<span class="main">⋅</span><span class="bound">h</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="bound">n</span><span class="main">)</span><span class="main">,</span> build<span class="main">⋅</span><span class="bound">g</span> <span class="main">++</span> build<span class="main">⋅</span><span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">listfun_comp_infix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∘lf</span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="keyword1"><span class="free">∘lf</span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">≡</span> listfun_comp<span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">mapFB</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'c</span> <span class="main">→</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'c</span> <span class="main">→</span> <span class="tfree">'c</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mapFB</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> x ys<span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="bound">ys</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont_listfun_body <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Product_Type.fst <span class="main">(</span>Rep_listfun <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_Rep_listfun<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cont_build_body <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Product_Type.snd <span class="main">(</span>Rep_listfun <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_Rep_listfun<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> build_Abs_listfun<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"abstract_list <span class="free">xs</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"build<span class="main">⋅</span><span class="main">(</span>Abs_listfun <span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> Abs_listfun_inverse <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> build_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> listfun_Abs_listfun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"abstract_list <span class="free">xs</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"listfun<span class="main">⋅</span><span class="main">(</span>Abs_listfun <span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> Abs_listfun_inverse <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> listfun_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> augment_Abs_listfun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"abstract_list <span class="free">xs</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"augment<span class="main">⋅</span><span class="main">(</span>Abs_listfun <span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">ys</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> Abs_listfun_inverse <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> augment_def build_Abs_listfun<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cont_augment_body <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Abs_cfun <span class="main">(</span><span class="main">(++)</span> <span class="main">(</span>Product_Type.snd <span class="main">(</span>Rep_listfun <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_Rep_listfun<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"fold/build"</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="free">k</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">(</span>build<span class="main">⋅</span><span class="free">g</span><span class="main">)</span> <span class="main">=</span> listfun<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="free">k</span><span class="main">⋅</span><span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Rep_listfun <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Rep_listfun <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> abstract_list <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> build_def listfun_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"foldr/augment"</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> listfun"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="free">k</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">(</span>augment<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> listfun<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="free">k</span><span class="main">⋅</span><span class="main">(</span>foldr<span class="main">⋅</span><span class="free">k</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Rep_listfun <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Rep_listfun <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> abstract_list <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> augment_def build_def listfun_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"foldr/id"</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="main">(:)</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="main">(:)</span><span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> <span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"foldr/app"</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="main">(:)</span><span class="main">⋅</span><span class="free">ys</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> xs<span class="main">.</span> <span class="bound">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="main">(:)</span><span class="main">⋅</span><span class="free">ys</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> xs<span class="main">.</span> <span class="bound">xs</span> <span class="main">++</span> <span class="free">ys</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"foldr/cons"</span><span class="main">:</span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="free">k</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">:</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">(</span>foldr<span class="main">⋅</span><span class="free">k</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"foldr/single"</span><span class="main">:</span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="free">k</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="free">k</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"foldr/nil"</span><span class="main">:</span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="free">k</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> cont_listfun_comp_body1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">h</span><span class="main">.</span> Abs_listfun <span class="main">(</span><span class="keyword1">Λ</span> c n<span class="main">.</span> listfun<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="main">(</span>listfun<span class="main">⋅</span><span class="bound">h</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="bound">n</span><span class="main">)</span><span class="main">,</span> build<span class="main">⋅</span><span class="free">g</span> <span class="main">++</span> build<span class="main">⋅</span><span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span><span class="main">.</span>
    <span class="main">(</span><span class="keyword1">Λ</span> c n<span class="main">.</span> listfun<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="main">(</span>listfun<span class="main">⋅</span><span class="bound">h</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="bound">n</span><span class="main">)</span><span class="main">,</span> build<span class="main">⋅</span><span class="free">g</span> <span class="main">++</span> build<span class="main">⋅</span><span class="bound">h</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span> <span class="bound">xs</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="main">=</span> abstract_list <span class="bound">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"fold/build"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> cont_Abs_listfun <span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont_listfun_comp_body2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Abs_listfun <span class="main">(</span><span class="keyword1">Λ</span> c n<span class="main">.</span> listfun<span class="main">⋅</span><span class="bound">g</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="main">(</span>listfun<span class="main">⋅</span><span class="free">h</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="bound">n</span><span class="main">)</span><span class="main">,</span> build<span class="main">⋅</span><span class="bound">g</span> <span class="main">++</span> build<span class="main">⋅</span><span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span>
    <span class="main">(</span><span class="keyword1">Λ</span> c n<span class="main">.</span> listfun<span class="main">⋅</span><span class="bound">g</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="main">(</span>listfun<span class="main">⋅</span><span class="free">h</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="bound">n</span><span class="main">)</span><span class="main">,</span> build<span class="main">⋅</span><span class="bound">g</span> <span class="main">++</span> build<span class="main">⋅</span><span class="free">h</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span> <span class="bound">xs</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="main">=</span> abstract_list <span class="bound">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"fold/build"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> cont_Abs_listfun <span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont_listfun_comp_body <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="keyword1">Λ</span> h<span class="main">.</span> Abs_listfun <span class="main">(</span><span class="keyword1">Λ</span> c n<span class="main">.</span> listfun<span class="main">⋅</span><span class="bound">g</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="main">(</span>listfun<span class="main">⋅</span><span class="bound">h</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="bound">n</span><span class="main">)</span><span class="main">,</span> build<span class="main">⋅</span><span class="bound">g</span> <span class="main">++</span> build<span class="main">⋅</span><span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cont2cont_LAM<span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abstract_list_build_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abstract_list <span class="main">(</span>build<span class="main">⋅</span><span class="free">g</span> <span class="main">++</span> build<span class="main">⋅</span><span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> c n<span class="main">.</span> listfun<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="main">(</span>listfun<span class="main">⋅</span><span class="free">h</span><span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cfun_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"fold/build"</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"augment/build"</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"augment<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="main">(</span>build<span class="main">⋅</span><span class="free">h</span><span class="main">)</span> <span class="main">=</span> build<span class="main">⋅</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">∘lf</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> listfun_comp_def augment_def build_Abs_listfun <span class="main"><span class="main">[</span></span><span class="operator">OF</span> abstract_list_build_append<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"augment/nil"</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"augment<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> build<span class="main">⋅</span><span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> augment_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> build_listfun_comp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"build<span class="main">⋅</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">∘lf</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> build<span class="main">⋅</span><span class="free">g</span> <span class="main">++</span> build<span class="main">⋅</span><span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted">"augment/build"</span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> augment_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> augment_augment<span class="main">:</span>
  <span class="quoted"><span class="quoted">"augment<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="main">(</span>augment<span class="main">⋅</span><span class="free">h</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> augment<span class="main">⋅</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">∘lf</span> <span class="free">h</span><span class="main">)</span><span class="main">⋅</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> augment_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abstract_list_map <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"abstract_list <span class="main">(</span>map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> c n<span class="main">.</span> foldr<span class="main">⋅</span><span class="main">(</span>mapFB<span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="free">f</span><span class="main">)</span><span class="main">⋅</span><span class="bound">n</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cfun_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"map"</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">xs</span> <span class="main">=</span> build<span class="main">⋅</span><span class="main">(</span>Abs_listfun <span class="main">(</span><span class="keyword1">Λ</span> c n<span class="main">.</span> foldr<span class="main">⋅</span><span class="main">(</span>mapFB<span class="main">⋅</span><span class="bound">c</span><span class="main">⋅</span><span class="free">f</span><span class="main">)</span><span class="main">⋅</span><span class="bound">n</span><span class="main">⋅</span><span class="free">xs</span><span class="main">,</span> map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> build_Abs_listfun<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"mapList"</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="main">(</span>mapFB<span class="main">⋅</span><span class="main">(:)</span><span class="main">⋅</span><span class="free">f</span><span class="main">)</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> map<span class="main">⋅</span><span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"mapFB"</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mapFB<span class="main">⋅</span><span class="main">(</span>mapFB<span class="main">⋅</span><span class="free">c</span><span class="main">⋅</span><span class="free">f</span><span class="main">)</span><span class="main">⋅</span><span class="free">g</span> <span class="main">=</span> mapFB<span class="main">⋅</span><span class="free">c</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span> <span class="keyword1">oo</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"++"</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">++</span> <span class="free">ys</span> <span class="main">=</span> augment<span class="main">⋅</span><span class="main">(</span>Abs_listfun <span class="main">(</span>abstract_list <span class="free">xs</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">sum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Integer<span class="main">]</span> <span class="main">→</span> Integer"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sum</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> foldr<span class="main">⋅</span><span class="main">(+)</span><span class="main">⋅</span><span class="main">0</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fixrec</span></span> <span class="entity">down'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer <span class="main">→</span> <span class="main">(</span>Integer <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">→</span> <span class="tfree">'a</span> <span class="main">→</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">down'</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="keyword1">If</span> le<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="free">down'</span><span class="main">⋅</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="keyword1"><span class="command">declare</span></span> down'.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> down'_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"down'<span class="main">⋅</span><span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">down</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> itself <span class="main">⇒</span> Integer <span class="main">→</span> <span class="main">[</span>Integer<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">down</span> <span class="free"><span class="bound"><span class="entity">C_type</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> v<span class="main">.</span> build<span class="main">⋅</span><span class="main">(</span>Abs_listfun <span class="main">(</span>
    <span class="main">(</span>down' <span class="main">::</span> Integer <span class="main">→</span> <span class="main">(</span>Integer <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'b</span><span class="main">)</span><span class="main">⋅</span><span class="bound">v</span><span class="main">,</span>
    down'<span class="main">⋅</span><span class="bound">v</span><span class="main">⋅</span><span class="main">(:)</span><span class="main">⋅</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abstract_list_down' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"abstract_list <span class="main">(</span>down'<span class="main">⋅</span><span class="free">v</span><span class="main">⋅</span><span class="main">(:)</span><span class="main">⋅</span><span class="main">[]</span><span class="main">)</span> <span class="main">=</span> down'<span class="main">⋅</span><span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Integer <span class="main">→</span> <span class="tfree">'b</span> <span class="main">→</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abstract_list <span class="main">(</span>down'<span class="main">⋅</span><span class="free">v</span><span class="main">⋅</span><span class="main">(:)</span><span class="main">⋅</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">c</span><span class="main">⋅</span><span class="skolem">n</span> <span class="main">=</span> down'<span class="main">⋅</span><span class="free">v</span><span class="main">⋅</span><span class="skolem">c</span><span class="main">⋅</span><span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="free">v</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="free">v</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="free">v</span> <span class="main">=</span> FF"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> down'.simps<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>Integer<span class="main">)</span><span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">1</span><span class="main">⋅</span><span class="free">v</span> <span class="main">=</span> TT"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">0</span><span class="main">⋅</span><span class="free">v</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nonneg_Integer_induct<span class="main">)</span>
         <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> down'.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont_Abs_listfun_down' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> Abs_listfun <span class="main">(</span>down'<span class="main">⋅</span><span class="bound">v</span><span class="main">,</span> down'<span class="main">⋅</span><span class="bound">v</span><span class="main">⋅</span><span class="main">(:)</span><span class="main">⋅</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span>down'<span class="main">⋅</span><span class="bound">v</span><span class="main">,</span> down'<span class="main">⋅</span><span class="bound">v</span><span class="main">⋅</span><span class="main">(:)</span><span class="main">⋅</span><span class="main">[]</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span> <span class="bound">xs</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="main">=</span> abstract_list <span class="bound">xs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> cont_Abs_listfun <span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted">id</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_down<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum<span class="main">⋅</span><span class="main">(</span><span class="main">(</span>down <span class="keyword1">TYPE</span><span class="main">(</span>Integer<span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> down'<span class="main">⋅</span><span class="free">v</span><span class="main">⋅</span><span class="main">(+)</span><span class="main">⋅</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> down_def <span class="quoted">"fold/build"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HLint">
<div class="head">
<h1>Theory HLint</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> HLint
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="HOLCF_Prelude.html">../HOLCF_Prelude</a>"</span>
    <span class="quoted">"<a href="List_Comprehension.html">../List_Comprehension</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹HLint›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The tool \texttt{hlint} analyses Haskell code and, based on a data base of
  rewrite rules, suggests stylistic improvements to it. We verify
  a number of these rules using our implementation of the Haskell standard
  library.
›</span></span>

<span class="comment1">(* -- I/O *)</span>
<span class="comment1">(*  putStrLn (show x) ==&gt; print x *)</span>
<span class="comment1">(*  mapM_ putChar ==&gt; putStr *)</span>
<span class="comment1">(*  hGetChar stdin ==&gt; getChar *)</span>
<span class="comment1">(*  hGetLine stdin ==&gt; getLine *)</span>
<span class="comment1">(*  hGetContents stdin ==&gt; getContents *)</span>
<span class="comment1">(*  hPutChar stdout ==&gt; putChar *)</span>
<span class="comment1">(*  hPutStr stdout ==&gt; putStr *)</span>
<span class="comment1">(*  hPutStrLn stdout ==&gt; putStrLn *)</span>
<span class="comment1">(*  hPrint stdout ==&gt; print *)</span>
<span class="comment1">(*  hWaitForInput a 0 ==&gt; hReady a *)</span>
<span class="comment1">(*  hPutStrLn a (show b) ==&gt; hPrint a b *)</span>
<span class="comment1">(*  hIsEOF stdin ==&gt; isEOF *)</span>
<span class="comment1">(* -- EXIT *)</span>
<span class="comment1">(*  exitWith ExitSuccess ==&gt; exitSuccess *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ord›</span></span>

<span class="comment1">(*  not (a == b) ==&gt; a /= b where note = "incorrect if either value is NaN" *)</span>
<span class="comment1">(*  not (a /= b) ==&gt; a == b where note = "incorrect if either value is NaN" *)</span>
<span class="comment1">(*  not (a &gt;  b) ==&gt; a &lt;= b where note = "incorrect if either value is NaN" *)</span>
<span class="comment1">(*  not (a &gt;= b) ==&gt; a &lt;  b where note = "incorrect if either value is NaN" *)</span>
<span class="comment1">(*  not (a &lt;  b) ==&gt; a &gt;= b where note = "incorrect if either value is NaN" *)</span>
<span class="comment1">(*  not (a &lt;= b) ==&gt; a &gt;  b where note = "incorrect if either value is NaN" *)</span>

<span class="comment1">(*  compare x y /= GT ==&gt; x &lt;= y *)</span>
<span class="comment1">(*  compare x y == LT ==&gt; x &lt; y *)</span>
<span class="comment1">(*  compare x y /= LT ==&gt; x &gt;= y *)</span>
<span class="comment1">(*  compare x y == GT ==&gt; x &gt; y *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹x == a || x == b || x == c ==&gt; x `elem` [a,b,c]›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eq<span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>Eq_sym<span class="main">)</span><span class="main">⋅</span><span class="free">a</span> <span class="keyword1">orelse</span> eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">b</span> <span class="keyword1">orelse</span> eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> elem<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_sym<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ x /= a &amp;&amp; x /= b &amp;&amp; x /= c ==&gt; x `notElem` [a,b,c]›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>neq<span class="main">⋅</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>Eq_sym<span class="main">)</span><span class="main">⋅</span><span class="free">a</span> <span class="keyword1">andalso</span> neq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">b</span> <span class="keyword1">andalso</span> neq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> notElem<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_sym<span class="main">)</span>

    <span class="comment1">(*  compare (f x) (f y) ==&gt; Data.Ord.comparing f x y -- not that great *)</span>
    <span class="comment1">(*  on compare f ==&gt; Data.Ord.comparing f -- not that great *)</span>
    <span class="comment1">(* -- READ/SHOW *)</span>
    <span class="comment1">(*  showsPrec 0 x "" ==&gt; show x *)</span>
    <span class="comment1">(*  readsPrec 0 ==&gt; reads *)</span>
    <span class="comment1">(*  showsPrec 0 ==&gt; shows *)</span>
    <span class="comment1">(*  showIntAtBase 16 intToDigit ==&gt; showHex *)</span>
    <span class="comment1">(*  showIntAtBase 8 intToDigit ==&gt; showOct *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹List›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ concat (map f x) ==&gt; concatMap f x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"concat<span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> concatMap<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> concatMap_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ concat [a, b] ==&gt; a ++ b›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"concat<span class="main">⋅</span><span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">]</span> <span class="main">=</span> <span class="free">a</span> <span class="main">++</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ map f (map g x) ==&gt; map (f . g) x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> map<span class="main">⋅</span><span class="main">(</span><span class="free">f</span> <span class="keyword1">oo</span> <span class="free">g</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ x !! 0 ==&gt; head x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">!!</span> <span class="main">0</span> <span class="main">=</span> head<span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ take n (repeat x) ==&gt; replicate n x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">(</span>repeat<span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> replicate<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> replicate_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹lemma "head⋅(reverse⋅x) = last⋅x" ›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"head<span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> last<span class="main">⋅</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite_list <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reverse_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_append_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_spine_strict reverse_spine_strict<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ head (drop n x) ==&gt; x !! n where note = "if the index is non-negative"›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">0</span><span class="main">⋅</span><span class="free">n</span> <span class="main">≠</span> FF"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"head<span class="main">⋅</span><span class="main">(</span>drop<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">!!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">0</span><span class="main">⋅</span><span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">0</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> FF"</span></span> <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">0</span><span class="main">⋅</span><span class="free">n</span> <span class="main">=</span> TT"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nonneg_Integer_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step.hyps <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="skolem">i</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def zero_Integer_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step.hyps <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="skolem">i</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Integer_def zero_Integer_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> step.IH  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span><span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ reverse (tail (reverse x)) ==&gt; init x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"reverse<span class="main">⋅</span><span class="main">(</span>tail<span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> init<span class="main">⋅</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite_list <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reverse_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> init_append_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reverse_spine_strict<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ take (length x - 1) x ==&gt; init x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span> <span class="main">⊑</span> init<span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> Cons
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> IH
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="skolem">zs</span>"</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cons one_Integer_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> length_ge_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_Integer_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldr (++) [] ==&gt; concat›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> foldr_append_concat<span class="main">:</span><span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span>append<span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> concat"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span>append<span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> concat<span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldl (++) [] ==&gt; concat›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span>append<span class="main">⋅</span><span class="main">[]</span> <span class="main">⊑</span> concat"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_belowI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span><span class="tfree">'a</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span>append<span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">⊑</span> concat<span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite_list <span class="skolem">xs</span>"</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foldr_append_concat foldl_assoc_foldr foldl_spine_strict<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ span (not . p) ==&gt; break p›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"span<span class="main">⋅</span><span class="main">(</span>neg <span class="keyword1">oo</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> break<span class="main">⋅</span><span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ break (not . p) ==&gt; span p›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"break<span class="main">⋅</span><span class="main">(</span>neg <span class="keyword1">oo</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> span<span class="main">⋅</span><span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> break.simps<span class="main">)</span> <span class="main">(</span><span class="operator">subst</span> assoc_oo<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="comment1">(*  concatMap (++ "\n") ==&gt; unlines *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ or (map p x) ==&gt; any p x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"the_or<span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> any<span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ and (map p x) ==&gt; all p x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"the_and<span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> all<span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ zipWith (,) ==&gt; zip›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"zipWith<span class="main">⋅</span><span class="main">⟨,⟩</span> <span class="main">=</span> zip"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zip_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ zipWith3 (,,) ==&gt; zip3›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"zipWith3<span class="main">⋅</span><span class="main">⟨,,⟩</span> <span class="main">=</span> zip3"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zip3_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ length x == 0 ==&gt; null x where note = "increases laziness"›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">0</span> <span class="main">⊑</span> null<span class="main">⋅</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="skolem">ys</span>"</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> length_ge_0 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ length x /= 0 ==&gt; not (null x)›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neq<span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">0</span> <span class="main">⊑</span> neg<span class="main">⋅</span><span class="main">(</span>null<span class="main">⋅</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="skolem">ys</span>"</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> length_ge_0 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_Integer_def one_Integer_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="comment1">(*  (\x -&gt; [x]) ==&gt; (:[]) *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ map (uncurry f) (zip x y) ==&gt; zipWith f x y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="main">(</span>uncurry<span class="main">⋅</span><span class="free">f</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>zip<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> zipWith<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ map f (zip x y) ==&gt; zipWith (curry f) x y where _ = isVar f›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span>zip<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> zipWith<span class="main">⋅</span><span class="main">(</span>curry<span class="main">⋅</span><span class="free">f</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ not (elem x y) ==&gt; notElem x y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="main">(</span>elem<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> notElem<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldr f z (map g x) ==&gt; foldr (f . g) z x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> foldr<span class="main">⋅</span><span class="main">(</span><span class="free">f</span> <span class="keyword1">oo</span> <span class="free">g</span><span class="main">)</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(*  x ++ concatMap (' ':) y ==&gt; unwords (x:y) *)</span>
<span class="comment1">(*  intercalate " " ==&gt; unwords *)</span>
<span class="comment1">(*  concat (intersperse x y) ==&gt; intercalate x y where _ = notEq x " " *)</span>
<span class="comment1">(*  concat (intersperse " " x) ==&gt; unwords x *)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ null (filter f x) ==&gt; not (any f x)›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"null<span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> neg<span class="main">⋅</span><span class="main">(</span>any<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ filter f x == [] ==&gt; not (any f x)›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> neg<span class="main">⋅</span><span class="main">(</span>any<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ filter f x /= [] ==&gt; any f x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neq<span class="main">⋅</span><span class="main">(</span>filter<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> any<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">⋅</span><span class="skolem">x</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ any (== a) ==&gt; elem a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"any<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> eq<span class="main">⋅</span><span class="bound">z</span><span class="main">⋅</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> elem<span class="main">⋅</span><span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"any<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> eq<span class="main">⋅</span><span class="bound">z</span><span class="main">⋅</span><span class="free">a</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> elem<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ any ((==) a) ==&gt; elem a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"any<span class="main">⋅</span><span class="main">(</span>eq<span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>Eq_sym<span class="main">)</span><span class="main">)</span> <span class="main">=</span> elem<span class="main">⋅</span><span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"any<span class="main">⋅</span><span class="main">(</span>eq<span class="main">⋅</span><span class="free">a</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> elem<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹any (a ==) ==&gt; elem a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"any<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> eq<span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>Eq_sym<span class="main">)</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">=</span> elem<span class="main">⋅</span><span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"any<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> elem<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ all (/= a) ==&gt; notElem a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> neq<span class="main">⋅</span><span class="bound">z</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>Eq_sym<span class="main">)</span><span class="main">)</span> <span class="main">=</span> notElem<span class="main">⋅</span><span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"all<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> neq<span class="main">⋅</span><span class="bound">z</span><span class="main">⋅</span><span class="free">a</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> notElem<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ all (a /=) ==&gt; notElem a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> neq<span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>Eq_sym<span class="main">)</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">=</span> notElem<span class="main">⋅</span><span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"all<span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> neq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> notElem<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* findIndex ((==) a) ==&gt; elemIndex a *)</span>
<span class="comment1">(* findIndex (a ==) ==&gt; elemIndex a *)</span>
<span class="comment1">(* findIndex (== a) ==&gt; elemIndex a *)</span>
<span class="comment1">(* findIndices ((==) a) ==&gt; elemIndices a *)</span>
<span class="comment1">(* findIndices (a ==) ==&gt; elemIndices a *)</span>
<span class="comment1">(* findIndices (== a) ==&gt; elemIndices a *)</span>
<span class="comment1">(* lookup b (zip l [0..]) ==&gt; elemIndex b l *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Folds›</span></span>

<span class="comment1">(*  foldr  (&gt;&gt;) (return ()) ==&gt; sequence_ *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldr  (&amp;&amp;) True ==&gt; and›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span>trand<span class="main">⋅</span>TT <span class="main">=</span> the_and"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> the_and.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldl  (&amp;&amp;) True ==&gt; and›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> foldl_to_and<span class="main">:</span><span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span>trand<span class="main">⋅</span>TT <span class="main">⊑</span> the_and"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_belowI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span>trand<span class="main">⋅</span>TT<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">⊑</span> the_and<span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite_list <span class="skolem">xs</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> foldl_assoc_foldr foldl_spine_strict<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldr1 (&amp;&amp;)  ==&gt; and›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foldr1<span class="main">⋅</span>trand <span class="main">⊑</span> the_and"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_belowI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldr1<span class="main">⋅</span>trand<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">⊑</span> the_and<span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> monofun_cfun_arg<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldl1 (&amp;&amp;)  ==&gt; and›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foldl1<span class="main">⋅</span>trand <span class="main">⊑</span> the_and"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_belowI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"foldl1<span class="main">⋅</span>trand<span class="main">⋅</span><span class="skolem">x</span> <span class="main">⊑</span> foldl<span class="main">⋅</span>trand<span class="main">⋅</span>TT<span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊑</span> the_and<span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monofun_cfun_fun<span class="main"><span class="main">[</span></span><span class="operator">OF</span> foldl_to_and<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldl1<span class="main">⋅</span>trand<span class="main">⋅</span><span class="skolem">x</span> <span class="main">⊑</span> the_and<span class="main">⋅</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldr  (||) False ==&gt; or›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span>tror<span class="main">⋅</span>FF <span class="main">=</span> the_or"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> the_or.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldl  (||) False ==&gt; or›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> foldl_to_or<span class="main">:</span> <span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span>tror<span class="main">⋅</span>FF <span class="main">⊑</span> the_or"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_belowI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span>tror<span class="main">⋅</span>FF<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">⊑</span> the_or<span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite_list <span class="skolem">xs</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> foldl_assoc_foldr foldl_spine_strict<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldr1 (||)  ==&gt; or›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foldr1<span class="main">⋅</span>tror <span class="main">⊑</span> the_or"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_belowI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldr1<span class="main">⋅</span>tror<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">⊑</span> the_or<span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> monofun_cfun_arg<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldl1 (||)  ==&gt; or›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foldl1<span class="main">⋅</span>tror <span class="main">⊑</span> the_or"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> cfun_belowI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"foldl1<span class="main">⋅</span>tror<span class="main">⋅</span><span class="skolem">x</span> <span class="main">⊑</span> foldl<span class="main">⋅</span>tror<span class="main">⋅</span>FF<span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊑</span> the_or<span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monofun_cfun_fun<span class="main"><span class="main">[</span></span><span class="operator">OF</span> foldl_to_or<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldl1<span class="main">⋅</span>tror<span class="main">⋅</span><span class="skolem">x</span> <span class="main">⊑</span> the_or<span class="main">⋅</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*  foldl  (+) 0 ==&gt; sum *)</span>
<span class="comment1">(*  foldr  (+) 0 ==&gt; sum *)</span>
<span class="comment1">(*  foldl1 (+)   ==&gt; sum *)</span>
<span class="comment1">(*  foldr1 (+)   ==&gt; sum *)</span>
<span class="comment1">(*  foldl  ( * ) 1 ==&gt; product *)</span>
<span class="comment1">(*  foldr  ( * ) 1 ==&gt; product *)</span>
<span class="comment1">(*  foldl1 ( * )   ==&gt; product *)</span>
<span class="comment1">(*  foldr1 ( * )   ==&gt; product *)</span>
<span class="comment1">(*  foldl1 max   ==&gt; maximum *)</span>
<span class="comment1">(*  foldr1 max   ==&gt; maximum *)</span>
<span class="comment1">(*  foldl1 min   ==&gt; minimum *)</span>
<span class="comment1">(*  foldr1 min   ==&gt; minimum *)</span>
<span class="comment1">(*  foldr mplus mzero ==&gt; msum *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Function›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (\x -&gt; x) ==&gt; id›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> ID"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ID_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (\x y -&gt; x) ==&gt; const›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Λ</span> x y<span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> const"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cfun_eqI<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(\(x,y) -&gt; y) ==&gt; fst where _ = notIn x y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Λ</span> <span class="main">⟨</span>x<span class="main">,</span> y<span class="main">⟩</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> fst"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">p</span> <span class="keyword1">of</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span> <span class="main">⇒</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">⋅</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> bottom <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Tuple2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(\(x,y) -&gt; y) ==&gt; snd where _ = notIn x y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Λ</span> <span class="main">⟨</span>x<span class="main">,</span> y<span class="main">⟩</span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> snd"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">p</span> <span class="keyword1">of</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span> <span class="main">⇒</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">⋅</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> bottom <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Tuple2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (\x y-&gt; f (x,y)) ==&gt; curry f where _ = notIn [x,y] f›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Λ</span> x y<span class="main">.</span> <span class="free">f</span><span class="main">⋅</span><span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> curry<span class="main">⋅</span><span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> cfun_eqI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (\(x,y) -&gt; f x y) ==&gt; uncurry f where _ = notIn [x,y] f›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Λ</span> <span class="main">⟨</span>x<span class="main">,</span> y<span class="main">⟩</span><span class="main">.</span> <span class="free">f</span><span class="main">⋅</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span> <span class="main">⊑</span> uncurry<span class="main">⋅</span><span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_belowI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(*  (($) . f) ==&gt; f *)</span>
<span class="comment1">(*  (f $) ==&gt; f *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (\x -&gt; y) ==&gt; const y where _ = isAtom y &amp;&amp; notIn x y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> const<span class="main">⋅</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cfun_eqI<span class="main">)</span> <span class="operator">simp</span>

<span class="comment1">(*  flip f x y ==&gt; f y x where _ = isApp original *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"flip<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(*  (\a b -&gt; o (f a) (f b)) ==&gt; o `Data.Function.on` f *)</span>
<span class="comment1">(* -- CHAR *)</span>
<span class="comment1">(*  a &gt;= 'a' &amp;&amp; a &lt;= 'z' ==&gt; isAsciiLower a *)</span>
<span class="comment1">(*  a &gt;= 'A' &amp;&amp; a &lt;= 'Z' ==&gt; isAsciiUpper a *)</span>
<span class="comment1">(*  a &gt;= '0' &amp;&amp; a &lt;= '9' ==&gt; isDigit a *)</span>
<span class="comment1">(*  a &gt;= '0' &amp;&amp; a &lt;= '7' ==&gt; isOctDigit a *)</span>
<span class="comment1">(*  not (isControl a) ==&gt; isPrint a *)</span>
<span class="comment1">(*  isLower a || isUpper a ==&gt; isAlpha a *)</span>
<span class="comment1">(*  isAlpha a || isDigit a ==&gt; isAlphaNum a *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bool›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ a == True ==&gt; a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> eq_true<span class="main">:</span><span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span>TT <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ a == False ==&gt; not a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> eq_false<span class="main">:</span><span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span>FF <span class="main">=</span> neg<span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (if a then x else x) ==&gt; x where note = "reduces strictness"›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> if_equal<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (if a then True else False) ==&gt; a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">a</span> <span class="keyword1">then</span> TT <span class="keyword1">else</span> FF<span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (if a then False else True) ==&gt; not a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">a</span> <span class="keyword1">then</span> FF <span class="keyword1">else</span> TT<span class="main">)</span> <span class="main">=</span> neg<span class="main">⋅</span><span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (if a then t else (if b then t else f)) ==&gt; if a || b then t else f›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">If</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">If</span> <span class="free">a</span> <span class="keyword1">orelse</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (if a then (if b then t else f) else f) ==&gt; if a &amp;&amp; b then t else f›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">If</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">If</span> <span class="free">a</span> <span class="keyword1">andalso</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (if x then True else y) ==&gt; x || y where _ = notEq y False›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">x</span> <span class="keyword1">then</span> TT <span class="keyword1">else</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">orelse</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (if x then y else False) ==&gt; x &amp;&amp; y where _ = notEq y True›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="free">y</span> <span class="keyword1">else</span> FF<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">andalso</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(*  case a of {True -&gt; t; False -&gt; f} ==&gt; if a then t else f *)</span>
<span class="comment1">(*  case a of {False -&gt; f; True -&gt; t} ==&gt; if a then t else f *)</span>
<span class="comment1">(*  case a of {True -&gt; t; _ -&gt; f} ==&gt; if a then t else f *)</span>
<span class="comment1">(*  case a of {False -&gt; f; _ -&gt; t} ==&gt; if a then t else f *)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (if c then (True, x) else (False, x)) ==&gt; (c, x) where note = "reduces strictness"›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">⟨</span>TT<span class="main">,</span> <span class="free">x</span><span class="main">⟩</span> <span class="keyword1">else</span> <span class="main">⟨</span>FF<span class="main">,</span> <span class="free">x</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">x</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (if c then (False, x) else (True, x)) ==&gt; (not c, x) where note = "reduces strictness"›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">⟨</span>FF<span class="main">,</span> <span class="free">x</span><span class="main">⟩</span> <span class="keyword1">else</span> <span class="main">⟨</span>TT<span class="main">,</span> <span class="free">x</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">⟨</span>neg<span class="main">⋅</span><span class="free">c</span><span class="main">,</span> <span class="free">x</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ or [x,y]  ==&gt; x || y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"the_or<span class="main">⋅</span><span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">orelse</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ or [x,y,z]  ==&gt; x || y || z›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"the_or<span class="main">⋅</span><span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">orelse</span> <span class="free">y</span> <span class="keyword1">orelse</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ and [x,y]  ==&gt; x &amp;&amp; y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"the_and<span class="main">⋅</span><span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">andalso</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ and [x,y,z]  ==&gt; x &amp;&amp; y &amp;&amp; z›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"the_and<span class="main">⋅</span><span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">andalso</span> <span class="free">y</span> <span class="keyword1">andalso</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Arrow›</span></span>

<span class="comment1">(*  id *** g ==&gt; second g *)</span>
<span class="comment1">(*  f *** id ==&gt; first f *)</span>
<span class="comment1">(*  zip (map f x) (map g x) ==&gt; map (f Control.Arrow.&amp;&amp;&amp; g) x *)</span>
<span class="comment1">(*  (\(x,y) -&gt; (f x, g y)) ==&gt; f Control.Arrow.*** g where _ = notIn [x,y] [f,g] *)</span>
<span class="comment1">(*  (\x -&gt; (f x, g x)) ==&gt; f Control.Arrow.&amp;&amp;&amp; g where _ = notIn x [f,g] *)</span>
<span class="comment1">(*  (\(x,y) -&gt; (f x,y)) ==&gt; Control.Arrow.first f where _ = notIn [x,y] f *)</span>
<span class="comment1">(*  (\(x,y) -&gt; (x,f y)) ==&gt; Control.Arrow.second f where _ = notIn [x,y] f *)</span>
<span class="comment1">(*  (f (fst x), g (snd x)) ==&gt; (f Control.Arrow.*** g) x *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (fst x, snd x) ==&gt;  x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="main">⟨</span>fst<span class="main">⋅</span><span class="free">x</span><span class="main">,</span> snd<span class="main">⋅</span><span class="free">x</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(* -- FUNCTOR *)</span>
<span class="comment1">(*  fmap f (fmap g x) ==&gt; fmap (f . g) x *)</span>
<span class="comment1">(*  fmap id ==&gt; id *)</span>
<span class="comment1">(* -- MONAD *)</span>
<span class="comment1">(*  return a &gt;&gt;= f ==&gt; f a *)</span>
<span class="comment1">(*  m &gt;&gt;= return ==&gt; m *)</span>
<span class="comment1">(*  m &gt;&gt;= return . f ==&gt; Control.Monad.liftM f m -- cannot be fmap, because is in Functor not Monad *)</span>
<span class="comment1">(*  (if x then y else return ()) ==&gt; Control.Monad.when x $ _noParen_ y where _ = not (isAtom y) *)</span>
<span class="comment1">(*  (if x then y else return ()) ==&gt; Control.Monad.when x y where _ = isAtom y *)</span>
<span class="comment1">(*  (if x then return () else y) ==&gt; Control.Monad.unless x $ _noParen_ y where _ = not (isAtom y) *)</span>
<span class="comment1">(*  (if x then return () else y) ==&gt; Control.Monad.unless x y where _ = isAtom y *)</span>
<span class="comment1">(*  sequence (map f x) ==&gt; mapM f x *)</span>
<span class="comment1">(*  sequence_ (map f x) ==&gt; mapM_ f x *)</span>
<span class="comment1">(*  flip mapM ==&gt; Control.Monad.forM *)</span>
<span class="comment1">(*  flip mapM_ ==&gt; Control.Monad.forM_ *)</span>
<span class="comment1">(*  flip forM ==&gt; mapM *)</span>
<span class="comment1">(*  flip forM_ ==&gt; mapM_ *)</span>
<span class="comment1">(*  when (not x) ==&gt; unless x *)</span>
<span class="comment1">(*  x &gt;&gt;= id ==&gt; Control.Monad.join x *)</span>
<span class="comment1">(*  liftM f (liftM g x) ==&gt; liftM (f . g) x *)</span>
<span class="comment1">(*  a &gt;&gt; return () ==&gt; void a *)</span>
<span class="comment1">(*  fmap (const ()) ==&gt; void *)</span>
<span class="comment1">(*  flip (&gt;=&gt;) ==&gt; (&lt;=&lt;) *)</span>
<span class="comment1">(*  flip (&lt;=&lt;) ==&gt; (&gt;=&gt;) *)</span>
<span class="comment1">(*  (\x -&gt; f x &gt;&gt;= g) ==&gt; f Control.Monad.&gt;=&gt; g where _ = notIn x [f,g] *)</span>
<span class="comment1">(*  (\x -&gt; f =&lt;&lt; g x) ==&gt; f Control.Monad.&lt;=&lt; g where _ = notIn x [f,g] *)</span>
<span class="comment1">(*  a &gt;&gt; forever a ==&gt; forever a *)</span>
<span class="comment1">(*  liftM2 id ==&gt; ap *)</span>
<span class="comment1">(* -- MONAD LIST *)</span>
<span class="comment1">(*  liftM unzip (mapM f x) ==&gt; Control.Monad.mapAndUnzipM f x *)</span>
<span class="comment1">(*  sequence (zipWith f x y) ==&gt; Control.Monad.zipWithM f x y *)</span>
<span class="comment1">(*  sequence_ (zipWith f x y) ==&gt; Control.Monad.zipWithM_ f x y *)</span>
<span class="comment1">(*  sequence (replicate n x) ==&gt; Control.Monad.replicateM n x *)</span>
<span class="comment1">(*  sequence_ (replicate n x) ==&gt; Control.Monad.replicateM_ n x *)</span>
<span class="comment1">(*  mapM f (map g x) ==&gt; mapM (f . g) x *)</span>
<span class="comment1">(*  mapM_ f (map g x) ==&gt; mapM_ (f . g) x *)</span>
<span class="comment1">(* -- APPLICATIVE / TRAVERSABLE *)</span>
<span class="comment1">(*  flip traverse ==&gt; for *)</span>
<span class="comment1">(*  flip for ==&gt; traverse *)</span>
<span class="comment1">(*  flip traverse_ ==&gt; for_ *)</span>
<span class="comment1">(*  flip for_ ==&gt; traverse_ *)</span>
<span class="comment1">(*  foldr ( *&gt;) (pure ()) ==&gt; sequenceA_ *)</span>
<span class="comment1">(*  foldr (&lt;|&gt;) empty ==&gt; asum *)</span>
<span class="comment1">(*  liftA2 (flip ($)) ==&gt; (&lt;**&gt;) *)</span>
<span class="comment1">(*  Just &lt;$&gt; a &lt;|&gt; pure Nothing ==&gt; optional a *)</span>
<span class="comment1">(* -- LIST COMP *)</span>
<span class="comment1">(*  (if b then [x] else []) ==&gt; [x | b] *)</span>
<span class="comment1">(*  [x | x &lt;- y] ==&gt; y where _ = isVar x *)</span>
<span class="comment1">(* -- SEQ *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Seq›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ x `seq` x ==&gt; x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"seq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_def<span class="main">)</span>

<span class="comment1">(*  id $! x ==&gt; x *)</span>
<span class="comment1">(*  x `seq` y ==&gt; y where _ = isWHNF x *)</span>
<span class="comment1">(*  f $! x ==&gt; f x where _ = isWHNF x *)</span>
<span class="comment1">(*  evaluate x ==&gt; return x where _ = isWHNF x *)</span>
<span class="comment1">(* -- MAYBE *)</span>
<span class="comment1">(*  maybe x id ==&gt; Data.Maybe.fromMaybe x *)</span>
<span class="comment1">(*  maybe False (const True) ==&gt; Data.Maybe.isJust *)</span>
<span class="comment1">(*  maybe True (const False) ==&gt; Data.Maybe.isNothing *)</span>
<span class="comment1">(*  not (isNothing x) ==&gt; isJust x *)</span>
<span class="comment1">(*  not (isJust x) ==&gt; isNothing x *)</span>
<span class="comment1">(*  maybe [] (:[]) ==&gt; maybeToList *)</span>
<span class="comment1">(*  catMaybes (map f x) ==&gt; mapMaybe f x *)</span>
<span class="comment1">(*  (case x of Nothing -&gt; y; Just a -&gt; a)  ==&gt; fromMaybe y x *)</span>
<span class="comment1">(*  (if isNothing x then y else f (fromJust x)) ==&gt; maybe y f x *)</span>
<span class="comment1">(*  (if isJust x then f (fromJust x) else y) ==&gt; maybe y f x *)</span>
<span class="comment1">(*  maybe Nothing (Just . f) ==&gt; fmap f *)</span>
<span class="comment1">(*  map fromJust . filter isJust  ==&gt;  Data.Maybe.catMaybes *)</span>
<span class="comment1">(*  x == Nothing  ==&gt;  isNothing x *)</span>
<span class="comment1">(*  Nothing == x  ==&gt;  isNothing x *)</span>
<span class="comment1">(*  x /= Nothing  ==&gt;  Data.Maybe.isJust x *)</span>
<span class="comment1">(*  Nothing /= x  ==&gt;  Data.Maybe.isJust x *)</span>
<span class="comment1">(*  concatMap (maybeToList . f) ==&gt; Data.Maybe.mapMaybe f *)</span>
<span class="comment1">(*  concatMap maybeToList ==&gt; catMaybes *)</span>
<span class="comment1">(*  maybe n Just x ==&gt; Control.Monad.mplus x n *)</span>
<span class="comment1">(*  (case x of Just a -&gt; a; Nothing -&gt; y)  ==&gt; fromMaybe y x *)</span>
<span class="comment1">(*  (if isNothing x then y else fromJust x) ==&gt; fromMaybe y x *)</span>
<span class="comment1">(*  (if isJust x then fromJust x else y) ==&gt; fromMaybe y x *)</span>
<span class="comment1">(*  isJust x &amp;&amp; (fromJust x == y) ==&gt; x == Just y *)</span>
<span class="comment1">(*  mapMaybe f (map g x) ==&gt; mapMaybe (f . g) x *)</span>
<span class="comment1">(*  fromMaybe a (fmap f x) ==&gt; maybe a f x *)</span>
<span class="comment1">(*  [x | Just x &lt;- a] ==&gt; Data.Maybe.catMaybes a *)</span>
<span class="comment1">(* -- EITHER *)</span>
<span class="comment1">(*  [a | Left a &lt;- a] ==&gt; lefts a *)</span>
<span class="comment1">(*  [a | Right a &lt;- a] ==&gt; rights a *)</span>
<span class="comment1">(* -- INFIX *)</span>
<span class="comment1">(*  X.elem x y ==&gt; x `X.elem` y where _ = not (isInfixApp original) &amp;&amp; not (isParen result) *)</span>
<span class="comment1">(*  X.notElem x y ==&gt; x `X.notElem` y where _ = not (isInfixApp original) &amp;&amp; not (isParen result) *)</span>
<span class="comment1">(*  X.isInfixOf x y ==&gt; x `X.isInfixOf` y where _ = not (isInfixApp original) &amp;&amp; not (isParen result) *)</span>
<span class="comment1">(*  X.isSuffixOf x y ==&gt; x `X.isSuffixOf` y where _ = not (isInfixApp original) &amp;&amp; not (isParen result) *)</span>
<span class="comment1">(*  X.isPrefixOf x y ==&gt; x `X.isPrefixOf` y where _ = not (isInfixApp original) &amp;&amp; not (isParen result) *)</span>
<span class="comment1">(*  X.union x y ==&gt; x `X.union` y where _ = not (isInfixApp original) &amp;&amp; not (isParen result) *)</span>
<span class="comment1">(*  X.intersect x y ==&gt; x `X.intersect` y where _ = not (isInfixApp original) &amp;&amp; not (isParen result) *)</span>
<span class="comment1">(* -- MATHS *)</span>
<span class="comment1">(*  fromIntegral x ==&gt; x where _ = isLitInt x *)</span>
<span class="comment1">(*  fromInteger x ==&gt; x where _ = isLitInt x *)</span>
<span class="comment1">(*  x + negate y ==&gt; x - y *)</span>
<span class="comment1">(*  0 - x ==&gt; negate x *)</span>
<span class="comment1">(*  log y / log x ==&gt; logBase x y *)</span>
<span class="comment1">(*  x ** 0.5 ==&gt; sqrt x *)</span>
<span class="comment1">(*  sin x / cos x ==&gt; tan x *)</span>
<span class="comment1">(*  sinh x / cosh x ==&gt; tanh x *)</span>
<span class="comment1">(*  n `rem` 2 == 0 ==&gt; even n *)</span>
<span class="comment1">(*  n `rem` 2 /= 0 ==&gt; odd n *)</span>
<span class="comment1">(*  not (even x) ==&gt; odd x *)</span>
<span class="comment1">(*  not (odd x) ==&gt; even x *)</span>
<span class="comment1">(*  x ** 0.5 ==&gt; sqrt x *)</span>
<span class="comment1">(*  x ^^ y ==&gt; x ** y where _ = isLitInt y *)</span>
<span class="comment1">(*  x ^ 0 ==&gt; 1 *)</span>
<span class="comment1">(*  round (x - 0.5) ==&gt; floor x *)</span>
<span class="comment1">(* -- CONCURRENT *)</span>
<span class="comment1">(*  mapM_ (writeChan a) ==&gt; writeList2Chan a *)</span>
<span class="comment1">(* -- EXCEPTION *)</span>
<span class="comment1">(*  Prelude.catch ==&gt; Control.Exception.catch where note = "Prelude.catch does not catch most exceptions" *)</span>
<span class="comment1">(*  flip Control.Exception.catch ==&gt; handle *)</span>
<span class="comment1">(*  flip handle ==&gt; Control.Exception.catch *)</span>
<span class="comment1">(*  flip (catchJust p) ==&gt; handleJust p *)</span>
<span class="comment1">(*  flip (handleJust p) ==&gt; catchJust p *)</span>
<span class="comment1">(*  Control.Exception.bracket b (const a) (const t) ==&gt; Control.Exception.bracket_ b a t *)</span>
<span class="comment1">(*  Control.Exception.bracket (openFile x y) hClose ==&gt; withFile x y *)</span>
<span class="comment1">(*  Control.Exception.bracket (openBinaryFile x y) hClose ==&gt; withBinaryFile x y *)</span>
<span class="comment1">(*  throw (ErrorCall a) ==&gt; error a *)</span>
<span class="comment1">(*  a `seq` return a ==&gt; Control.Exception.evaluate a *)</span>
<span class="comment1">(*  toException NonTermination ==&gt; nonTermination *)</span>
<span class="comment1">(*  toException NestedAtomically ==&gt; nestedAtomically *)</span>
<span class="comment1">(* -- WEAK POINTERS *)</span>
<span class="comment1">(*  mkWeak a a b ==&gt; mkWeakPtr a b *)</span>
<span class="comment1">(*  mkWeak a (a, b) c ==&gt; mkWeakPair a b c *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Evaluate›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ True &amp;&amp; x ==&gt; x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TT <span class="keyword1">andalso</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ False &amp;&amp; x ==&gt; False›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>FF <span class="keyword1">andalso</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> FF"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ True || x ==&gt; True›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TT <span class="keyword1">orelse</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ False || x ==&gt; x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>FF <span class="keyword1">orelse</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ not True ==&gt; False›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span>TT <span class="main">=</span> FF"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ not False ==&gt; True›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span>FF <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*  Nothing &gt;&gt;= k ==&gt; Nothing *)</span>
<span class="comment1">(*  either f g (Left x) ==&gt; f x *)</span>
<span class="comment1">(*  either f g (Right y) ==&gt; g y *)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ fst (x,y) ==&gt; x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"fst<span class="main">⋅</span><span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ snd (x,y) ==&gt; y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"snd<span class="main">⋅</span><span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ f (fst p) (snd p) ==&gt; uncurry f p›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">⋅</span><span class="main">(</span>fst<span class="main">⋅</span><span class="free">p</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>snd<span class="main">⋅</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> uncurry<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ init [x] ==&gt; []›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"init<span class="main">⋅</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ null [] ==&gt; True›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"null<span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> TT"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ length [] ==&gt; 0›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"length<span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldl f z [] ==&gt; z›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foldl<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldr f z [] ==&gt; z›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foldr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ foldr1 f [x] ==&gt; x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foldr1<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ scanr f z [] ==&gt; [z]›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"scanr<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">z</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="free">z</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ scanr1 f [] ==&gt; []›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"scanr1<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ scanr1 f [x] ==&gt; [x]›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"scanr1<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ take n [] ==&gt; []›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"take<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">⊑</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ drop n [] ==&gt; []›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"drop<span class="main">⋅</span><span class="free">n</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">⊑</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> drop.simps<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> if_equal<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ takeWhile p [] ==&gt; []›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"takeWhile<span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ dropWhile p [] ==&gt; []›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dropWhile<span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ span p [] ==&gt; ([],[])›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"span<span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">⟨</span><span class="main">[]</span><span class="main">,</span> <span class="main">[]</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fixrec_simp</span><span class="main">)</span>

<span class="comment1">(*  lines "" ==&gt; [] *)</span>
<span class="comment1">(*  unwords [] ==&gt; "" *)</span>
<span class="comment1">(*  x - 0 ==&gt; x *)</span>
<span class="comment1">(*  x * 1 ==&gt; x *)</span>
<span class="comment1">(*  x / 1 ==&gt; x *)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ concat [a] ==&gt; a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"concat<span class="main">⋅</span><span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ concat [] ==&gt; []›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"concat<span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ zip [] [] ==&gt; []›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"zip<span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ id x ==&gt; x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ID<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ const x y ==&gt; x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"const<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Complex hints›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ take (length t) s == t ==&gt; t `Data.List.isPrefixOf` s›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>Eq_sym<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="main">(</span>take<span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">t</span><span class="main">)</span><span class="main">⋅</span><span class="free">s</span><span class="main">)</span><span class="main">⋅</span><span class="free">t</span> <span class="main">⊑</span> isPrefixOf<span class="main">⋅</span><span class="free">t</span><span class="main">⋅</span><span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eq_sym<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> eq_take_length_isPrefixOf<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹ (take i s == t) ==&gt; _eval_ ((i &gt;= length t) &amp;&amp; (t `Data.List.isPrefixOf` s))›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The hint is not true in general, as the following two lemmas show:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">x</span> <span class="main">:</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>eq<span class="main">⋅</span><span class="main">(</span>take<span class="main">⋅</span><span class="free">i</span><span class="main">⋅</span><span class="free">s</span><span class="main">)</span><span class="main">⋅</span><span class="free">t</span> <span class="main">⊑</span> <span class="main">(</span>le<span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">t</span><span class="main">)</span><span class="main">⋅</span><span class="free">i</span> <span class="keyword1">andalso</span> isPrefixOf<span class="main">⋅</span><span class="free">t</span><span class="main">⋅</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="main">0</span><span class="main">⋅</span><span class="free">i</span> <span class="main">=</span> TT"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"le<span class="main">⋅</span><span class="free">i</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> FF"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span>le<span class="main">⋅</span><span class="main">(</span>length<span class="main">⋅</span><span class="free">t</span><span class="main">)</span><span class="main">⋅</span><span class="free">i</span> <span class="keyword1">andalso</span> isPrefixOf<span class="main">⋅</span><span class="free">t</span><span class="main">⋅</span><span class="free">s</span><span class="main">)</span> <span class="main">⊑</span> eq<span class="main">⋅</span><span class="main">(</span>take<span class="main">⋅</span><span class="free">i</span><span class="main">⋅</span><span class="free">s</span><span class="main">)</span><span class="main">⋅</span><span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> take.simps<span class="main">)</span> <span class="operator">simp</span>

<span class="comment1">(* -- clever hint, but not actually a good idea *)</span>
<span class="comment1">(*  (do a &lt;- f; g a) ==&gt; f &gt;&gt;= g *)</span>
<span class="comment1">(*  a $$$$ b $$$$ c ==&gt; a . b $$$$$ c *)</span>

<span class="comment1">(* not (a == b) ==&gt; a /= b *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="main">(</span>eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> neq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹not (a /= b) ==&gt; a == b›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="main">(</span>neq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> eq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹map id ==&gt; id›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> map_id<span class="main">:</span><span class="quoted"><span class="quoted">"map<span class="main">⋅</span>ID <span class="main">=</span> ID"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cfun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹x == [] ==&gt; null x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">[]</span> <span class="main">=</span> null<span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹any id ==&gt; or›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"any<span class="main">⋅</span>ID <span class="main">=</span> the_or"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>map_id<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹all id ==&gt; and›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all<span class="main">⋅</span>ID <span class="main">=</span> the_and"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>map_id<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(if x then False else y) ==&gt; (not x &amp;&amp; y)›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">x</span> <span class="keyword1">then</span> FF <span class="keyword1">else</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>neg<span class="main">⋅</span><span class="free">x</span> <span class="keyword1">andalso</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(if x then y else True) ==&gt; (not x || y)›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="free">y</span> <span class="keyword1">else</span> TT<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>neg<span class="main">⋅</span><span class="free">x</span> <span class="keyword1">orelse</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹not (not x) ==&gt; x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="main">(</span>neg<span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(if c then f x else f y) ==&gt; f (if c then x else y)›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="free">f</span><span class="main">⋅</span><span class="free">x</span> <span class="keyword1">else</span> <span class="free">f</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">f</span><span class="main">⋅</span><span class="main">(</span><span class="keyword1">If</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(\ x -&gt; [x]) ==&gt; (: [])›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Λ</span> x<span class="main">.</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> <span class="bound">z</span> <span class="main">:</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹True == a ==&gt; a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span>TT<span class="main">⋅</span><span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹False == a ==&gt; not a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span>FF<span class="main">⋅</span><span class="free">a</span> <span class="main">=</span> neg<span class="main">⋅</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹a /= True ==&gt; not a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span>TT <span class="main">=</span> neg<span class="main">⋅</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹a /= False ==&gt; a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neq<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span>FF <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹True /= a ==&gt; not a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neq<span class="main">⋅</span>TT<span class="main">⋅</span><span class="free">a</span> <span class="main">=</span> neg<span class="main">⋅</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹False /= a ==&gt; a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neq<span class="main">⋅</span>FF<span class="main">⋅</span><span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹not (isNothing x) ==&gt; isJust x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="main">(</span>isNothing<span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> isJust<span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹not (isJust x) ==&gt; isNothing x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neg<span class="main">⋅</span><span class="main">(</span>isJust<span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> isNothing<span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹x == Nothing ==&gt; isNothing x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span>Nothing <span class="main">=</span> isNothing<span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹Nothing == x ==&gt; isNothing x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eq<span class="main">⋅</span>Nothing<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> isNothing<span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹x /= Nothing ==&gt; Data.Maybe.isJust x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span>Nothing <span class="main">=</span> isJust<span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹Nothing /= x ==&gt; Data.Maybe.isJust x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"neq<span class="main">⋅</span>Nothing<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> isJust<span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(if isNothing x then y else fromJust x) ==&gt; fromMaybe y x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> isNothing<span class="main">⋅</span><span class="free">x</span> <span class="keyword1">then</span> <span class="free">y</span> <span class="keyword1">else</span> fromJust<span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> fromMaybe<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(if isJust x then fromJust x else y) ==&gt; fromMaybe y x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> isJust<span class="main">⋅</span><span class="free">x</span> <span class="keyword1">then</span> fromJust<span class="main">⋅</span><span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> fromMaybe<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(isJust x &amp;&amp; (fromJust x == y)) ==&gt; x == Just y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>isJust<span class="main">⋅</span><span class="free">x</span> <span class="keyword1">andalso</span> <span class="main">(</span>eq<span class="main">⋅</span><span class="main">(</span>fromJust<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> eq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">(</span>Just<span class="main">⋅</span><span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹elem True ==&gt; or›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"elem<span class="main">⋅</span>TT <span class="main">=</span> the_or"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elem<span class="main">⋅</span>TT<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> the_or<span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_true<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹notElem False ==&gt; and›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"notElem<span class="main">⋅</span>FF <span class="main">=</span> the_and"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"notElem<span class="main">⋅</span>FF<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> the_and<span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_false<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹all ((/=) a) ==&gt; notElem a›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all<span class="main">⋅</span><span class="main">(</span>neq<span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>Eq_sym<span class="main">)</span><span class="main">)</span> <span class="main">=</span> notElem<span class="main">⋅</span><span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"all<span class="main">⋅</span><span class="main">(</span>neq<span class="main">⋅</span><span class="free">a</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> notElem<span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹maybe x id ==&gt; Data.Maybe.fromMaybe x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"maybe<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span>ID <span class="main">=</span> fromMaybe<span class="main">⋅</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maybe<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span>ID<span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> fromMaybe<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹maybe False (const True) ==&gt; Data.Maybe.isJust›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"maybe<span class="main">⋅</span>FF<span class="main">⋅</span><span class="main">(</span>const<span class="main">⋅</span>TT<span class="main">)</span> <span class="main">=</span> isJust"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maybe<span class="main">⋅</span>FF<span class="main">⋅</span><span class="main">(</span>const<span class="main">⋅</span>TT<span class="main">)</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">=</span> isJust<span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹maybe True (const False) ==&gt; Data.Maybe.isNothing›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"maybe<span class="main">⋅</span>TT<span class="main">⋅</span><span class="main">(</span>const<span class="main">⋅</span>FF<span class="main">)</span> <span class="main">=</span> isNothing"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maybe<span class="main">⋅</span>TT<span class="main">⋅</span><span class="main">(</span>const<span class="main">⋅</span>FF<span class="main">)</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">=</span> isNothing<span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹maybe [] (: []) ==&gt; maybeToList›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"maybe<span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> <span class="bound">z</span> <span class="main">:</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> maybeToList"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Maybe"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maybe<span class="main">⋅</span><span class="main">[]</span><span class="main">⋅</span><span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> <span class="bound">z</span> <span class="main">:</span> <span class="main">[]</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">x</span> <span class="main">=</span> maybeToList<span class="main">⋅</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹catMaybes (map f x) ==&gt; mapMaybe f x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"catMaybes<span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> mapMaybe<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(if isNothing x then y else f (fromJust x)) ==&gt; maybe y f x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> isNothing<span class="main">⋅</span><span class="free">x</span> <span class="keyword1">then</span> <span class="free">y</span> <span class="keyword1">else</span> <span class="free">f</span><span class="main">⋅</span><span class="main">(</span>fromJust<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> maybe<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(if isJust x then f (fromJust x) else y) ==&gt; maybe y f x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">If</span> isJust<span class="main">⋅</span><span class="free">x</span> <span class="keyword1">then</span> <span class="free">f</span><span class="main">⋅</span><span class="main">(</span>fromJust<span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> maybe<span class="main">⋅</span><span class="free">y</span><span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(map fromJust . filter isJust) ==&gt; Data.Maybe.catMaybes›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map<span class="main">⋅</span>fromJust <span class="keyword1">oo</span> filter<span class="main">⋅</span>isJust<span class="main">)</span> <span class="main">=</span> catMaybes"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> Maybe<span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map<span class="main">⋅</span>fromJust <span class="keyword1">oo</span> filter<span class="main">⋅</span>isJust<span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> catMaybes<span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹concatMap (maybeToList . f) ==&gt; Data.Maybe.mapMaybe f›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"concatMap<span class="main">⋅</span><span class="main">(</span>maybeToList <span class="keyword1">oo</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> mapMaybe<span class="main">⋅</span><span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"concatMap<span class="main">⋅</span><span class="main">(</span>maybeToList <span class="keyword1">oo</span> <span class="free">f</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">xs</span> <span class="main">=</span> mapMaybe<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹concatMap maybeToList ==&gt; catMaybes›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"concatMap<span class="main">⋅</span>maybeToList <span class="main">=</span> catMaybes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹mapMaybe f (map g x) ==&gt; mapMaybe (f . g) x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"mapMaybe<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="main">(</span>map<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> mapMaybe<span class="main">⋅</span><span class="main">(</span><span class="free">f</span> <span class="keyword1">oo</span> <span class="free">g</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(($) . f) ==&gt; f›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dollar <span class="keyword1">oo</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cfun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(f $) ==&gt; f›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Λ</span> z<span class="main">.</span> dollar<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cfun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹(\ a b -&gt; g (f a) (f b)) ==&gt; g `Data.Function.on` f›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Λ</span> a b<span class="main">.</span> <span class="free">g</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="bound">a</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> on<span class="main">⋅</span><span class="free">g</span><span class="main">⋅</span><span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cfun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹id $! x ==&gt; x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dollarBang<span class="main">⋅</span>ID<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>seq_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹[x | x &lt;- y] ==&gt; y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span> <span class="main">&lt;-</span> <span class="free">y</span><span class="main">]</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹isPrefixOf (reverse x) (reverse y) ==&gt; isSuffixOf x y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"isPrefixOf<span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span>reverse<span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> isSuffixOf<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹concat (intersperse x y) ==&gt; intercalate x y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"concat<span class="main">⋅</span><span class="main">(</span>intersperse<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> intercalate<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹x `seq` y ==&gt; y›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"seq<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹f $! x ==&gt; f x›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dollarBang<span class="main">⋅</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">f</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">‹maybe (f x) (f . g) ==&gt; (f . maybe x g)›</span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"maybe<span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span> <span class="keyword1">oo</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">oo</span> maybe<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cfun_belowI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maybe<span class="main">⋅</span><span class="main">(</span><span class="free">f</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">f</span> <span class="keyword1">oo</span> <span class="free">g</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">oo</span> maybe<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">g</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>