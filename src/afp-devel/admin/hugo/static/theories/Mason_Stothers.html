<div id="Mason_Stothers">
<div class="head">
<h1>Theory Mason_Stothers</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Mason_Stothers.thy
  Author:   Manuel Eberl, TU München

  A simple proof of the Mason--Stothers theorem, the analogue of the abc conjecture
  for polynomials.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Mason--Stother's Theorem›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Mason_Stothers
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial_Factorial.html">HOL-Computational_Algebra.Polynomial_Factorial</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary material›</span></span>

<span class="comment1">(* TODO Rename this to fps_radical or whatever *)</span>
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Formal_Power_Series.radical

<span class="keyword1" id="Mason_Stothers-degree_div"><span class="command">lemma</span></span> degree_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">b</span> <span class="keyword1">div</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">b</span> <span class="main">-</span> degree <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_mult_eq<span class="main">)</span>

<span class="keyword1" id="Mason_Stothers-degree_pderiv_le"><span class="command">lemma</span></span> degree_pderiv_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_pderiv coeff_eq_0<span class="main">)</span>

<span class="keyword1" id="Mason_Stothers-degree_pderiv_less"><span class="command">lemma</span></span> degree_pderiv_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_pderiv_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mason_Stothers-pderiv_eq_0"><span class="command">lemma</span></span> pderiv_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of a radical›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following definition of a radical is generic for any factorial semiring.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> factorial_semiring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">radical</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">radical</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">∏</span><span class="main">(</span>prime_factors <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Mason_Stothers-radical_0"><span class="command">lemma</span></span> radical_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"radical <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> radical_def<span class="main">)</span>

<span class="keyword1" id="Mason_Stothers-radical_nonzero"><span class="command">lemma</span></span> radical_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> radical <span class="free">x</span> <span class="main">=</span> <span class="main">∏</span><span class="main">(</span>prime_factors <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> radical_def<span class="main">)</span>

<span class="keyword1" id="Mason_Stothers-radical_eq_0_iff"><span class="command">lemma</span></span> radical_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"radical <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> radical_def<span class="main">)</span>

<span class="keyword1" id="Mason_Stothers-prime_factorization_radical"><span class="command">lemma</span></span> prime_factorization_radical <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span>radical <span class="free">x</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="main">(</span>prime_factors <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span>radical <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">x</span><span class="main">.</span> prime_factorization <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> radical_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prime_factorization_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">x</span><span class="main">.</span> <span class="main">{#</span><span class="bound">p</span><span class="main">#}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Groups_Big.sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prime_factorization_prime<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mset_set <span class="main">(</span>prime_factors <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mason_Stothers-prime_factors_radical"><span class="command">lemma</span></span> prime_factors_radical <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> prime_factors <span class="main">(</span>radical <span class="free">x</span><span class="main">)</span> <span class="main">=</span> prime_factors <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Mason_Stothers-radical_dvd"><span class="command">lemma</span></span> radical_dvd <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"radical <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prime_factorization_subset_imp_dvd mset_set_set_mset_msubset<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Mason_Stothers-multiplicity_radical_prime"><span class="command">lemma</span></span> multiplicity_radical_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span>radical <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span>radical <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>prime_factors <span class="free">x</span><span class="main">.</span> multiplicity <span class="free">p</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> radical_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_elem_multiplicity_prod_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>prime_factors <span class="free">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">q</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Groups_Big.sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prime_multiplicity_other<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">∈</span> prime_factors <span class="free">x</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mason_Stothers-radical_1"><span class="command">lemma</span></span> radical_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"radical <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> radical_def<span class="main">)</span>

<span class="keyword1" id="Mason_Stothers-radical_unit"><span class="command">lemma</span></span> radical_unit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="free">x</span> <span class="main">⟹</span> radical <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> radical_def prime_factorization_unit<span class="main">)</span>

<span class="keyword1" id="Mason_Stothers-prime_factors_power"><span class="command">lemma</span></span> prime_factors_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> prime_factors <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_dvd zero_power prime_dvd_power_iff<span class="main">)</span>

<span class="keyword1" id="Mason_Stothers-radical_power"><span class="command">lemma</span></span> radical_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> radical <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> radical <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> radical_def prime_factors_power<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> factorial_semiring_gcd
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Mason_Stothers-radical_mult_coprime"><span class="command">lemma</span></span> radical_mult_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"radical <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> radical <span class="free">a</span> <span class="main">*</span> radical <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="free">a</span> <span class="main">∩</span> prime_factors <span class="free">b</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_prime_unit coprime_common_divisor <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏</span><span class="main">(</span>prime_factors <span class="free">a</span> <span class="main">∪</span> prime_factors <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">∏</span><span class="main">(</span>prime_factors <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">∏</span><span class="main">(</span>prime_factors <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> radical_def prime_factorization_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mason_Stothers-multiplicity_le_imp_dvd'"><span class="command">lemma</span></span> multiplicity_le_imp_dvd'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> prime_factors <span class="free">x</span> <span class="main">⟹</span> multiplicity <span class="bound">p</span> <span class="free">x</span> <span class="main">≤</span> multiplicity <span class="bound">p</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicity_le_imp_dvd<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="free">x</span> <span class="main">≤</span> multiplicity <span class="skolem">p</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_dvd not_dvd_imp_multiplicity_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Main result›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following proofs are basically a one-to-one translation of Franz Lemmermeyer's
  presentation~\cite{lemmermeyer05} of Snyder's proof of the Mason--Stothers theorem.
›</span></span>
<span class="keyword1" id="Mason_Stothers-prime_power_dvd_pderiv"><span class="command">lemma</span></span> prime_power_dvd_pderiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_gcd poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> multiplicity <span class="free">p</span> <span class="free">f</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">dvd</span> pderiv <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">f</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="free">f</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_multiplicity_gt_zero_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> Suc_n<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">div</span> <span class="free">p</span> <span class="main">^</span> Suc <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> Suc <span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Suc_n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicity_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> f_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> Suc <span class="free">n</span> <span class="main">*</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="main">…</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span>smult <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> pderiv <span class="skolem">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> pderiv_mult pderiv_power_Suc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def not_dvd_imp_multiplicity_0<span class="main">)</span>

<span class="keyword1" id="Mason_Stothers-poly_div_radical_dvd_pderiv"><span class="command">lemma</span></span> poly_div_radical_dvd_pderiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_gcd poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> radical <span class="free">p</span> <span class="keyword1">dvd</span> pderiv <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicity_le_imp_dvd'<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> prime_factors <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> radical <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="keyword1">div</span> radical <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> div_dvd_iff_mult<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> radical <span class="free">p</span> <span class="main">*</span> radical <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> q <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">q</span> <span class="main">…</span> <span class="main">=</span> Suc <span class="main">(</span>multiplicity <span class="skolem">q</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> radical <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_div_eq_0_iff multiplicity_radical_prime <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>›</span></span> prime_factors_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">q</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> radical <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> multiplicity <span class="skolem">q</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> multiplicity <span class="skolem">q</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> q <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multiplicity_geI prime_power_dvd_pderiv<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_dvd dvd_div_eq_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">q</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> radical <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> multiplicity <span class="skolem">q</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_div_eq_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mason_Stothers-degree_pderiv_mult_less"><span class="command">lemma</span></span> degree_pderiv_mult_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">B</span> <span class="main">+</span> degree <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">≤</span> degree <span class="main">(</span>pderiv <span class="free">C</span><span class="main">)</span> <span class="main">+</span> degree <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_mult_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">C</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_pderiv_less<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Mason_Stothers-Mason_Stothers_aux"><span class="command">lemma</span></span> Mason_Stothers_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_gcd poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">+</span> <span class="free">B</span> <span class="main">+</span> <span class="free">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> coprime<span class="main">:</span> <span class="quoted"><span class="quoted">"Gcd <span class="main">{</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> deg_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">A</span> <span class="main">≥</span> degree <span class="main">(</span>radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> C_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">-</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">C</span> <span class="main">=</span> <span class="free">A</span> <span class="main">+</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> coprime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">A</span> <span class="main">(</span>gcd <span class="free">B</span> <span class="main">(</span><span class="main">-</span><span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> C_eq<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd.commute add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main"><span class="main">]</span></span> coprime_iff_gcd_eq_1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">A</span> <span class="main">(</span><span class="main">-</span><span class="free">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">B</span> <span class="main">(</span><span class="main">-</span><span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> C_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="main">]</span></span> gcd.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">+</span> <span class="free">B</span>"</span></span><span class="main"><span class="main">]</span></span>
                                     add.commute coprime_iff_gcd_eq_1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">A</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">B</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">note</span></span> coprime <span class="main">=</span> coprime <span class="quoted"><span class="quoted">‹coprime <span class="free">A</span> <span class="free">B</span>›</span></span> this
  <span class="keyword1"><span class="command">have</span></span> coprime1<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="free">A</span> <span class="keyword1">div</span> radical <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">B</span> <span class="keyword1">div</span> radical <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_divisors<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ <span class="quoted"><span class="quoted">‹coprime <span class="free">A</span> <span class="free">B</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> nz<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_dvd_iff_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> coprime2<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="free">A</span> <span class="keyword1">div</span> radical <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">div</span> radical <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_divisors<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ <span class="quoted"><span class="quoted">‹coprime <span class="free">A</span> <span class="free">C</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> nz<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_dvd_iff_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> coprime3<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="free">B</span> <span class="keyword1">div</span> radical <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">div</span> radical <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_divisors<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ <span class="quoted"><span class="quoted">‹coprime <span class="free">B</span> <span class="free">C</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> nz<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_dvd_iff_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> coprime4<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="free">A</span> <span class="keyword1">div</span> radical <span class="free">A</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="keyword1">div</span> radical <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">div</span> radical <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> coprime2 coprime3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> coprime_mult_left_iff<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">*</span> pderiv <span class="free">B</span> <span class="main">-</span> pderiv <span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">=</span> pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq pderiv_add pderiv_diff pderiv_minus <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">div</span> radical <span class="free">A</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">A</span> <span class="main">*</span> pderiv <span class="free">B</span> <span class="main">-</span> pderiv <span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_diff dvd_mult2 poly_div_radical_dvd_pderiv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_dvd_iff_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">div</span> radical <span class="free">A</span> <span class="keyword1">dvd</span> <span class="main">(</span>pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">div</span> radical <span class="free">C</span> <span class="keyword1">dvd</span> <span class="main">(</span>pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_diff dvd_mult2 poly_div_radical_dvd_pderiv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_dvd_iff_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="keyword1">div</span> radical <span class="free">B</span> <span class="keyword1">dvd</span> <span class="main">(</span>pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_diff dvd_mult poly_div_radical_dvd_pderiv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_dvd_iff_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">div</span> radical <span class="free">A</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="keyword1">div</span> radical <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">div</span> radical <span class="free">C</span><span class="main">)</span> <span class="keyword1">dvd</span> 
                     <span class="main">(</span>pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coprime coprime1 coprime4
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divides_mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">div</span> radical <span class="free">A</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="keyword1">div</span> radical <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">div</span> radical <span class="free">C</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>radical <span class="free">A</span> <span class="main">*</span> radical <span class="free">B</span> <span class="main">*</span> radical <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_div_if_dvd mult_dvd_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"radical <span class="free">A</span> <span class="main">*</span> radical <span class="free">B</span> <span class="main">*</span> radical <span class="free">C</span> <span class="main">=</span> radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">*</span> radical <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> coprime <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> radical_mult_coprime<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> coprime <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> radical_mult_coprime <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span> <span class="keyword1">div</span> radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">(</span>pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">B</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> pderiv <span class="free">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>pderiv <span class="free">B</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> pderiv <span class="free">C</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">B</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> pderiv <span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span><span class="main">)</span> <span class="main">≤</span> 
            max <span class="main">(</span>degree <span class="main">(</span>pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span><span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_diff_le_max<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> degree <span class="free">B</span> <span class="main">+</span> degree <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> degree_pderiv_mult_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">C</span></span><span class="main">]</span> degree_pderiv_mult_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">B</span> <span class="main">+</span> degree <span class="free">C</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> degree <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> degree_mult_eq<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> degree <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span>radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mult.assoc
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> diff_le_mono2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span> <span class="keyword1">div</span> radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span><span class="main">)</span> <span class="main">&lt;</span>
                          degree <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span> <span class="keyword1">div</span> radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span> <span class="keyword1">div</span> radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> degree <span class="main">(</span>pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> dvd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_degree_le<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> less <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">dvd</span> <span class="free">C</span> <span class="main">*</span> pderiv <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> eq' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> pderiv <span class="free">C</span> <span class="main">*</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">dvd</span> pderiv <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coprime
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> coprime_dvd_mult_left_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coprime_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">C</span> <span class="main">≤</span> degree <span class="main">(</span>pderiv <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_degree_le<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">C</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_pderiv_less<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="keyword1">dvd</span> <span class="free">B</span> <span class="main">*</span> pderiv <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> eq' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> pderiv <span class="free">B</span> <span class="main">*</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="keyword1">dvd</span> pderiv <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coprime
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> coprime_dvd_mult_left_iff<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">B</span> <span class="main">≤</span> degree <span class="main">(</span>pderiv <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_degree_le<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">B</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_pderiv_less<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword2"><span class="keyword">and</span></span> nz <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Mason_Stothers<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_gcd poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">,</span><span class="free">C</span><span class="main">}</span><span class="main">.</span> pderiv <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">+</span> <span class="free">B</span> <span class="main">+</span> <span class="free">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> coprime<span class="main">:</span> <span class="quoted"><span class="quoted">"Gcd <span class="main">{</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">{</span>degree <span class="free">A</span><span class="main">,</span> degree <span class="free">B</span><span class="main">,</span> degree <span class="free">C</span><span class="main">}</span> <span class="main">&lt;</span> degree <span class="main">(</span>radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">A</span> <span class="main">&lt;</span> degree <span class="main">(</span>radical <span class="main">(</span><span class="skolem">A</span> <span class="main">*</span> <span class="skolem">B</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="skolem">A</span><span class="main">,</span><span class="skolem">B</span><span class="main">,</span><span class="skolem">C</span><span class="main">}</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="skolem">A</span><span class="main">,</span><span class="skolem">B</span><span class="main">,</span><span class="skolem">C</span><span class="main">}</span><span class="main">.</span> pderiv <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"sum_mset <span class="main">{#</span><span class="skolem">A</span><span class="main">,</span><span class="skolem">B</span><span class="main">,</span><span class="skolem">C</span><span class="main">#}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Gcd <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="skolem">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>degree <span class="skolem">A</span> <span class="main">&lt;</span> degree <span class="main">(</span>radical <span class="main">(</span><span class="skolem">A</span> <span class="main">*</span> <span class="skolem">B</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">A</span> <span class="main">≥</span> degree <span class="main">(</span>radical <span class="main">(</span><span class="skolem">A</span> <span class="main">*</span> <span class="skolem">B</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Mason_Stothers_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">A</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span></span></span><span class="main">]</span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">C</span></span><span class="main">]</span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> insert_commute mult_ac add_ac<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The result can be simplified a bit more in fields of characteristic 0:
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> Mason_Stothers_char_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_gcd<span class="main">,</span> field_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">,</span><span class="free">C</span><span class="main">}</span><span class="main">.</span> degree <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">+</span> <span class="free">B</span> <span class="main">+</span> <span class="free">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> coprime<span class="main">:</span> <span class="quoted"><span class="quoted">"Gcd <span class="main">{</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">{</span>degree <span class="free">A</span><span class="main">,</span> degree <span class="free">B</span><span class="main">,</span> degree <span class="free">C</span><span class="main">}</span> <span class="main">&lt;</span> degree <span class="main">(</span>radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">,</span><span class="free">C</span><span class="main">}</span><span class="main">.</span> pderiv <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pderiv_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Mason_Stothers<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> this assms<span class="main"><span class="main">(</span></span>5-<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  As a nice corollary, we get a kind of analogue of Fermat's last theorem for polynomials:
  Given non-zero polynomials $A$, $B$, $C$ with $A ^ n + B ^ n + C ^ n = 0$ on lowest terms, 
  we must either have $n \leq 2$ or $(A ^ n)' = (B ^ n)' = (C ^ n)' = 0$.

  In the case of a field with characteristic 0, this last possibility is equivalent to 
  $A$, $B$, and $C$ all being constant.
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> fermat_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_gcd poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">^</span> <span class="free">n</span> <span class="main">+</span> <span class="free">B</span> <span class="main">^</span> <span class="free">n</span> <span class="main">+</span> <span class="free">C</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cop<span class="main">:</span> <span class="quoted"><span class="quoted">"Gcd <span class="main">{</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>    <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">,</span><span class="free">C</span><span class="main">}</span><span class="main">.</span> pderiv <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">{</span>degree <span class="main">(</span><span class="free">A</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> degree <span class="main">(</span><span class="free">B</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> degree <span class="main">(</span><span class="free">C</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="main">&lt;</span> 
          degree <span class="main">(</span>radical <span class="main">(</span><span class="free">A</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="free">B</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="free">C</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">&lt;</span> <span class="var">?d</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Mason_Stothers<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_power_eq gcd_exp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">{</span>degree <span class="main">(</span><span class="free">A</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> degree <span class="main">(</span><span class="free">B</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> degree <span class="main">(</span><span class="free">C</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> degree <span class="free">A</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="var">?d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> degree <span class="free">B</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="var">?d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> degree <span class="free">C</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_power_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> <span class="main">(</span>degree <span class="free">A</span> <span class="main">+</span> degree <span class="free">B</span> <span class="main">+</span> degree <span class="free">C</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">*</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ring_distribs <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="free">B</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="free">C</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"radical <span class="main">…</span> <span class="main">=</span> radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>radical <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> degree <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">*</span> <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_degree_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="free">A</span> <span class="main">+</span> degree <span class="free">B</span> <span class="main">+</span> degree <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_mult_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>degree <span class="free">A</span> <span class="main">+</span> degree <span class="free">B</span> <span class="main">+</span> degree <span class="free">C</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">-</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> fermat_poly_char_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_gcd<span class="main">,</span>field_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">^</span> <span class="free">n</span> <span class="main">+</span> <span class="free">B</span> <span class="main">^</span> <span class="free">n</span> <span class="main">+</span> <span class="free">C</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cop<span class="main">:</span> <span class="quoted"><span class="quoted">"Gcd <span class="main">{</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>    <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">,</span><span class="free">C</span><span class="main">}</span><span class="main">.</span> degree <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> nz <span class="keyword2"><span class="keyword">and</span></span> deg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">,</span><span class="free">C</span><span class="main">}</span><span class="main">.</span> pderiv <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pderiv_eq_0_iff degree_power_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fermat_poly<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-5<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>