<div id="CofGroups">
<div class="head">
<h1>Theory CofGroups</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       An Example of a Cofinitary Group in Isabelle/HOL
    Author:      Bart.Kastermans at colorado.edu, 2009
    Maintainer:  Bart.Kastermans at colorado.edu
*)</span>

<span class="keyword1"><span class="command">theory</span></span> CofGroups
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Nat_Bijection.html">HOL-Library.Nat_Bijection</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Introduction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Cofinitary groups have received a lot of attention in Set
Theory.  I will start by giving some references, that together give a
nice view of the area.  See also Kastermans \cite {Kques} for my view
of where the study of these groups (other than formalization) is
headed.  Starting work was done by Adeleke \cite {MR989749}, Truss
\cite {MR896533} and \cite {MR1683516}, and Koppelberg \cite
{MR709997}.  Cameron \cite {MR1367160} is a very nice survey.  There
is also work on cardinal invariants related to these groups and other
almost disjoint families, see e.g. Brendle, Spinas, and Zhang \cite
{MR1783921}, Hru{\v{s}}{\'a}k, Steprans, and Zhang \cite {MR1856740},
and Kastermans and Zhang \cite {KZ}.  Then there is also work on
constructions and descriptive complexity of these groups, see
e.g. Zhang \cite {MR1974545}, Gao and Zhang \cite {MR2370282}, and
Kastermans \cite {BK1} and \cite {BK2}.

In this note we work through formalizing a basic example of a
cofinitary group.  We want to achieve two things by working through
this example.  First how to formalize some proofs from basic
set-theoretic algebra, and secondly, to do some first steps in the
study of formalization of this area of set theory.  This is related to
the work of Paulson andGr{\polhk{a}}bczewski \cite {PG} on formalizing
set theory, our preference however is towards using Isar resulting in
a development more readable for ``normal'' mathematicians.

A \emph{cofinitary group} is a subgroup $G$ of the symmetric group on
$\mathbb{N}$ (in Isabelle <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">nat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>) such that all non-identity
elements $g \in G$ have finitely many fixed points.  A simple example
of a cofinitary group is obtained by considering the group $G'$ a
subgroup of the symmetric group on $\mathbb {Z}$ (in Isabelle <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="quoted">int</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> generated by the function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">upOne</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> $:\mathbb {Z}
\rightarrow \mathbb {Z}$ defined by $k \mapsto k + 1$.  No element in
this group other than the identity has a fixed point.  Conjugating
this group by any bijection $\mathbb {Z} \rightarrow \N$ gives a
cofinitary group.

We will develop a workable definition of a cofinitary group (Section
\ref {sect:mainnotions}) and show that the group as described in the
previous paragraph is indeed cofinitary (this takes the whole paper,
but is all pulled together in Section \ref {sect:concl}).  Note:
formalizing the previous paragraph is all that is completed in this
note.

Since this note is also written to be read by the proverbial
``normal'' mathematician we will sometimes remark on notations as used
in Isabelle as they related to common notation.  We do expect this
proverbial mathematician to be somewhat flexible though.  He or she
will need to be flexible in reading, this is just like reading any
other article; part of reading is reconstructing.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We end this introduction with a quick overview of the paper.
In Section \ref {sect:mainnotions} we define the notion of cofinitary
group.  In Section \ref {sect:theFunction} we define the function
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">upOne</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and give some of its basic properties.  In Section \ref
{sect:setOFunc} we define the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Ex1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> which is the underlying
set of the group generated by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">upOne</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, there we also derive a
normal form theorem for the elements of this set.  In Section \ref
{sect:Ex1CofBij} we show all elements in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Ex1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are cofinitary
bijections (cofinitary here is used in the general meaning of having
finitely many fixed points).  In Section \ref {sect:Ex1Closed} we show
this set is closed under composition and inverse, in effect showing
that it is a ``cofinitary group'' (cofinitary group here is in quotes,
since we only define it for sets of permutations on the natural
numbers).  In Section \ref {sect:moveNN} we show the general theorem that
conjugating a permutation by a bijection does the expected thing to
the set of fixed points.  In Section \ref {sect:bijN} we define the
function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">CONJ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that is conjugation by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ni_bij</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
(a bijection from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">nat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">int</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>), show that
is acts well with respect to the group operations, use it to define
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Ex2</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> which is the underlying set of the cofinitary group we are
construction, and show the basic properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Ex2</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.  Finally
in Section \ref {sect:concl} we quickly show that all the work in the
section before it combines to show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Ex2</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a cofinitary
group.›</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Main Notions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label {sect:mainnotions} First we define the two main notions.

We write <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S_inf</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for the symmetric group on the natural numbers
(we do not define this as a group, only as the set of bijections).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">S_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">S_inf</span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span><span class="main">.</span> bij <span class="bound">f</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note here that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">bij</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the predicate that
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a bijection.  This is common notation in Isabelle, a
predicate applied to an object.  Related to this <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">inj</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
means <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is injective, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">surj</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> means <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is surjective.

The same notation is used for functionn application.  Next we define a
function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Fix</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, applying it to an object is also written by
juxtaposition.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Given any function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> we define <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Fix</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
to be the set of fixed points for this function.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Fix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Fix</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">n</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We then define a locale <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">CofinitaryGroup</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that
represents the notion of a cofinitary group. An interpretation is
given by giving a set of functions $nat \rightarrow nat$ and showing
that it satisfies the identities the locale assumes.  A locale is a
way to collect together some information that can then later be used
in a flexible way (we will not make a lot of use of that here).›</span></span>

<span class="keyword1"><span class="command">locale</span></span> CofinitaryGroup <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    type_dom <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dom</span> <span class="main">⊆</span> S_inf"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    id_com <span class="main">:</span> <span class="quoted"><span class="quoted">"id <span class="main">∈</span> <span class="free">dom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mult_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">dom</span> <span class="main">∧</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">dom</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">dom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    inv_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">dom</span> <span class="main">⟹</span> inv <span class="free">f</span> <span class="main">∈</span> <span class="free">dom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    cofinitary <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">dom</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">≠</span> id <span class="main">⟹</span> finite <span class="main">(</span>Fix <span class="free">f</span><span class="main">)</span>"</span></span>





<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">upOne</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label{sect:theFunction} Here we define the function, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="free"><span class="quoted"><span class="free">upOne</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, translation up by 1 and proof some of its basic properties.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">upOne</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">upOne</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> upOne_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="comment1">― ‹automated tools can use the definition›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we show that this function is a bijection.  This is done
in the usual two parts; we show it is injective by showing from the
assumption that outputs on two numbers are equal that these two
numbers are equal.  Then we show it is surjective by finding the
number that maps to a given number.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_upOne<span class="main">:</span> <span class="quoted"><span class="quoted">"inj upOne"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Fun.injI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> surj_upOne<span class="main">:</span> <span class="quoted"><span class="quoted">"surj upOne"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Fun.surj_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">k</span> <span class="main">=</span> upOne <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">l</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> upOne <span class="bound"><span class="bound"><span class="bound">l</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> bij_upOne<span class="main">:</span> <span class="quoted"><span class="quoted">"bij upOne"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> bij_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_upOne surj_upOne<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we show that the set of fixed points of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">upOne</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
is empty.  We show this in two steps, first we show that no number
is a fixed point, and then derive from this that the set of fixed
points is empty.›</span></span>


<span class="keyword1"><span class="command">lemma</span></span> no_fix_upOne<span class="main">:</span> <span class="quoted"><span class="quoted">"upOne <span class="free">n</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"upOne <span class="free">n</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> upOne_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"Fix upOne <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Fix_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">upOne</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fix upOne <span class="main">=</span> <span class="main">{</span><span class="bound">n</span> <span class="main">.</span> upOne <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> no_fix_upOne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fix upOne <span class="main">=</span> <span class="main">{</span><span class="bound">n</span> <span class="main">.</span> False<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Set.empty_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Fix upOne <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we derive the equation for the inverse of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="quoted">upOne</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.  The rule we use references <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Hilbert_Choice›</span></span></span></span> since the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="quoted">inv</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> operator, the operator that gives an inverse of a function, is
defined using Hilbert's choice operator.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inv_upOne_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv upOne<span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="quoted">"<span class="skolem">n</span>"</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>inv upOne<span class="main">)</span> <span class="main">∘</span> upOne<span class="main">)</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>inv upOne<span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> inj_upOne <span class="keyword2"><span class="keyword">and</span></span> Hilbert_Choice.inv_o_cancel
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv upOne<span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can also show this quickly using Hilbert\_Choice.inv\_f\_eq
properly instantiated : <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Hilbert_Choice.inv_f_eq<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">of</span></span> <span class="quoted"><span class="quoted">upOne</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span>"</span></span>
<span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator"><span class="operator">OF</span></span> inj_upOne<span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv upOne<span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_Choice.inv_f_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">upOne</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">n</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> inj_upOne<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>





<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Set of Functions and Normal Forms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label {sect:setOFunc} We define the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Ex1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of all
powers of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">upOne</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and study some of its properties, note that
this is the group generated by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">upOne</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (in Section \ref
{sect:Ex1Closed} we prove it closed under composition and inverse).
In Section \ref {sect:Ex1CofBij} we show that all its elements are
cofinitary and bijections (bijections with finitely many fixed
points).  Note that this is not a cofinitary group, since our
definition requires the group to be a subset of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">S_inf</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">Ex1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="main">⇒</span> int<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
base_func<span class="main">:</span> <span class="quoted"><span class="quoted">"upOne <span class="main">∈</span> <span class="free">Ex1</span>"</span></span> <span class="main">|</span>
comp_func<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∈</span> <span class="free">Ex1</span> <span class="main">⟹</span> <span class="main">(</span>upOne <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">Ex1</span>"</span></span> <span class="main">|</span>
comp_inv <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∈</span> <span class="free">Ex1</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>inv upOne<span class="main">)</span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">Ex1</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We start by showing a \emph{normal form} for elements in this
set.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ex1_Normal_form_part1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1 <span class="main">⟹</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Ex1.induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span> 
    <span class="comment1">― ‹blast takes care of the first goal which is formal noise›</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> upOne <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> HOL.exI <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> upOne <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span><span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">=&gt;</span> int"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> fa_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">fa</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">k</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>upOne <span class="main">∘</span> <span class="skolem">fa</span><span class="main">)</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> fa_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">fa</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">k</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> inv_upOne_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>inv upOne<span class="main">)</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> fa_k <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>inv upOne <span class="main">∘</span> <span class="skolem">fa</span><span class="main">)</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we'll show the other direction.  Then we apply rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>int_induct›</span></span></span></span> which allows us to do the induction by first showing it
true for $k = 1$, then showing that if true for $k = i$ it is also
true for $k = i+1$ and finally showing that if true for $k = i$ then
it is also true for $k = i - 1$.

All proofs are fairly straightforward and use extensionality for
functions.  In the base case we are just dealing with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">upOne</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
In the other cases we define the function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>?h›</span></span></span></span> which satisfies
the induction hypothesis.  Then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is obtained from this by
adding or subtracting one pointwise. 

In this proof we use some pattern matching to save on writing.  In the
statement of the theorem, we match the theorem against <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>?P k›</span></span></span></span> thereby
defining the predicate <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>?P›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ex1_Normal_form_part2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> Ex1<span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">k</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> int_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="main">∈</span> Ex1"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> upOne <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> fun_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted">upOne</span><span class="main">,</span><span class="operator">THEN</span> sym<span class="main">]</span> 
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> upOne"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">with</span></span> Ex1.base_func <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> induct_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="main">∈</span> Ex1"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> f_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> induct_hyp <span class="keyword1"><span class="command">have</span></span> h_Ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span>  f_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> upOne <span class="main">(</span><span class="var">?h</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> upOne_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span>upOne <span class="main">∘</span> <span class="var">?h</span><span class="main">)</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> fun_eq_iff<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="quoted">"upOne <span class="main">∘</span> <span class="var">?h</span>"</span></span><span class="main">]</span> 
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> upOne <span class="main">∘</span> <span class="var">?h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> h_Ex1 <span class="keyword2"><span class="keyword">and</span></span> Ex1.comp_func<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> induct_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="main">∈</span> Ex1"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> f_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span>  induct_hyp <span class="keyword1"><span class="command">have</span></span> h_Ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> inv_upOne_eq <span class="keyword2"><span class="keyword">and</span></span> f_eq 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span>inv upOne<span class="main">)</span> <span class="main">(</span><span class="var">?h</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span>inv upOne <span class="main">∘</span> <span class="var">?h</span><span class="main">)</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> fun_eq_iff<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="quoted">"inv upOne <span class="main">∘</span> <span class="var">?h</span>"</span></span><span class="main">]</span> 
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> inv upOne <span class="main">∘</span> <span class="var">?h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> h_Ex1 <span class="keyword2"><span class="keyword">and</span></span> Ex1.comp_inv<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Combining the two directions we get the normal form
theorem.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Ex1_Normal_form<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∈</span> Ex1<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">with</span></span> Ex1_Normal_form_part1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">k</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> Ex1_Normal_form_part2
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹All Elements Cofinitary Bijections.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label {sect:Ex1CofBij} We now show all elements in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="quoted">Ex1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are bijections, Theorem <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">all_bij</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and have no fixed
points, Theorem <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">no_fixed_pt</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> all_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1 <span class="main">⟹</span> bij <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> bij_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">with</span></span> Ex1_Normal_form
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span> <span class="main">∧</span> surj <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> INJ<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> injI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> f_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>

    <span class="keyword3"><span class="command">show</span></span> SURJ<span class="main">:</span> <span class="quoted"><span class="quoted">"surj <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Fun.surj_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">from</span></span> f_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> no_fixed_pt<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> f_Ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> f_not_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> id"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Fix <span class="free">f</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="comment1">― ‹we start by proving an easy general fact›</span>
  <span class="keyword1"><span class="command">have</span></span> f_eq_then_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> f_prop <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">=</span> id <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> id <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> fun_eq_iff<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted">id</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> f_prop <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> f_Ex1 <span class="keyword2"><span class="keyword">and</span></span> Ex1_Normal_form <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> f_eq_then_id <span class="keyword2"><span class="keyword">and</span></span> f_not_id <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> k_prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">≠</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> Fix_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fix <span class="free">f</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span> <span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fix <span class="free">f</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> False<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Set.empty_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Fix <span class="free">f</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Closed under Composition and Inverse›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label {sect:Ex1Closed} We start by showing that this set is
closed under composition.  These facts can later be conjugated to
easily obtain the corresponding results for the group on the natural
numbers.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> closed_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1 <span class="main">∧</span> <span class="free">g</span> <span class="main">∈</span> Ex1 <span class="main">⟹</span> <span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">∈</span> Ex1"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Ex1.induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1 <span class="main">∧</span> <span class="free">g</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">with</span></span> Ex1.comp_func<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"upOne <span class="main">∘</span> <span class="free">g</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">with</span></span> Ex1.comp_func <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="main">∘</span> <span class="free">g</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> Fun.o_assoc <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"upOne"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span>"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"upOne <span class="main">∘</span> <span class="skolem">fa</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">with</span></span> Ex1.comp_inv <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="main">∘</span> <span class="free">g</span>"</span></span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> Fun.o_assoc <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inv upOne"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span>"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv upOne<span class="main">)</span> <span class="main">∘</span> <span class="skolem">fa</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we show the set is closed under inverses.  This is
done by an induction on the definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Ex1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> only using
the normal form theorem and rewriting of expressions.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> closed_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1 <span class="main">⟹</span> inv <span class="free">f</span> <span class="main">∈</span> Ex1"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Ex1.induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv upOne <span class="main">∈</span> Ex1"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?right</span> <span class="main">∈</span> Ex1"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?left</span></span></span>  <span class="main">=</span> <span class="quoted"><span class="quoted">"inv upOne <span class="main">∘</span> <span class="main">(</span>inv upOne <span class="main">∘</span> upOne<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">from</span></span> Ex1.comp_inv <span class="keyword2"><span class="keyword">and</span></span> Ex1.base_func <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">from</span></span> bij_upOne <span class="keyword2"><span class="keyword">and</span></span> bij_is_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj upOne"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inv upOne <span class="main">∘</span> upOne <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">=</span> <span class="var">?right</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> f_Ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">from</span></span> f_Ex1 <span class="keyword2"><span class="keyword">and</span></span> Ex1_Normal_form
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span>upOne <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ic</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span>upOne <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ci</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inv <span class="skolem">f</span> <span class="main">∘</span> inv upOne"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="comment1">― ‹first we get an expression for <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?ci</span></span><span class="antiquote">}</span></span>›</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">from</span></span> all_bij <span class="keyword2"><span class="keyword">and</span></span> f_Ex1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> bij_is_inj <span class="keyword1"><span class="command">have</span></span> inj_f<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> inv <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">from</span></span> f_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> inv_f_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> inj_f 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">-</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> inv_upOne_eq 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="var">?ci</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="var">?ci</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="comment1">― ‹then we check that this implies <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?ci</span></span><span class="antiquote">}</span></span> is›</span>
      <span class="comment1">― ‹a member of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">Ex1</span><span class="antiquote">}</span></span>›</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">from</span></span> Ex1_Normal_form_part2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> Ex1<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ci</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">from</span></span> f_Ex1 all_bij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> bij_upOne <span class="keyword2"><span class="keyword">and</span></span> o_inv_distrib<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ci</span> <span class="main">=</span> <span class="var">?ic</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> f_Ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">with</span></span> Ex1_Normal_form
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span>inv upOne <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ic</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span>inv upOne <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inv <span class="skolem">f</span> <span class="main">∘</span> upOne"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">from</span></span> all_bij <span class="keyword2"><span class="keyword">and</span></span> f_Ex1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> bij_is_inj <span class="keyword1"><span class="command">have</span></span> inj_f<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> inv <span class="skolem">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">from</span></span> f_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> inv_f_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> inj_f 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">-</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> upOne_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>inv <span class="skolem">f</span> <span class="main">∘</span> upOne<span class="main">)</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>inv <span class="skolem">f</span> <span class="main">∘</span> upOne<span class="main">)</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> Ex1_Normal_form_part2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">∈</span> Ex1<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">from</span></span> f_Ex1 all_bij <span class="keyword2"><span class="keyword">and</span></span> bij_is_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> bij_upOne <span class="keyword2"><span class="keyword">and</span></span> bij_imp_bij_inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span>inv upOne<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">note</span></span> o_inv_distrib<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">]</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">f</span> <span class="main">∘</span> inv <span class="main">(</span>inv upOne<span class="main">)</span> <span class="main">=</span> inv <span class="main">(</span>inv upOne <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> bij_upOne <span class="keyword2"><span class="keyword">and</span></span> inv_inv_eq 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span>inv upOne<span class="main">)</span> <span class="main">=</span> upOne"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">=</span> <span class="var">?ic</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Conjugation with a Bijection›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label {sect:moveNN} An abbreviation of the bijection from the
natural numbers to the integers defined in the library.  This will be
used to coerce the functions above to be on the natural numbers.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ni_bij</span> <span class="main">==</span> int_decode"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_f_o_inf_f<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∘</span> inv <span class="free">f</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bij_def surj_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following theorem is a key theorem in showing that the
group we are interested in is cofinitary.  It states that when you
conjugate a function with a bijection the fixed points get mapped
over.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> conj_fix_pt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span><span class="main">.</span> <span class="main">⋀</span><span class="bound">g</span><span class="main">::</span><span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>bij <span class="bound">f</span><span class="main">)</span> 
  <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>inv <span class="bound">f</span><span class="main">)</span><span class="main">`</span><span class="main">(</span>Fix <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Fix <span class="main">(</span><span class="main">(</span>inv <span class="bound">f</span><span class="main">)</span> <span class="main">∘</span> <span class="bound">g</span> <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> bij_f<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> bij_def <span class="keyword1"><span class="command">have</span></span> inj_f<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">⇒</span><span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span><span class="main">`</span><span class="main">(</span>Fix <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Fix <span class="main">(</span><span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">thm</span></span> set_eq_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span><span class="main">`</span><span class="main">(</span>Fix <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Fix<span class="main">(</span><span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span><span class="main">`</span><span class="main">(</span>Fix <span class="skolem">g</span><span class="main">)</span> <span class="main">⊆</span> Fix <span class="main">(</span><span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span><span class="main">`</span><span class="main">(</span>Fix <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> image_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> Fix <span class="skolem">g</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Fix <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> inv <span class="skolem">f</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> bij_f <span class="keyword2"><span class="keyword">and</span></span> bij_f_o_inf_f<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> f_x_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> y_prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Fix <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> Fix_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> f_x_y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inv <span class="skolem">f</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> inv_f_f <span class="keyword2"><span class="keyword">and</span></span> inj_f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> Fix_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inv <span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span>"</span></span><span class="main">]</span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Fix <span class="main">(</span><span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Fix <span class="main">(</span>inv <span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span><span class="main">`</span><span class="main">(</span>Fix <span class="skolem">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Fix <span class="main">(</span>inv <span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Fix_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inv <span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span>"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">have</span></span> x_fix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv <span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_inf_f_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> x_fix <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv <span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span><span class="main">(</span><span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> inv <span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="skolem">f</span> <span class="main">∘</span> inv <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> inv <span class="skolem">f</span><span class="main">)</span><span class="main">(</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> o_assoc 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> inv <span class="skolem">f</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∘</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> inv <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> inv <span class="skolem">f</span><span class="main">)</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> bij_f <span class="keyword2"><span class="keyword">and</span></span> bij_f_o_inf_f<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> Fix_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Fix <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> x_inf_f_y <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>inv <span class="skolem">f</span><span class="main">)</span><span class="main">`</span><span class="main">(</span>Fix <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Bijections on $\mathbb{N}$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label {sect:bijN} In this section we define the subset <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="free"><span class="quoted"><span class="free">Ex2</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">S_inf</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that is the conjugate of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Ex1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> bij <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="quoted">ni_bij</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and show its basic properties. 

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">CONJ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the function that will conjugate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Ex1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Ex2</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">CONJ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="main">⇒</span> int<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">CONJ</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∘</span> ni_bij"</span></span>

<span class="keyword1"><span class="command">declare</span></span> CONJ_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="comment1">― ‹automated tools can use the definition›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We quickly check that this function is of the right type, and
then show three of its properties that are very useful in showing
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Ex2</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a group.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> type_CONJ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1 <span class="main">⟹</span> <span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">∘</span> ni_bij <span class="main">∈</span> S_inf"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> f_Ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex1"</span></span>
  <span class="keyword1"><span class="command">with</span></span> all_bij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> bij_int_decode <span class="keyword2"><span class="keyword">and</span></span> bij_comp 
    <span class="keyword1"><span class="command">have</span></span> bij_f_nibij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> ni_bij<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> bij_int_decode <span class="keyword2"><span class="keyword">and</span></span> bij_imp_bij_inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span>inv ni_bij<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> bij_f_nibij <span class="keyword2"><span class="keyword">and</span></span> bij_comp<span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> ni_bij"</span></span> <span class="quoted"><span class="quoted">"inv ni_bij"</span></span><span class="main">]</span> 
    <span class="keyword2"><span class="keyword">and</span></span> o_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inv ni_bij"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"ni_bij"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">∘</span> ni_bij<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> S_inf_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">∘</span> ni_bij<span class="main">)</span> <span class="main">∈</span> S_inf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> inv_CONJ<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> bij_f<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span>CONJ <span class="free">f</span><span class="main">)</span> <span class="main">=</span> CONJ <span class="main">(</span>inv <span class="free">f</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">=</span> <span class="var">?right</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> st1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">=</span> inv <span class="main">(</span><span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">∘</span> ni_bij<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> CONJ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> bij_int_decode <span class="keyword2"><span class="keyword">and</span></span> bij_imp_bij_inv 
    <span class="keyword1"><span class="command">have</span></span> inv_ni_bij_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span>inv ni_bij<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> bij_f <span class="keyword2"><span class="keyword">and</span></span> bij_comp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span>inv ni_bij <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> o_inv_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inv ni_bij <span class="main">∘</span> <span class="free">f</span>"</span></span> <span class="quoted">ni_bij</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> bij_int_decode
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span><span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">∘</span>  ni_bij<span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>inv <span class="main">(</span><span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> st1 <span class="keyword1"><span class="command">have</span></span> st2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">=</span>
    <span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>inv <span class="main">(</span><span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> inv_ni_bij_bij <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹bij <span class="free">f</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> o_inv_distrib
    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span>inv ni_bij <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> inv <span class="free">f</span> <span class="main">∘</span> inv <span class="main">(</span>inv <span class="main">(</span>ni_bij<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> bij_int_decode <span class="keyword2"><span class="keyword">and</span></span> inv_inv_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted">ni_bij</span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">=</span> ni_bij"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> st2 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">=</span> <span class="main">(</span>inv ni_bij <span class="main">∘</span> <span class="main">(</span>inv <span class="free">f</span> <span class="main">∘</span> <span class="main">(</span> ni_bij<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> o_assoc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">=</span> inv ni_bij <span class="main">∘</span> inv <span class="free">f</span> <span class="main">∘</span> ni_bij"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> CONJ_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inv <span class="free">f</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_CONJ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CONJ <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>CONJ <span class="free">f</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>CONJ <span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">=</span> <span class="var">?right</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bij_int_decode <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"surj ni_bij"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bij_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ni_bij <span class="main">∘</span> <span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> surj_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">=</span> <span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">∘</span> ni_bij"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">=</span> <span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> id<span class="main">)</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">∘</span> ni_bij"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">=</span> 
    <span class="main">(</span>inv ni_bij<span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span>ni_bij <span class="main">∘</span> <span class="main">(</span>inv ni_bij<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">∘</span> ni_bij"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">― ‹a simple computation using only associativity›</span>
      <span class="comment1">― ‹completes the proof›</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?left</span> <span class="main">=</span> <span class="var">?right</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> id_CONJ<span class="main">:</span> <span class="quoted"><span class="quoted">"CONJ id <span class="main">=</span> id"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> CONJ_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bij_int_decode <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj ni_bij"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inv ni_bij <span class="main">∘</span> ni_bij <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv ni_bij <span class="main">∘</span> id<span class="main">)</span> <span class="main">∘</span> ni_bij <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define the group we are interested in, and show the
basic facts that together will show this is a cofinitary group.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Ex2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Ex2</span> <span class="main">=</span> CONJ<span class="main">`</span>Ex1"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> mem_Ex2_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex2 <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="bound">g</span> <span class="main">∈</span> Ex1 <span class="main">∧</span> <span class="free">f</span> <span class="main">=</span> CONJ <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex2"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> CONJ<span class="main">`</span>Ex1"</span></span> <span class="keyword1"><span class="command">using</span></span> Ex2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted">"<span class="skolem"><span class="skolem">g</span></span>"</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> Ex1 <span class="main">∧</span> <span class="free">f</span> <span class="main">=</span> CONJ <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="bound">g</span> <span class="main">∈</span> Ex1 <span class="main">∧</span> <span class="free">f</span> <span class="main">=</span> CONJ <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="bound">g</span> <span class="main">∈</span> Ex1 <span class="main">∧</span> <span class="free">f</span> <span class="main">=</span> CONJ <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> Ex2_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Ex2_cofinitary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_Ex2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex2"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> f_nid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> id"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Fix <span class="free">f</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> f_Ex2 <span class="keyword2"><span class="keyword">and</span></span> mem_Ex2_rule
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g_Ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f_cg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> CONJ <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> id_CONJ <span class="keyword2"><span class="keyword">and</span></span> f_nid <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> g_Ex1 <span class="keyword2"><span class="keyword">and</span></span> no_fixed_pt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> fg_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"Fix <span class="skolem">g</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> conj_fix_pt<span class="main">[</span><span class="operator">of</span> <span class="quoted">ni_bij</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> bij_int_decode
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv ni_bij<span class="main">)</span><span class="main">`</span><span class="main">(</span>Fix <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> Fix<span class="main">(</span>CONJ <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> fg_empty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">=</span> Fix <span class="main">(</span>CONJ <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> f_cg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Fix <span class="free">f</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1"><span class="command">lemma</span></span> id_Ex2<span class="main">:</span> <span class="quoted"><span class="quoted">"id <span class="main">∈</span> Ex2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Ex1_Normal_form_part2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"id <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> id_CONJ <span class="keyword2"><span class="keyword">and</span></span> Ex2_def <span class="keyword2"><span class="keyword">and</span></span> mem_Ex2_rule <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> inv_Ex2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex2 <span class="main">⟹</span> <span class="main">(</span>inv <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> Ex2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex2"</span></span>
  <span class="keyword1"><span class="command">with</span></span> mem_Ex2_rule <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted">"<span class="skolem"><span class="skolem">g</span></span>"</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> CONJ <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> closed_inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">g</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">=</span> CONJ <span class="skolem">g</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> if_iCg<span class="main">:</span> <span class="quoted"><span class="quoted">"inv <span class="free">f</span> <span class="main">=</span> inv <span class="main">(</span>CONJ <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> all_bij <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> Ex1›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> if_iCg <span class="keyword2"><span class="keyword">and</span></span> inv_CONJ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">f</span> <span class="main">=</span> CONJ <span class="main">(</span>inv <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> Ex1›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"closed_inv"</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">g</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹inv <span class="free">f</span> <span class="main">=</span> CONJ <span class="main">(</span>inv <span class="skolem">g</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> mem_Ex2_rule <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">f</span> <span class="main">∈</span> Ex2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_Ex2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_Ex2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Ex2"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  g_Ex2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> Ex2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">∈</span> Ex2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> f_Ex2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f_1</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> f_1_Ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f_1</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> CONJ <span class="skolem">f_1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mem_Ex2_rule <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> g_Ex2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g_1</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> g_1_Ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g_1</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> CONJ <span class="skolem">g_1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mem_Ex2_rule <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span>CONJ <span class="skolem">f_1</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>CONJ <span class="skolem">g_1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> CONJ <span class="main">(</span><span class="skolem">f_1</span> <span class="main">∘</span> <span class="skolem">g_1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp_CONJ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f_1</span> <span class="main">∘</span> <span class="skolem">g_1</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword1"><span class="command">using</span></span> closed_comp <span class="keyword2"><span class="keyword">and</span></span> f_1_Ex1 <span class="keyword2"><span class="keyword">and</span></span> g_1_Ex1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">∈</span> Ex2"</span></span> <span class="keyword1"><span class="command">using</span></span> mem_Ex2_rule <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Conclusion›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\label{sect:concl} With all that we have shown we have already
clearly shown <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Ex2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to be a cofinitary group.  The formalization
also shows this, we just have to refer to the correct theorems proved
above.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> CofinitaryGroup <span class="quoted">Ex2</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ex2 <span class="main">⊆</span> S_inf"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Ex2"</span></span>
    <span class="keyword1"><span class="command">with</span></span> mem_Ex2_rule <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> Ex1"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> CONJ <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> type_CONJ <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> S_inf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> id_Ex2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"id <span class="main">∈</span> Ex2"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Ex2 <span class="main">∧</span> <span class="skolem">g</span> <span class="main">∈</span> Ex2"</span></span>
  <span class="keyword1"><span class="command">with</span></span> comp_Ex2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="main">∈</span> Ex2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Ex2"</span></span>
  <span class="keyword1"><span class="command">with</span></span> inv_Ex2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">f</span> <span class="main">∈</span> Ex2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Ex2 <span class="main">∧</span> <span class="skolem">f</span> <span class="main">≠</span> id"</span></span>
  <span class="keyword1"><span class="command">with</span></span> Ex2_cofinitary <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fix <span class="skolem">f</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Fix <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>