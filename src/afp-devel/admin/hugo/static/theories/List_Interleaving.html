<div id="ListInterleaving">
<div class="head">
<h1>Theory ListInterleaving</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Reasoning about Lists via List Interleaving
    Author:      Pasquale Noce
                 Security Certification Specialist at Arjo Systems - Gep S.p.A.
                 pasquale dot noce dot lavoro at gmail dot com
                 pasquale dot noce at arjowiggins-it dot com
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"List interleaving"</span></span>

<span class="keyword1"><span class="command">theory</span></span> ListInterleaving
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Among the various mathematical tools introduced in his outstanding work on Communicating Sequential
Processes \cite{R2}, Hoare has defined \emph{interleaves} as the predicate satisfied by any three
lists \emph{s}, \emph{t}, emph{u} such that \emph{s} may be split into sublists alternately
extracted from \emph{t} and \emph{u}, whatever is the criterion for extracting an item from either
\emph{t} or \emph{u} in each step.

This paper enriches Hoare's definition by identifying such criterion with the truth value of a
predicate taking as inputs the head and the tail of \emph{s}. This enhanced \emph{interleaves}
predicate turns out to permit the proof of equalities between lists without the need of an
induction. Some rules that allow to infer \emph{interleaves} statements without induction,
particularly applying to the addition of a prefix to the input lists, are also proven. Finally, a
stronger version of the predicate, named \emph{Interleaves}, is shown to fulfil further rules
applying to the addition of a suffix to the input lists.

Throughout this paper, the salient points of definitions and proofs are commented; for additional
information, cf. Isabelle documentation, particularly \cite{R3}, \cite{R4}, \cite{R5}, and
\cite{R6}. For a sample nontrivial application of the mathematical machinery developed in this
paper, cf. \cite{R1}.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"A first version of interleaving"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Here below is the definition of predicate <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>interleaves›</span></span></span></span>, as well as of a convenient symbolic
notation for it. As in the definition of predicate \emph{interleaves} formulated in \cite{R2}, the
recursive decomposition of the input lists is performed by item prepending. In the case of a list
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ws›</span></span></span></span> constructed recursively by item appending rather than prepending, the statement that it
satisfies predicate <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>interleaves›</span></span></span></span> with two further lists can nevertheless be proven by
induction using as input <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"rev <span class="free"><span class="free">ws</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, rather than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ws›</span></span></span></span> itself.

With respect to Hoare's homonymous predicate, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>interleaves›</span></span></span></span> takes as an additional input a
predicate <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P›</span></span></span></span>, which is a function of a single item and a list. Then, for statement
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">interleaves</span></span> <span class="free"><span class="free">P</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">x</span></span> <span class="main"><span class="main">#</span></span> <span class="free"><span class="free">xs</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">y</span></span> <span class="main"><span class="main">#</span></span> <span class="free"><span class="free">ys</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">z</span></span> <span class="main"><span class="main">#</span></span> <span class="free"><span class="free">zs</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to hold, the item picked for being <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> must
be <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P x xs›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> otherwise. On the contrary, in case either the second or
the third list is empty, the truth value of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P x xs›</span></span></span></span> does not matter and list
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">#</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> just has to match the other nonempty one, if any.

\null
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">interleaves</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>
  <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free">interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span>
  <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free">interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="main">=</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free">interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free">interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interleaves</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">#</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interleaves</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">#</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interleaves</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">#</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interleaves</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">interleaves_syntax</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≃</span> <span class="keyword1">{</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">}</span><span class="keyword3">)</span>"</span> <span class="main">[</span>60<span class="main">,</span> 60<span class="main">,</span> 60<span class="main">]</span> 51<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">≃</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">≡</span> interleaves <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

The advantage provided by this enhanced \emph{interleaves} predicate is that in case
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">ys</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">zs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, fixing the values of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>xs›</span></span></span></span> and either <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ys›</span></span></span></span> or <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>zs›</span></span></span></span> has
the effect of fixing the value of the remaining list, too. Namely, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">ys'</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">zs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
also holds, then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ys</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">ys'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and likewise, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">ys</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">zs'</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> also holds, then
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">zs</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">zs'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Therefore, once two \emph{interleaves} statements <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">ys</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">zs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs'</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">ys'</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">zs'</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P'</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> have been proven along with equalities <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">xs'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">P'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and either <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">zs</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">zs'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> or <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ys</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">ys'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, possibly by induction, the
remaining equality, i.e. respectively <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ys</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">ys'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">zs</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">zs'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, can be inferred
without the need of a further induction.

Here below is the proof of this property as well as of other ones. Particularly, it is also proven
that in case <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">ys</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">zs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, lists <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ys›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>zs›</span></span></span></span> can be swapped by
replacing predicate <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P›</span></span></span></span> with its negation.

It is worth noting that fixing the values of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ys›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>zs›</span></span></span></span> does not fix the value of
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>xs›</span></span></span></span> instead. A counterexample is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ys</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">zs</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">z</span></span><span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">y</span></span> <span class="main"><span class="main">≠</span></span> <span class="free"><span class="free">z</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="free"><span class="free">y</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">z</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">=</span></span> True"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="free"><span class="free">z</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">=</span></span> False"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, in which case both of the \emph{interleaves}
statements <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">z</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">ys</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">zs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">z</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">ys</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">zs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> hold.

\null
›</span></span>

<span class="keyword1" id="ListInterleaving-interleaves_length"><span class="command">lemma</span></span> interleaves_length <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">+</span> length <span class="free">zs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">zs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> interleaves.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-interleaves_nil"><span class="command">lemma</span></span> interleaves_nil<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> interleaves.cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">P</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="main"><span class="main"><span class="main">[]</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="free"><span class="free"><span class="free">ys</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="free"><span class="free"><span class="free">zs</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-interleaves_swap"><span class="command">lemma</span></span> interleaves_swap<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">zs</span><span class="main">,</span> <span class="free">ys</span><span class="main">,</span> <span class="main">λ</span><span class="bound">w</span> <span class="bound">ws</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">w</span> <span class="bound">ws</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">zs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> interleaves.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y'</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ys'</span> <span class="skolem">zs'</span> <span class="skolem">P'</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[]</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">zs'</span><span class="main">,</span> <span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="main">λ</span><span class="bound">w</span> <span class="bound">ws</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">P'</span> <span class="bound">w</span> <span class="bound">ws</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-interleaves_equal_fst"><span class="command">lemma</span></span> interleaves_equal_fst <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys'</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="free">ys</span> <span class="main">=</span> <span class="free">ys'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">ys'</span></span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span> <span class="skolem">ys'</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> interleaves_nil<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> interleaves_nil<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">ys'</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ys</span> <span class="bound">ys'</span> <span class="bound">zs</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="bound">ys</span><span class="main">,</span> <span class="bound">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="bound">ys'</span><span class="main">,</span> <span class="bound">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">ys</span> <span class="main">=</span> <span class="bound">ys'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">ys'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main">-</span>3<span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ys'</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">ws</span><span class="main">.</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="bound">w</span> <span class="main">#</span> <span class="bound">ws</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w'</span> <span class="bound">ws'</span><span class="main">.</span> <span class="skolem">ys'</span> <span class="main">=</span> <span class="bound">w'</span> <span class="main">#</span> <span class="bound">ws'</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B' <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="skolem"><span class="skolem">ws'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">=</span> <span class="skolem">w'</span> <span class="main">#</span> <span class="skolem">ws'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> D'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B' <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B' <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> Y' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">ws'</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">ws'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Y <span class="keyword2"><span class="keyword">and</span></span> Y' <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword2"><span class="keyword">and</span></span> D' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">w'</span> <span class="skolem">ws'</span>
    <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">=</span> <span class="skolem">w'</span> <span class="main">#</span> <span class="skolem">ws'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws'</span><span class="main">,</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B' <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span> <span class="main">+</span> length <span class="skolem">ws'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interleaves_length<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interleaves_length<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">w'</span> <span class="main">#</span> <span class="skolem">ws'</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B' <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">w'</span> <span class="main">#</span> <span class="skolem">ws'</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
        <span class="main">[]</span> <span class="main">=</span> <span class="skolem">w'</span> <span class="main">#</span> <span class="skolem">ws'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">=</span> <span class="skolem">w'</span> <span class="main">#</span> <span class="skolem">ws'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">w</span> <span class="skolem">ws</span>
    <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws</span><span class="main">,</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span> <span class="main">+</span> length <span class="skolem">ws</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interleaves_length<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interleaves_length<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">[]</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">w</span> <span class="skolem">ws</span> <span class="skolem">w'</span> <span class="skolem">ws'</span>
    <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">=</span> <span class="skolem">w'</span> <span class="main">#</span> <span class="skolem">ws'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws</span><span class="main">,</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> F'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B' <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D' <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws'</span><span class="main">,</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B' <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D' <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws</span><span class="main">,</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws'</span><span class="main">,</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
        <span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">ws'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">ws'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="skolem">w'</span> <span class="main">∧</span> <span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">ws'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F <span class="keyword2"><span class="keyword">and</span></span> F' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">w'</span> <span class="main">#</span> <span class="skolem">ws'</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B' <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D' <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">w'</span> <span class="main">#</span> <span class="skolem">ws'</span><span class="main">,</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
        <span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">w'</span> <span class="main">#</span> <span class="skolem">ws'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">w'</span> <span class="main">#</span> <span class="skolem">ws'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="skolem">w'</span> <span class="main">∧</span> <span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">ws'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="skolem">w'</span> <span class="main">∧</span> <span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">ws'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-interleaves_equal_snd"><span class="command">lemma</span></span> interleaves_equal_snd<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">zs</span> <span class="main">=</span> <span class="free">zs'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> interleaves_swap<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleaves_equal_fst<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Since \emph{interleaves} statements permit to prove equalities between lists without the need of an
induction, it is useful to search for rules that allow to infer such statements themselves without
induction, which is precisely what is done here below. Particularly, it is proven that under proper
assumptions, predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">interleaves</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> keeps being satisfied by applying a filter, a mapping, or
the addition or removal of a prefix to the input lists.

\null
›</span></span>

<span class="keyword1" id="ListInterleaving-interleaves_all_nil"><span class="command">lemma</span></span> interleaves_all_nil<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">xs</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-interleaves_nil_all"><span class="command">lemma</span></span> interleaves_nil_all<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="free">xs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-interleaves_equal_all_nil"><span class="command">lemma</span></span> interleaves_equal_all_nil<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> interleaves_all_nil<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleaves_equal_fst<span class="main">)</span>

<span class="keyword1" id="ListInterleaving-interleaves_equal_nil_all"><span class="command">lemma</span></span> interleaves_equal_nil_all<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">zs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> interleaves_nil_all<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleaves_equal_snd<span class="main">)</span>

<span class="keyword1" id="ListInterleaving-interleaves_filter"><span class="command">lemma</span></span> interleaves_filter <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> filter <span class="free">Q</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="free">ys</span><span class="main">,</span> filter <span class="free">Q</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> interleaves_nil<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ys'</span> <span class="bound">zs'</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="bound">ys'</span><span class="main">,</span> <span class="bound">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
      filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="bound">ys'</span><span class="main">,</span> filter <span class="free">Q</span> <span class="bound">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">zs</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> filter.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
      filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="main">[]</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">ys'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
      filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys'</span><span class="main">,</span> filter <span class="free">Q</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">ys'</span> <span class="skolem">z</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
        filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys'</span><span class="main">,</span> filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys'</span><span class="main">,</span> filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> filter <span class="free">Q</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> filter <span class="free">Q</span> <span class="skolem">ys'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Q</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="skolem">ys'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">Q</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
        filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> filter <span class="free">Q</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> filter <span class="free">Q</span> <span class="skolem">zs'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Q</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="skolem">zs'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">Q</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-interleaves_map"><span class="command">lemma</span></span> interleaves_map <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
    map <span class="free">f</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span>map <span class="free">f</span> <span class="free">ys</span><span class="main">,</span> map <span class="free">f</span> <span class="free">zs</span><span class="main">,</span> <span class="main">λ</span><span class="bound">w</span> <span class="bound">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>inv <span class="free">f</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>inv <span class="free">f</span><span class="main">)</span> <span class="bound">ws</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">≃</span> <span class="main">{</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> interleaves_nil<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≃</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ys</span> <span class="bound">zs</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="bound">ys</span><span class="main">,</span> <span class="bound">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>map <span class="free">f</span> <span class="bound">ys</span><span class="main">,</span> map <span class="free">f</span> <span class="bound">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">zs</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> interleaves.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>map <span class="free">f</span> <span class="main">[]</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">∧</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">ys'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys'</span><span class="main">,</span> map <span class="free">f</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">∧</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">ys'</span> <span class="skolem">z</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">y</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
        map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys'</span><span class="main">,</span> map <span class="free">f</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">∧</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys'</span><span class="main">,</span> map <span class="free">f</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
        map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>map <span class="free">f</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">∧</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≃</span> <span class="main">{</span>map <span class="free">f</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-interleaves_prefix_fst_1"><span class="command">lemma</span></span> interleaves_prefix_fst_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ws</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">ws</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="bound">n</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">ws</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">0</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-interleaves_prefix_fst_2"><span class="command">lemma</span></span> interleaves_prefix_fst_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ws</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">ws</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="bound">n</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">0</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">ws</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-interleaves_prefix_fst"><span class="command">lemma</span></span> interleaves_prefix_fst <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> interleaves_prefix_fst_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">erule</span> interleaves_prefix_fst_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-interleaves_prefix_snd"><span class="command">lemma</span></span> interleaves_prefix_snd <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> interleaves_swap<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> interleaves_prefix_fst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"A second, stronger version of interleaving"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Simple counterexamples show that unlike prefixes, the addition or removal of suffixes to the input
lists does not generally preserve the validity of predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">interleaves</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. In fact, if
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="free"><span class="free">y</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">=</span></span> True"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">≠</span></span> <span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not hold
although <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">[]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">w</span></span> <span class="bound"><span class="bound">ws</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">P</span></span> <span class="bound"><span class="bound">w</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">ws</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does, by virtue of lemma
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> interleaves_nil_all<span class="antiquote"><span class="antiquote">}</span></span></span></span>. Similarly, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">[]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">w</span></span> <span class="bound"><span class="bound">ws</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">P</span></span> <span class="bound"><span class="bound">w</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">ws</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does
not hold for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">≠</span></span> <span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> even though <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does.

Both counterexamples would not work any longer if the truth value of the input predicate were
significant even if either the second or the third list is empty. In fact, in the former case,
condition <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="free"><span class="free">y</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">=</span></span> True"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> would entail the falseness of statement
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">[]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">w</span></span> <span class="bound"><span class="bound">ws</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">P</span></span> <span class="bound"><span class="bound">w</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">ws</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, so that the validity of rule
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">[]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">w</span></span> <span class="bound"><span class="bound">ws</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">P</span></span> <span class="bound"><span class="bound">w</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">ws</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">⟹</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> would be preserved. In
the latter case, statement <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may only hold provided the last
item <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> of the first list is extracted from the third one, which would require that
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">¬</span></span> <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">[]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>; thus, subordinating rule
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">⟹</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">≃</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">[]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">w</span></span> <span class="bound"><span class="bound">ws</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">P</span></span> <span class="bound"><span class="bound">w</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">ws</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to
condition <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">[]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> would preserve its validity.

This argument suggests that in order to obtain an \emph{interleaves} predicate whose validity is
also preserved upon the addition or removal of a suffix to the input lists, the truth value of the
input predicate must matter until both the second and the third list are empty. In what follows,
such a stronger version of the predicate, named <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Interleaves›</span></span></span></span>, is defined along with a
convenient symbolic notation for it.

\null
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Interleaves</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>
  <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free">Interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span>
  <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free">Interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="main">=</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free">Interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free">Interleaves</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Interleaves</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">#</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Interleaves</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">#</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Interleaves</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">#</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Interleaves</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Interleaves_syntax</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≅</span> <span class="keyword1">{</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">}</span><span class="keyword3">)</span>"</span> <span class="main">[</span>60<span class="main">,</span> 60<span class="main">,</span> 60<span class="main">]</span> 51<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">≅</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">≡</span> Interleaves <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

In what follows, it is proven that predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Interleaves</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is actually not weaker than, viz.
is a sufficient condition for, predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">interleaves</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Moreover, the former predicate is
shown to fulfil the same rules as the latter, although sometimes under more stringent assumptions
(cf. lemmas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Interleaves_all_nil›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Interleaves_nil_all›</span></span></span></span> with lemmas
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> interleaves_all_nil<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> interleaves_nil_all<span class="antiquote"><span class="antiquote">}</span></span></span></span>), and to have the further property that under
proper assumptions, its validity is preserved upon the addition or removal of a suffix to the input
lists.

\null
›</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_interleaves"><span class="command">lemma</span></span> Interleaves_interleaves <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">≃</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">zs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> interleaves.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_length"><span class="command">lemma</span></span> Interleaves_length<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">+</span> length <span class="free">zs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> Interleaves_interleaves<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleaves_length<span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_nil"><span class="command">lemma</span></span> Interleaves_nil<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> Interleaves_interleaves<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleaves_nil<span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_swap"><span class="command">lemma</span></span> Interleaves_swap<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">zs</span><span class="main">,</span> <span class="free">ys</span><span class="main">,</span> <span class="main">λ</span><span class="bound">w</span> <span class="bound">ws</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">w</span> <span class="bound">ws</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">zs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Interleaves.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y'</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ys'</span> <span class="skolem">zs'</span> <span class="skolem">P'</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">zs'</span><span class="main">,</span> <span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="main">λ</span><span class="bound">w</span> <span class="bound">ws</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">P'</span> <span class="bound">w</span> <span class="bound">ws</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_equal_fst"><span class="command">lemma</span></span> Interleaves_equal_fst<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys'</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">=</span> <span class="free">ys'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">drule</span> Interleaves_interleaves<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleaves_equal_fst<span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_equal_snd"><span class="command">lemma</span></span> Interleaves_equal_snd<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">zs</span> <span class="main">=</span> <span class="free">zs'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">drule</span> Interleaves_interleaves<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleaves_equal_snd<span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_equal_all_nil"><span class="command">lemma</span></span> Interleaves_equal_all_nil<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> Interleaves_interleaves<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleaves_equal_all_nil<span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_equal_nil_all"><span class="command">lemma</span></span> Interleaves_equal_nil_all<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">zs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> Interleaves_interleaves<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleaves_equal_nil_all<span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_filter"><span class="command">lemma</span></span> Interleaves_filter <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> filter <span class="free">Q</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="free">ys</span><span class="main">,</span> filter <span class="free">Q</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_nil<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ys'</span> <span class="bound">zs'</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="bound">ys'</span><span class="main">,</span> <span class="bound">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
      filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="bound">ys'</span><span class="main">,</span> filter <span class="free">Q</span> <span class="bound">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">zs</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> filter.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
      filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="main">[]</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">ys'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
      filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys'</span><span class="main">,</span> filter <span class="free">Q</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">ys'</span> <span class="skolem">z</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
        filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys'</span><span class="main">,</span> filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="skolem">ys'</span><span class="main">,</span> filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> filter <span class="free">Q</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> filter <span class="free">Q</span> <span class="skolem">ys'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Q</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="skolem">ys'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">Q</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
        filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> filter <span class="free">Q</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> filter <span class="free">Q</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> filter <span class="free">Q</span> <span class="skolem">zs'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Q</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="skolem">zs'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">Q</span> <span class="skolem">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"filter <span class="free">Q</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_map"><span class="command">lemma</span></span> Interleaves_map <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
    map <span class="free">f</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span>map <span class="free">f</span> <span class="free">ys</span><span class="main">,</span> map <span class="free">f</span> <span class="free">zs</span><span class="main">,</span> <span class="main">λ</span><span class="bound">w</span> <span class="bound">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>inv <span class="free">f</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>inv <span class="free">f</span><span class="main">)</span> <span class="bound">ws</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">≅</span> <span class="main">{</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_nil<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≅</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ys</span> <span class="bound">zs</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="bound">ys</span><span class="main">,</span> <span class="bound">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>map <span class="free">f</span> <span class="bound">ys</span><span class="main">,</span> map <span class="free">f</span> <span class="bound">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">zs</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Interleaves.simps<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>map <span class="free">f</span> <span class="main">[]</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">ys'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys'</span><span class="main">,</span> map <span class="free">f</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">y</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">ys'</span> <span class="skolem">z</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">y</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
        map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys'</span><span class="main">,</span> map <span class="free">f</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">∧</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>map <span class="free">f</span> <span class="skolem">ys'</span><span class="main">,</span> map <span class="free">f</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">)</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
        map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>map <span class="free">f</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">∧</span> map <span class="free">f</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span>map <span class="free">f</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span><span class="main">,</span> map <span class="free">f</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_prefix_fst_1"><span class="command">lemma</span></span> Interleaves_prefix_fst_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ws</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">ws</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="bound">n</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">ws</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">0</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_prefix_fst_2"><span class="command">lemma</span></span> Interleaves_prefix_fst_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ws</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">ws</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="bound">n</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">0</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">ws</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_prefix_fst"><span class="command">lemma</span></span> Interleaves_prefix_fst <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> Interleaves_prefix_fst_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">erule</span> Interleaves_prefix_fst_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_prefix_snd"><span class="command">lemma</span></span> Interleaves_prefix_snd <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> Interleaves_swap<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_prefix_fst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_all_nil_1"><span class="command">lemma</span></span> Interleaves_all_nil_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">xs</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">xs</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">xs</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">xs</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">xs</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="skolem">n</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> length <span class="skolem">xs</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_all_nil_2"><span class="command">lemma</span></span> Interleaves_all_nil_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">xs</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> Interleaves_prefix_fst <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_all_nil"><span class="command">lemma</span></span> Interleaves_all_nil<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">xs</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Interleaves_all_nil_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_all_nil_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_nil_all"><span class="command">lemma</span></span> Interleaves_nil_all<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="free">xs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Interleaves_swap<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Interleaves_all_nil<span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_suffix_one_aux"><span class="command">lemma</span></span> Interleaves_suffix_one_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">xs</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">zs</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="bound">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_suffix_one_fst_2"><span class="command">lemma</span></span> Interleaves_suffix_one_fst_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="main">λ</span><span class="bound">w</span> <span class="bound">ws</span><span class="main">.</span> <span class="free">P</span> <span class="bound">w</span> <span class="main">(</span><span class="bound">ws</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">≅</span> <span class="main">{</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">+</span> length <span class="skolem">zs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_length<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ys <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ys</span> <span class="bound">zs</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="bound">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="bound">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="bound">ys</span><span class="main">,</span> <span class="bound">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ys</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Interleaves.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys'</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z'</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_suffix_one_aux<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y'</span> <span class="skolem">ys'</span> <span class="skolem">z'</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_suffix_fst_1"><span class="command">lemma</span></span> Interleaves_suffix_fst_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="main">λ</span><span class="bound">v</span> <span class="bound">vs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">v</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span><span class="main">}</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≅</span> <span class="main">{</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_nil<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Interleaves_all_nil<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ys</span> <span class="bound">zs</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="bound">ys</span><span class="main">,</span> <span class="bound">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="bound">ys</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="bound">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> Interleaves.cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="var"><span class="var">?P'</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="main"><span class="main">#</span></span> <span class="skolem"><span class="skolem">xs</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">ys</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">zs</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Interleaves.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="main">(</span><span class="operator">erule_tac</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P'</span> <span class="skolem">x'</span> <span class="skolem">xs'</span> <span class="skolem">y'</span> <span class="skolem">ys'</span> <span class="skolem">z'</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span>
      B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">#</span> <span class="skolem">xs'</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="skolem">P'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">=</span> <span class="skolem">P'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">xs'</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">#</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="skolem">x'</span> <span class="skolem">xs'</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x'</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="main">(</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="main">(</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x'</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">z'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P'</span> <span class="skolem">x'</span> <span class="skolem">xs'</span> <span class="skolem">y'</span> <span class="skolem">ys'</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="skolem">P'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">=</span> <span class="skolem">P'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">xs'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="skolem">x'</span> <span class="skolem">xs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">y'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">y'</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">y'</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P'</span> <span class="skolem">x'</span> <span class="skolem">xs'</span> <span class="skolem">z'</span> <span class="skolem">zs'</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="skolem">P'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">=</span> <span class="skolem">P'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">xs'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ws</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">P'</span> <span class="skolem">x'</span> <span class="skolem">xs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">z'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">z'</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ws</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ws</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_suffix_one_fst_1"><span class="command">lemma</span></span> Interleaves_suffix_one_fst_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">[]</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="main">λ</span><span class="bound">w</span> <span class="bound">ws</span><span class="main">.</span> <span class="free">P</span> <span class="bound">w</span> <span class="main">(</span><span class="bound">ws</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_suffix_fst_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_suffix_one_fst"><span class="command">lemma</span></span> Interleaves_suffix_one_fst<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">[]</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="main">λ</span><span class="bound">w</span> <span class="bound">ws</span><span class="main">.</span> <span class="free">P</span> <span class="bound">w</span> <span class="main">(</span><span class="bound">ws</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Interleaves_suffix_one_fst_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_suffix_one_fst_2<span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_suffix_one_snd"><span class="command">lemma</span></span> Interleaves_suffix_one_snd<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="free">x</span> <span class="main">[]</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="main">λ</span><span class="bound">w</span> <span class="bound">ws</span><span class="main">.</span> <span class="free">P</span> <span class="bound">w</span> <span class="main">(</span><span class="bound">ws</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> Interleaves_swap<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Interleaves_suffix_one_fst<span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_suffix_aux"><span class="command">lemma</span></span> Interleaves_suffix_aux <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ws</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span>
  <span class="main">¬</span> <span class="free">P</span> <span class="free">x</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ws</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="skolem">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">P</span> <span class="free">x</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">ws</span> <span class="skolem">P</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P'</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="bound">P'</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">@</span> <span class="skolem">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ws</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="bound">P'</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">P'</span> <span class="free">x</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span>
      <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> drop <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">-</span> length <span class="skolem">ws</span><span class="main">)</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">@</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="skolem">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">@</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="skolem">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">v</span> <span class="bound">vs</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">v</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="var">?P'</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">@</span> <span class="skolem">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ws</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="var">?P'</span> <span class="free">x</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="skolem">ws</span><span class="main">.</span> <span class="var">?P'</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">ws</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> drop <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> length <span class="skolem">ws</span><span class="main">)</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_butlast<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">@</span> <span class="skolem">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ws</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="var">?P'</span> <span class="free">x</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> length <span class="skolem">ws</span><span class="main">)</span>
    <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ws</span> <span class="main">@</span> drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span> <span class="main">-</span> length <span class="skolem">ws</span><span class="main">)</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">w</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">@</span> <span class="skolem">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ws</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_suffix_one_fst_2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P'</span> <span class="free">x</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">P</span> <span class="free">x</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_suffix_fst_2"><span class="command">lemma</span></span> Interleaves_suffix_fst_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="main">λ</span><span class="bound">v</span> <span class="bound">vs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">v</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">≅</span> <span class="main">{</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ws</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span> <span class="main">+</span> length <span class="skolem">zs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_length<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ys <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ys</span> <span class="bound">zs</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="bound">ys</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="bound">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="bound">ys</span><span class="main">,</span> <span class="bound">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">zs</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ys</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Interleaves.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ws</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span> <span class="main">=</span> length <span class="free">ws</span> <span class="main">+</span> length <span class="main">[]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> Interleaves_length <span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys'</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z'</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ws</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ws</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_suffix_aux<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ws</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z'</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ws</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ws</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z'</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y'</span> <span class="skolem">ys'</span> <span class="skolem">z'</span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">z'</span> <span class="main">#</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span> <span class="main">⟶</span> <span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">zs'</span><span class="main">,</span> <span class="var">?P'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListInterleaving-Interleaves_suffix_fst"><span class="command">lemma</span></span> Interleaves_suffix_fst <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="main">λ</span><span class="bound">v</span> <span class="bound">vs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">v</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Interleaves_suffix_fst_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> Interleaves_suffix_fst_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ListInterleaving-Interleaves_suffix_snd"><span class="command">lemma</span></span> Interleaves_suffix_snd <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">ws</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">ws</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">ws</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">xs</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">,</span> <span class="main">λ</span><span class="bound">v</span> <span class="bound">vs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">v</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="free">ws</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ws</span> <span class="main">≅</span> <span class="main">{</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span> <span class="main">@</span> <span class="free">ws</span><span class="main">,</span> <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> Interleaves_swap<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Interleaves_suffix_fst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>