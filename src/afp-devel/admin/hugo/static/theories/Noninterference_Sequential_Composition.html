<div id="Propaedeutics">
<div class="head">
<h1>Theory Propaedeutics</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Conservation of CSP Noninterference Security under Sequential Composition
    Author:      Pasquale Noce
                 Security Certification Specialist at Arjo Systems, Italy
                 pasquale dot noce dot lavoro at gmail dot com
                 pasquale dot noce at arjosystems dot com
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Propaedeutic definitions and lemmas"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Propaedeutics
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Noninterference_Ipurge_Unwinding/DeterministicProcesses.html">Noninterference_Ipurge_Unwinding.DeterministicProcesses</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

\emph{To our Lord Jesus Christ, my dear parents, and my "little" sister,}

\emph{for the immense love with which they surround me.}

\null

In his outstanding work on Communicating Sequential Processes \cite{R4}, Hoare has defined two
fundamental binary operations allowing to compose the input processes into another, typically more
complex, process: sequential composition and concurrent composition. Particularly, the output of the
former operation is a process that initially behaves like the first operand, and then like the
second operand once the execution of the first one has terminated successfully, as long as it does.
In order to distinguish it from deadlock, successful termination is regarded as a special event in
the process alphabet (required to be the same for both the input processes and the output one).

This paper formalizes Hoare's definition of sequential composition and proves, in the general case
of a possibly intransitive policy, that CSP noninterference security \cite{R2} is conserved under
this operation, viz. the security of both of the input processes implies that of the output process.

This property is conditional on two nontrivial assumptions. The first assumption is that the policy
do not allow successful termination to be affected by confidential events, viz. by other events not
allowed to affect some event in the process alphabet. The second assumption is that successful
termination do not occur as an alternative to other events in the traces of the first operand, viz.
that whenever the process can terminate successfully, it cannot engage in any other event. Both of
these assumptions are shown, by means of counterexamples, to be necessary for the theorem to hold.

From the above sketch of the sequential composition of two processes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
notwithstanding its informal character, it clearly follows that any failure of the output process
is either a failure of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (case A), or a pair <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">ys</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Y</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a
trace of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">ys</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Y</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a failure of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (case B). On the other hand,
according to the definition of security given in \cite{R2}, the output process is secure just in
case, for each of its failures, any event <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> contained in the failure trace can be removed
from the trace, or inserted into the trace of another failure after the same previous events as in
the original trace, and the resulting pair is still a failure of the process, provided that the
future of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is deprived of the events that may be affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

In case A, this transformation is performed on a failure of process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>; being it secure, the
result is still a failure of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and then of the output process. In case B, the
transformation may involve either <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ys</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> alone, or both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ys</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, depending on
the position at which <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is removed or inserted. In the former subcase, being <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
secure, the result has the form <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">ys'</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Y'</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">ys'</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Y'</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a failure of
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, thus it is still a failure of the output process. In the latter subcase, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ys</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has
to be deprived of the events that may be affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, as well as by any event affected by
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in the involved portion of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and a similar transformation applies to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Y</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
In order that the output process be secure, the resulting pair <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">ys''</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Y''</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> must still be a
failure of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, so that the pair <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">xs'</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">ys''</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Y''</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> results from
the transformation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, be a failure of the output process.

The transformations bringing from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ys</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Y</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ys''</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Y''</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are
implemented by the functions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_ref_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> defined in \cite{R3}.
Therefore, the proof of the target security conservation theorem requires that of the following
lemma: given a process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, a noninterference policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and an event-domain map
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is secure with respect to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">xs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">X</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a
failure of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>ipurge_tr_aux <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span><span class="main"><span class="main">,</span></span> ipurge_ref_aux <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> <span class="free"><span class="free">X</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is still a
failure of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. In other words, the lemma states that the failures of a secure process are
closed under intransitive purge. This section contains a proof of such closure lemma, as well as
further definitions and lemmas required for the proof of the target theorem.

Throughout this paper, the salient points of definitions and proofs are commented; for additional
information, cf. Isabelle documentation, particularly \cite{R6}, \cite{R7}, \cite{R8}, and
\cite{R9}.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Preliminary propaedeutic lemmas"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In what follows, some lemmas required for the demonstration of the target closure lemma are proven.

Here below is the proof of some properties of functions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_ref</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_length"><span class="command">lemma</span></span> ipurge_tr_length<span class="main">:</span>
 <span class="quoted"><span class="quoted">"length <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_swap"><span class="command">lemma</span></span> ipurge_ref_swap<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span>
  <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="free">X</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_last"><span class="command">lemma</span></span> ipurge_ref_last<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">X</span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>
    <span class="keyword1">then</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">,</span> <span class="free">D</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">}</span>
    <span class="keyword1">else</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below is the proof of some properties of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sinks_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1" id="Propaedeutics-sinks_aux_append"><span class="command">lemma</span></span> sinks_aux_append<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> append_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_assoc<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-sinks_aux_union"><span class="command">lemma</span></span> sinks_aux_union<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span>
  sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">∪</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span>
    sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span> <span class="main">∪</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
    sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">∪</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span> <span class="main">∪</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span>
      <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span> <span class="main">∪</span>
      sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-sinks_aux_subset_dom"><span class="command">lemma</span></span> sinks_aux_subset_dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> F <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-sinks_aux_subset_ipurge_tr_aux"><span class="command">lemma</span></span> sinks_aux_subset_ipurge_tr_aux<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u'</span> <span class="main">∈</span> sinks_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="free">D'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I'</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u'</span> <span class="main">∈</span> sinks_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="free">D'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
       <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">with</span></span> E <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I'</span> <span class="free">D'</span> <span class="free">U'</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-sinks_aux_subset_ipurge_tr"><span class="command">lemma</span></span> sinks_aux_subset_ipurge_tr<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I'</span> <span class="free">D'</span> <span class="free">u'</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux_single_dom <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> sinks_aux_subset_ipurge_tr_aux<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-sinks_aux_member_ipurge_tr_aux"><span class="command">lemma</span></span> sinks_aux_member_ipurge_tr_aux <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="free">xs</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟶</span>
    <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="free">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∨</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">u</span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟶</span>
      <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u'</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u'</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="skolem">u'</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟶</span>
        <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="skolem">u'</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
       <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="var">?P</span> <span class="main">⟶</span> <span class="var">?Q</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span> <span class="main">⟶</span> <span class="var">?Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="skolem">x</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> F <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u'</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span>
        <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="skolem">x</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">=</span>
        ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟶</span>
        <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
       <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="var">?P</span> <span class="main">⟶</span> <span class="var">?Q</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span> <span class="main">⟶</span> <span class="var">?Q</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟶</span>
      <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
     <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="var">?P</span> <span class="main">⟶</span> <span class="var">?Q</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span> <span class="main">⟶</span> <span class="var">?Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-sinks_aux_member_ipurge_tr"><span class="command">lemma</span></span> sinks_aux_member_ipurge_tr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="free">v</span> <span class="free">U</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="free">v</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">v</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ipurge_tr_aux_single_dom <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule_tac</span> w <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">w</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sinks_aux_member_ipurge_tr_aux<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_single_dom<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below is the proof of some properties of functions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_ref_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_aux_append"><span class="command">lemma</span></span> ipurge_tr_aux_append<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span>
  ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> append_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_append <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_assoc<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_aux_single_event"><span class="command">lemma</span></span> ipurge_tr_aux_single_event<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>
    <span class="keyword1">then</span> <span class="main">[]</span>
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append_Nil <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_Nil<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_aux_cons"><span class="command">lemma</span></span> ipurge_tr_aux_cons<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>
    <span class="keyword1">then</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span><span class="main">)</span> <span class="free">xs</span>
    <span class="keyword1">else</span> <span class="free">x</span> <span class="main">#</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
    ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux_append<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_single_event ipurge_tr_aux_single_event<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_aux_union"><span class="command">lemma</span></span> ipurge_tr_aux_union<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span>
  ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span>
    ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
    ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span> <span class="main">∪</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span>
      <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_union<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span> <span class="main">∪</span>
      sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_union<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_aux_insert"><span class="command">lemma</span></span> ipurge_tr_aux_insert<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="free">v</span> <span class="free">U</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span>
  ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">v</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> insert_is_Un<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux_union ipurge_tr_aux_single_dom<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_aux_subset"><span class="command">lemma</span></span> ipurge_ref_aux_subset<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ipurge_ref_aux_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Intransitive purge of event sets with trivial base case"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Here below are the definitions of variants of functions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sinks_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_ref_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, respectively named <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sinks_aux_less›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_ref_aux_less›</span></span></span></span>,
such that their base cases in correspondence with an empty input list are trivial, viz. such that
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">sinks_aux_less</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="main"><span class="main">[]</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">{}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ipurge_ref_aux_less</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="main"><span class="main">[]</span></span> <span class="free"><span class="free">X</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. These
functions will prove to be useful in what follows.

\null
›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">sinks_aux_less</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'d</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'d</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sinks_aux_less</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sinks_aux_less</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">∪</span> <span class="free">sinks_aux_less</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>
  <span class="keyword1">then</span> insert <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">sinks_aux_less</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
  <span class="keyword1">else</span> <span class="free">sinks_aux_less</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_paired_all<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> rev_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">lexicographic_order</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_ref_aux_less</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'d</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_ref_aux_less</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span>
  <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux_less <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below is the proof of some properties of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sinks_aux_less</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> used in what follows.

\null
›</span></span>

<span class="keyword1" id="Propaedeutics-sinks_aux_sinks_aux_less"><span class="command">lemma</span></span> sinks_aux_sinks_aux_less<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-sinks_aux_less_single_dom"><span class="command">lemma</span></span> sinks_aux_less_single_dom<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span> <span class="free">xs</span> <span class="main">=</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-sinks_aux_less_single_event"><span class="command">lemma</span></span> sinks_aux_less_single_event<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">D</span> <span class="free">x</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> append_Nil <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_Nil<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-sinks_aux_less_append"><span class="command">lemma</span></span> sinks_aux_less_append<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span>
  sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> append_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_assoc<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-sinks_aux_less_cons"><span class="command">lemma</span></span> sinks_aux_less_cons<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>
   <span class="keyword1">then</span> insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>
   <span class="keyword1">else</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
    sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_aux_less_append<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_less_single_event<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below is the proof of some properties of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_ref_aux_less</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> used in what
follows.

\null
›</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_aux_less_last"><span class="command">lemma</span></span> ipurge_ref_aux_less_last<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">X</span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>
    <span class="keyword1">then</span> ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">,</span> <span class="free">D</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">}</span>
    <span class="keyword1">else</span> ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_aux_less_def<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_aux_less_nil"><span class="command">lemma</span></span> ipurge_ref_aux_less_nil<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">(</span>ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">[]</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span>
  ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_aux_def ipurge_ref_aux_less_def sinks_aux_sinks_aux_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_aux_less_cons_1"><span class="command">lemma</span></span> ipurge_ref_aux_less_cons_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="free">X</span> <span class="main">=</span>
    ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">xs</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_def ipurge_ref_aux_less_def sinks_aux_less_single_event A<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x'</span> <span class="skolem">xs</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span>
    ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">X</span> <span class="main">=</span>
    ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>
      <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span>
    ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span>
      ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x'</span><span class="main">,</span> <span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> append_Cons <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_aux_less_last <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
      ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>
        <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x'</span><span class="main">,</span> <span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">}</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span>
      ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>
        <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x'</span><span class="main">,</span> <span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x'</span><span class="main">,</span> <span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">}</span> <span class="main">=</span>
        ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_last<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="skolem">x'</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_interference_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x'</span><span class="main">,</span> <span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">}</span> <span class="main">=</span>
        ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x'</span><span class="main">,</span> <span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_last<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x'</span><span class="main">,</span> <span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_swap<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span>
        ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>
          <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x'</span><span class="main">,</span> <span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span>
        <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span>
          <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_sinks_aux_less<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_cons<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> F <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_aux_member_ipurge_tr<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_sinks_aux_less<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> F <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_aux_less_last<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span>
        ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span>
          <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="skolem">x'</span> <span class="main">∉</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_interference_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span> <span class="main">=</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span>
      ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">X</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> append_Cons <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_aux_less_last <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
      ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>
        <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
      ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span>
        <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span>
        <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_aux_subset_ipurge_tr<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_sinks_aux_less<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_insertI<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_aux_subset_dom<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_cons<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_sinks_aux_less<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> E <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_aux_less_last<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
      ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_aux_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">x</span> <span class="main">∈</span> insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">x</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">x</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_cons<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_sinks_aux_less<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">D</span> <span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">{</span><span class="free">D</span> <span class="free">x</span><span class="main">}</span> <span class="skolem">xs</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_aux_subset_dom<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">{</span><span class="free">D</span> <span class="free">x</span><span class="main">}</span> <span class="skolem">xs</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_single_dom<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="free">U</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_cons<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_sinks_aux_less<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> E <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span> <span class="main">=</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_interference_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="skolem">X</span> <span class="main">=</span>
        ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">X</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_last<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_aux_less_cons_2"><span class="command">lemma</span></span> ipurge_ref_aux_less_cons_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟹</span>
  ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="free">X</span> <span class="main">=</span>
    ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_aux_less_def sinks_aux_less_cons<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Closure of the failures of a secure process under intransitive purge"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The intransitive purge of an event list <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with regard to a policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, an
event-domain map <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and a set of domains <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can equivalently be computed as follows:
for each item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may be affected by some domain in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
discard <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and go on recursively using <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">D</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">xs'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as input, where
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the sublist of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> following <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>; otherwise, retain <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and go on
recursively using <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as input.

In fact, in each recursive step, any item allowed to be indirectly affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> through the
effect of some item preceding <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> within <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has already been removed from the list.
Hence, it is sufficient to check whether <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may be directly affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and remove
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, as well as any residual item allowed to be affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, if this is the case.

Similarly, the intransitive purge of an event set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with regard to a policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, an
event-domain map <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, a set of domains <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and an event list <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can be computed
as follows. First of all, compute <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="main"><span class="main">[]</span></span> <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and use this set, along with
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, as the input for the subsequent step. Then, for each item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, if
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may be affected by some domain in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, go on recursively using
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">D</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">xs'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">D</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">xs'</span></span> <span class="free"><span class="free">X'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as input, where
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the set input to the current recursive step; otherwise, go on recursively using
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as input.

In fact, in each recursive step, any item allowed to be affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> either directly, or
through the effect of some item preceding <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> within <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, has already been removed from
the set (in the initial step and in subsequent steps, respectively). Thus, it is sufficient to check
whether <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may be directly affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and remove any residual item allowed to be
affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if this is the case.

Assume that the two computations be performed simultaneously by a single function, which will then
take as input an event list-event set pair and return as output another such pair. Then, if the
input pair is a failure of a secure process, the output pair is still a failure. In fact, for each
item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> allowed to be affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ys</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the partial
output list for the sublist of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> preceding <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">ys</span></span> <span class="main"><span class="main">@</span></span> ipurge_tr <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">D</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">xs'</span></span><span class="main"><span class="main">,</span></span> ipurge_ref <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">D</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">xs'</span></span> <span class="free"><span class="free">X'</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a failure provided that
such is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">ys</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">#</span></span> <span class="free"><span class="free">xs'</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">X'</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, by virtue of the definition of CSP noninterference security
\cite{R2}. Hence, the property of being a failure is conserved upon each recursive call by the event
list-event set pair such that the list matches the concatenation of the partial output list with the
residual input list, and the set matches the residual input set. This holds until the residual input
list is nil, which is the base case determining the end of the computation.

As shown by this argument, a proof by induction that the output event list-event set pair, under the
aforesaid assumptions, is still a failure, requires that the partial output list be passed to the
function as a further argument, in addition to the residual input list, in the recursive calls
contained within the definition of the function. Therefore, the output list has to be accumulated
into a parameter of the function, viz. the function needs to be tail-recursive. This suggests to
prove the properties of interest of the function by applying the ten-step proof method for theorems
on tail-recursive functions described in \cite{R1}.

The starting point is to formulate a naive definition of the function, which will then be refined as
specified by the proof method. A slight complication is due to the preliminary replacement of the
input event set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="main"><span class="main">[]</span></span> <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, to be performed before the items
of the input event list start to be consumed recursively. A simple solution to this problem is to
nest the accumulator of the output list within data type <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>option›</span></span></span></span>. In this way, the initial
state can be distinguished from the subsequent one, in which the input event list starts to be
consumed, by assigning the distinct values <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some <span class="main"><span class="main">[]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, respectively, to the
accumulator.

Everything is now ready for giving a naive definition of the function under consideration:

\null
›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">ipurge_fail_aux_t_naive</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'d</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list option <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span>
    <span class="tfree">'a</span> failure"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_naive</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> None <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span>
  <span class="free">ipurge_fail_aux_t_naive</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span>Some <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>ipurge_ref_aux <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_naive</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>
  <span class="keyword1">then</span> <span class="free">ipurge_fail_aux_t_naive</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span>
    <span class="main">(</span>ipurge_tr <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">(</span>ipurge_ref <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>
  <span class="keyword1">else</span> <span class="free">ipurge_fail_aux_t_naive</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span>
    <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_naive</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

The parameter into which the output list is accumulated is the last but one.

As shown by the above informal argument, function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_naive›</span></span></span></span> enjoys the
following properties:

\null

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"fst <span class="main"><span class="main">(</span></span><span class="free"><span class="free">ipurge_fail_aux_t_naive</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> None <span class="free"><span class="free">X</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> ipurge_tr_aux <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

\null

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"snd <span class="main"><span class="main">(</span></span><span class="free"><span class="free">ipurge_fail_aux_t_naive</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> None <span class="free"><span class="free">X</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> ipurge_ref_aux <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

\null

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⟦</span></span>secure <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span><span class="main"><span class="main">;</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">xs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">X</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> failures <span class="free"><span class="free">P</span></span><span class="main"><span class="main">⟧</span></span> <span class="main"><span class="main">⟹</span></span>
  <span class="free"><span class="free">ipurge_fail_aux_t_naive</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> None <span class="free"><span class="free">X</span></span> <span class="main"><span class="main">∈</span></span> failures <span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

\null

which altogether imply the target lemma, viz. the closure of the failures of a secure process under
intransitive purge.

In what follows, the steps provided for by the aforesaid proof method will be dealt with one after
the other, with the purpose of proving the target closure lemma in the final step. For more
information on this proof method, cf. \cite{R1}.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 1"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In the definition of the auxiliary tail-recursive function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_aux›</span></span></span></span>, the
Cartesian product of the input parameter types of function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_naive›</span></span></span></span> will be
implemented as the following record type:

\null
›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">=</span>
  Pol <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set"</span></span>
  Map <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span>
  Doms <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> set"</span></span>
  List <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
  ListOp <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list option"</span></span>
  Set <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below is the resulting definition of function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_aux›</span></span></span></span>:

\null
›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">ipurge_fail_aux_t_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>

<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_aux</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span>
  ListOp <span class="main">=</span> None<span class="main">,</span> Set <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span> <span class="main">=</span>
 <span class="free">ipurge_fail_aux_t_aux</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span>
  ListOp <span class="main">=</span> Some <span class="main">[]</span><span class="main">,</span> Set <span class="main">=</span> ipurge_ref_aux <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span>"</span></span> <span class="main">|</span>

<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_aux</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span>
  ListOp <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">,</span> Set <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>
  <span class="keyword1">then</span> <span class="free">ipurge_fail_aux_t_aux</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span>
   List <span class="main">=</span> ipurge_tr <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> ListOp <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">,</span>
    Set <span class="main">=</span> ipurge_ref <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span>
  <span class="keyword1">else</span> <span class="free">ipurge_fail_aux_t_aux</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span>
   List <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> ListOp <span class="main">=</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">,</span> Set <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="main">|</span>

<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_aux</span>
  <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> <span class="main">[]</span><span class="main">,</span> ListOp <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">,</span> Set <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span> <span class="main">=</span>
 <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> <span class="main">[]</span><span class="main">,</span> ListOp <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">,</span> Set <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">atomize_elim</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">I</span> <span class="bound">D</span> <span class="bound">U</span> <span class="bound">xs</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="bound">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="bound">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="bound">U</span><span class="main">,</span> List <span class="main">=</span> <span class="bound">xs</span><span class="main">,</span>
      ListOp <span class="main">=</span> None<span class="main">,</span> Set <span class="main">=</span> <span class="bound">X</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">I</span> <span class="bound">D</span> <span class="bound">U</span> <span class="bound">x</span> <span class="bound">xs</span> <span class="bound">ys</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="bound">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="bound">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="bound">U</span><span class="main">,</span> List <span class="main">=</span> <span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">,</span>
      ListOp <span class="main">=</span> Some <span class="bound">ys</span><span class="main">,</span> Set <span class="main">=</span> <span class="bound">X</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">I</span> <span class="bound">D</span> <span class="bound">U</span> <span class="bound">ys</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="bound">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="bound">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="bound">U</span><span class="main">,</span> List <span class="main">=</span> <span class="main">[]</span><span class="main">,</span>
      ListOp <span class="main">=</span> Some <span class="bound">ys</span><span class="main">,</span> Set <span class="main">=</span> <span class="bound">X</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">Y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">yso</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list option"</span></span>
    <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"<span class="skolem">yso</span> <span class="main">=</span> None <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">x'</span> <span class="bound">xs'</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="bound">x'</span> <span class="main">#</span> <span class="bound">xs'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ys</span><span class="main">.</span> <span class="skolem">yso</span> <span class="main">=</span> Some <span class="bound">ys</span><span class="main">)</span> <span class="main">∨</span>
      <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ys</span><span class="main">.</span> <span class="skolem">yso</span> <span class="main">=</span> Some <span class="bound">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">yso</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> spec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> list.nchotomy<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

The length of the input event list of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_fail_aux_t_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> decreases in every
recursive call except for the first one, where the input list is left unchanged while the nested
output list passes from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some <span class="main"><span class="main">[]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. A measure function decreasing in the
first recursive call as well can then be obtained by increasing the length of the input list by one
in case the nested output list matches <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Using such a measure function, the termination
of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_fail_aux_t_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is guaranteed by the fact that the event lists output by
function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are not longer than the corresponding input ones.

\null
›</span></span>

<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">ipurge_fail_aux_t_aux</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> ListOp <span class="bound">Y</span> <span class="main">=</span> None <span class="keyword1">then</span> Suc <span class="keyword1">else</span> id<span class="main">)</span>
 <span class="main">(</span>length <span class="main">(</span>List <span class="bound">Y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">I</span> <span class="skolem">x</span> <span class="skolem">xs</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>ipurge_tr <span class="skolem">I</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≤</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_length<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>ipurge_tr <span class="skolem">I</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 2"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_fail_aux_t_in</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'d</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_in</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span>
  <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> ListOp <span class="main">=</span> None<span class="main">,</span> Set <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_fail_aux_t_out</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> <span class="tfree">'a</span> failure"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_out</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> ListOp <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="keyword1">of</span> Some <span class="bound">ys</span> <span class="main">⇒</span> <span class="bound">ys</span><span class="main">,</span> Set <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_fail_aux_t</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'d</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> failure"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span>
  ipurge_fail_aux_t_out <span class="main">(</span>ipurge_fail_aux_t_aux <span class="main">(</span>ipurge_fail_aux_t_in <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Since the significant inputs of function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_naive›</span></span></span></span> match pattern
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>_, _, _, _, None, _›</span></span></span></span>, those of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_fail_aux_t_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, as returned by
function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_fail_aux_t_in</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, match pattern
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⦇Pol = _, Map = _, Doms = _, List = _, ListOp = None, Set = _⦈›</span></span></span></span>.

Likewise, since the nested output lists returned by function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_fail_aux_t_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> match
pattern <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Some _›</span></span></span></span>, function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_fail_aux_t_out</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not need to worry about
dealing with nested output lists equal to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

In terms of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_fail_aux_t</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the statements to be proven in order to demonstrate
the target closure lemma, previously expressed using function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_naive›</span></span></span></span> and
henceforth respectively named <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_eq_tr›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_eq_ref›</span></span></span></span>, and
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_failures›</span></span></span></span>, take the following form:

\null

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"fst <span class="main"><span class="main">(</span></span>ipurge_fail_aux_t <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> <span class="free"><span class="free">X</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> ipurge_tr_aux <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

\null

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"snd <span class="main"><span class="main">(</span></span>ipurge_fail_aux_t <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> <span class="free"><span class="free">X</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> ipurge_ref_aux <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

\null

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⟦</span></span>secure <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span><span class="main"><span class="main">;</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">xs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">X</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> failures <span class="free"><span class="free">P</span></span><span class="main"><span class="main">⟧</span></span> <span class="main"><span class="main">⟹</span></span>
  ipurge_fail_aux_t <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> <span class="free"><span class="free">X</span></span> <span class="main"><span class="main">∈</span></span> failures <span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 3"</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">ipurge_fail_aux_t_set</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec set"</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="entity">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>

R0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">∈</span> <span class="free">ipurge_fail_aux_t_set</span> <span class="free">Y</span>"</span></span> <span class="main">|</span>

R1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span>
  ListOp <span class="main">=</span> None<span class="main">,</span> Set <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span> <span class="main">∈</span> <span class="free">ipurge_fail_aux_t_set</span> <span class="free">Y</span> <span class="main">⟹</span>
 <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span>
  ListOp <span class="main">=</span> Some <span class="main">[]</span><span class="main">,</span> Set <span class="main">=</span> ipurge_ref_aux <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span> <span class="main">∈</span> <span class="free">ipurge_fail_aux_t_set</span> <span class="free">Y</span>"</span></span> <span class="main">|</span>

R2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span>
  ListOp <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">,</span> Set <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span> <span class="main">∈</span> <span class="free">ipurge_fail_aux_t_set</span> <span class="free">Y</span><span class="main">;</span>
 <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">⟧</span> <span class="main">⟹</span>
 <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> ipurge_tr <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span>
  ListOp <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">,</span> Set <span class="main">=</span> ipurge_ref <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span> <span class="main">∈</span> <span class="free">ipurge_fail_aux_t_set</span> <span class="free">Y</span>"</span></span> <span class="main">|</span>

R3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span>
  ListOp <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">,</span> Set <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span> <span class="main">∈</span> <span class="free">ipurge_fail_aux_t_set</span> <span class="free">Y</span><span class="main">;</span>
 <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
 <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Doms <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> List <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span>
  ListOp <span class="main">=</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">,</span> Set <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⦈</span> <span class="main">∈</span> <span class="free">ipurge_fail_aux_t_set</span> <span class="free">Y</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 4"</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_subset"><span class="command">lemma</span></span> ipurge_fail_aux_t_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Z</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_set <span class="free">Z</span> <span class="main">⊆</span> ipurge_fail_aux_t_set <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> ipurge_fail_aux_t_set.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Z</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">U</span> <span class="skolem">xs</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="skolem">U</span><span class="main">,</span> List <span class="main">=</span> <span class="skolem">xs</span><span class="main">,</span>
    ListOp <span class="main">=</span> None<span class="main">,</span> Set <span class="main">=</span> <span class="skolem">X</span><span class="main">⦈</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="free">Y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="skolem">U</span><span class="main">,</span> List <span class="main">=</span> <span class="skolem">xs</span><span class="main">,</span>
    ListOp <span class="main">=</span> Some <span class="main">[]</span><span class="main">,</span> Set <span class="main">=</span> ipurge_ref_aux <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">U</span> <span class="main">[]</span> <span class="skolem">X</span><span class="main">⦈</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="free">Y</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">U</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="skolem">U</span><span class="main">,</span> List <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">,</span>
      ListOp <span class="main">=</span> Some <span class="skolem">ys</span><span class="main">,</span> Set <span class="main">=</span> <span class="skolem">X</span><span class="main">⦈</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="skolem">U</span><span class="main">,</span> List <span class="main">=</span> ipurge_tr <span class="skolem">I</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">,</span>
    ListOp <span class="main">=</span> Some <span class="skolem">ys</span><span class="main">,</span> Set <span class="main">=</span> ipurge_ref <span class="skolem">I</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="skolem">X</span><span class="main">⦈</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="free">Y</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">U</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="skolem">U</span><span class="main">,</span> List <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">,</span>
      ListOp <span class="main">=</span> Some <span class="skolem">ys</span><span class="main">,</span> Set <span class="main">=</span> <span class="skolem">X</span><span class="main">⦈</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="skolem">U</span><span class="main">,</span> List <span class="main">=</span> <span class="skolem">xs</span><span class="main">,</span>
    ListOp <span class="main">=</span> Some <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> Set <span class="main">=</span> <span class="skolem">X</span><span class="main">⦈</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="free">Y</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_aux_set"><span class="command">lemma</span></span> ipurge_fail_aux_t_aux_set<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_aux <span class="free">Y</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_aux.induct<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_aux.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">U</span> <span class="skolem">xs</span> <span class="skolem">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="skolem">U</span><span class="main">,</span> List <span class="main">=</span> <span class="skolem">xs</span><span class="main">,</span>
      ListOp <span class="main">=</span> None<span class="main">,</span> Set <span class="main">=</span> <span class="skolem">X</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?Y'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="skolem">U</span><span class="main">,</span> List <span class="main">=</span> <span class="skolem">xs</span><span class="main">,</span>
      ListOp <span class="main">=</span> Some <span class="main">[]</span><span class="main">,</span> Set <span class="main">=</span> ipurge_ref_aux <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">U</span> <span class="main">[]</span> <span class="skolem">X</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span> <span class="main">⟹</span>
    <span class="var">?Y'</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y'</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_set <span class="var">?Y'</span> <span class="main">⊆</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_aux <span class="var">?Y'</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y'</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_aux <span class="var">?Y'</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">U</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="skolem">U</span><span class="main">,</span> List <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">,</span>
      ListOp <span class="main">=</span> Some <span class="skolem">ys</span><span class="main">,</span> Set <span class="main">=</span> <span class="skolem">X</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?Y'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="skolem">U</span><span class="main">,</span> List <span class="main">=</span> ipurge_tr <span class="skolem">I</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">,</span>
      ListOp <span class="main">=</span> Some <span class="skolem">ys</span><span class="main">,</span> Set <span class="main">=</span> ipurge_ref <span class="skolem">I</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="skolem">X</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?Y''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="skolem">U</span><span class="main">,</span> List <span class="main">=</span> <span class="skolem">xs</span><span class="main">,</span>
      ListOp <span class="main">=</span> Some <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> Set <span class="main">=</span> <span class="skolem">X</span><span class="main">⦈</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span>
      ipurge_fail_aux_t_aux <span class="var">?Y'</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">I</span> <span class="main">⟹</span>
      ipurge_fail_aux_t_aux <span class="var">?Y''</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y''</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_aux <span class="var">?Y</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R0<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span>
      <span class="var">?Y'</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y'</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_set <span class="var">?Y'</span> <span class="main">⊆</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_aux <span class="var">?Y'</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y'</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_aux <span class="var">?Y'</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R0<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span> <span class="main">⟹</span>
      <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?Y''</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R3<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y''</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_set <span class="var">?Y''</span> <span class="main">⊆</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_aux <span class="var">?Y''</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y''</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_aux <span class="var">?Y''</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="var">?Y</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 5"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_fail_aux_t_inv_1</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'d</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_inv_1</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span>
  <span class="main">(</span><span class="keyword1">case</span> ListOp <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="main">[]</span> <span class="main">|</span> Some <span class="bound">ys</span> <span class="main">⇒</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">@</span> ipurge_tr_aux <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>List <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="main">=</span>
  ipurge_tr_aux <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_fail_aux_t_inv_2</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'d</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_inv_2</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span>
  <span class="keyword1">if</span> ListOp <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> None
  <span class="keyword1">then</span> List <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∧</span> Set <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>
  <span class="keyword1">else</span> ipurge_ref_aux_less <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span>List <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="main">=</span> ipurge_ref_aux <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_fail_aux_t_inv_3</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_inv_3</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span>
  secure <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">∈</span> failures <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">(</span><span class="keyword1">case</span> ListOp <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="main">[]</span> <span class="main">|</span> Some <span class="bound">ys</span> <span class="main">⇒</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">@</span> List <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">,</span> Set <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="main">∈</span> failures <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Three invariants have been defined, one for each of lemmas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_eq_tr›</span></span></span></span>,
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_eq_ref›</span></span></span></span>, and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_failures›</span></span></span></span>. More precisely, the
invariants are <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_1 <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_2 <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_3 <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">xs</span></span> <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
where the free variables are intended to match those appearing in the aforesaid lemmas.

Particularly:

\begin{itemize}

\item
The first invariant expresses the fact that in each recursive step, any item of the residual input
list <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"List <span class="free"><span class="free">Y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> indirectly affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> through the effect of previous, already
consumed items has already been removed from the list, so that applying function
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to the list is sufficient to obtain the intransitive purge of the
whole original list.

\item
The second invariant expresses the fact that in each recursive step, any item of the residual input
set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Set <span class="free"><span class="free">Y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> either directly, or through the effect of previous,
already consumed items, has already been removed from the set, so that applying function
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="main"><span class="main">(</span></span>List <span class="free"><span class="free">Y</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to the set is sufficient to obtain the intransitive
purge of the whole original set.
\\The use of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_ref_aux_less</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> ensures that the invariant implies the equality
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Set <span class="free"><span class="free">Y</span></span> <span class="main"><span class="main">=</span></span> ipurge_ref_aux <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"List <span class="free"><span class="free">Y</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">[]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, viz. for the output values of
function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_fail_aux_t_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which is the reason requiring the introduction of function
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_ref_aux_less</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\item
The third invariant expresses the fact that in each recursive step, the event list-event set pair
such that the list matches the concatenation of the partial output list with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"List <span class="free"><span class="free">Y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and
the set matches <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Set <span class="free"><span class="free">Y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, is a failure provided that the original input pair is such as well.

\end{itemize}
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 6"</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_input_1"><span class="command">lemma</span></span> ipurge_fail_aux_t_input_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span>
    <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="free">U</span><span class="main">,</span> List <span class="main">=</span> <span class="free">xs</span><span class="main">,</span> ListOp <span class="main">=</span> None<span class="main">,</span> Set <span class="main">=</span> <span class="free">X</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_inv_1_def<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_input_2"><span class="command">lemma</span></span> ipurge_fail_aux_t_input_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_2 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>
    <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="free">U</span><span class="main">,</span> List <span class="main">=</span> <span class="free">xs</span><span class="main">,</span> ListOp <span class="main">=</span> None<span class="main">,</span> Set <span class="main">=</span> <span class="free">X</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_inv_2_def<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_input_3"><span class="command">lemma</span></span> ipurge_fail_aux_t_input_3<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_3 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">xs</span> <span class="free">X</span>
    <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="free">U</span><span class="main">,</span> List <span class="main">=</span> <span class="free">xs</span><span class="main">,</span> ListOp <span class="main">=</span> None<span class="main">,</span> Set <span class="main">=</span> <span class="free">X</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_inv_3_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 7"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_fail_aux_t_form</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_fail_aux_t_form</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span>
  <span class="keyword1">case</span> ListOp <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> False <span class="main">|</span> Some <span class="bound">ys</span> <span class="main">⇒</span> List <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_intro_1"><span class="command">lemma</span></span> ipurge_fail_aux_t_intro_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>ipurge_fail_aux_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">Y</span><span class="main">;</span> ipurge_fail_aux_t_form <span class="free">Y</span><span class="main">⟧</span> <span class="main">⟹</span>
    fst <span class="main">(</span>ipurge_fail_aux_t_out <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_inv_1_def ipurge_fail_aux_t_form_def
 ipurge_fail_aux_t_out_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split_asm<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_intro_2"><span class="command">lemma</span></span> ipurge_fail_aux_t_intro_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>ipurge_fail_aux_t_inv_2 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span> <span class="free">Y</span><span class="main">;</span> ipurge_fail_aux_t_form <span class="free">Y</span><span class="main">⟧</span> <span class="main">⟹</span>
    snd <span class="main">(</span>ipurge_fail_aux_t_out <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_inv_2_def ipurge_fail_aux_t_form_def
 ipurge_fail_aux_t_out_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_aux_less_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split_asm<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_intro_3"><span class="command">lemma</span></span> ipurge_fail_aux_t_intro_3<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>ipurge_fail_aux_t_inv_3 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">xs</span> <span class="free">X</span> <span class="free">Y</span><span class="main">;</span> ipurge_fail_aux_t_form <span class="free">Y</span><span class="main">⟧</span> <span class="main">⟹</span>
    secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">⟶</span>
      ipurge_fail_aux_t_out <span class="free">Y</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_inv_3_def ipurge_fail_aux_t_form_def
 ipurge_fail_aux_t_out_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 8"</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_form_aux"><span class="command">lemma</span></span> ipurge_fail_aux_t_form_aux<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_form <span class="main">(</span>ipurge_fail_aux_t_aux <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_aux.induct<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_form_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 9"</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_invariance_aux"><span class="command">lemma</span></span> ipurge_fail_aux_t_invariance_aux<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">Z</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="free">Y</span> <span class="main">⟹</span>
  Pol <span class="free">Z</span> <span class="main">=</span> Pol <span class="free">Y</span> <span class="main">∧</span> Map <span class="free">Z</span> <span class="main">=</span> Map <span class="free">Y</span> <span class="main">∧</span> Doms <span class="free">Z</span> <span class="main">=</span> Doms <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> ipurge_fail_aux_t_set.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

The lemma just proven, stating the invariance of the first three record fields over inductive set
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_set <span class="free"><span class="free">Y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, is used in the following proofs of the invariance of predicates
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_1 <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_2 <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">U</span></span> <span class="free"><span class="free">xs</span></span> <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_3 <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">xs</span></span> <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

The equality between the free variables appearing in the predicates and the corresponding fields of
the record generating the set, which is required for such invariance properties to hold, is asserted
in the enunciation of the properties by means of record updates. In the subsequent proofs of lemmas
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_eq_tr›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_eq_ref›</span></span></span></span>, and
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_failures›</span></span></span></span>, the enforcement of this equality will be ensured by the
identification of both predicate variables and record fields with the related free variables
appearing in the lemmas.

\null
›</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_invariance_1"><span class="command">lemma</span></span> ipurge_fail_aux_t_invariance_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Z</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="main">(</span><span class="free">Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">:=</span> <span class="free">U</span><span class="main">⦈</span><span class="main">)</span><span class="main">;</span>
    ipurge_fail_aux_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">(</span><span class="free">Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">:=</span> <span class="free">U</span><span class="main">⦈</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
  ipurge_fail_aux_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">Z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> ipurge_fail_aux_t_set.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">drule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> ipurge_fail_aux_t_invariance_aux<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_inv_1_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs'</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span>"</span></span>
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">U</span><span class="main">)</span> <span class="skolem">xs'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs'</span><span class="main">)</span>"</span></span>
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs'</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span>"</span></span>
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">x</span> <span class="main">#</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs'</span>"</span></span>
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_invariance_2"><span class="command">lemma</span></span> ipurge_fail_aux_t_invariance_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Z</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="main">(</span><span class="free">Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">:=</span> <span class="free">U</span><span class="main">⦈</span><span class="main">)</span><span class="main">;</span>
    ipurge_fail_aux_t_inv_2 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">(</span><span class="free">Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">:=</span> <span class="free">U</span><span class="main">⦈</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
  ipurge_fail_aux_t_inv_2 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span> <span class="free">Z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> ipurge_fail_aux_t_set.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">drule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> ipurge_fail_aux_t_invariance_aux<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_inv_2_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">(</span>ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">[]</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span>
    ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_aux_less_nil<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs'</span> <span class="skolem">X'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="skolem">X'</span> <span class="main">=</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span>
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs'</span><span class="main">)</span>
    <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs'</span> <span class="skolem">X'</span><span class="main">)</span>"</span></span>
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_aux_less_cons_1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs'</span> <span class="skolem">X'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="skolem">X'</span> <span class="main">=</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span>
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> ipurge_ref_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs'</span> <span class="skolem">X'</span>"</span></span>
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_aux_less_cons_2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_invariance_3"><span class="command">lemma</span></span> ipurge_fail_aux_t_invariance_3<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Z</span> <span class="main">∈</span> ipurge_fail_aux_t_set <span class="main">(</span><span class="free">Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">⦈</span><span class="main">)</span><span class="main">;</span>
    ipurge_fail_aux_t_inv_3 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">(</span><span class="free">Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">⦈</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
  ipurge_fail_aux_t_inv_3 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">xs</span> <span class="free">X</span> <span class="free">Z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> ipurge_fail_aux_t_set.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">drule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> ipurge_fail_aux_t_invariance_aux<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_inv_3_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs'</span> <span class="skolem">X'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">xs'</span><span class="main">,</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs'</span><span class="main">,</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>Doms <span class="free">Y</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">X'</span> <span class="main">⊆</span> <span class="skolem">X'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_aux_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs'</span><span class="main">,</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>Doms <span class="free">Y</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs'</span> <span class="skolem">ys</span> <span class="skolem">X'</span>
  <span class="keyword3"><span class="command">assume</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs'</span><span class="main">,</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs'</span><span class="main">,</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs'</span><span class="main">,</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="skolem">ys</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs'</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs'</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="skolem">ys</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs'</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs'</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 10"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Here below are the proofs of lemmas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_eq_tr›</span></span></span></span>,
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_eq_ref›</span></span></span></span>, and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_fail_aux_t_failures›</span></span></span></span>, which are then applied to
demonstrate the target closure lemma.

\null
›</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_eq_tr"><span class="command">lemma</span></span> ipurge_fail_aux_t_eq_tr<span class="main">:</span>
 <span class="quoted"><span class="quoted">"fst <span class="main">(</span>ipurge_fail_aux_t <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="free">U</span><span class="main">,</span> List <span class="main">=</span> <span class="free">xs</span><span class="main">,</span> ListOp <span class="main">=</span> None<span class="main">,</span>
    Set <span class="main">=</span> <span class="free">X</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_aux <span class="var">?Y</span>
    <span class="main">∈</span> ipurge_fail_aux_t_set <span class="main">(</span><span class="var">?Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">:=</span> <span class="free">U</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_aux_set <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_aux.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">(</span><span class="var">?Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">:=</span> <span class="free">U</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_input_1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">(</span>ipurge_fail_aux_t_aux <span class="var">?Y</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_invariance_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_form <span class="main">(</span>ipurge_fail_aux_t_aux <span class="var">?Y</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_form_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>ipurge_fail_aux_t_out <span class="main">(</span>ipurge_fail_aux_t_aux <span class="var">?Y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_intro_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">=</span> ipurge_fail_aux_t_in <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_in_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_eq_ref"><span class="command">lemma</span></span> ipurge_fail_aux_t_eq_ref<span class="main">:</span>
 <span class="quoted"><span class="quoted">"snd <span class="main">(</span>ipurge_fail_aux_t <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="free">U</span><span class="main">,</span> List <span class="main">=</span> <span class="free">xs</span><span class="main">,</span> ListOp <span class="main">=</span> None<span class="main">,</span>
    Set <span class="main">=</span> <span class="free">X</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_aux <span class="var">?Y</span>
    <span class="main">∈</span> ipurge_fail_aux_t_set <span class="main">(</span><span class="var">?Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">:=</span> <span class="free">U</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_aux_set <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_aux.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_2 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">(</span><span class="var">?Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">:=</span> <span class="free">U</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_input_2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_2 <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">(</span>ipurge_fail_aux_t_aux <span class="var">?Y</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_invariance_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_form <span class="main">(</span>ipurge_fail_aux_t_aux <span class="var">?Y</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_form_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>ipurge_fail_aux_t_out <span class="main">(</span>ipurge_fail_aux_t_aux <span class="var">?Y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_intro_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">=</span> ipurge_fail_aux_t_in <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_in_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_fail_aux_t_failures"><span class="command">lemma</span></span> ipurge_fail_aux_t_failures <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">⟶</span>
    ipurge_fail_aux_t <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="free">D</span><span class="main">,</span> Doms <span class="main">=</span> <span class="free">U</span><span class="main">,</span> List <span class="main">=</span> <span class="free">xs</span><span class="main">,</span> ListOp <span class="main">=</span> None<span class="main">,</span>
    Set <span class="main">=</span> <span class="free">X</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_aux <span class="var">?Y</span>
    <span class="main">∈</span> ipurge_fail_aux_t_set <span class="main">(</span><span class="var">?Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_aux_set <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_aux.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_3 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">(</span><span class="var">?Y</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_input_3<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_inv_3 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">(</span>ipurge_fail_aux_t_aux <span class="var">?Y</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_invariance_3<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t_form <span class="main">(</span>ipurge_fail_aux_t_aux <span class="var">?Y</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_form_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">⟶</span>
    ipurge_fail_aux_t_out <span class="main">(</span>ipurge_fail_aux_t_aux <span class="var">?Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_fail_aux_t_intro_3<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">=</span> ipurge_fail_aux_t_in <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_in_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_ref_aux_failures"><span class="command">lemma</span></span> ipurge_tr_ref_aux_failures<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span><span class="main">;</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span>
    <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">,</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">drule</span> ipurge_fail_aux_t_failures <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> U <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">cases</span> <span class="quoted"><span class="quoted">"ipurge_fail_aux_t <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_fail_aux_t_eq_tr <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free">X</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
 ipurge_fail_aux_t_eq_ref <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Additional propaedeutic lemmas"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In what follows, additional lemmas required for the demonstration of the target security
conservation theorem are proven.

Here below is the proof of some properties of functions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_ref_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Particularly, it is shown that in case an event list and its intransitive
purge for some set of domains are both traces of a secure process, and the purged list has a future
not affected by any purged event, then that future is also a future for the full event list.

\null
›</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_aux_idem"><span class="command">lemma</span></span> ipurge_tr_aux_idem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux_union <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_aux_set"><span class="command">lemma</span></span> ipurge_tr_aux_set<span class="main">:</span>
 <span class="quoted"><span class="quoted">"set <span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_aux_nil"><span class="command">lemma</span></span> ipurge_tr_aux_nil <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x'</span> <span class="main">∈</span> set <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x'</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_aux_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_aux_del_failures"><span class="command">lemma</span></span> ipurge_tr_aux_del_failures <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">Z</span> <span class="main">∪</span> set <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">ys</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">⟶</span>
    <span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">zs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">ys</span> <span class="skolem">zs</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">zs</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">Z</span> <span class="main">∪</span> set <span class="bound">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="bound">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">⟶</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="bound">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">Z</span> <span class="main">∪</span> set <span class="skolem">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">Z</span> <span class="main">∪</span> set <span class="skolem">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">⟶</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_sinks_aux_less<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> insert <span class="main">(</span><span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">Z</span> <span class="main">∪</span> set <span class="skolem">zs</span><span class="main">.</span>
      <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_aux_less.simps if_True<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">Z</span> <span class="main">∪</span> set <span class="skolem">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> traces_failures<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">zs</span> <span class="free">Z</span><span class="main">)</span>
      <span class="main">∈</span> futures <span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">zs</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ipurge_tr_all<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">zs</span> <span class="free">Z</span> <span class="main">=</span> <span class="free">Z</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_all<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> E<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">Z</span> <span class="main">∪</span> set <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">)</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">⟶</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">)</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∪</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_sinks_aux_less<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">Z</span> <span class="main">∪</span> set <span class="skolem">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_aux_less.simps if_False<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux_less <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">Z</span> <span class="main">∪</span> set <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> E <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">)</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">⟶</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">)</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">)</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">)</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_aux_append"><span class="command">lemma</span></span> ipurge_ref_aux_append<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">X</span> <span class="main">=</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_aux_def sinks_aux_append<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_aux_empty"><span class="command">lemma</span></span> ipurge_ref_aux_empty <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equals0I<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_aux_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below is the proof of some properties of functions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sinks</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_ref</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Particularly, using the previous analogous result on function
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, it is shown that in case an event list and its intransitive purge for some
domain are both traces of a secure process, and the purged list has a future not affected by any
purged event, then that future is also a future for the full event list.

\null
›</span></span>

<span class="keyword1" id="Propaedeutics-sinks_idem"><span class="command">lemma</span></span> sinks_idem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sinks <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-sinks_elem"><span class="command">lemma</span></span> sinks_elem <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_append"><span class="command">lemma</span></span> ipurge_tr_append<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span>
  ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="free">u</span> <span class="main">(</span>sinks <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_single_dom <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
 ipurge_tr_aux_single_dom <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux_append<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_idem"><span class="command">lemma</span></span> ipurge_tr_idem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux_single_dom <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> ipurge_tr_aux_idem<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_set"><span class="command">lemma</span></span> ipurge_tr_set<span class="main">:</span>
 <span class="quoted"><span class="quoted">"set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux_single_dom <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> ipurge_tr_aux_set<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_del_failures"><span class="command">lemma</span></span> ipurge_tr_del_failures <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    S<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">Z</span> <span class="main">∪</span> set <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">ys</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_aux_del_failures <span class="main"><span class="main">[</span></span><span class="operator">OF</span> S _ _ C<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> U <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="free"><span class="free">u</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A sinks_aux_less_single_dom<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B ipurge_tr_aux_single_dom<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_tr_del_traces"><span class="command">lemma</span></span> ipurge_tr_del_traces <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    S<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">ys</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> set <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∉</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">ys</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> ipurge_tr_del_failures <span class="main"><span class="main">[</span></span><span class="operator">OF</span> S _ _ C<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> u <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> traces_failures <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_append"><span class="command">lemma</span></span> ipurge_ref_append<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">X</span> <span class="main">=</span>
  ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span>insert <span class="free">u</span> <span class="main">(</span>sinks <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_single_dom <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
 ipurge_ref_aux_single_dom <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_aux_append<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_distrib_inter"><span class="command">lemma</span></span> ipurge_ref_distrib_inter<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">(</span><span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">∩</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_distrib_union"><span class="command">lemma</span></span> ipurge_ref_distrib_union<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">∪</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_subset"><span class="command">lemma</span></span> ipurge_ref_subset<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ipurge_ref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_subset_union"><span class="command">lemma</span></span> ipurge_ref_subset_union<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∪</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_subset_insert"><span class="command">lemma</span></span> ipurge_ref_subset_insert<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> insert_def ipurge_ref_subset_union<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-ipurge_ref_empty"><span class="command">lemma</span></span> ipurge_ref_empty <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ipurge_ref_aux_single_dom <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> ipurge_ref_aux_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinks_aux_single_dom<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Finally, in what follows, properties <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">process_prop_1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">process_prop_5</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">process_prop_6</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of processes (cf. \cite{R2}) are put into the form of introduction rules.

\null
›</span></span>

<span class="keyword1" id="Propaedeutics-process_rule_1"><span class="command">lemma</span></span> process_rule_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failures_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_process <span class="free">P</span> <span class="main">∈</span> process_set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_process<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> fst <span class="var">?P'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_set_def process_prop_1_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-process_rule_5"><span class="command">lemma</span></span> process_rule_5 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> divergences <span class="free">P</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∈</span> divergences <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divergences_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_process <span class="free">P</span> <span class="main">∈</span> process_set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_process<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">∈</span> snd <span class="var">?P'</span> <span class="main">⟶</span> <span class="bound">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> snd <span class="var">?P'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_set_def process_prop_5_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> snd <span class="var">?P'</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∈</span> snd <span class="var">?P'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Propaedeutics-process_rule_6"><span class="command">lemma</span></span> process_rule_6 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> divergences <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failures_def divergences_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_process <span class="free">P</span> <span class="main">∈</span> process_set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_process<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">∈</span> snd <span class="var">?P'</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> fst <span class="var">?P'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_set_def process_prop_6_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> snd <span class="var">?P'</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> fst <span class="var">?P'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SequentialComposition">
<div class="head">
<h1>Theory SequentialComposition</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Conservation of CSP Noninterference Security under Sequential Composition
    Author:      Pasquale Noce
                 Security Certification Specialist at Arjo Systems, Italy
                 pasquale dot noce dot lavoro at gmail dot com
                 pasquale dot noce at arjosystems dot com
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Sequential composition and noninterference security"</span></span>

<span class="keyword1"><span class="command">theory</span></span> SequentialComposition
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Propaedeutics.html">Propaedeutics</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

This section formalizes the definitions of sequential processes and sequential composition given in
\cite{R4}, and then proves that under the assumptions discussed above, noninterference security is
conserved under sequential composition for any pair of processes sharing an alphabet that contains
successful termination. Finally, this result is generalized to an arbitrary list of processes.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Sequential processes"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In \cite{R4}, a \emph{sequential process} is defined as a process whose alphabet contains successful
termination. Since sequential composition applies to sequential processes, the first problem put by
the formalization of this operation is that of finding a suitable way to represent such a process.

A simple but effective strategy is to identify it with a process having alphabet <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span> option"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the native type of its ordinary (i.e. distinct from termination) events. Then,
ordinary events will be those matching pattern <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Some _›</span></span></span></span>, whereas successful termination will
be denoted by the special event <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This means that the \emph{sentences} of a sequential
process, defined in \cite{R4} as the traces after which the process can terminate successfully, will
be nothing but the event lists <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> such that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span>None<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a trace (which implies
that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a trace as well).

Once a suitable representation of successful termination has been found, the next step is to
formalize the properties of sequential processes related to this event, expressing them in terms of
the selected representation. The first of the resulting predicates, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>weakly_sequential›</span></span></span></span>, is
the minimum required for allowing the identification of event <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with successful
termination, namely that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may occur in a trace as its last event only. The second
predicate, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sequential›</span></span></span></span>, following what Hoare does in \cite{R4}, extends the first predicate
with an additional requirement, namely that whenever the process can engage in event <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
it cannot engage in any other event. A simple counterexample shows that this requirement does not
imply the first one: a process whose traces are <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">[]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span>None<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">[</span></span>None<span class="main"><span class="main">,</span></span> None<span class="main"><span class="main">]</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> satisfies the
second requirement, but not the first one.

Moreover, here below is the definition of a further predicate, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>secure_termination›</span></span></span></span>, which
applies to a security policy rather than to a process, and is satisfied just in case the policy does
not allow event <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to be affected by confidential events, viz. by ordinary events not
allowed to affect some event in the alphabet. Interestingly, this property, which will prove to be
necessary for the target theorem to hold, is nothing but the CSP counterpart of a condition required
for a security type system to enforce termination-sensitive noninterference security of programs,
namely that program termination must not depend on confidential data (cf. \cite{R5}, section 9.2.6).

\null
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sentences</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option process <span class="main">⇒</span> <span class="tfree">'a</span> option list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sentences</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">weakly_sequential</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option process <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">weakly_sequential</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span>
  <span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">.</span> None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="bound">xs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sequential</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option process <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sequential</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">.</span> None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> sentences <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">.</span> next_events <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">{</span>None<span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">secure_termination</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">secure_termination</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≡</span>
  <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="bound">x</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> None<span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="bound">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below is the proof of some useful lemmas involving the constants just defined. Particularly, it
is proven that process sequentiality is indeed stronger than weak sequentiality, and a sentence of a
refusals union closed (cf. \cite{R3}), sequential process admits the set of all the ordinary events
of the process as a refusal. The use of the latter lemma in the proof of the target security
conservation theorem is the reason why the theorem requires to assume that the first of the
processes to be composed be refusals union closed (cf. below).

\null
›</span></span>

<span class="keyword1" id="SequentialComposition-seq_implies_weakly_seq"><span class="command">lemma</span></span> seq_implies_weakly_seq<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sequential <span class="free">P</span> <span class="main">⟹</span> weakly_sequential <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weakly_sequential_def sequential_def<span class="main">)</span>

<span class="keyword1" id="SequentialComposition-weakly_seq_sentences_none"><span class="command">lemma</span></span> weakly_seq_sentences_none<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    WS<span class="main">:</span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span><span class="main">.</span> None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="bound">xs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> WS <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weakly_sequential_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_sentences_none"><span class="command">lemma</span></span> seq_sentences_none<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    S<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> None"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> sentences <span class="free">P</span><span class="main">.</span> next_events <span class="free">P</span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">{</span>None<span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequential_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"next_events <span class="free">P</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">{</span>None<span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> next_events <span class="free">P</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_events_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_sentences_ref"><span class="command">lemma</span></span> seq_sentences_ref<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="var">?X</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> singleton_set <span class="var">?X</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> singleton_set <span class="var">?X</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> singleton_set <span class="var">?X</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ref_union_closed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?X</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> singleton_set <span class="var">?X</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> singleton_set_some<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> singleton_set <span class="var">?X</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> singleton_set <span class="var">?X</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> singleton_set <span class="var">?X</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> singleton_set_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> not_None_eq<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> None"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> traces_failures<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_4<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> None"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_none<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> singleton_set <span class="var">?X</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> singleton_set_union<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Sequential composition"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In what follows, the definition of the failures resulting from the sequential composition of two
processes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> given in \cite{R4} is formalized as the inductive definition of set
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>seq_comp_failures P Q›</span></span></span></span>. Then, the sequential composition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
denoted by means of notation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P ; Q›</span></span></span></span> following \cite{R4}, is defined as the process having
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>seq_comp_failures P Q›</span></span></span></span> as failures set and the empty set as divergences set.

For the sake of generality, this definition is based on the mere implicit assumption that the input
processes be weakly sequential, rather than sequential. This slightly complicates things, since the
sentences of process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may number further events in addition to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in their
future.

Therefore, the resulting refusals of a sentence <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> will have the form
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"insert None <span class="free"><span class="free">X</span></span> <span class="main"><span class="main">∩</span></span> <span class="free"><span class="free">Y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a refusal of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Y</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
is an initial refusal of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (cf. rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SCF_R2›</span></span></span></span>). In fact, after <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, process
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P ; Q›</span></span></span></span> must be able to refuse <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is, whereas it cannot refuse an
ordinary event unless both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, in their respective states, can.

Moreover, a trace <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P ; Q›</span></span></span></span> may result from different combinations of a sentence
of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with a trace of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Thus, in order that the refusals of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P ; Q›</span></span></span></span> be
closed under set union, the union of any two refusals of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> must still be a refusal (cf.
rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SCF_R4›</span></span></span></span>). Indeed, this property will prove to be sufficient to ensure that for any two
processes whose refusals are closed under set union, their sequential composition still be such,
which is what is expected for any process of practical significance (cf. \cite{R3}).

According to the definition given in \cite{R4}, a divergence of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P ; Q›</span></span></span></span> is either a
divergence of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, or the concatenation of a sentence of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with a divergence of
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Apparently, this definition does not match the formal one stated here below, which
identifies the divergences set of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P ; Q›</span></span></span></span> with the empty set. Nonetheless, as remarked
above, sequential composition does not make sense unless the input processes are weakly sequential,
since this is the minimum required to confer the meaning of successful termination on the
corresponding alphabet symbol. But a weakly sequential process cannot have any divergence, so that
the two definitions are actually equivalent. In fact, a divergence is a trace such that, however it
is extended with arbitrary additional events, the resulting event list is still a trace (cf. process
properties <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">process_prop_5</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">process_prop_6</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in \cite{R2}). Therefore, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
were a divergence, then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span>None<span class="main"><span class="main">,</span></span> None<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> would be a trace, which is impossible in case
the process satisfies predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">weakly_sequential</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">seq_comp_failures</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option process <span class="main">⇒</span> <span class="tfree">'a</span> option process <span class="main">⇒</span> <span class="tfree">'a</span> option failure set"</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="entity">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option process"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option process"</span></span> <span class="keyword2"><span class="keyword">where</span></span>

SCF_R1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∉</span> sentences <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span><span class="main">;</span> None <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">seq_comp_failures</span> <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="main">|</span>

SCF_R2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∈</span> sentences <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> insert None <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">seq_comp_failures</span> <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="main">|</span>

SCF_R3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∈</span> sentences <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">seq_comp_failures</span> <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="main">|</span>

SCF_R4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">seq_comp_failures</span> <span class="free">P</span> <span class="free">Q</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">seq_comp_failures</span> <span class="free">P</span> <span class="free">Q</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">seq_comp_failures</span> <span class="free">P</span> <span class="free">Q</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">seq_comp</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option process <span class="main">⇒</span> <span class="tfree">'a</span> option process <span class="main">⇒</span> <span class="tfree">'a</span> option process"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">;</span>"</span> 60<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">;</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> Abs_process <span class="main">(</span>seq_comp_failures <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below is the proof that, for any two processes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> defined over the same
alphabet containing successful termination, set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"seq_comp_failures <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">Q</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> indeed enjoys the
characteristic properties of the failures set of a process as defined in \cite{R2} provided that
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is weakly sequential, which is what happens in any meaningful case.

\null
›</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_prop_1"><span class="command">lemma</span></span> seq_comp_prop_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">[]</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{</span>None<span class="main">}</span> <span class="main">∩</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_prop_2_aux"><span class="command">lemma</span></span> seq_comp_prop_2_aux <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> WS<span class="main">:</span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ws</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">⟹</span>
    <span class="free">ws</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> seq_comp_failures.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X'</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> A' <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_1<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword2"><span class="keyword">and</span></span> A' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{</span>None<span class="main">}</span> <span class="main">∩</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X'</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span><span class="main">.</span> None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="bound">xs</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> WS <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weakly_sequential_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword2"><span class="keyword">and</span></span> A' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_1<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword2"><span class="keyword">and</span></span> A' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{</span>None<span class="main">}</span> <span class="main">∩</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs'</span> <span class="skolem">ys</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="bound">ys'</span><span class="main">.</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="bound">ys'</span> <span class="main">@</span> <span class="main">[</span><span class="bound">y</span><span class="main">]</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> D'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">ys'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">ys'</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs'</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> traces_failures<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_1<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs'</span><span class="main">,</span> <span class="main">{</span>None<span class="main">}</span> <span class="main">∩</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs'</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> C'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys'</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">ys'</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_prop_2"><span class="command">lemma</span></span> seq_comp_prop_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> WS<span class="main">:</span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> seq_comp_prop_2_aux <span class="main"><span class="main">[</span></span><span class="operator">OF</span> WS<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="SequentialComposition-seq_comp_prop_3"><span class="command">lemma</span></span> seq_comp_prop_3 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> seq_comp_failures.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">Z</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">⊆</span> insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">-</span> <span class="main">{</span>None<span class="main">}</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">Z</span> <span class="main">-</span> <span class="main">{</span>None<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert None <span class="main">(</span><span class="skolem">Z</span> <span class="main">-</span> <span class="main">{</span>None<span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert None <span class="main">(</span><span class="skolem">Z</span> <span class="main">-</span> <span class="main">{</span>None<span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">Z</span> <span class="main">=</span> <span class="skolem">Z</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">Z</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">∩</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">Z</span> <span class="main">∩</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">Z</span> <span class="main">∩</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">∩</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">Z</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">Z</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">Z</span> <span class="main">∩</span> <span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Z</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R4<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">Z</span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_Un_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Z</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Int_absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_prop_4"><span class="command">lemma</span></span> seq_comp_prop_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> WS<span class="main">:</span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">∨</span>
    <span class="main">(</span><span class="free">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> seq_comp_failures.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
    <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">∨</span>
    <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"None <span class="main">=</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
         <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_1<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{</span>None<span class="main">}</span> <span class="main">∩</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">∨</span>
    <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="main">(</span>insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> None"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∨</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> insert None <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_4<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">∨</span>
      <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert None <span class="main">(</span>insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>None<span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> insert None <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert None <span class="skolem">X</span> <span class="main">∩</span> insert None <span class="skolem">Y</span><span class="main">)</span>
        <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert None <span class="skolem">X</span> <span class="main">∩</span> insert None <span class="skolem">Y</span> <span class="main">=</span>
        insert None <span class="main">(</span>insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert None <span class="main">(</span>insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_4<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span>
        D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> WS <span class="keyword2"><span class="keyword">and</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> not_None_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> D <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_1<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{</span>None<span class="main">}</span> <span class="main">∩</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∨</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_4<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert None <span class="main">(</span>insert <span class="free">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∩</span> insert <span class="free">x</span> <span class="skolem">Y</span><span class="main">)</span>
          <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert None <span class="main">(</span>insert <span class="free">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∩</span> insert <span class="free">x</span> <span class="skolem">Y</span> <span class="main">=</span>
          insert <span class="free">x</span> <span class="main">(</span>insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="main">(</span>insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">∨</span>
    <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">∨</span>
      <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">∨</span>
      <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">∨</span>
    <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="skolem">X</span> <span class="main">∪</span> insert <span class="free">x</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R4<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> insert <span class="free">x</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_rep"><span class="command">lemma</span></span> seq_comp_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> WS<span class="main">:</span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Rep_process <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> seq_comp_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Abs_process_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_set_def<span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="operator">subst</span> conj_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"process_prop_1 <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_prop_1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_prop_1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"process_prop_2 <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_prop_2_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> all_simps<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_prop_2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> WS<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"process_prop_3 <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_prop_3_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> all_simps<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_prop_3<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"process_prop_4 <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_prop_4_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_prop_4 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> WS<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"process_prop_5 <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_prop_5_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"process_prop_6 <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_prop_6_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below, the previous result is applied to derive useful expressions for the outputs of the
functions returning the elements of a process, as defined in \cite{R2} and \cite{R3}, when acting on
the sequential composition of a pair of processes.

\null
›</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_failures"><span class="command">lemma</span></span> seq_comp_failures<span class="main">:</span>
 <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span> <span class="main">⟹</span>
    failures <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> seq_comp_rep <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failures_def<span class="main">)</span>

<span class="keyword1" id="SequentialComposition-seq_comp_divergences"><span class="command">lemma</span></span> seq_comp_divergences<span class="main">:</span>
 <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span> <span class="main">⟹</span>
    divergences <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> seq_comp_rep <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divergences_def<span class="main">)</span>

<span class="keyword1" id="SequentialComposition-seq_comp_futures"><span class="command">lemma</span></span> seq_comp_futures<span class="main">:</span>
 <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span> <span class="main">⟹</span>
    futures <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">ys</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="bound">ys</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def seq_comp_failures<span class="main">)</span>

<span class="keyword1" id="SequentialComposition-seq_comp_traces"><span class="command">lemma</span></span> seq_comp_traces<span class="main">:</span>
 <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span> <span class="main">⟹</span>
    traces <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> Domain <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> traces_def seq_comp_failures<span class="main">)</span>

<span class="keyword1" id="SequentialComposition-seq_comp_refusals"><span class="command">lemma</span></span> seq_comp_refusals<span class="main">:</span>
 <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span> <span class="main">⟹</span>
    refusals <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span> <span class="free">xs</span> <span class="main">≡</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">``</span> <span class="main">{</span><span class="free">xs</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> refusals_def seq_comp_failures<span class="main">)</span>

<span class="keyword1" id="SequentialComposition-seq_comp_next_events"><span class="command">lemma</span></span> seq_comp_next_events<span class="main">:</span>
 <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span> <span class="main">⟹</span>
    next_events <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> Domain <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_events_def seq_comp_traces<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Conservation of refusals union closure and sequentiality under sequential composition"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Here below is the proof that, for any two processes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and any failure
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">xs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">X</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">;</span></span> <span class="free"><span class="free">Q</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the refusal <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the union of a set of refusals where,
for any such refusal <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">W</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">xs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">W</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a failure of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">;</span></span> <span class="free"><span class="free">Q</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> by virtue of one
of rules <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SCF_R1›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SCF_R2›</span></span></span></span>, or <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SCF_R3›</span></span></span></span>.

The converse is also proven, under the assumption that the refusals of both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
be closed under union: namely, for any trace <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">;</span></span> <span class="free"><span class="free">Q</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and any set of refusals
where, for any such refusal <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">W</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">xs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">W</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a failure of the aforesaid kind, the
union of these refusals is still a refusal of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

The proof of the latter lemma makes use of the axiom of choice.

\null
›</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_refusals_1"><span class="command">lemma</span></span> seq_comp_refusals_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">R</span><span class="main">.</span>
    <span class="free">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="free">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">0</span><span class="main">.</span>
      <span class="free">xs</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
      <span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
        <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="free">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span>
      take <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="free">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span> <span class="free">xs</span> <span class="free">X</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> seq_comp_failures.induct<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span> <span class="skolem">xs</span> <span class="skolem">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">X</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A B C<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span>
      <span class="main">∃</span><span class="bound">W</span> <span class="main">∈</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">X</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">W</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span> <span class="skolem">xs</span> <span class="main">(</span>insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span>insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span>
      <span class="main">∃</span><span class="bound">W</span> <span class="main">∈</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span>insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">W</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> None <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
      insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span> <span class="skolem">Y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> length <span class="skolem">ys</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">Y</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A B C<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span> <span class="main">+</span> length <span class="skolem">ys</span><span class="main">}</span><span class="main">.</span>
      <span class="main">∃</span><span class="bound">W</span> <span class="main">∈</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> length <span class="skolem">ys</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">Y</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">W</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">Rx</span> <span class="skolem">Ry</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">Rx</span> <span class="skolem">xs</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">Ry</span> <span class="skolem">xs</span> <span class="skolem">Y</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span> <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">Rx</span> <span class="bound">n</span> <span class="main">∪</span> <span class="skolem">Ry</span> <span class="bound">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">≤</span> length <span class="skolem">xs</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∪</span>
      <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">≤</span> length <span class="skolem">xs</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Ry</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">≤</span> length <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Ry</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">≤</span> length <span class="skolem">xs</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="bound">n</span> <span class="main">∪</span> <span class="skolem">Ry</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">≤</span> length <span class="skolem">xs</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="bound">n</span> <span class="main">∪</span> <span class="skolem">Ry</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">W</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="main">0</span> <span class="main">∪</span> <span class="skolem">Ry</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span>
     <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="skolem">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
      <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
        <span class="skolem">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T'</span> <span class="skolem">W</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="main">0</span><span class="main">.</span> <span class="var">?T'</span> <span class="bound">W</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Ry</span> <span class="main">0</span><span class="main">.</span> <span class="var">?T'</span> <span class="bound">W</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">Ry</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">W</span>
    <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="skolem">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="skolem">Ry</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span>
     <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T'</span> <span class="skolem">n</span> <span class="skolem">W</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?T'</span> <span class="bound">n</span> <span class="bound">W</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="skolem">n</span><span class="main">.</span> <span class="var">?T'</span> <span class="skolem">n</span> <span class="bound">W</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Ry</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?T'</span> <span class="bound">n</span> <span class="bound">W</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Ry</span> <span class="skolem">n</span><span class="main">.</span> <span class="var">?T'</span> <span class="skolem">n</span> <span class="bound">W</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">Ry</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="bound">n</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="skolem">n</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="skolem">Ry</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="skolem">Ry</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">Rx</span> <span class="bound">n</span> <span class="main">∪</span> <span class="skolem">Ry</span> <span class="bound">n</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_refusals_finite"><span class="command">lemma</span></span> seq_comp_refusals_finite <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> Domain <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> finite_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Domain_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_prop_3<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x'</span> <span class="skolem">A</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> insert <span class="skolem">x'</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">F</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">F</span> <span class="skolem">x'</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> insert <span class="skolem">x'</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_refusals_2"><span class="command">lemma</span></span> seq_comp_refusals_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> Domain <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="free">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span>
        <span class="free">xs</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
        <span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
          <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="free">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">n</span><span class="main">.</span>
        take <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
        <span class="main">(</span>drop <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Domain_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_prop_3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span>
      F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> None <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> G<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ref_union_closed_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword2"><span class="keyword">and</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span>
      F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
      <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">F</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
      <span class="bound">W</span> <span class="main">=</span> insert None <span class="main">(</span><span class="bound">F</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∩</span> <span class="bound">V</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bchoice<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span>
      <span class="main">∃</span><span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="skolem">F</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
        <span class="bound">W</span> <span class="main">=</span> insert None <span class="main">(</span><span class="skolem">F</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∩</span> <span class="bound">V</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="skolem">F</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">G</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
      <span class="bound">W</span> <span class="main">=</span> insert None <span class="main">(</span><span class="skolem">F</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∩</span> <span class="bound">G</span> <span class="bound">W</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bchoice<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span>
      <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="skolem">F</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">G</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
        <span class="bound">W</span> <span class="main">=</span> insert None <span class="main">(</span><span class="skolem">F</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">G</span> <span class="bound">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> insert None <span class="main">(</span><span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="skolem">F</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="skolem">G</span> <span class="bound">W</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="var">?S</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> G<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ref_union_closed_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">`</span> <span class="free">R</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">`</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">`</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⟶</span> <span class="var">?B</span> <span class="main">⟶</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">`</span> <span class="free">R</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">W</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⟶</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> bexE<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">W</span> <span class="skolem">X</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="skolem">F</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="skolem">F</span> <span class="skolem">W</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="skolem">F</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Y</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">Y</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ref_union_closed_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">`</span> <span class="free">R</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Y</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">`</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">Y</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">`</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⟶</span> <span class="var">?B</span> <span class="main">⟶</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">`</span> <span class="free">R</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="skolem">W</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⟶</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> bexE<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">W</span> <span class="skolem">Y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">G</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="skolem">G</span> <span class="skolem">W</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="skolem">G</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> bexE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">W</span>
      <span class="keyword3"><span class="command">assume</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">=</span> insert None <span class="main">(</span><span class="skolem">F</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">G</span> <span class="skolem">W</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">W</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert None <span class="main">(</span><span class="skolem">F</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">G</span> <span class="skolem">W</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> None <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="bound">W</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="bound">W</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∧</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IntE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> None <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="skolem">W</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> None"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="skolem">W</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">0</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="bound">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="skolem">W</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_prop_3<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="free">xs</span><span class="main">}</span><span class="main">.</span>
    <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="free">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">n</span><span class="main">.</span>
      take <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>take <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span> <span class="main">@</span> drop <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span>
        <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ref_union_closed_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">n</span><span class="main">.</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="main">(</span>drop <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>drop <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> G <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">arith</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="free">xs</span><span class="main">}</span><span class="main">.</span>
    <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="free">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_refusals_finite <span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="free">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> F <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="free">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

In what follows, the previous results are used to prove that refusals union closure, weak
sequentiality, and sequentiality are conserved under sequential composition. The proof of the first
of these lemmas makes use of the axiom of choice.

Since the target security conservation theorem, in addition to the security of both of the processes
to be composed, also requires to assume that the first process be refusals union closed and
sequential (cf. below), these further conservation lemmas will permit to generalize the theorem to
the sequential composition of an arbitrary list of processes.

\null
›</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_ref_union_closed"><span class="command">lemma</span></span> seq_comp_ref_union_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    WS<span class="main">:</span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ref_union_closed_def seq_comp_failures <span class="main"><span class="main">[</span></span><span class="operator">OF</span> WS<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">A</span> <span class="skolem">X'</span>
  <span class="keyword3"><span class="command">assume</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">.</span>
    <span class="bound">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">0</span><span class="main">.</span>
      <span class="skolem">xs</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="skolem">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
      <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
        <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span>
      take <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span> <span class="bound">X</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">0</span><span class="main">.</span>
        <span class="skolem">xs</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="skolem">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
        <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
          <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span>
        take <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
        <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_refusals_1<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span> <span class="skolem">X</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="var">?T</span> <span class="main">(</span><span class="bound">R</span> <span class="bound">X</span><span class="main">)</span> <span class="bound">X</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bchoice<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="var">?T</span> <span class="main">(</span><span class="skolem">R</span> <span class="bound">X</span><span class="main">)</span> <span class="bound">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> Domain <span class="main">(</span>seq_comp_failures <span class="free">P</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Domain_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">X</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">X</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">erule</span> bexE<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> bexE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">X</span>
      <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">W</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">X</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">W</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">X</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">W</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">n</span> <span class="skolem">X</span> <span class="skolem">W</span>
      <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="skolem">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> G<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">X</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">X</span> <span class="main">0</span><span class="main">.</span>
      <span class="skolem">xs</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="skolem">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
      <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
        <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">W</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> UN_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> bexE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">W</span> <span class="skolem">X</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="main">0</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">W</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">X</span> <span class="bound">n</span><span class="main">.</span>
      take <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">n</span> <span class="bound">W</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> UN_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> bexE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">W</span> <span class="skolem">X</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">n</span> <span class="bound">W</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="skolem">xs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="skolem">n</span><span class="main">.</span> <span class="var">?T</span> <span class="skolem">n</span> <span class="bound">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">n</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">X</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_refusals_2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_weakly_sequential"><span class="command">lemma</span></span> seq_comp_weakly_sequential<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> weakly_sequential_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> traces_failures<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> seq_comp_failures <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> seq_comp_failures.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option list"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_set_butlastD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_set_butlastD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">Q</span><span class="main">.</span> None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="bound">xs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weakly_sequential_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> butlast <span class="skolem">ys</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> butlast <span class="skolem">ys</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> butlast_append<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_sequential"><span class="command">lemma</span></span> seq_comp_sequential<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sequential <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sequential_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_weakly_sequential<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span><span class="main">.</span> None <span class="main">∉</span> set <span class="main">(</span>butlast <span class="bound">xs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weakly_sequential_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> sentences <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span><span class="main">.</span> next_events <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">{</span>None<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def next_events_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">drule</span> traces_failures<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_comp_failures <span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span>
      D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">0</span><span class="main">.</span>
        <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span>
          None <span class="main">∉</span> set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
        <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
            <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span>
        take <span class="main">(</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
        <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_refusals_1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">n</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equals0I<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">W</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{..</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">assume</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∉</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equals0D<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span>
     <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">≤</span> length <span class="skolem">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">arith</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span>
     <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">0</span><span class="main">.</span>
        <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span>
          None <span class="main">∉</span> set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
        <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
            <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span>
        take <span class="main">(</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
        <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_refusals_1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R'</span></span> <span class="keyword2"><span class="keyword">where</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">R'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R'</span> <span class="bound">n</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> <span class="main">{..</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R'</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">n'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> None"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R'</span> <span class="main">0</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W'</span> <span class="main">∈</span> <span class="skolem">R'</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span>
       <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span>
          None <span class="main">∉</span> set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
        <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
            <span class="skolem">W'</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
       <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span> None <span class="main">≠</span> <span class="skolem">x</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span>
        drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> append_take_drop_id<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span>
        drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="bound">ys</span><span class="main">.</span> drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">ys</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> M <span class="keyword2"><span class="keyword">and</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> None"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_none <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> None"</span></span>
       <span class="keyword1"><span class="command">using</span></span> M <span class="keyword2"><span class="keyword">and</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W'</span> <span class="main">∈</span> <span class="skolem">R'</span> <span class="skolem">n'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
        <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="skolem">W'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span> <span class="main">≤</span> length <span class="skolem">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">arith</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> O<span class="main">:</span>
       <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
        <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span>
          take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">@</span>
          drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> append_take_drop_id<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
          take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span>
          drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
          take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span>
          take <span class="main">(</span><span class="skolem">n'</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> drop_take<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span>
          take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span>
          take <span class="main">(</span><span class="skolem">n'</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">n'</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
           <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> M <span class="keyword2"><span class="keyword">and</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="bound">ys</span><span class="main">.</span> take <span class="main">(</span><span class="skolem">n'</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">ys</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">n'</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span>
         <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">n'</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span>
          take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> None"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_none <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> None"</span></span>
         <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span>
          take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">@</span>
          drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> append_take_drop_id<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
          take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span>
          drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
          take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span>
          take <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> drop_take<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span>
          take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span>
          take <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
           <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> G <span class="keyword2"><span class="keyword">and</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="bound">ys</span><span class="main">.</span> take <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">ys</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span>
         <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span>
          take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> None"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_none <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> None"</span></span>
         <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W'</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> sentences <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> B <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_none<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Conservation of noninterference security under sequential composition"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Everything is now ready for proving the target security conservation theorem. The two closure
properties that the definition of noninterference security requires process futures to satisfy, one
for the addition of events into traces and the other for the deletion of events from traces (cf.
\cite{R2}), will be faced separately; here below is the proof of the former property.
Unsurprisingly, rule induction on set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">seq_comp_failures</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is applied, and the closure of the
failures of a secure process under intransitive purge (proven in the previous section) is used to
meet the proof obligations arising from rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SCF_R3›</span></span></span></span>.

\null
›</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_secure_aux_1_case_1"><span class="command">lemma</span></span> seq_comp_secure_aux_1_case_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    H<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span>
    futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span>
    failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> I
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F G<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">ys</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_set<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span>
      J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> K<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> bexE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> F <span class="keyword2"><span class="keyword">and</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span>
        L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y'</span> <span class="main">∈</span> set <span class="free">ys</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">y'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_elem<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> None"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="free">ys</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
         <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">u</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">y'</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="skolem">y'</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">y'</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> M <span class="keyword2"><span class="keyword">and</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_1<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> J <span class="keyword2"><span class="keyword">and</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span>
        insert None <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span>
      J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append_assoc<span class="main"><span class="keyword3">,</span></span>
     <span class="operator">rule</span> ipurge_tr_del_traces <span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> u <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> traces_failures<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span>
        ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ipurge_tr.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>
        <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def ipurge_ref_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_idem<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> None <span class="main">∉</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_interference_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span>
        <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_idem<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_secure_aux_1_case_2"><span class="command">lemma</span></span> seq_comp_secure_aux_1_case_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">Q</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span>
    ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">(</span>insert None <span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span><span class="main">)</span>
    <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span><span class="main">)</span>
    <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> J <span class="keyword2"><span class="keyword">and</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span>
      insert None <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">(</span>insert None <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span> <span class="main">⊆</span>
      insert None <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> insert_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">(</span>insert None <span class="free">X</span><span class="main">)</span> <span class="main">⊆</span>
        insert None <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_subset_insert<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">(</span>insert None <span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert None <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span>
      ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">(</span>insert None <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_prop_3<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_distrib_inter<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span>
      J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">(</span>insert None <span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> K<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> bexE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> None"</span></span>
         <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span>
        L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y'</span> <span class="main">∈</span> set <span class="free">ys</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">y'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_elem<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> None"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="free">ys</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">ys</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">u</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">y'</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="skolem">y'</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">y'</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> M <span class="keyword2"><span class="keyword">and</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y'</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> J <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> I
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">ys</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_set<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">ys</span>"</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span>
      J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> traces_failures<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span>
      ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="var">?Y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ipurge_tr.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="var">?Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> None <span class="main">∉</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_interference_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_secure_aux_1_case_3"><span class="command">lemma</span></span> seq_comp_secure_aux_1_case_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">Q</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">R</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">∈</span> sentences <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ys'</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">@</span> <span class="free">ys'</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">Q</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&lt;</span> length <span class="free">ws</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys'</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">ys'</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?ws'</span> <span class="main">@</span> <span class="main">_</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">=</span>
    ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_append<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span> <span class="main">=</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="free">Y</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_append<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">∈</span> sentences <span class="free">Q</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">∈</span> sentences <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span><span class="main">,</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">R</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_ref_aux_failures<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span><span class="main">,</span>
      ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">Q</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">,</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_ref<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">R</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> K <span class="keyword2"><span class="keyword">and</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">,</span>
        insert None <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">}</span> <span class="main">∩</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="free">Y</span><span class="main">)</span>
        <span class="main">∈</span> seq_comp_failures <span class="free">Q</span> <span class="free">R</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> J<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert None <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">}</span> <span class="main">∩</span>
        ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="free">Y</span> <span class="main">=</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="free">Y</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Cons
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> J <span class="keyword2"><span class="keyword">and</span></span> K <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">)</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span><span class="main">,</span>
          ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">Q</span> <span class="free">R</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">∉</span> sentences <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">=</span> take <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="var">?ws'</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys'</span><span class="main">)</span> <span class="main">=</span>
      take <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">ws</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="var">?ws'</span> <span class="main">∈</span> sentences <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> traces_failures<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="free">xs</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span>
      ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="free">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ipurge_tr.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def ipurge_ref_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="var">?ws'</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span><span class="main">,</span>
      ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">Q</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> M<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> bexE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_aux_nil <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> None"</span></span>
           <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
        <span class="keyword3"><span class="command">assume</span></span>
          O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> set <span class="var">?ws'</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">w</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_elem<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="var">?ws'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> None"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> None"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="var">?ws'</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="var">?ws'</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_aux_nil <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">u</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> O<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> P <span class="keyword2"><span class="keyword">and</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span> <span class="free">Y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> M<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> bexE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_aux_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?U</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_aux_subset<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">y</span> <span class="main">∈</span> <span class="var">?U</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">y</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> None"</span></span>
           <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
        <span class="keyword3"><span class="command">assume</span></span>
          O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> set <span class="var">?ws'</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">w</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_elem<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="var">?ws'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> None"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> None"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="var">?ws'</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="var">?ws'</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_aux_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">u</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?U</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_aux_subset<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="var">?U</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> P <span class="keyword2"><span class="keyword">and</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> None <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_interference_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
           <span class="keyword1"><span class="command">using</span></span> N
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="var">?ws'</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_set<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="var">?ws'</span>"</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>
          <span class="main">∈</span> seq_comp_failures <span class="free">Q</span> <span class="free">R</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> J<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> None <span class="main">∉</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_interference_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">∈</span> sentences <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys'</span><span class="main">)</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys'</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?xs'</span> <span class="main">@</span> <span class="main">_</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?xs'</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">R</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">R</span> <span class="var">?xs'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span>
    <span class="main">∈</span> futures <span class="free">R</span> <span class="var">?xs'</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?xs'</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span>
    <span class="main">∈</span> failures <span class="free">R</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="free">xs</span> <span class="main">@</span> <span class="var">?xs'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span> <span class="main">@</span> <span class="var">?xs'</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys'</span><span class="main">)</span> <span class="main">@</span> <span class="var">?xs'</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">@</span> <span class="var">?xs'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?xs'</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> I<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> J<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ws</span><span class="main">,</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_ref<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ws</span><span class="main">,</span> insert None <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">}</span> <span class="main">∩</span>
      ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">Q</span> <span class="free">R</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert None <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">}</span> <span class="main">∩</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span> <span class="main">=</span>
      ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ws</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">Q</span> <span class="free">R</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs'</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> F <span class="keyword2"><span class="keyword">and</span></span> I <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="var">?xs'</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">Q</span> <span class="free">R</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="var">?xs'</span><span class="main">)</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">Q</span> <span class="free">R</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_secure_aux_1"><span class="command">lemma</span></span> seq_comp_secure_aux_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">Q</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ws</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">⟹</span>
    <span class="free">ws</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> seq_comp_failures.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"None <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="skolem">X</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_secure_aux_1_case_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A C D<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span>
    ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">(</span>insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_secure_aux_1_case_2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A C D E<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ws</span> <span class="skolem">ys'</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys'</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">@</span> <span class="skolem">ys'</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="skolem">Y</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_secure_aux_1_case_3 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B C D E<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="skolem">X</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="skolem">Y</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span>
    ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="skolem">X</span> <span class="main">∪</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="skolem">Y</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_distrib_union<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_secure_1"><span class="command">lemma</span></span> seq_comp_secure_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">Q</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_secure_aux_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B C D E<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ws <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">xs</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="free"><span class="free"><span class="free">y</span></span></span> <span class="main"><span class="main"><span class="main">#</span></span></span> <span class="free"><span class="free"><span class="free">ys</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

This completes the proof that the former requirement for noninterference security is satisfied, so
it is the turn of the latter one. Again, rule induction on set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">seq_comp_failures</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is applied,
and the closure of the failures of a secure process under intransitive purge is used to meet the
proof obligations arising from rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SCF_R3›</span></span></span></span>. In more detail, rule induction is applied to the
trace into which the event is inserted, and then a case distinction is performed on the trace from
which the event is extracted, using the expression of its refusal as union of a set of refusals
derived previously.

\null
›</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_secure_aux_2_case_1"><span class="command">lemma</span></span> seq_comp_secure_aux_2_case_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">0</span><span class="main">.</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span>
      take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_refusals_1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">n</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> equals0I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">W</span>
    <span class="keyword3"><span class="command">assume</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span><span class="main">.</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
      take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">vs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span>
        drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> append_take_drop_id<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">=</span>
        take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> take_append<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span>
        <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> take_append<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> B <span class="keyword2"><span class="keyword">and</span></span> K <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> None"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_none<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> L<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> None"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{..</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> L <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∉</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equals0D<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span><span class="main">.</span>
    <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span>
      None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
    <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
        <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">W</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> None <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ex_simps<span class="main"><span class="keyword3">,</span></span>
   <span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">≠</span> <span class="free">y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">zs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span>
    futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span>
    failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> L
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F K<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">zs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_set<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span>
      M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> N<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> bexE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> None"</span></span>
         <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span>
        O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="main">∈</span> set <span class="free">zs</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">z</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_elem<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="free">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> None"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="free">zs</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
         <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">u</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> O<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">z</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">z</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">z</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> P <span class="keyword2"><span class="keyword">and</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">z</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_1<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> M <span class="keyword2"><span class="keyword">and</span></span> L <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span>
        insert None <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span>
      M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main"><span class="keyword3">,</span></span>
     <span class="operator">rule</span> ipurge_tr_del_traces <span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> u <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> traces_failures<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span>
        ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ipurge_tr.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>
        <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def ipurge_ref_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_idem<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> None <span class="main">∉</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_interference_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">)</span>
        <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_idem<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_secure_aux_2_case_2"><span class="command">lemma</span></span> seq_comp_secure_aux_2_case_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">Q</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span>
    ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">(</span>insert None <span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">0</span><span class="main">.</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span>
      take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_refusals_1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">n</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span><span class="main">.</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span>
        None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
          <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">W</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> None <span class="main">≠</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ex_simps<span class="main"><span class="keyword3">,</span></span>
     <span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> None <span class="main">≠</span> <span class="free">y</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">zs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span><span class="main">)</span>
      <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span><span class="main">)</span>
      <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> P <span class="keyword2"><span class="keyword">and</span></span> O <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span>
        insert None <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span><span class="main">)</span>
        <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">(</span>insert None <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span> <span class="main">⊆</span>
        insert None <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> insert_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">(</span>insert None <span class="free">X</span><span class="main">)</span> <span class="main">⊆</span>
          insert None <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_subset_insert<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">(</span>insert None <span class="free">X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert None <span class="main">(</span>ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span>
        ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">(</span>insert None <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span><span class="main">)</span>
        <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_prop_3<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_distrib_inter<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span>
        P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">(</span>insert None <span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Q<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> bexE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> None"</span></span>
           <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
        <span class="keyword3"><span class="command">assume</span></span>
          R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="main">∈</span> set <span class="free">zs</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">z</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_elem<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="free">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">have</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> None"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> None"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="free">zs</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">zs</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">u</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">z</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">z</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">z</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> S <span class="keyword2"><span class="keyword">and</span></span> U <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">z</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> V <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> U <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">with</span></span> O <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> P <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>
          <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">zs</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_set<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">zs</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span>
        P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> traces_failures<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span>
        ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="var">?Z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ipurge_tr.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="var">?Z</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> None <span class="main">∉</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_interference_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">n</span><span class="main">.</span>
      take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">n</span> <span class="bound">W</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span><span class="main">.</span> <span class="var">?T</span> <span class="skolem">n</span> <span class="bound">W</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">n</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
      take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">vs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span>
        drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> append_take_drop_id<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">=</span>
        take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> take_append<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span>
        <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> take_append<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> B <span class="keyword2"><span class="keyword">and</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> None"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_none<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> R<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> None"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span>
      drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> append_take_drop_id<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span>
      drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> append_take_drop_id<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> R
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> SCF_R3<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="bound">y</span> <span class="bound">ys</span> <span class="bound">Y</span> <span class="bound">zs</span> <span class="bound">Z</span><span class="main">.</span>
        <span class="main">(</span><span class="bound">y</span> <span class="main">#</span> <span class="bound">ys</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="bound">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">zs</span><span class="main">,</span> <span class="bound">Z</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="bound">xs</span> <span class="main">⟶</span>
        <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">ys</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="bound">xs</span> <span class="main">∧</span>
        <span class="main">(</span><span class="bound">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">zs</span> <span class="bound">Z</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="bound">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="main">[]</span> <span class="main">⟶</span>
        <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">[]</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="main">[]</span> <span class="main">∧</span>
        <span class="main">(</span><span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">[]</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">[]</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">[]</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="var">?Y'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>insert None <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> <span class="var">?Y'</span> <span class="main">⊆</span> <span class="var">?Y'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>insert None <span class="free">X</span><span class="main">)</span> <span class="main">∩</span> <span class="var">?Y'</span><span class="main">)</span>
        <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>insert None <span class="free">X</span> <span class="main">∩</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_distrib_inter<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_secure_aux_2_case_3"><span class="command">lemma</span></span> seq_comp_secure_aux_2_case_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">Q</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ys</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">0</span><span class="main">.</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">.</span>
      take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="bound">R</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">R</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_refusals_1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">n</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&lt;</span> length <span class="free">ws</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span><span class="main">.</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span>
        None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
      <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
          <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">W</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span><span class="main">.</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
        take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">arith</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">&lt;</span> length <span class="free">ws</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
         <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">vs</span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span>
          drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> C <span class="keyword2"><span class="keyword">and</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> None"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_none<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">ws</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> Q<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> None"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> None <span class="main">≠</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ex_simps<span class="main"><span class="keyword3">,</span></span>
     <span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> None <span class="main">≠</span> <span class="free">y</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zs</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?ws'</span> <span class="main">@</span> <span class="main">_</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">=</span>
      ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_append<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span> <span class="main">=</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="free">Y</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_append<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span><span class="main">,</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_ref_aux_failures<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span><span class="main">,</span>
        ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">,</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_ref<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword2"><span class="keyword">and</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">,</span>
          insert None <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">}</span> <span class="main">∩</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span>
          <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> P<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert None <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">}</span> <span class="main">∩</span>
          ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="free">Y</span> <span class="main">=</span> ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="free">Y</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Cons
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> P <span class="keyword2"><span class="keyword">and</span></span> Q <span class="keyword1"><span class="command">have</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">)</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span><span class="main">,</span>
            ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span> <span class="var">?ws'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">ws</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="var">?ws'</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> traces_failures<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span>
        ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="free">xs</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ipurge_tr.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def ipurge_ref_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?ws'</span> <span class="main">⊆</span> set <span class="free">ws</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_drop_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">ws</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="var">?ws'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span><span class="main">,</span>
        ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span>
       <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> S<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> bexE<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_aux_nil <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> None"</span></span>
             <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
          <span class="keyword3"><span class="command">assume</span></span>
            T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> set <span class="var">?ws'</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">w</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_elem<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="var">?ws'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">have</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> None"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> None"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="var">?ws'</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> V <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="var">?ws'</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_aux_nil <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">u</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">≠</span> None <span class="main">⟶</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> U <span class="keyword2"><span class="keyword">and</span></span> W <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> W <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_ref_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span> <span class="free">Y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> S<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> bexE<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_aux_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?U</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_aux_subset<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">y</span> <span class="main">∈</span> <span class="var">?U</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">y</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> None"</span></span>
             <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
          <span class="keyword3"><span class="command">assume</span></span>
            T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="main">∈</span> set <span class="var">?ws'</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">w</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_elem<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="var">?ws'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">have</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> None"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> None"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∈</span> set <span class="var">?ws'</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> V <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="var">?ws'</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_ref_aux_empty <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">u</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?U</span> <span class="main">⊆</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_aux_subset<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="var">?U</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">≠</span> None <span class="main">⟶</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> U <span class="keyword2"><span class="keyword">and</span></span> W <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> range <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> W <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> None <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_interference_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="var">?ws'</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_set<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>
            <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> P<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> None<span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> None <span class="main">∉</span> sinks <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinks_interference_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="var">?ws'</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="bound">n</span><span class="main">.</span>
      take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
      <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="var">?T</span> <span class="bound">n</span> <span class="bound">W</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span><span class="main">.</span>
        <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∉</span> sentences <span class="free">P</span> <span class="main">∧</span>
          None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∨</span>
        <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span> <span class="main">∧</span>
            <span class="bound">W</span> <span class="main">=</span> insert None <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="var">?T'</span> <span class="bound">W</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T'</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ex_simps<span class="main"><span class="keyword3">,</span></span>
       <span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_3<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">≠</span> <span class="free">y</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span> None <span class="main">≠</span> <span class="free">y</span> <span class="main">∧</span> None <span class="main">∉</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">@</span> take <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> length <span class="free">ws</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="bound">vs</span><span class="main">.</span> take <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> length <span class="free">ws</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">=</span> <span class="bound">v</span> <span class="main">#</span> <span class="bound">vs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> length <span class="free">ws</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span>
       <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> length <span class="free">ws</span><span class="main">)</span> <span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> C <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> None"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_none<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> None"</span></span>
       <span class="keyword1"><span class="command">using</span></span> N <span class="keyword2"><span class="keyword">and</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span><span class="main">.</span> <span class="var">?T</span> <span class="skolem">n</span> <span class="bound">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">n</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="skolem">n</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">arith</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">=</span> length <span class="free">ws</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> neq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">&lt;</span> length <span class="free">ws</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span>
        drop <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">@</span> <span class="var">?ws'</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">@</span> <span class="var">?ws'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span> <span class="var">?ws'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="var">?ws'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ws'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="bound">vs</span><span class="main">.</span> <span class="var">?ws'</span> <span class="main">=</span> <span class="bound">v</span> <span class="main">#</span> <span class="bound">vs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?ws'</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ws'</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span>
        <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> None"</span></span>
       <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_none<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">ws</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> None"</span></span>
       <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ws</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
        take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">ws</span> <span class="main">@</span>
        take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">-</span> length <span class="free">ws</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">@</span> <span class="var">?ys'</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">@</span> <span class="var">?ys'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">@</span> <span class="var">?ys'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ys'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword2"><span class="keyword">and</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="bound">vs</span><span class="main">.</span> <span class="var">?ys'</span> <span class="main">=</span> <span class="bound">v</span> <span class="main">#</span> <span class="bound">vs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?ys'</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ys'</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> C <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> None"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_sentences_none<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_seq_sentences_none<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> None"</span></span>
       <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> not_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>drop <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> O <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>drop <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?xs'</span> <span class="main">@</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="var">?xs'</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="var">?xs'</span> <span class="main">@</span> <span class="free">zs</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?xs'</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">zs</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">Q</span> <span class="var">?xs'</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span><span class="main">)</span>
      <span class="main">∈</span> futures <span class="free">Q</span> <span class="var">?xs'</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?xs'</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span><span class="main">)</span>
      <span class="main">∈</span> failures <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs'</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="var">?xs'</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span>
      ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="var">?xs'</span><span class="main">)</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span>
      ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="free">xs</span> <span class="main">@</span> <span class="var">?xs'</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">@</span> <span class="var">?xs'</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">ws</span><span class="main">)</span> <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">@</span> <span class="var">?xs'</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">@</span> <span class="var">?xs'</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_secure_aux_2"><span class="command">lemma</span></span> seq_comp_secure_aux_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">Q</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ws</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">⟹</span>
    <span class="free">ws</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Z</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> seq_comp_failures.induct<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">∉</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"None <span class="main">∉</span> set <span class="free">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="skolem">X</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_secure_aux_2_case_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A C D<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span>
    ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">(</span>insert None <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_secure_aux_2_case_2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A C D E<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ws</span> <span class="skolem">ys</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">∈</span> sentences <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="skolem">Y</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_secure_aux_2_case_3 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B C D E<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="skolem">X</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="skolem">Y</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span>
    ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="skolem">X</span> <span class="main">∪</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="skolem">Y</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_ref_distrib_union<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_secure_2"><span class="command">lemma</span></span> seq_comp_secure_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">Q</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">,</span> <span class="free">Z</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span> <span class="free">Z</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_secure_aux_2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B C D E<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ws <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">xs</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="free"><span class="free"><span class="free">zs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Finally, the target security conservation theorem can be enunciated and proven, which is done here
below. The theorem states that for any two processes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> defined over the same
alphabet containing successful termination, to which the noninterference policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and the
event-domain map <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> apply, if:

\begin{itemize}

\item
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> enforce termination security,

\item
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is refusals union closed and sequential, and

\item
both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are secure with respect to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,

\end{itemize}

then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">;</span></span> <span class="free"><span class="free">Q</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is secure as well.

\null
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> seq_comp_secure<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">Q</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"secure <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def seq_comp_futures seq_implies_weakly_seq <span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span> <span class="skolem">Y</span> <span class="skolem">zs</span> <span class="skolem">Z</span>
  <span class="keyword3"><span class="command">assume</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">,</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">ys</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">ys</span> <span class="skolem">Y</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span> <span class="main">∧</span>
    <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">zs</span> <span class="skolem">Z</span><span class="main">)</span>
      <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∧</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_secure_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B C D E F<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> failures <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_comp_failures<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="main">(</span><span class="free">P</span> <span class="main">;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_failures<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures <span class="free">P</span> <span class="free">Q</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_comp_failures<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_secure_2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B C D E G<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Generalization of the security conservation theorem to lists of processes"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The target security conservation theorem, in the basic version just proven, applies to the
sequential composition of a pair of processes. However, given an arbitrary list of processes where
each process satisfies its assumptions, the theorem could be orderly applied to the composition of
the first two processes in the list, then to the composition of the resulting process with the third
process in the list, and so on, until the last process is reached. The final outcome would be that
the sequential composition of all the processes in the list is secure.

Of course, this argument works provided that the assumptions of the theorem keep being satisfied by
the composed processes produced in each step of the recursion. But this is what indeed happens, by
virtue of the conservation of refusals union closure and sequentiality under sequential composition,
proven previously, and of the conservation of security under sequential composition, ensured by the
target theorem itself.

Therefore, the target security conservation theorem can be generalized to an arbitrary list of
processes, which is done here below. The resulting theorem states that for any nonempty list of
processes defined over the same alphabet containing successful termination, to which the
noninterference policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and the event-domain map <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> apply, if:

\begin{itemize}

\item
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> enforce termination security,

\item
each process in the list, with the possible exception of the last one, is refusals union closed and
sequential, and

\item
each process in the list is secure with respect to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,

\end{itemize}

then the sequential composition of all the processes in the list is secure as well.

As a precondition, the above conservation lemmas for weak sequentiality, refusals union closure, and
sequentiality are generalized, too.

\null
›</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_list_weakly_sequential"><span class="command">lemma</span></span> seq_comp_list_weakly_sequential <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">P</span> <span class="main">#</span> <span class="free">PS</span><span class="main">)</span><span class="main">.</span> weakly_sequential <span class="bound">X</span><span class="main">)</span> <span class="main">⟶</span>
    weakly_sequential <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="free">PS</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">PS</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_weakly_sequential<span class="main">)</span>

<span class="keyword1" id="SequentialComposition-seq_comp_list_ref_union_closed"><span class="command">lemma</span></span> seq_comp_list_ref_union_closed <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="main">(</span><span class="free">P</span> <span class="main">#</span> <span class="free">PS</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> weakly_sequential <span class="bound">X</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">P</span> <span class="main">#</span> <span class="free">PS</span><span class="main">)</span><span class="main">.</span> ref_union_closed <span class="bound">X</span><span class="main">)</span> <span class="main">⟶</span>
    ref_union_closed <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="free">PS</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">PS</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">split</span> if_split_asm<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> seq_comp_ref_union_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">PS</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option process"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="skolem">PS</span><span class="main">.</span> weakly_sequential <span class="bound">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">P</span> <span class="main">#</span> butlast <span class="skolem">PS</span><span class="main">)</span><span class="main">.</span> weakly_sequential <span class="bound">X</span><span class="main">)</span> <span class="main">⟶</span>
      ref_union_closed <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="skolem">PS</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="skolem">PS</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_list_weakly_sequential<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> set <span class="skolem">PS</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">P</span> <span class="main">#</span> butlast <span class="skolem">PS</span><span class="main">)</span><span class="main">.</span> weakly_sequential <span class="bound">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">PS</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> set <span class="skolem">PS</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_set_butlastD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="skolem">PS</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="skolem">PS</span> <span class="main">;</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_ref_union_closed<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SequentialComposition-seq_comp_list_sequential"><span class="command">lemma</span></span> seq_comp_list_sequential <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">P</span> <span class="main">#</span> <span class="free">PS</span><span class="main">)</span><span class="main">.</span> sequential <span class="bound">X</span><span class="main">)</span> <span class="main">⟶</span>
    sequential <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="free">PS</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">PS</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_sequential<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> seq_comp_list_secure <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_termination <span class="free">I</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="main">(</span><span class="free">P</span> <span class="main">#</span> <span class="free">PS</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> ref_union_closed <span class="bound">X</span> <span class="main">∧</span> sequential <span class="bound">X</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">P</span> <span class="main">#</span> <span class="free">PS</span><span class="main">)</span><span class="main">.</span> secure <span class="bound">X</span> <span class="free">I</span> <span class="free">D</span><span class="main">)</span> <span class="main">⟶</span>
      secure <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="free">PS</span><span class="main">)</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">PS</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">split</span> if_split_asm<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> seq_comp_secure <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">PS</span> <span class="skolem">Q</span>
  <span class="keyword3"><span class="command">assume</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">PS</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"sequential <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="skolem">PS</span><span class="main">.</span> ref_union_closed <span class="bound">X</span> <span class="main">∧</span> sequential <span class="bound">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="skolem">Q</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">P</span> <span class="main">#</span> butlast <span class="skolem">PS</span><span class="main">)</span><span class="main">.</span> ref_union_closed <span class="bound">X</span> <span class="main">∧</span> sequential <span class="bound">X</span><span class="main">)</span> <span class="main">⟶</span>
      secure <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="skolem">PS</span><span class="main">)</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="skolem">PS</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_list_ref_union_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> disjE<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="free">P</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">PS</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> set <span class="skolem">PS</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_set_butlastD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> E <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="skolem">X</span> <span class="main">∧</span> sequential <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sequential <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"weakly_sequential <span class="skolem">X</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_implies_weakly_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> set <span class="skolem">PS</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> E <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="skolem">X</span> <span class="main">∧</span> sequential <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequential <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="skolem">PS</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_list_sequential<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> set <span class="skolem">PS</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> E <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="skolem">X</span> <span class="main">∧</span> sequential <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sequential <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">P</span> <span class="main">#</span> butlast <span class="skolem">PS</span><span class="main">)</span><span class="main">.</span> ref_union_closed <span class="bound">X</span> <span class="main">∧</span> sequential <span class="bound">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C D<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">PS</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> set <span class="skolem">PS</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_set_butlastD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> E <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="skolem">X</span> <span class="main">∧</span> sequential <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"secure <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="skolem">PS</span><span class="main">)</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"secure <span class="main">(</span>foldl <span class="main">(;)</span> <span class="free">P</span> <span class="skolem">PS</span> <span class="main">;</span> <span class="skolem">Q</span><span class="main">)</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_secure <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Counterexamples">
<div class="head">
<h1>Theory Counterexamples</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Conservation of CSP Noninterference Security under Sequential Composition
    Author:      Pasquale Noce
                 Security Certification Specialist at Arjo Systems, Italy
                 pasquale dot noce dot lavoro at gmail dot com
                 pasquale dot noce at arjosystems dot com
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Necessity of nontrivial assumptions"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Counterexamples
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SequentialComposition.html">SequentialComposition</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

The security conservation theorem proven in this paper contains two nontrivial assumptions; namely,
the security policy must satisfy predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">secure_termination</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and the first input process
must satisfy predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sequential</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> instead of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">weakly_sequential</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> alone. This section
shows, by means of counterexamples, that both of these assumptions are necessary for the theorem to
hold.

In more detail, two counterexamples will be constructed: the former drops the termination security
assumption, whereas the latter drops the process sequentiality assumption, replacing it with weak
sequentiality alone. In both cases, all the other assumptions of the theorem keep being satisfied.

Both counterexamples make use of reflexive security policies, which is the case for any policy of
practical significance, and are based on trace set processes as defined in \cite{R3}. The security
of the processes input to sequential composition, as well as the insecurity of the resulting
process, are demonstrated by means of the Ipurge Unwinding Theorem proven in \cite{R3}.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Preliminary definitions and lemmas"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Both counterexamples will use the same type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">event</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as native type of ordinary events, as well
as the same process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as second input to sequential composition. Here below are the
definitions of these constants, followed by few useful lemmas on process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> event <span class="main">=</span> a <span class="main">|</span> b

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"event option process"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≡</span> ts_process <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Counterexamples-trace_set_snd"><span class="command">lemma</span></span> trace_set_snd<span class="main">:</span>
 <span class="quoted"><span class="quoted">"trace_set <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> failures_snd <span class="main">=</span> ts_process_failures <span class="main">[</span><span class="operator">OF</span> trace_set_snd<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> traces_snd <span class="main">=</span> ts_process_traces <span class="main">[</span><span class="operator">OF</span> trace_set_snd<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> next_events_snd <span class="main">=</span> ts_process_next_events <span class="main">[</span><span class="operator">OF</span> trace_set_snd<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> unwinding_snd <span class="main">=</span> ts_ipurge_unwinding <span class="main">[</span><span class="operator">OF</span> trace_set_snd<span class="main">]</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Necessity of termination security"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The reason why the conservation of noninterference security under sequential composition requires
the security policy to satisfy predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">secure_termination</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is that the second input process
cannot engage in its events unless the first process has terminated successfully. Thus, the ordinary
events of the first process can indirectly affect the events of the second process by affecting the
successful termination of the first process. Therefore, if an ordinary event is allowed to affect
successful termination, then the policy must allow it to affect any other event as well, which is
exactly what predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">secure_termination</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> states.

A counterexample showing the necessity of this assumption can then be constructed by defining a
reflexive policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that allows event <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some a"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to affect <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, but not
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some b"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and a deterministic process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that can engage in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> only after
engaging in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some a"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. The resulting process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="main">;</span></span> Q"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> will number
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some a<span class="main"><span class="main">,</span></span> Some b<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, but not <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some b<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, among its traces, so that event
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some a"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> affects the occurrence of event <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some b"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in contrast with policy
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, viz. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="main">;</span></span> Q"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not secure with respect to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Here below are the definitions of constants <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, followed by few useful lemmas
on process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">I<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>event option <span class="main">×</span> event option<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">I<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span>Some a<span class="main">,</span> None<span class="main">)</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"event option process"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≡</span> ts_process <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Counterexamples-trace_set_fst_1"><span class="command">lemma</span></span> trace_set_fst_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"trace_set <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> failures_fst_1 <span class="main">=</span> ts_process_failures <span class="main">[</span><span class="operator">OF</span> trace_set_fst_1<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> traces_fst_1 <span class="main">=</span> ts_process_traces <span class="main">[</span><span class="operator">OF</span> trace_set_fst_1<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> next_events_fst_1 <span class="main">=</span> ts_process_next_events <span class="main">[</span><span class="operator">OF</span> trace_set_fst_1<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> unwinding_fst_1 <span class="main">=</span> ts_ipurge_unwinding <span class="main">[</span><span class="operator">OF</span> trace_set_fst_1<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below is the proof that policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">I<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not satisfy predicate
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">secure_termination</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, whereas the remaining assumptions of the security conservation theorem
keep being satisfied. For the sake of simplicity, the identity function is used as event-domain map.

\null
›</span></span>

<span class="keyword1" id="Counterexamples-not_secure_termination_1"><span class="command">lemma</span></span> not_secure_termination_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">¬</span> secure_termination I<span class="hidden">⇩</span><sub>1</sub> id"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def I<span class="hidden">⇩</span><sub>1</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Some a"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Some b"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Counterexamples-ref_union_closed_fst_1"><span class="command">lemma</span></span> ref_union_closed_fst_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ref_union_closed P<span class="hidden">⇩</span><sub>1</sub>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> d_implies_ruc<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> P<span class="hidden">⇩</span><sub>1</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ts_process_d<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> trace_set_fst_1<span class="main">)</span>

<span class="keyword1" id="Counterexamples-sequential_fst_1"><span class="command">lemma</span></span> sequential_fst_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sequential P<span class="hidden">⇩</span><sub>1</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequential_def sentences_def P<span class="hidden">⇩</span><sub>1</sub>_def traces_fst_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff next_events_fst_1<span class="main">)</span>

<span class="keyword1" id="Counterexamples-secure_fst_1"><span class="command">lemma</span></span> secure_fst_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"secure P<span class="hidden">⇩</span><sub>1</sub> I<span class="hidden">⇩</span><sub>1</sub> id"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P<span class="hidden">⇩</span><sub>1</sub>_def unwinding_fst_1 dfc_equals_dwfc_rel_ipurge <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
 d_future_consistent_def rel_ipurge_def traces_fst_1<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
    ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
      next_dom_events <span class="main">(</span>ts_process <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">}</span><span class="main">)</span> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span>
      next_dom_events <span class="main">(</span>ts_process <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">}</span><span class="main">)</span> id <span class="skolem">u</span> <span class="skolem">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_dom_events_def next_events_fst_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some a <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None<span class="main">)</span><span class="main">}</span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some a <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None<span class="main">)</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I<span class="hidden">⇩</span><sub>1</sub>_def None<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some a <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None<span class="main">)</span><span class="main">}</span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some a <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None<span class="main">)</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I<span class="hidden">⇩</span><sub>1</sub>_def Some<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Counterexamples-secure_snd_1"><span class="command">lemma</span></span> secure_snd_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"secure Q I<span class="hidden">⇩</span><sub>1</sub> id"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def unwinding_snd dfc_equals_dwfc_rel_ipurge <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
 d_future_consistent_def rel_ipurge_def traces_snd<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
    ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
      next_dom_events <span class="main">(</span>ts_process <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">}</span><span class="main">)</span> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span>
      next_dom_events <span class="main">(</span>ts_process <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">}</span><span class="main">)</span> id <span class="skolem">u</span> <span class="skolem">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_dom_events_def next_events_snd<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some b<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some b<span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> None<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some b<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some b<span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I<span class="hidden">⇩</span><sub>1</sub>_def Some<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

In what follows, the insecurity of process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"P<span class="hidden">⇩</span><sub>1</sub> <span class="main"><span class="main">;</span></span> Q"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is demonstrated by proving that event
list <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some a<span class="main"><span class="main">,</span></span> Some b<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a trace of the process, whereas <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some b<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not.

\null
›</span></span>

<span class="keyword1" id="Counterexamples-traces_comp_1"><span class="command">lemma</span></span> traces_comp_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span> <span class="main">=</span> Domain <span class="main">(</span>seq_comp_failures P<span class="hidden">⇩</span><sub>1</sub> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> seq_comp_traces<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> seq_implies_weakly_seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sequential_fst_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Counterexamples-ref_union_closed_comp_1"><span class="command">lemma</span></span> ref_union_closed_comp_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ref_union_closed <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_ref_union_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> seq_implies_weakly_seq<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> sequential_fst_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ref_union_closed_fst_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> d_implies_ruc<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Q_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ts_process_d<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> trace_set_snd<span class="main">)</span>

<span class="keyword1" id="Counterexamples-not_secure_comp_1_aux_aux_1"><span class="command">lemma</span></span> not_secure_comp_1_aux_aux_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures P<span class="hidden">⇩</span><sub>1</sub> Q <span class="main">⟹</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[</span>Some b<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> rev_mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> seq_comp_failures.induct<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P<span class="hidden">⇩</span><sub>1</sub>_def Q_def sentences_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failures_fst_1 traces_fst_1<span class="main">)</span>

<span class="keyword1" id="Counterexamples-not_secure_comp_1_aux_1"><span class="command">lemma</span></span> not_secure_comp_1_aux_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[</span>Some b<span class="main">]</span> <span class="main">∉</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> traces_comp_1 Domain_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">drule</span> not_secure_comp_1_aux_aux_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Counterexamples-not_secure_comp_1_aux_2"><span class="command">lemma</span></span> not_secure_comp_1_aux_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[</span>Some a<span class="main">,</span> Some b<span class="main">]</span> <span class="main">∈</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> traces_comp_1 Domain_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Some a<span class="main">]</span> <span class="main">∈</span> sentences P<span class="hidden">⇩</span><sub>1</sub>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P<span class="hidden">⇩</span><sub>1</sub>_def sentences_def traces_fst_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Some b<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures Q"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def failures_snd<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Some b<span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Some a<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures P<span class="hidden">⇩</span><sub>1</sub> Q"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Some a<span class="main">,</span> Some b<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures P<span class="hidden">⇩</span><sub>1</sub> Q"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Counterexamples-not_secure_comp_1"><span class="command">lemma</span></span> not_secure_comp_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">¬</span> secure <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span> I<span class="hidden">⇩</span><sub>1</sub> id"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ipurge_unwinding<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ref_union_closed_comp_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span>
 <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fc_equals_wfc_rel_ipurge <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> future_consistent_def rel_ipurge_def
 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> disj_not1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Some b"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> process_rule_1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ys</span><span class="main">.</span> <span class="bound">ys</span> <span class="main">∈</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span> <span class="main">∧</span>
    ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="main">(</span>Some b<span class="main">)</span> <span class="main">[]</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="main">(</span>Some b<span class="main">)</span> <span class="bound">ys</span> <span class="main">∧</span>
    <span class="main">(</span>next_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some b<span class="main">)</span> <span class="main">[]</span> <span class="main">≠</span>
       next_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some b<span class="main">)</span> <span class="bound">ys</span> <span class="main">∨</span>
     ref_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some b<span class="main">)</span> <span class="main">[]</span> <span class="main">≠</span>
       ref_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some b<span class="main">)</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some a<span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> disjI1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Some a<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Some b<span class="main">]</span> <span class="main">∈</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_secure_comp_1_aux_2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Some a<span class="main">]</span> <span class="main">∈</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> process_rule_2_traces<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="main">(</span>Some b<span class="main">)</span> <span class="main">[]</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>1</sub> id <span class="main">(</span>Some b<span class="main">)</span> <span class="main">[</span>Some a<span class="main">]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"next_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some b<span class="main">)</span> <span class="main">[]</span> <span class="main">≠</span>
      next_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some b<span class="main">)</span> <span class="main">[</span>Some a<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_dom_events_def next_events_def set_eq_iff<span class="main"><span class="keyword3">,</span></span>
     <span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Some b"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_secure_comp_1_aux_1 not_secure_comp_1_aux_2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below, the previous results are used to show that constants <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">I<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">P<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Q</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">id</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> indeed constitute a counterexample to the statement obtained by removing termination
security from the assumptions of the security conservation theorem.

\null
›</span></span>

<span class="keyword1" id="Counterexamples-counterexample_1"><span class="command">lemma</span></span> counterexample_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>ref_union_closed P<span class="hidden">⇩</span><sub>1</sub> <span class="main">∧</span>
     sequential P<span class="hidden">⇩</span><sub>1</sub> <span class="main">∧</span>
     secure P<span class="hidden">⇩</span><sub>1</sub> I<span class="hidden">⇩</span><sub>1</sub> id <span class="main">∧</span>
     secure Q I<span class="hidden">⇩</span><sub>1</sub> id <span class="main">⟶</span>
   secure <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span> I<span class="hidden">⇩</span><sub>1</sub> id<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> conj_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ref_union_closed P<span class="hidden">⇩</span><sub>1</sub>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ref_union_closed_fst_1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sequential P<span class="hidden">⇩</span><sub>1</sub>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sequential_fst_1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"secure P<span class="hidden">⇩</span><sub>1</sub> I<span class="hidden">⇩</span><sub>1</sub> id"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> secure_fst_1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"secure Q I<span class="hidden">⇩</span><sub>1</sub> id"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> secure_snd_1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> secure <span class="main">(</span>P<span class="hidden">⇩</span><sub>1</sub> <span class="main">;</span> Q<span class="main">)</span> I<span class="hidden">⇩</span><sub>1</sub> id"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> not_secure_comp_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Necessity of process sequentiality"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The reason why the conservation of noninterference security under sequential composition requires
the first input process to satisfy predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sequential</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, instead of the more permissive
predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">weakly_sequential</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, is that the possibility for the first process to engage in
events alternative to successful termination entails the possibility for the resulting process to
engage in events alternative to the initial ones of the second process. Namely, the resulting
process would admit some state in which events of the first process can occur in alternative to
events of the second process. But neither process, though being secure on its own, will in general
be prepared to handle securely the alternative events added by the other process. Therefore, the
first process must not admit alternatives to successful termination, which is exactly what predicate
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sequential</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> states in addition to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">weakly_sequential</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

A counterexample showing the necessity of this assumption can then be constructed by defining a
reflexive policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that does not allow event <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some b"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to affect <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some a"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
and a deterministic process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that can engage in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some a"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in alternative to
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">None</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. The resulting process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">;</span></span> Q"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> will number both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some b<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some a<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, but not <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some b<span class="main"><span class="main">,</span></span> Some a<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, among its traces, so that event
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some b"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> affects the occurrence of event <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Some a"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in contrast with policy
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, viz. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">;</span></span> Q"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not secure with respect to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Here below are the definitions of constants <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, followed by few useful lemmas
on process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">I<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>event option <span class="main">×</span> event option<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">I<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span>None<span class="main">,</span> Some a<span class="main">)</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"event option process"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≡</span> ts_process <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Counterexamples-trace_set_fst_2"><span class="command">lemma</span></span> trace_set_fst_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"trace_set <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> failures_fst_2 <span class="main">=</span> ts_process_failures <span class="main">[</span><span class="operator">OF</span> trace_set_fst_2<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> traces_fst_2 <span class="main">=</span> ts_process_traces <span class="main">[</span><span class="operator">OF</span> trace_set_fst_2<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> next_events_fst_2 <span class="main">=</span> ts_process_next_events <span class="main">[</span><span class="operator">OF</span> trace_set_fst_2<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> unwinding_fst_2 <span class="main">=</span> ts_ipurge_unwinding <span class="main">[</span><span class="operator">OF</span> trace_set_fst_2<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below is the proof that process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">P<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not satisfy predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sequential</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, but
rather predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">weakly_sequential</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> only, whereas the remaining assumptions of the security
conservation theorem keep being satisfied. For the sake of simplicity, the identity function is used
as event-domain map.

\null
›</span></span>

<span class="keyword1" id="Counterexamples-secure_termination_2"><span class="command">lemma</span></span> secure_termination_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"secure_termination I<span class="hidden">⇩</span><sub>2</sub> id"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_termination_def I<span class="hidden">⇩</span><sub>2</sub>_def<span class="main">)</span>

<span class="keyword1" id="Counterexamples-ref_union_closed_fst_2"><span class="command">lemma</span></span> ref_union_closed_fst_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ref_union_closed P<span class="hidden">⇩</span><sub>2</sub>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> d_implies_ruc<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> P<span class="hidden">⇩</span><sub>2</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ts_process_d<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> trace_set_fst_2<span class="main">)</span>

<span class="keyword1" id="Counterexamples-weakly_sequential_fst_2"><span class="command">lemma</span></span> weakly_sequential_fst_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"weakly_sequential P<span class="hidden">⇩</span><sub>2</sub>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weakly_sequential_def P<span class="hidden">⇩</span><sub>2</sub>_def traces_fst_2<span class="main">)</span>

<span class="keyword1" id="Counterexamples-not_sequential_fst_2"><span class="command">lemma</span></span> not_sequential_fst_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">¬</span> sequential P<span class="hidden">⇩</span><sub>2</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequential_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bexI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"next_events P<span class="hidden">⇩</span><sub>2</sub> <span class="main">[]</span> <span class="main">≠</span> <span class="main">{</span>None<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> eqset_imp_iff <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Some a"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P<span class="hidden">⇩</span><sub>2</sub>_def next_events_fst_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> sentences P<span class="hidden">⇩</span><sub>2</sub>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sentences_def P<span class="hidden">⇩</span><sub>2</sub>_def traces_fst_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Counterexamples-secure_fst_2"><span class="command">lemma</span></span> secure_fst_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"secure P<span class="hidden">⇩</span><sub>2</sub> I<span class="hidden">⇩</span><sub>2</sub> id"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P<span class="hidden">⇩</span><sub>2</sub>_def unwinding_fst_2 dfc_equals_dwfc_rel_ipurge <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
 d_future_consistent_def rel_ipurge_def traces_fst_2<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
    ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
      next_dom_events <span class="main">(</span>ts_process <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">}</span><span class="main">)</span> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span>
      next_dom_events <span class="main">(</span>ts_process <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>None<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">]</span><span class="main">,</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">}</span><span class="main">)</span> id <span class="skolem">u</span> <span class="skolem">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_dom_events_def next_events_fst_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some a <span class="main">∨</span>
          <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None<span class="main">)</span><span class="main">}</span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some a <span class="main">∨</span>
          <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None<span class="main">)</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I<span class="hidden">⇩</span><sub>2</sub>_def None<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">,</span> None<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some a <span class="main">∨</span>
          <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None<span class="main">)</span><span class="main">}</span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some a <span class="main">∨</span>
          <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some a<span class="main">]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> None<span class="main">)</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I<span class="hidden">⇩</span><sub>2</sub>_def Some<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Counterexamples-secure_snd_2"><span class="command">lemma</span></span> secure_snd_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"secure Q I<span class="hidden">⇩</span><sub>2</sub> id"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def unwinding_snd dfc_equals_dwfc_rel_ipurge <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
 d_future_consistent_def rel_ipurge_def traces_snd<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
    ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
      next_dom_events <span class="main">(</span>ts_process <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">}</span><span class="main">)</span> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span>
      next_dom_events <span class="main">(</span>ts_process <span class="main">{</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">}</span><span class="main">)</span> id <span class="skolem">u</span> <span class="skolem">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_dom_events_def next_events_snd<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some b<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some b<span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> None<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
      ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">⟶</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some b<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> Some b<span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I<span class="hidden">⇩</span><sub>2</sub>_def Some<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

In what follows, the insecurity of process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"P<span class="hidden">⇩</span><sub>2</sub> <span class="main"><span class="main">;</span></span> Q"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is demonstrated by proving that event
lists <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some b<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some a<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are traces of the process, whereas
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some b<span class="main"><span class="main">,</span></span> Some a<span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not.

\null
›</span></span>

<span class="keyword1" id="Counterexamples-traces_comp_2"><span class="command">lemma</span></span> traces_comp_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span> <span class="main">=</span> Domain <span class="main">(</span>seq_comp_failures P<span class="hidden">⇩</span><sub>2</sub> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> seq_comp_traces<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> weakly_sequential_fst_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Counterexamples-ref_union_closed_comp_2"><span class="command">lemma</span></span> ref_union_closed_comp_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ref_union_closed <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> seq_comp_ref_union_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> weakly_sequential_fst_2<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> ref_union_closed_fst_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> d_implies_ruc<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Q_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ts_process_d<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> trace_set_snd<span class="main">)</span>

<span class="keyword1" id="Counterexamples-not_secure_comp_2_aux_aux_1"><span class="command">lemma</span></span> not_secure_comp_2_aux_aux_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures P<span class="hidden">⇩</span><sub>2</sub> Q <span class="main">⟹</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[</span>Some b<span class="main">,</span> Some a<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> rev_mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> seq_comp_failures.induct<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P<span class="hidden">⇩</span><sub>2</sub>_def Q_def sentences_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failures_fst_2 traces_fst_2 failures_snd<span class="main">)</span>

<span class="keyword1" id="Counterexamples-not_secure_comp_2_aux_1"><span class="command">lemma</span></span> not_secure_comp_2_aux_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[</span>Some b<span class="main">,</span> Some a<span class="main">]</span> <span class="main">∉</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> traces_comp_2 Domain_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">drule</span> not_secure_comp_2_aux_aux_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Counterexamples-not_secure_comp_2_aux_2"><span class="command">lemma</span></span> not_secure_comp_2_aux_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[</span>Some a<span class="main">]</span> <span class="main">∈</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> traces_comp_2 Domain_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Some a<span class="main">]</span> <span class="main">∈</span> sentences P<span class="hidden">⇩</span><sub>2</sub>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P<span class="hidden">⇩</span><sub>2</sub>_def sentences_def traces_fst_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Some a<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures P<span class="hidden">⇩</span><sub>2</sub>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P<span class="hidden">⇩</span><sub>2</sub>_def failures_fst_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures Q"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def failures_snd<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Some a<span class="main">]</span><span class="main">,</span> insert None <span class="main">{}</span> <span class="main">∩</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures P<span class="hidden">⇩</span><sub>2</sub> Q"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Some a<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures P<span class="hidden">⇩</span><sub>2</sub> Q"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Counterexamples-not_secure_comp_2_aux_3"><span class="command">lemma</span></span> not_secure_comp_2_aux_3<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[</span>Some b<span class="main">]</span> <span class="main">∈</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> traces_comp_2 Domain_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> sentences P<span class="hidden">⇩</span><sub>2</sub>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P<span class="hidden">⇩</span><sub>2</sub>_def sentences_def traces_fst_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Some b<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures Q"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def failures_snd<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Some b<span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="main">[</span>Some b<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures P<span class="hidden">⇩</span><sub>2</sub> Q"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SCF_R3<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Some b<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> seq_comp_failures P<span class="hidden">⇩</span><sub>2</sub> Q"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Counterexamples-not_secure_comp_2"><span class="command">lemma</span></span> not_secure_comp_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">¬</span> secure <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span> I<span class="hidden">⇩</span><sub>2</sub> id"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ipurge_unwinding<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ref_union_closed_comp_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span>
 <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fc_equals_wfc_rel_ipurge <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> future_consistent_def rel_ipurge_def
 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> disj_not1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Some a"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> process_rule_1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ys</span><span class="main">.</span> <span class="bound">ys</span> <span class="main">∈</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span> <span class="main">∧</span>
    ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="main">(</span>Some a<span class="main">)</span> <span class="main">[]</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="main">(</span>Some a<span class="main">)</span> <span class="bound">ys</span> <span class="main">∧</span>
    <span class="main">(</span>next_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some a<span class="main">)</span> <span class="main">[]</span> <span class="main">≠</span>
       next_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some a<span class="main">)</span> <span class="bound">ys</span> <span class="main">∨</span>
     ref_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some a<span class="main">)</span> <span class="main">[]</span> <span class="main">≠</span>
       ref_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some a<span class="main">)</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span>Some b<span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> disjI1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Some b<span class="main">]</span> <span class="main">∈</span> traces <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> not_secure_comp_2_aux_3<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="main">(</span>Some a<span class="main">)</span> <span class="main">[]</span> <span class="main">=</span> ipurge_tr_rev I<span class="hidden">⇩</span><sub>2</sub> id <span class="main">(</span>Some a<span class="main">)</span> <span class="main">[</span>Some b<span class="main">]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I<span class="hidden">⇩</span><sub>2</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"next_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some a<span class="main">)</span> <span class="main">[]</span> <span class="main">≠</span>
      next_dom_events <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span> id <span class="main">(</span>Some a<span class="main">)</span> <span class="main">[</span>Some b<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_dom_events_def next_events_def set_eq_iff<span class="main"><span class="keyword3">,</span></span>
     <span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Some a"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_secure_comp_2_aux_1 not_secure_comp_2_aux_2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below, the previous results are used to show that constants <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">I<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">P<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Q</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">id</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> indeed constitute a counterexample to the statement obtained by replacing process
sequentiality with weak sequentiality in the assumptions of the security conservation theorem.

\null
›</span></span>

<span class="keyword1" id="Counterexamples-counterexample_2"><span class="command">lemma</span></span> counterexample_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>secure_termination I<span class="hidden">⇩</span><sub>2</sub> id <span class="main">∧</span>
     ref_union_closed P<span class="hidden">⇩</span><sub>2</sub> <span class="main">∧</span>
     weakly_sequential P<span class="hidden">⇩</span><sub>2</sub> <span class="main">∧</span>
     secure P<span class="hidden">⇩</span><sub>2</sub> I<span class="hidden">⇩</span><sub>2</sub> id <span class="main">∧</span>
     secure Q I<span class="hidden">⇩</span><sub>2</sub> id <span class="main">⟶</span>
   secure <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span> I<span class="hidden">⇩</span><sub>2</sub> id<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> conj_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"secure_termination I<span class="hidden">⇩</span><sub>2</sub> id"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> secure_termination_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ref_union_closed P<span class="hidden">⇩</span><sub>2</sub>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ref_union_closed_fst_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"weakly_sequential P<span class="hidden">⇩</span><sub>2</sub>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weakly_sequential_fst_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"secure P<span class="hidden">⇩</span><sub>2</sub> I<span class="hidden">⇩</span><sub>2</sub> id"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> secure_fst_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"secure Q I<span class="hidden">⇩</span><sub>2</sub> id"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> secure_snd_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> secure <span class="main">(</span>P<span class="hidden">⇩</span><sub>2</sub> <span class="main">;</span> Q<span class="main">)</span> I<span class="hidden">⇩</span><sub>2</sub> id"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> not_secure_comp_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>